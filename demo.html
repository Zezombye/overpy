<!--
 * This file is part of OverPy (https://github.com/Zezombye/overpy).
 * Copyright (c) 2019 Zezombye.
 * 
 * This program is free software: you can redistribute it and/or modify  
 * it under the terms of the GNU General Public License as published by  
 * the Free Software Foundation, version 3.
 *
 * This program is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of 
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU 
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License 
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 *
-->
<!--stfu firefox -->
<meta charset="utf-8">

<style>
textarea {
	resize: vertical;
}

body, textarea {
	color: #CCCCCC;
	background-color: #222222;
	scrollbar-color: #CCCCCC #222222;
}

a {
	color: lightblue;
}

</style>

<center>
	<a href="https://github.com/Zezombye/overpy"><h1>OverPy v3.0 language demo by Zezombye</h1></a>
	<p><a href="https://github.com/Zezombye/overpy/blob/master/functions.md">Function documentation</a> | <button onclick="demoAddText();">Add example text</button> | Language: 
		<select id="languageInput">
			<option value="en-US">English</option>
			<option value="de-DE">Deutsch</option>
			<option value="es-ES">Español (EU)</option>
			<option value="es-MX">Español (AL)</option>
			<option value="fr-FR">Français</option>
			<option value="it-IT">Italiano</option>
			<option value="ja-JP">日本語</option>
			<option value="ko-KR">한국어</option>
			<option value="pl-PL">Polski</option>
			<option value="pt-BR">Português</option>
			<option value="ru-RU">Русский</option>
			<option value="zh-CN">简体中文</option>
			<option value="zh-TW">繁體中文</option>
		</select>
	</p>
    
	<div id="workshop-text" style="float:left; width:33%;">
		<p>Workshop text</p>
		<button onclick="demoDecompile()">Decompile</button>
		<textarea id="workshop-textarea" onkeyup="getTextareaLineNumber(this, 'workshop');" onmouseup="this.onkeyup();" rows="20" style="width:100%;" wrap="off"></textarea> 
		<p style="float:left;">line <span id="workshop-textarea-line-number"></span>, col <span id="workshop-textarea-col-number"></span></p>
	</div>
	
	<div id="overpy-text" style="float:left; width:33%;">
		<p>OverPy text</p>
		<button onclick="demoCompile()">Compile</button>
		<textarea id="overpy-textarea" onkeyup="getTextareaLineNumber(this, 'overpy');" onmouseup="this.onkeyup();" rows="20" style="width:100%;" wrap="off"></textarea> 
		<p style="float:left;">line <span id="overpy-textarea-line-number"></span>, col <span id="overpy-textarea-col-number"></span></p>
	</div>
	
	<div id="compiled-text" style="float:right; width:34%;">
		<p>Compiled text</p>
		<button style="visibility: hidden;">hidden</button>
		<textarea id="compiled-textarea" onkeyup="getTextareaLineNumber(this, 'compiled');" onmouseup="this.onkeyup();" rows="20" style="width:100%;" wrap="off"></textarea> 
		<p style="float:left;">line <span id="compiled-textarea-line-number"></span>, col <span id="compiled-textarea-col-number"></span></p>
	</div>
</center>


<script src="src/utils/other.js"></script>

<script src="src/doc/actions.js"></script>
<script src="src/doc/values.js"></script>
<script src="src/doc/maps.js"></script>
<script src="src/doc/heroes.js"></script>
<script src="src/doc/gamemodes.js"></script>
<script src="src/doc/constants.js"></script>
<script src="src/doc/keywords.js"></script>
<script src="src/doc/customGameSettings.js"></script>
<script src="src/doc/opy/functions.js"></script>
<script src="src/doc/opy/memberFunctions.js"></script>
<script src="src/doc/opy/preprocessing.js"></script>

<script src="src/utils/compilation.js"></script>
<script src="src/utils/decompilation.js"></script>
<script src="src/utils/file.js"></script>
<script src="src/utils/logging.js"></script>
<script src="src/utils/optimization.js"></script>
<script src="src/utils/strings.js"></script>
<script src="src/utils/translation.js"></script>
<script src="src/utils/varNames.js"></script>

<script src="src/obfuscation.js"></script>
<script src="src/globalVars.js"></script>
<script src="src/tests/decompileTest.js"></script>
<script src="src/tests/compileTest.js"></script>
<script src="src/decompiler.js"></script>
<script src="src/tokenizer.js"></script>
<script src="src/compiler.js"></script>
<script src="src/doc/stringKw.js"></script>

<script>

function getTextareaLineNumber(textarea, name) {
		
	document.getElementById(name+"-textarea-line-number").innerHTML = textarea.value.substr(0, textarea.selectionStart).split("\n").length;
	document.getElementById(name+"-textarea-col-number").innerHTML = textarea.selectionStart - textarea.value.substr(0, textarea.selectionStart).lastIndexOf("\n");
}

function demoDecompile() {
	
    var str = "";
    var language = document.getElementById("languageInput").value;
    
	try {
        str = decompileAllRules(document.getElementById("workshop-textarea").value, language);
	} catch (Error) {
		console.log(Error);
		str = "An error occurred. Press F12 (Firefox) or Ctrl+Shift+J (Chrome)";
	}
	document.getElementById("overpy-textarea").value = str;
}

function demoCompile() {
	
	var str = "";
    var language = document.getElementById("languageInput").value;
	try {
		compilationResult = compile(document.getElementById("overpy-textarea").value, language);
		str = compilationResult.result;
		if (compilationResult.encounteredWarnings.length > 0) {
			var strWarn = "/* Warnings were encountered:\n\n"
			for (var warning of compilationResult.encounteredWarnings) {
				strWarn += " - "+warning+"\n\n";
			}
			strWarn += "*/\n";
			str = strWarn+str;
		}
	} catch (Error) {
		console.log(Error);
		str = "An error occurred. Press F12 (Firefox) or Ctrl+Shift+J (Chrome)";
	}
	document.getElementById("compiled-textarea").value = str;
}

function demoAddText() {
	document.getElementById("workshop-textarea").value = decompileTest;
	document.getElementById("overpy-textarea").value = "";
	document.getElementById("compiled-textarea").value = "";
	
}

</script>