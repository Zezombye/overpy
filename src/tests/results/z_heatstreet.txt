settings
{
	main
	{
		Description: "☆ Heat Street: TALENTS Chateau Guillard! by LemonAid#11644\n★ [KFVAY] - Fight for survival against an overwhelming force. Your enemies are numerous and hunting you down. Can you survive all waves? The AI is able to play 25 different heroes, some of which have new abilities. PvE game mode suited for 1 to 5 players. \n☆ Version 3.4.6 from the classic version, featuring new enemies, abilities, and talents for every hero!\n★ Credits to: Shingen and SgtMoody\n☆ Join our Discord! discord.gg/WJr3gFC"
		Mode Name: "Heat Street: Talents - Chateau"
	}
	lobby
	{
		Map Rotation: After A Game
		Max Team 1 Players: 5
		Max Team 2 Players: 0
		Return To Lobby: Never
		Use Experimental Update If Available: Yes
	}
	modes
	{
		Team Deathmatch
		{
			enabled maps
			{
				Château Guillard
			}
		}
		General
		{
			Game Mode Start: Immediately
			Hero Limit: Off
			Kill Cam: Off
			Kill Feed: Off
			Score To Win: 1
			Spawn Health Packs: Enabled
		}
	}
	heroes
	{
		Team 1
		{
			Ultimate Generation: 50%
			Ultimate Generation - Combat: 90%
			Baptiste
			{
				Ultimate Duration: 125%
			}
			Brigitte
			{
				Damage Dealt: 115%
			}
			Hanzo
			{
				Projectile Gravity: 0%
			}
			Junker Queen
			{
				Ultimate Generation Rampage: 60%
			}
			Kiriko
			{
				Damage Dealt: 115%
			}
			Mercy
			{
				Damage Dealt: 115%
				Ultimate Generation Valkyrie: 40%
			}
			Moira
			{
				Damage Dealt: 115%
				Ultimate Generation Coalescence: 40%
			}
			Widowmaker
			{
				Ultimate Duration: 120%
			}
			Wrecking Ball
			{
				Ultimate Generation Minefield: 50%
			}
			Zarya
			{
				Damage Dealt: 73%
				Ultimate Generation Graviton Surge: 40%
			}
			Zenyatta
			{
				Damage Dealt: 120%
				Healing Dealt: 150%
				Ultimate Generation Transcendence: 60%
			}
		}
		Team 2
		{
			Ammunition Clip Size Scalar: 200%
			Ana
			{
				Biotic Grenade Cooldown Time: 10%
				Damage Dealt: 60%
				Healing Dealt: 150%
				Health: 150%
				Sleep Dart Cooldown Time: 10%
			}
			Baptiste
			{
				Damage Dealt: 46%
				Healing Dealt: 10%
				Immortality Field Cooldown Time: 10%
				Projectile Gravity: 500%
				Projectile Speed: 0%
				Regenerative Burst Cooldown Time: 10%
			}
			Bastion
			{
				Damage Dealt: 62%
				Damage Received: 70%
				Health: 500%
				Infinite Ultimate Duration: On
			}
			Brigitte
			{
				Barrier Shield Recharge Rate: 200%
				Damage Dealt: 31%
				Health: 125%
				Shield Bash: Off
				Whip Shot Cooldown Time: 10%
			}
			Cassidy
			{
				Combat Roll Cooldown Time: 10%
				Damage Dealt: 23%
				Flashbang Cooldown Time: 10%
				Health: 89%
			}
			D.Va
			{
				Boosters Cooldown Time: 10%
				Damage Dealt: 35%
				Defense Matrix Recharge Rate: 200%
				Health: 60%
			}
			Echo
			{
				Damage Dealt: 29%
				Flight Cooldown Time: 0%
				Focusing Beam Cooldown Time: 10%
				Sticky Bombs Cooldown Time: 10%
				Ultimate Ability Duplicate: Off
			}
			Genji
			{
				Damage Dealt: 91%
				Deflect Cooldown Time: 10%
				Health: 333%
				Infinite Ultimate Duration: On
				Swift Strike Cooldown Time: 10%
			}
			Hanzo
			{
				Damage Dealt: 75%
				Health: 333%
				Lunge Cooldown Time: 10%
				Storm Arrows Cooldown Time: 10%
				Storm Arrows Quantity: 12
			}
			Kiriko
			{
				Damage Dealt: 134%
				Healing Dealt: 150%
				Healing Received: 10%
				Health: 400%
				Protection Suzu Cooldown Time: 10%
				Swift Step Cooldown Time: 10%
				Swift Step Distance Scalar: 300%
			}
			Lúcio
			{
				Amp It Up Cooldown Time: 125%
				Damage Dealt: 35%
				Healing Dealt: 167%
				Healing Received: 25%
				Health: 126%
				Movement Speed: 110%
				Soundwave Cooldown Time: 125%
				Soundwave Knockback Scalar: 85%
			}
			Mei
			{
				Cryo-Freeze Cooldown Time: 250%
				Damage Dealt: 35%
				Healing Received: 200%
				Health: 222%
				No Ammunition Requirement: On
				Quick Melee: Off
				Spawn With Ultimate Ready: On
				Weapon Freeze Duration Scalar: 120%
			}
			Orisa
			{
				Damage Dealt: 30%
				Energy Javelin Cooldown Time: 10%
				Fortify Cooldown Time: 0%
				Javelin Spin Cooldown Time: 10%
			}
			Pharah
			{
				Concussive Blast Cooldown Time: 40%
				Concussive Blast Knockback Scalar: 75%
				Damage Dealt: 25%
				Health: 111%
				Hover Jets Recharge Rate: 300%
				Hover Jets Vertical Speed Scalar: 81%
				Jump Jet Acceleration Scalar: 60%
				Jump Jet Cooldown Time: 100%
			}
			Reaper
			{
				Damage Dealt: 23%
				Wraith Form Cooldown Time: 10%
			}
			Reinhardt
			{
				Charge Cooldown Time: 10%
				Damage Dealt: 136%
				Damage Received: 75%
				Fire Strike Cooldown Time: 10%
				Healing Received: 50%
				Health: 333%
				Projectile Speed: 150%
			}
			Roadhog
			{
				Chain Hook Cooldown Time: 10%
				Damage Dealt: 75%
				Damage Received: 90%
				Whole Hog Knockback Scalar: 150%
			}
			Sigma
			{
				Accretion Cooldown Time: 10%
				Accretion Knockback Scalar: 125%
				Damage Dealt: 47%
				Health: 111%
				Kinetic Grasp Cooldown Time: 10%
			}
			Soldier: 76
			{
				Biotic Field Cooldown Time: 10%
				Damage Dealt: 84%
				Healing Dealt: 125%
				Health: 300%
				Helix Rockets Cooldown Time: 0%
				Helix Rockets Knockback Scalar: 80%
				Projectile Speed: 150%
				Ultimate Duration: 125%
			}
			Sombra
			{
				Damage Dealt: 42%
				Projectile Gravity: 0%
				Translocator Cooldown Time: 10%
				Virus Cooldown Time: 10%
			}
			Torbjörn
			{
				Damage Dealt: 60%
				Damage Received: 50%
				Deploy Turret Cooldown Time: 0%
				Health: 500%
				Infinite Ultimate Duration: On
				No Ammunition Requirement: On
				Overload Cooldown Time: 10%
				Overload Duration Scalar: 500%
				Projectile Gravity: 500%
				Projectile Speed: 250%
				Spawn With Ultimate Ready: On
			}
			Tracer
			{
				Blink Cooldown Time: 150%
				Damage Dealt: 51%
				Health: 150%
				Projectile Gravity: 500%
				Projectile Speed: 0%
			}
			Widowmaker
			{
				Damage Dealt: 63%
				Grappling Hook Cooldown Time: 10%
				Health: 125%
				Ultimate Ability Infra-Sight: Off
				Ultimate Duration: 120%
				Venom Mine Cooldown Time: 10%
			}
			Wrecking Ball
			{
				Damage Dealt: 89%
				Health: 250%
				Infinite Ultimate Duration: On
				Movement Speed: 50%
				Projectile Speed: 150%
				Roll Always Active: On
			}
			Zarya
			{
				Damage Dealt: 18%
				Health: 93%
				Particle Barrier Cooldown Time: 10%
				Projected Barrier Cooldown Time: 10%
				Projectile Gravity: 40%
			}
			enabled heroes
			{
				Ashe
				Doomfist
				Junkrat
				Mercy
				Symmetra
				Winston
				Zenyatta
			}
		}
	}
	workshop
	{
		Difficulty: [1]
	}
	extensions
	{
		Buff Status Effects
		Projectiles
		Spawn More Dummy Bots
	}
}
variables {
    global:
        1: gamemode
        2: is_hard_mode_enabled
        3: Special_Thanks
        4: wave_number
        5: enable_normal_spawns
        6: special_spawns_count
        7: tier_4_spawns_block_end_t
        8: last_spawn_phase_end_t
        9: upgrade_count
        11: boss_list_1
        12: boss_list_2
        13: objective_phase_number
        14: objective_progress
        15: enable_objective_enemy_spawn
        16: iv_dom_objective_pos
        17: iv_dom_objective_all_pos_list
        18: hvt_dom_objective_killed_count
        19: hvt_call_reinforcements_end_t
        20: dom_point_A_contesters
        21: dom_point_B_contesters
        22: is_infrasight_on
        23: combatants
        24: combatants_count
        25: progress_bar_strings
        26: game_or_mutator_start_huds
        27: is_load_limit_reached
        28: is_waiting_to_remove_bot
        29: temp_1
        30: temp_2
        31: player_spawn_pos
        32: player_spawn_facing
        33: ability_shop_pos
        34: buy_menu_left_up_forward
        35: buy_menu_cam_pos
        36: buy_menu_base_pos
        37: spawn_pos_list
        38: spawn_nearest_node_idx_list
        39: nodes
        40: nodes_count
        41: edges
        42: distance_matrix
        43: elevator_nodes
        44: is_map_cg
        47: char_string
        48: aim_offset
        49: is_victory_declared
        52: is_mutator_activation_disabled
        53: is_mutator_mode_enabled
        54: money_amount
        55: money_mult
        56: diff_health_mult
        57: diff_damage_mult
        58: current_perks
        59: current_perks_huds_list
        60: mutators_list
        61: is_gmut_enabled
        62: gmut_storm_raging
        63: gmut_sympathy_gains
        64: gmut_adaptive_shield
        65: gmut_fortified
        66: mut_amped
        67: mut_hardwired
        68: mut_promotion
        69: mut_advanced_medkit
        71: mut_lock_n_load
        72: mut_emp_rounds
        73: mut_heartburn
        74: mut_deep_wounds
        75: mut_gear_upgrade
        76: mut_reinforcements
        77: mut_mutation
        78: mut_expendable
        79: mut_swan_song
        81: mut_fully_loaded
        82: mut_bulletproof
        83: gmut_list
        84: is_apocalyptic
        85: mut_count
        86: i
        87: mut_artful_dodger
        88: mut_counterstrike
        89: mut_yakuza
        90: gmut_salvation
        91: mut_low_blow
        92: gazed____
        93: length
    player:
        0: ab_player
        1: ab_var_1
        2: ab_var_2
        3: ab_var_3
        4: ab_wraith_pos
        5: sombra_stealth_timer
        6: last_damage_taken_t
        7: is_combatant
        8: is_controller_player
        9: mercy_res_button
        10: downed_start_t
        11: revivers
        12: revive_timer
        13: is_revive_slow
        14: tased_end_t
        15: is_flying
        16: is_invisible
        17: spectated_player
        18: death_cam_target
        19: is_changing_heroes
        20: in_buy_menu_start_t
        21: is_showing_active_abilities
        22: can_use_drop_in_buy_menu
        23: money_spent_amount
        24: is_pathfinding_disabled
        25: is_using_combat_pathfinding
        26: combat_pathfinding_type
        27: nav_pos
        28: nav_idx
        29: best_nav_idx
        30: dom_nav_guard_idx
        31: is_nav_reachable_node
        32: last_nav_update_t
        33: last_time_at_node_t
        34: real_speed_pos_1
        35: real_speed_pos_2
        36: last_jump_t
        37: real_speed
        38: eye_offset
        39: facing_override_direction
        40: is_wraith
        41: is_ranged
        42: can_dodge
        43: can_stagger
        44: can_quick_melee
        45: recall_block_end_t
        46: is_target_in_los
        47: target
        48: target_last_seen_pos
        49: is_ignoring_other_targets
        50: base_tier
        51: real_tier
        52: is_alive
        53: is_living_boss
        54: iv_is_portal
        55: aggression_health_threshold
        56: is_using_boss_aggression
        57: is_aggressive
        58: is_fortified
        59: fear_end_t
        60: is_hardwired
        61: soldier_espionage
        62: is_mutated
        63: is_expendable
        64: gmut_var
        65: gmut_fortified_bypass_end_t
        67: last_hit_by_shatter_t
        68: active_ab_number
        69: active_ab_cooldown
        70: active_ab_var
        71: active_ab_is_cloaked
        72: active_ab_is_frenzied
        73: active_ab_is_smoked
        74: active_ab_effect_list
        75: ab_bought_abilities_string
        76: ab_headhunter
        77: ab_quick_fix
        78: current_quick_fix_speed_bonus
        79: ab_charged
        80: ab_heavy_impact
        81: ab_second_wind
        82: ab_triage
        83: ab_resilience
        84: ab_antigens
        85: ab_haste
        86: ab_priority
        87: ab_health_bonus
        88: ab_damage_bonus
        89: ab_healing_bonus
        90: perk_mystery_swap
        91: perk_bulletstorm
        92: perk_die_hard
        93: perk_brass_knuckles
        94: perk_vampiric
        95: perk_crash_n_dash
        96: perk_golden_hour
        97: perk_super_charge
        98: perk_nemesis
        99: nemesis_killer
        100: nemesis_beam_effect
        101: perk_special_operator
        102: perk_sharpshooter
        103: perk_shockproof
        104: health_percent
        105: Damage_Dealt
        106: healing_dealt_percent
        107: Move_Speed
        108: heal_mod
        109: Slowed_until
        110: talent_text
        111: damage_mod
        112: Ability_Countdown
        113: Ability_Active
        114: Ability_Projectile1
        115: Ability_Available
        116: Ability_End
        117: Effects__
        118: i
        119: Smoked_Screen
        120: Tut_Active
        121: Swapped_Talent_Array
        122: Talent2
        123: Talent1
        124: HP_Pool
        125: Chain_Reaction_Immune
        126: Chain_Reaction_On
        127: Damage_Received
}
subroutines {
    0: update_combatants
    1: declare_victory
    2: play_incoming_sound_twice
    3: teleport_to_free_spawn
    4: nwp_teleport
    5: start_facing
    6: find_chase_target
    7: update_target_nav
    8: find_wp_near_nav
    9: check_drop
    10: upgrade_health_and_healing
    11: start_kill_remaining_phase
    12: set_random_perks
    13: iv_defend_portal
    14: mut_add_mutator
    15: disable_player
    16: enable_player
    17: open_buy_menu
    18: leave_buy_menu
    19: check_if_enough_money
    20: buy_active_ability
    21: remove_active_ability
    22: update_ab_string_and_play_sound
    23: play_purchase_confirmation_sound
    28: set_map_cg
    32: call_reinforcements
    33: Cancel_Momentum
}
rule ("Mod by LemonAid#11644, Original mode by Shingen#21859") {
    event {
        Ongoing - Global;
    }
    actions {
        Disable Inspector Recording;
    }
}

rule ("Special thanks") {
    event {
        Ongoing - Global;
    }
    actions {
        Set Global Variable(Special_Thanks, Workshop Setting Combo(Custom String("Special thanks"), Custom String("Cool people"), 10, Array(Custom String("Thank you to"), Custom String("Shingen"), Custom String("Developful"), Custom String("SgtMoody")), 0));
    }
}

rule ("Global (Init): Set Workshop Vars, Game Vars, Disable Game Components, Create Game Entities") {
    event {
        Ongoing - Global;
    }
    actions {
        "Select and initialize Gamemode"
        Set Global Variable(gamemode, Empty Array);
        If(Workshop Setting Toggle(Custom String("Enabled Game Modes"), Custom String("Invasion"), True, 0));
            Modify Global Variable(gamemode, Append To Array, 0);
        End;
        If(Workshop Setting Toggle(Custom String("Enabled Game Modes"), Custom String("High Value Target"), True, 1));
            Modify Global Variable(gamemode, Append To Array, 1);
        End;
        "Workaround: Need to reduce Slots because of spectator bug"
        If(And(Workshop Setting Toggle(Custom String("Enabled Game Modes"), Custom String("Domination"), True, 2), Compare(Number Of Slots(Color(Team 1)), <=, 7)));
            Modify Global Variable(gamemode, Append To Array, 2);
        End;
        If(Count Of(Global.gamemode));
            Set Global Variable(gamemode, Random Value In Array(Global.gamemode));
        Else;
            "Workaround: Need to reduce Slots because of spectator bug"
            Set Global Variable(gamemode, Random Integer(0, If-Then-Else(Compare(Number Of Slots(Team 1), <=, 7), 2, 1)));
        End;
        If(Compare(Global.gamemode, ==, 2));
            Set Global Variable(boss_list_1, Array(Hero(Baptiste), Hero(Cassidy), Hero(Baptiste), Hero(Echo), Hero(Zarya), Hero(Lúcio), Hero(Widowmaker), Hero(Ana), Hero(Orisa), Hero(Sigma), Hero(Tracer), Hero(Ana), Hero(Orisa), Hero(Hanzo), Hero(Genji), Hero(Brigitte), Hero(Widowmaker), Hero(Reaper), Hero(Kiriko), Hero(D.Va), Hero(Pharah), Hero(Reinhardt)));
            Set Global Variable(boss_list_2, Array(Hero(Brigitte), Hero(Sombra), Hero(Reaper), Hero(Pharah), Hero(Kiriko), Hero(Tracer), Hero(Roadhog), Hero(Zarya), Hero(Lúcio), Hero(D.Va), Hero(Kiriko), Hero(Roadhog), Hero(D.Va), Hero(Genji), Hero(Reinhardt), Hero(Mei), Hero(Cassidy), Hero(Sombra), Hero(Sigma), Hero(Echo), Hero(Brigitte), Hero(Mei)));
        Else;
            Set Global Variable(boss_list_1, Array(Hero(Cassidy), Hero(Baptiste), Hero(Lúcio), Hero(Pharah), Hero(Widowmaker), Hero(Sombra), Hero(Reaper), Hero(Ana), Hero(Echo), Hero(Mei), Hero(Zarya), Hero(Tracer), Hero(Orisa), Hero(Kiriko), Hero(Reinhardt), Hero(Brigitte), Hero(Hanzo), Hero(Genji), Hero(D.Va), Hero(Roadhog), Hero(Sigma), Hero(Reinhardt)));
        End;
        "0=Easy, 1=Normal, 2=Hard, 3=Apocalypse"
        Set Global Variable(temp_1, Workshop Setting Combo(Custom String("Settings"), Custom String("Difficulty"), 1, Array(Custom String("Easy"), Custom String("Normal"), Custom String("Hard"), Custom String("Apocalyptic")), 0));
        "100-500%"
        Set Global Variable(money_mult, Workshop Setting Integer(Custom String("Settings"), Custom String("Money Generation Scalar (in Percent)"), 100, 100, 500, 1));
        "0=15w, 1=22w"
        Set Global Variable(length, Workshop Setting Combo(Custom String("Settings"), Custom String("Game Length"), 0, Array(Custom String("15 Waves"), Custom String("22 Waves")), 2));
        Create HUD Text(All Players(All Teams), Null, Null, Custom String("{0} Difficulty{1}", Value In Array(Array(Custom String("Easy"), Custom String("Normal"), Custom String("Hard"), Custom String("Apocalyptic")), Global.temp_1), If-Then-Else(Compare(Global.money_mult, ==, 100), Custom String(""), Custom String(", +{0}% money", Subtract(Global.money_mult, 100)))), Right, -100, Null, Null, Color(Orange), Visible To, Default Visibility);
        Modify Global Variable(money_mult, Divide, 100);
        If(Compare(Global.temp_1, ==, 0));
            Set Global Variable(diff_health_mult, 0.6);
            Set Global Variable(diff_damage_mult, 0.6);
        Else If(Compare(Global.temp_1, ==, 1));
            Set Global Variable(diff_health_mult, 0.8);
            Set Global Variable(diff_damage_mult, 0.8);
        Else If(Compare(Global.temp_1, ==, 2));
            Set Global Variable(is_hard_mode_enabled, True);
            Set Global Variable(diff_health_mult, 1.15);
            Set Global Variable(diff_damage_mult, 1.15);
            Set Global Variable(mut_count, 5);
        Else;
            Set Global Variable(is_apocalyptic, 1);
            Modify Global Variable(money_mult, Multiply, 1.4);
            Set Global Variable(diff_health_mult, 1.5);
            Set Global Variable(diff_damage_mult, 1.25);
            Set Global Variable(mut_count, 5);
        End;
        Set Global Variable(gazed____, 1);
        "0=On, 1=Off"
        Set Global Variable(is_mutator_activation_disabled, 0);
        If(Compare(Global.is_mutator_activation_disabled, ==, 0));
            Set Global Variable(is_mutator_mode_enabled, True);
            Modify Global Variable(money_mult, Multiply, 2);
        End;
        Disable Built-In Game Mode Completion;
        Disable Built-In Game Mode Scoring;
        Disable Built-In Game Mode Announcer;
        Set Global Variable(progress_bar_strings, Array(Custom String("□□□□□"), Custom String("▣□□□□"), Custom String("■□□□□"), Custom String("■▣□□□"), Custom String("■■□□□"), Custom String("■■▣□□"), Custom String("■■■□□"), Custom String("■■■▣□"), Custom String("■■■■□"), Custom String("■■■■▣"), Custom String("■■■■■")));
        Set Global Variable(char_string, Custom String("0123456789!?#$%"));
        Set Global Variable(aim_offset, Vector(0, -0.5, 0));
        Set Global Variable At Index(mutators_list, 20, Null);
        Set Global Variable(mutators_list, Mapped Array(Global.mutators_list, Current Array Index));
        Set Global Variable At Index(gmut_list, 4, Null);
        Set Global Variable(gmut_list, Mapped Array(Global.gmut_list, Current Array Index));
        If(Or(Global.is_hard_mode_enabled, Global.is_apocalyptic));
            For Global Variable(i, -1, 3, 1);
                Wait(False, Ignore Condition);
                Call Subroutine(mut_add_mutator);
            End;
        End;
        "Initialize Map Specific Variables"
        If(Or(Compare(Current Map, ==, Map(Château Guillard)), Compare(Current Map, ==, Map(Château Guillard Halloween))));
            Call Subroutine(set_map_cg);
            Set Global Variable(is_map_cg, True);
        Else;
            Create HUD Text(All Players(All Teams), Custom String(" \n\n\n\n\n\n\n\n\n\n\n\n\n\n     This Map is not supported! Restart and choose a valid map.     \n\n\n\n\n\n\n\n\n\n\n\n\n\n"), Null, Null, Top, -1000, Color(Yellow), Null, Null, Visible To, Default Visibility);
        End;
        Set Global Variable(nodes_count, Count Of(Global.nodes));
        Set Global Variable At Index(buy_menu_left_up_forward, 1, Direction From Angles(Horizontal Angle From Direction(Value In Array(Global.buy_menu_left_up_forward, 2)), Subtract(Vertical Angle From Direction(Value In Array(Global.buy_menu_left_up_forward, 2)), 90)));
        Set Global Variable At Index(buy_menu_left_up_forward, 0, Cross Product(Value In Array(Global.buy_menu_left_up_forward, 1), Value In Array(Global.buy_menu_left_up_forward, 2)));
        Set Global Variable(buy_menu_base_pos, Add(Subtract(Global.buy_menu_cam_pos, Multiply(9, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(142, Value In Array(Global.buy_menu_left_up_forward, 2))));
        "Workaround: Need to reduce Slots because of spectator bug"
        If(Compare(Number Of Slots(Team 1), >, 8));
            Create HUD Text(All Players(All Teams), Custom String(" \n\n\n\n\n\n\n\n\n\n\n\n\n\n     Too many player slots! Set Max Team 1 Players to 5 or lower and restart.     \n\n\n\n\n\n\n\n\n\n\n\n\n\n"), Null, Null, Top, -1000, Color(Yellow), Null, Null, Visible To, Default Visibility);
        End;
        "Create HUDs"
        Create HUD Text(All Players(All Teams), Null, Null, Custom String("Heat Street: Talents - 3.4.6 | KFVAY - Chateau Guillard)​ ​-​ ​{0}{1}", Value In Array(Array(Custom String("Invasion"), Custom String("High Value Target"), Custom String("Domination")), Global.gamemode), If-Then-Else(Match Time, Custom String("      {0}{1}{2}", If-Then-Else(Compare(Match Time, >, 10), Custom String("0:"), Custom String("")), Round To Integer(Divide(Round To Integer(Multiply(10, Match Time), Up), 10), Down), If-Then-Else(Compare(Match Time, >, 10), Custom String(""), Custom String(".{0}", Modulo(Round To Integer(Multiply(10, Match Time), Up), 10)))), Custom String(""))), Top, -100, Null, Null, Color(White), Visible To and String, Default Visibility);
        If(Compare(Global.length, ==, 0));
            Create HUD Text(All Players(All Teams), Custom String(" Wave {0}/15 ", Global.wave_number), Null, Null, Top, -99, Color(White), Null, Null, Visible To and String, Default Visibility);
        Else If(Compare(Global.length, ==, 1));
            Create HUD Text(All Players(All Teams), Custom String(" Wave {0}/22 ", Global.wave_number), Null, Null, Top, -99, Color(White), Null, Null, Visible To and String, Default Visibility);
        End;
        If(Compare(Global.gamemode, ==, 2));
            Create HUD Text(All Players(All Teams), Null, If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Custom String(" "), Custom String(" \n\n\n")), Null, Top, -98, Null, Color(White), Null, Visible To and String, Default Visibility);
        Else;
            Create HUD Text(All Players(All Teams), Null, If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), Custom String(" "), Custom String(" \n\n\n")), Null, Top, -98, Null, Color(White), Null, Visible To and String, Default Visibility);
        End;
        Create HUD Text(Filtered Array(Global.combatants, Compare(Distance Between(Current Array Element, Global.ability_shop_pos), >, 2)), Custom String(" \n{0}\n\n Press {1} to Start \n", Value In Array(Array(Custom String("   Invasion"), Custom String("  High Value Target"), Custom String("    Domination")), Global.gamemode), Input Binding String(Button(Interact))), Null, Null, Top, -92, Color(White), Null, Null, Visible To and String, Default Visibility);
        Set Global Variable At Index(game_or_mutator_start_huds, 0, Last Text ID);
        Create HUD Text(Filtered Array(Global.combatants, Compare(Distance Between(Current Array Element, Global.ability_shop_pos), >, 2)), Null, Null, Custom String("Change the Objective in the Workshop Settings"), Top, -91, Null, Null, Color(Green), Visible To, Default Visibility);
        Set Global Variable At Index(game_or_mutator_start_huds, 1, Last Text ID);
        Create HUD Text(Filtered Array(Global.combatants, And(Not((Current Array Element).downed_start_t), Or((Current Array Element).is_changing_heroes, And(Compare(Global.objective_phase_number, ==, 0), Not((Current Array Element).in_buy_menu_start_t))))), Custom String(" \n\n\n    You can change Heroes now\n\n Hold {0} to open the Hero menu \n", Input Binding String(Button(Reload))), Null, Null, Top, -90, Color(Yellow), Null, Null, Visible To and String, Default Visibility);
        Create HUD Text(Filtered Array(Global.combatants, (Current Array Element).downed_start_t), Null, Null, Custom String("Waiting for revival. Press {0} to spectate the next player.", Input Binding String(Button(Jump))), Top, -70, Null, Null, Color(Yellow), Visible To and String, Default Visibility);
        Create HUD Text(Local Player, Null, Null, If-Then-Else((Local Player).Tut_Active, Custom String(" \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"), Custom String("Press [{0}] + [{1}] to toggle hud", Input Binding String(Button(Crouch)), Input Binding String(Button(Reload)))), Left, 9, Null, Null, Color(Orange), Visible To and String, Default Visibility);
        Create Progress Bar HUD Text(If-Then-Else(If-Then-Else((Local Player).downed_start_t, (Local Player).revive_timer, Is True For Any(Global.combatants, Array Contains((Current Array Element).revivers, Local Player))), Local Player, Empty Array), If-Then-Else((Local Player).downed_start_t, (Local Player).revive_timer, (Last Of(Sorted Array(Filtered Array(Global.combatants, Array Contains((Current Array Element).revivers, Local Player)), (Current Array Element).revive_timer))).revive_timer), If-Then-Else((Local Player).downed_start_t, Custom String("You are being revived"), Custom String("Reviving {0}", If-Then-Else(Compare(Count Of(Filtered Array(Global.combatants, Array Contains((Current Array Element).revivers, Local Player))), >, 1), Custom String("{0} Teammates", Count Of(Filtered Array(Global.combatants, Array Contains((Current Array Element).revivers, Local Player)))), First Of(Filtered Array(Global.combatants, Array Contains((Current Array Element).revivers, Local Player)))))), Top, -60, If-Then-Else(If-Then-Else((Local Player).downed_start_t, (Local Player).is_revive_slow, Is True For All(Global.combatants, Or(Not(Array Contains((Current Array Element).revivers, Local Player)), (Current Array Element).is_revive_slow))), Color(Orange), Color(Sky Blue)), Color(White), Visible To Values and Color, Default Visibility);
        Create HUD Text(If-Then-Else(Global.is_infrasight_on, All Players(All Teams), Empty Array), Custom String("{0} Enemies have improved aim!", Ability Icon String(Hero(Widowmaker), Button(Ultimate))), Null, Null, Top, -50, Color(Violet), Null, Null, Visible To, Default Visibility);
        Create HUD Text(If-Then-Else(Is True For Any(Players On Hero(Hero(Soldier: 76), Color(Team 2)), And((Current Array Element).ab_var_1, Compare((Current Array Element).target, ==, Local Player))), Local Player, Empty Array), Custom String("{0} Locked on!", Ability Icon String(Hero(Soldier: 76), Button(Ultimate))), Null, Null, Top, -49, Custom Color(Add(245, Multiply(10, Sine From Radians(Multiply(4, Total Time Elapsed)))), Add(205, Multiply(50, Sine From Radians(Multiply(4, Total Time Elapsed)))), Multiply(200, Sine From Radians(Multiply(4, Total Time Elapsed))), 255), Null, Null, Visible To and Color, Default Visibility);
        Create HUD Text(All Players(All Teams), Null, Null, Custom String(" \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"), Top, -1, Null, Null, Color(White), Visible To, Default Visibility);
        Create HUD Text(All Players(Team 2), Custom String("Server Load: {0}, Average: {1}, Peak: {2}", Server Load, Server Load Average, Server Load Peak), Null, Null, Left, -110, If-Then-Else(Global.is_waiting_to_remove_bot, Color(Yellow), Color(White)), Null, Null, Visible To String and Color, Default Visibility);
        Create HUD Text(Empty Array, Null, Custom String("Mod by Lemonaid:\nChateau Guillard: KFVAY\nKanezaka: H4H7K\nDorado: NNNS6\nEichenwalde: MH9DN\nHollywood: K3235\nMalevento: 8GRV8\\Rout"), Custom String("____\nCredits to:\n Shingen\n SgtMoody\nDevelopful\n"), Left, -1000, Color(White), Color(Lime Green), Color(Green), Visible To, Visible Always);
        "Create Sombra Stealth Timer IWT"
        Create Progress Bar In-World Text(If-Then-Else(And(Compare(Hero Of(Local Player), ==, Hero(Sombra)), (Local Player).is_invisible), Local Player, Empty Array), (Local Player).sombra_stealth_timer, Custom String("Invisible"), Update Every Frame(Add(Eye Position(Local Player), Multiply(100, Direction From Angles(Horizontal Facing Angle Of(Local Player), Add(Vertical Facing Angle Of(Local Player), 13.5))))), 1.2, Do Not Clip, Color(Purple), Color(White), Visible To Position and Values, Default Visibility);
        Set Global Variable(money_amount, 1400);
        Call Subroutine(set_random_perks);
        "Priority A: Players to Bots Damage Increase"
        Start Damage Modification(Filtered Array(All Players(Team 2), And((Current Array Element).is_target_in_los, Compare(((Current Array Element).target).ab_priority, ==, 1))), Global.combatants, 125, Receivers and Damagers);
        "Priority A: Bots to Players Damage Decrease"
        Start Damage Modification(Global.combatants, Filtered Array(All Players(Team 2), And((Current Array Element).is_target_in_los, Compare(((Current Array Element).target).ab_priority, ==, 1))), 75, Receivers and Damagers);
        "Priority C: Players to Players Healing Increase"
        Start Healing Modification(Filtered Array(Global.combatants, And(Compare(Normalized Health(Current Array Element), <=, 0.5), Compare(Add((Current Array Element).last_damage_taken_t, 2.5), >, Total Time Elapsed))), Filtered Array(Global.combatants, Compare((Current Array Element).ab_priority, ==, 3)), 140, Receivers Healers and Healing Percent);
        "Nemesis: Your Nemesis IWT"
        Create In-World Text(If-Then-Else((Local Player).nemesis_killer, Local Player, Empty Array), Custom String("Your Nemesis"), (Local Player).nemesis_killer, 1.5, Do Not Clip, Visible To and Position, Color(Team 2), Default Visibility);
        Create Effect(All Players(All Teams), Ring, Color(Sky Blue), Global.ability_shop_pos, 2, Visible To);
        Create In-World Text(All Players(All Teams), Custom String("Ability Shop"), Global.ability_shop_pos, 1.5, Do Not Clip, Visible To, Color(Sky Blue), Default Visibility);
        Create HUD Text(If-Then-Else(Or(Or(Or(Not((Local Player).is_combatant), (Local Player).downed_start_t), (Local Player).in_buy_menu_start_t), (Local Player).is_changing_heroes), Empty Array, Local Player), If-Then-Else(Compare(Distance Between(Local Player, Global.ability_shop_pos), <=, 2), If-Then-Else(Match Time, Custom String("Press {0} to buy Abilities", Input Binding String(Button(Interact))), Custom String(" \n Press {0} to buy Abilities \n", Input Binding String(Button(Interact)))), If-Then-Else(Or((Local Player).can_use_drop_in_buy_menu, Match Time), Custom String("Hold {0} to buy Abilities", Input Binding String(Button(Interact))), Custom String(""))), Null, Null, Top, -80, Color(Green), Null, Null, Visible To and String, Default Visibility);
        "Create Buy Menu IWTs, on scale 2.5 1 space is 8.5 pixels"
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("┃\n┃\n┃\n┃\n┃\n┃\n┃\n┃\n┃"), Add(Subtract(Global.buy_menu_base_pos, Multiply(21, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(90, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To, Color(White), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("┃\n┃\n┃\n┃\n┃\n┃\n┃\n┃\n┃"), Subtract(Subtract(Global.buy_menu_base_pos, Multiply(21, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(90, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To, Color(White), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Refund"), Add(Add(Global.buy_menu_base_pos, Multiply(45, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(90, First Of(Global.buy_menu_left_up_forward))), 3, Do Not Clip, Visible To, Color(Green), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("[{0}] {1}", Input Binding String(Button(Melee)), If-Then-Else((Local Player).is_showing_active_abilities, Custom String("Show passive Abilities"), Custom String("Show active Abilities"))), Add(Global.buy_menu_base_pos, Multiply(45, Value In Array(Global.buy_menu_left_up_forward, 1))), 3, Do Not Clip, Visible To and String, Color(Green), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("[{0}] Leave", Input Binding String(Button(Interact))), Subtract(Add(Global.buy_menu_base_pos, Multiply(45, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(90, First Of(Global.buy_menu_left_up_forward))), 3, Do Not Clip, Visible To and String, Color(Green), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).ab_priority, Custom String("Priority A\n  Swap"), Custom String("Priority A\n 1200$")), Add(Add(Global.buy_menu_base_pos, Multiply(20, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(112.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).ab_priority, Color(Yellow), Custom Color(0, 134, 171, 255)), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).ab_priority, Custom String("Priority B\n  Swap"), Custom String("Priority B\n 1200$")), Add(Subtract(Global.buy_menu_base_pos, Multiply(2.5, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(112.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).ab_priority, Color(Yellow), Custom Color(0, 134, 171, 255)), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).ab_priority, Custom String("Priority C\n  Swap"), Custom String("Priority C\n 1200$")), Add(Subtract(Global.buy_menu_base_pos, Multiply(25, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(112.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).ab_priority, Color(Yellow), Custom Color(0, 134, 171, 255)), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Custom String("Stim Infusion\n    Swap"), Custom String("Stim Infusion\n   1200$")), If-Then-Else((Local Player).ab_headhunter, Custom String("Headhunter II\n  800$"), Custom String("Headhunter I\n  800$"))), Add(Add(Global.buy_menu_base_pos, Multiply(20, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(67.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Color(Yellow), Color(Green)), If-Then-Else(Compare((Local Player).ab_headhunter, <, 2), Color(Green), Color(Gray))), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Custom String("Smoke Bomb\n    Swap"), Custom String("Smoke Bomb\n   1200$")), If-Then-Else((Local Player).ab_antigens, Custom String("Antigens II\n   600$"), Custom String("Antigens I\n   600$"))), Add(Subtract(Global.buy_menu_base_pos, Multiply(2.5, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(67.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Color(Yellow), Color(Green)), If-Then-Else(Compare((Local Player).ab_antigens, <, 2), Color(Green), Color(Gray))), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, Custom String(""), If-Then-Else((Local Player).ab_quick_fix, Custom String("Quick Fix II\n  700$"), Custom String("Quick Fix I\n  700$"))), Add(Subtract(Global.buy_menu_base_pos, Multiply(25, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(67.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else(Compare((Local Player).ab_quick_fix, <, 2), Color(Green), Color(Gray)), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Custom String("Cloak\n Swap"), Custom String("Cloak\n1200$")), If-Then-Else((Local Player).ab_charged, Custom String("Charged II\n  700$"), Custom String("Charged I\n  700$"))), Add(Add(Global.buy_menu_base_pos, Multiply(20, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(22.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Color(Yellow), Color(Green)), If-Then-Else(Compare((Local Player).ab_charged, <, 2), Color(Green), Color(Gray))), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Custom String("Resurgence\n   Swap"), Custom String("Resurgence\n  1200$")), If-Then-Else((Local Player).ab_haste, Custom String("Haste II\n  800$"), Custom String("Haste I\n  800$"))), Add(Subtract(Global.buy_menu_base_pos, Multiply(2.5, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(22.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Color(Yellow), Color(Green)), If-Then-Else(Compare((Local Player).ab_haste, <, 2), Color(Green), Color(Gray))), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, Custom String(""), If-Then-Else((Local Player).ab_heavy_impact, Custom String("Heavy Impact II\n  1000$"), Custom String("Heavy Impact I\n  1000$"))), Add(Subtract(Global.buy_menu_base_pos, Multiply(25, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(22.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else(Compare((Local Player).ab_heavy_impact, <, 2), Color(Green), Color(Gray)), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Custom String(" Feint\nSwap"), Custom String(" Feint\n1200$")), If-Then-Else((Local Player).ab_second_wind, Custom String("Second Wind II\n   1000$"), Custom String("Second Wind I\n   1000$"))), Subtract(Add(Global.buy_menu_base_pos, Multiply(20, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(22.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Color(Yellow), Color(Green)), If-Then-Else(Compare((Local Player).ab_second_wind, <, 2), Color(Green), Color(Gray))), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Custom String("Tear Gas\n Swap"), Custom String("Tear Gas\n   1200$")), If-Then-Else((Local Player).ab_triage, Custom String("Triage II\n  700$"), Custom String("Triage I\n  700$"))), Subtract(Subtract(Global.buy_menu_base_pos, Multiply(2.5, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(22.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Color(Yellow), Color(Green)), If-Then-Else(Compare((Local Player).ab_triage, <, 2), Color(Green), Color(Gray))), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, Custom String(""), If-Then-Else((Local Player).ab_resilience, Custom String("Resilience II\n   800$"), Custom String("Resilience I\n   800$"))), Subtract(Subtract(Global.buy_menu_base_pos, Multiply(25, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(22.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else(Compare((Local Player).ab_resilience, <, 2), Color(Green), Color(Gray)), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Custom String("Frenzy\n  Swap"), Custom String("Frenzy\n 1200$")), Custom String("+5% Health\n   500$")), Subtract(Add(Global.buy_menu_base_pos, Multiply(20, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(67.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Color(Yellow), Color(Green)), Color(Green)), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Custom String("Chain Hack\n   Swap"), Custom String("Chain Hack\n  1200$")), Custom String("+5% Damage\n  500$")), Subtract(Subtract(Global.buy_menu_base_pos, Multiply(2.5, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(67.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).is_showing_active_abilities, If-Then-Else((Local Player).active_ab_number, Color(Yellow), Color(Green)), Color(Green)), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), If-Then-Else((Local Player).is_showing_active_abilities, Custom String(""), Custom String("+5% Healing\n  500$")), Subtract(Subtract(Global.buy_menu_base_pos, Multiply(25, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(67.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To and String, Color(Green), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Limited offer!"), Subtract(Add(Global.buy_menu_base_pos, Multiply(22.5, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(112.5, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To and String, Color(White), Default Visibility);
        Create In-World Text(If-Then-Else(And((Local Player).in_buy_menu_start_t, (Local Player).is_showing_active_abilities), Local Player, Empty Array), Custom String("Hold or double tap {0} to use your active ability\n", Input Binding String(Button(Melee))), Subtract(Global.buy_menu_base_pos, Multiply(25, Value In Array(Global.buy_menu_left_up_forward, 1))), 2.5, Do Not Clip, Visible To and String, Color(White), Default Visibility);
        Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Press {0} to buy\n", Input Binding String(Button(Primary Fire))), Subtract(Subtract(Global.buy_menu_base_pos, Multiply(74, Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(55, First Of(Global.buy_menu_left_up_forward))), 2.5, Do Not Clip, Visible To and String, Color(White), Default Visibility);
        "Create Ability Entities and Cursor"
        Create In-World Text(If-Then-Else((Local Player).in_buy_menu_start_t, Local Player, Empty Array), Custom String("{0}$\n", Round To Integer(Subtract(Multiply(Global.money_mult, Global.money_amount), (Local Player).money_spent_amount), Down)), Subtract(Global.buy_menu_base_pos, Multiply(74, Value In Array(Global.buy_menu_left_up_forward, 1))), 2.5, Do Not Clip, Visible To and String, Color(White), Default Visibility);
        Create In-World Text(If-Then-Else((Local Player).in_buy_menu_start_t, Local Player, Empty Array), Custom String("▲"), Update Every Frame(Add(Subtract(Global.buy_menu_base_pos, Multiply(Add(4, Vertical Facing Angle Of(Local Player)), Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(Horizontal Facing Angle Of(Local Player), First Of(Global.buy_menu_left_up_forward)))), 4, Do Not Clip, Visible To Position and Color, Custom Color(Add(245, Multiply(10, Sine From Radians(Multiply(4, Total Time Elapsed)))), Add(205, Multiply(50, Sine From Radians(Multiply(4, Total Time Elapsed)))), Multiply(200, Sine From Radians(Multiply(4, Total Time Elapsed))), 255), Default Visibility);
        "Use Update Every Frame to avoid showing the String when the cursor is out of bounds, resulting in 0"
        Create In-World Text(Update Every Frame(If-Then-Else(And(And((Local Player).in_buy_menu_start_t, Compare(Absolute Value(Horizontal Facing Angle Of(Local Player)), <, 135)), Compare(Absolute Value(Add(Vertical Facing Angle Of(Local Player), 11.25)), <, 45)), Local Player, Empty Array)), Update Every Frame(If-Then-Else(Compare(Vertical Facing Angle Of(Local Player), <, -33.75), Value In Array(Array(Custom String("Leave Buy Menu\n"), If-Then-Else((Local Player).is_showing_active_abilities, Custom String("Swap to the passive abilities page\n"), Custom String("Swap to the active abilities page\n")), Custom String("Refund your money\n")), Round To Integer(Divide(Add(Horizontal Facing Angle Of(Local Player), 135), 90), Down)), Value In Array(Array(If-Then-Else(Compare(Vertical Facing Angle Of(Local Player), <, -11.25), Custom String("The limited offer changes every wave\n"), Value In Array(Array(Custom String("Mystery Swap: Periodically swap to a random hero with a free ult\n         Health, damage and healing is increased by 20%"), Custom String("Bulletstorm: Your weapon can hold unlimited ammo\n"), Custom String("Die Hard: Your health regeneration delay is halved\n"), Custom String("Brass Knuckles: While using quick melee you are immune to Cloakers' charge attack\n     Your quick melee attack knocks enemies{0}", Custom String(" down (15 second cooldown)")), Custom String("Vampiric: Heal for 30% of all dealt damage\n"), Custom String("Crash N' Dash: Regenerate health while moving faster than 8 meters per second\n"), Custom String("Golden Hour: You can be revived twice as fast\n"), Custom String("Supercharge: Healing allies slowly charges their ultimate\n"), Custom String("Nemesis: After going down automatically revive yourself when your killer dies\n"), Custom String("Spec Ops: Gain 50 armour and immunity to grenadier smokes\n"), Custom String("Sharpshooter: Deal 50% more damage to enemies that are further than 20 meters away\n"), Custom String("Shockproof: Gain +15% speed and pass through enemies. \nBecome immune and deflect Taser electrocution attempts"), Custom String("{0}: {1}", Value In Array((Local Player).talent_text, 1), Value In Array((Local Player).talent_text, 2)), Custom String("{0}: {1}", Value In Array((Local Player).talent_text, 3), Value In Array((Local Player).talent_text, 4))), Value In Array(Global.current_perks, Compare(Vertical Facing Angle Of(Local Player), >=, 11.25)))), Value In Array(If-Then-Else((Local Player).is_showing_active_abilities, Array(Custom String("Frenzy: Become invincible and force enemies to target you\n"), Custom String("          Chain Hack: Hack and electrocute an enemy\nCan jump to nearby enemies up to 3 times with a shorter duration after ea{0}", Custom String("ch jump")), Custom String("")), Array(Custom String("Increase your health by 5%\n"), Custom String("Increase your damage by 5%\n"), Custom String("Increase your healing by 5%\n"))), Round To Integer(Divide(Add(Vertical Facing Angle Of(Local Player), 33.75), 22.5), Down)), Value In Array(If-Then-Else((Local Player).is_showing_active_abilities, Array(Custom String("    Feint: Dodge and dash into any direction, creating an explosion from start to finish"), Custom String("Tear Gas: Launch a grenade that releases lingering noxious gas\n                 Enemies in the gas get stunned"), Custom String("")), Array(If-Then-Else((Local Player).ab_second_wind, Custom String("Second Wind II: Revive yourself when downed. Can only happen once every 60 seconds"), Custom String("Second Wind I: Revive yourself when downed. Can only happen once every 90 seconds")), If-Then-Else((Local Player).ab_triage, Custom String("Triage II: Heal 50% more to players under 50% health\n"), Custom String("Triage I: Heal 25% more to players under 50% health\n")), If-Then-Else((Local Player).ab_resilience, Custom String("          Resilience II: Receive 20% less damage\nReceive 60% less knockback and inflict 60% more"), Custom String("          Resilience I: Receive 20% less damage\nReceive 30% less knockback and inflict 30% more")))), Round To Integer(Divide(Add(Vertical Facing Angle Of(Local Player), 33.75), 22.5), Down)), Value In Array(If-Then-Else((Local Player).is_showing_active_abilities, Array(Custom String("Cloak: Become invisible and freeze nearby enemies when you become visible again\n"), Custom String("   Resurgence: Heal yourself for 300 health per second\nIf you are at full health, heal a nearby injured ally instead"), Custom String("")), Array(If-Then-Else((Local Player).ab_charged, Custom String("Charged II: Ultimates cost 30% less\n"), Custom String("Charged I: Ultimates cost 15% less\n")), If-Then-Else((Local Player).ab_haste, Custom String("  Haste II: Ability cooldown is reduced by 50%\nDoes not affect abilities with multiple charges"), Custom String("  Haste I: Ability cooldown is reduced by 25%\nDoes not affect abilities with multiple charges")), If-Then-Else((Local Player).ab_heavy_impact, Custom String("Heavy Impact II: Every hit has a chance to stun the enemy for 2 seconds\n"), Custom String("Heavy Impact I: Every hit has a chance to stun the enemy for 1 second\n")))), Round To Integer(Divide(Add(Vertical Facing Angle Of(Local Player), 33.75), 22.5), Down)), Value In Array(If-Then-Else((Local Player).is_showing_active_abilities, Array(Custom String("  Stim Infusion: Instantly start health regeneration\nGain +100% damage, +100% healing and +50% speed"), Custom String("      Smoke Bomb: Create a smoke screen\nEnemies are less accurate when targeting allies in the smoke"), Custom String("")), Array(If-Then-Else((Local Player).ab_headhunter, Custom String("Headhunter II: Critical hits deal 60% more damage\n"), Custom String("Headhunter I: Critical hits deal 30% more damage\n")), If-Then-Else((Local Player).ab_antigens, Custom String("Antigens II: Receive 40% more healing and a natural overtime heal"), Custom String("Antigens I: Receive 20% more healing and a natural overtime heal")), If-Then-Else((Local Player).ab_quick_fix, Custom String("Quick Fix II: Eliminations restore 100 HP and shortly increase speed by 30%\n"), Custom String("Quick Fix I: Eliminations restore 50 HP and shortly increase speed by 15%\n")))), Round To Integer(Divide(Add(Vertical Facing Angle Of(Local Player), 33.75), 22.5), Down)), Value In Array(Array(Custom String("    Priority A: Enemies are more likely to target you\nEnemies targeting you take 25% more and deal 25% less damage"), Custom String("         Priority B: Enemies are less likely to target you\nGain +20% damage and speed if you did not take damage in the last {0}", Custom String("3 seconds")), Custom String("  Priority C: Enemies are much less likely to target you\nHeal 40% more to allies in combat. Heal for 25% of dealt healing")), Round To Integer(Divide(Add(Vertical Facing Angle Of(Local Player), 33.75), 22.5), Down))), Round To Integer(Divide(Add(Horizontal Facing Angle Of(Local Player), 135), 45), Down)))), Subtract(Global.buy_menu_base_pos, Multiply(55, Value In Array(Global.buy_menu_left_up_forward, 1))), 2.5, Do Not Clip, Visible To and String, Color(White), Default Visibility);
        "Skip Assembling Heroes"
        Set Match Time(3);
        Wait Until(Is Game In Progress, 3.5);
        Set Match Time(0);
        "Workaround: Need to reduce Slots because of spectator bug"
        If(Compare(Number Of Slots(Team 1), <=, 8));
            Create Dummy Bot(Hero(Ana), Team 2, Global.gamemode, Vector(0, -1000, 0), Forward);
            If(Compare(Number Of Slots(Team 1), <=, 8));
                Create Dummy Bot(Hero(Roadhog), Team 2, 3, Vector(0, -1000, 0), Forward);
            End;
            If(Compare(Number Of Slots(Team 1), <=, 5));
                Create Dummy Bot(Hero(Cassidy), Team 2, 4, Vector(0, -1000, 0), Forward);
            End;
            If(Compare(Number Of Slots(Team 1), <=, 6));
                Create Dummy Bot(Hero(Cassidy), Team 2, 5, Vector(0, -1000, 0), Forward);
            End;
            Create Dummy Bot(Hero(Soldier: 76), Team 2, 6, Vector(0, -1000, 0), Forward);
            Create Dummy Bot(Hero(Soldier: 76), Team 2, 7, Vector(0, -1000, 0), Forward);
            Create Dummy Bot(Hero(Soldier: 76), Team 2, 8, Vector(0, -1000, 0), Forward);
            Create Dummy Bot(Hero(Soldier: 76), Team 2, 9, Vector(0, -1000, 0), Forward);
            Create Dummy Bot(Hero(Soldier: 76), Team 2, 10, Vector(0, -1000, 0), Forward);
        End;
        Set Global Variable(is_gmut_enabled, True);
        Wait(2, Ignore Condition);
    }
}

rule ("[Tutorial] Close HUD") {
    event {
        Ongoing - Each Player;
        All;
        All;
    }
    conditions {
        (Event Player).Tut_Active == True;
        Is Button Held(Event Player, Button(Reload)) == True;
        Is Button Held(Event Player, Button(Crouch)) == True;
        Is Alive(Event Player) == True;
    }
    actions {
        Wait(0.25, Ignore Condition);
        Set Player Variable(Event Player, Tut_Active, False);
        Small Message(Event Player, Custom String("press {0} + {1} to toggle hero changes", Input Binding String(Button(Crouch)), Input Binding String(Button(Reload))));
    }
}

rule ("[Tutorial] Open HUD") {
    event {
        Ongoing - Each Player;
        All;
        All;
    }
    conditions {
        (Event Player).Tut_Active == False;
        Is Button Held(Event Player, Button(Reload)) == True;
        Is Button Held(Event Player, Button(Crouch)) == True;
        Is Alive(Event Player) == True;
    }
    actions {
        Wait(0.25, Ignore Condition);
        Set Player Variable(Event Player, Tut_Active, True);
    }
}

rule ("Subroutine (Set Map CG): Set Spawns, Nodes, Edges, Distance Matrix, Ability Buy Location") {
    event {
        Subroutine;
        set_map_cg;
    }
    actions {
        Set Global Variable(spawn_pos_list, Array(Vector(206.454, 0.001, 70.22), Vector(221.427, 8.692, 66.933), Vector(193.658, 0.998, 67.449), Vector(229.543, 1.999, 85.875), Vector(224.599, 5.001, 110.683), Vector(199.902, 8.843, 109.823), Vector(176.589, 6.999, 66.024), Vector(212.836, 9, 81.39), Vector(228.988, 12.998, 65.82), Vector(186.82, 0.999, 87.814)));
        Set Global Variable(spawn_nearest_node_idx_list, Array(0, 24, 2, 40, 42, 35, 10, 25, 21, 7));
        Set Global Variable(nodes, Array(Vector(206.137, 0.041, 81.572), Vector(197.753, 1.002, 81.213), Vector(189.242, 0.998, 66.794), Vector(188.545, 3, 51.941), Vector(193.895, 16.5, 51.891), Vector(196.476, 16.501, 68.781), Vector(186.703, 0.999, 80.98), Vector(187.579, 0.999, 92.388), Vector(174.916, 5.001, 92.33), Vector(174.294, 5, 80.881), Vector(173.301, 6.999, 66.065), Vector(173.262, 6.998, 57.01), Vector(183.04, 7.999, 56.064), Vector(183.491, 7.999, 63.766), Vector(191.037, 7.999, 64.119), Vector(199.061, 7.998, 49.104), Vector(201.742, 7.998, 60.913), Vector(209.518, 7.998, 60.774), Vector(208.498, 9, 44.68), Vector(218.343, 12, 45.13), Vector(216.613, 14.001, 61.938), Vector(229.231, 13.001, 61.763), Vector(229.677, 9.187, 73.895), Vector(220.985, 7.998, 81.14), Vector(221.33, 9.002, 61.664), Vector(206.1, 9, 81.084), Vector(206.313, 7.999, 70.046), Vector(183.802, 5.998, 74.325), Vector(186.933, 6, 80.94), Vector(185.025, 6.001, 87.18), Vector(194.265, 8.001, 96.067), Vector(205.974, 9.025, 95.64), Vector(216.192, 7.999, 95.441), Vector(180.423, 8.998, 104.206), Vector(205.974, 8.027, 103.778), Vector(206.172, 7.998, 110.406), Vector(193.533, 9, 110.488), Vector(219.054, 5.998, 103.97), Vector(219.07, 1.998, 90.657), Vector(235.431, 1.998, 90.539), Vector(229.409, 1.999, 90.044), Vector(237.966, 3.998, 104.629), Vector(226.962, 4.284, 112.037), Vector(219.008, 0.998, 81.327), Vector(177.92, 0.002, 51.147), Vector(196.386, 16.5, 51.909), Vector(196.295, 16.5, 46.848), Vector(208.835, 16.5, 47.146)));
        Set Global Variable(edges, Array(Array(1, 43), Array(0, 2, 6, 43), Array(1, 3), Array(2, 4, 44), Array(45), Array(14, 45), Array(1, 7), Array(6, 8), Array(7, 9), Array(8, 10, 27, 29), Array(9, 11), Array(10, 12), Array(3, 11, 13), Array(12, 14, 16, 27, 29), Array(1, 3, 13, 15, 16), Array(14, 16), Array(13, 14, 15, 17, 18, 24, 26), Array(16, 18, 24, 26), Array(16, 17, 19), Array(18, 20), Array(17, 19, 21), Array(20, 22), Array(21, 23, 40), Array(22, 24, 25, 38), Array(16, 17, 23), Array(6, 23, 26), Array(16, 17, 25), Array(9, 13, 28, 29), Array(1, 27, 29), Array(9, 13, 27, 28, 30), Array(29, 31, 33, 34, 36), Array(30, 32, 34), Array(31, 38), Array(9, 30, 34), Array(30, 31, 33, 35, 37), Array(34, 36), Array(30, 35), Array(34, 38, 41), Array(37, 39, 40, 43), Array(38, 40, 41), Array(38, 39), Array(37, 39, 42), Array(35, 41), Array(0, 1, 38), Array(3), Array(3, 5, 15, 16, 46), Array(45, 47), Array(17, 19, 46)));
        Set Global Variable(distance_matrix, Array(Custom String("012346234567877667789!9878767655654563233451456710123512345676655667898767656555654563233451345621012423456765544556787656567666"), Custom String("76567434456223453210133456765443344567654545656787677545567312345432025665654332233456543434545676676656678531233232303454543212"), Custom String("23345654343343456556554556733123212346012345656667789!98787454567656643445624567323457101234545656678987676343456556554556735678"), Custom String("43456821012343454556787656523234544545566674678943445732101232343445676545412123433434566564567854434643210123454556787656523234"), Custom String("54454567767545675432355432101234344567654543434565565667778534564321244543210123233456543432323454454556667423453232353432321012"), Custom String("12234543232121234334344555633456212124234343210112234543232232345445443445622345323235345454321012234543232343456556554556733456"), Custom String("32323534434321110112343212123234544544344563345643434634545432221012343212134345655654344564456743434645545432221101234323234345"), Custom String("65565545567445675454575665654333221012343434545676676655467556785454574565654333212101232324545676676544356556785565684566765444"), Custom String("32321012333565667656743324546789445568345676544433432101223565556545632213436789334457234565433322343210112454445434521223425678"), Custom String("43434634545432221123432102234345654553233453456732345712345543332234432120145455654563233453567843434623445432221123443221034345"), Custom String("65565434456445673233463321232123233456543430112343343445556345672123462332343234344567654541012343343434456245673233463321232123"), Custom String("23345654343110123223234554534567434457443234323434456765454221012112123443445678445568554345434545567876565332101212222333436789"), Custom String("33456845545654565667898767644321032332122342678954556843212343454556787656523212301222344344678944556854323443454556787656533211"), Custom String("210121233233678955667965434554565667898767644322321012344344789!5455685543454345455678765653321232210345545567893345684543455456"), Custom String("56678987676443223212301221226789223457345456656767789!9878755433432341011231567833456845656776787889!?!9898665445433421011226789"), Custom String("33456845656776787889!?!9898665445434521102326789445679565456656767789!9878755433432231212013789!55678!665456656767789!9878755433"), Custom String("43212232310489!?112346234567767667789!987876654454345212234045674321244567876554455678765656767898788656678403454321214554543221"), Custom String("12234543232343456556554556742012543232566565433222323454343454567667665667853101544343456565433321212343232454567667654556754210")));
        Set Global Variable(elevator_nodes, Empty Array);
        If(Compare(Global.gamemode, ==, 0));
            Set Global Variable(iv_dom_objective_all_pos_list, Array(Vector(206.094, 2, 77.597), Vector(232.886, 4, 93.877), Vector(230.416, 6, 107.918), Vector(193.307, 11, 113.551), Vector(180.089, 11, 101.823), Vector(205.915, 11.043, 93.96), Vector(168.798, 7, 81.112), Vector(173.483, 9, 57.292), Vector(189.454, 5, 56.301), Vector(196.295, 18.5, 68.985), Vector(206.485, 10, 51.593), Vector(206.259, 10.999, 81.079), Vector(218.594, 10, 85.339), Vector(224.043, 3, 78.247), Vector(182.628, 3, 83.08)));
        Else If(Compare(Global.gamemode, ==, 2));
            Set Global Variable(iv_dom_objective_all_pos_list, Array(Array(Vector(201.832, 8, 52.598), Vector(218.7, 8, 82.857), 47, 23), Array(Vector(188.463, 3, 54.695), Vector(173.555, 6.997, 65.855), 14, 10), Array(Vector(192.951, 9, 112.137), Vector(168.563, 5, 81.053), 35, 9), Array(Vector(205.608, 0.039, 81.423), Vector(232.253, 2, 97.003), 28, 39), Array(Vector(206.304, 9, 81.776), Vector(185.063, 1, 82.814), 25, 7)));
        End;
        Set Global Variable(player_spawn_pos, Vector(181.974, 9, 96.862));
        Set Global Variable(player_spawn_facing, Forward);
        Set Global Variable(ability_shop_pos, Vector(182.587, 8.998, 105.229));
        Set Global Variable At Index(buy_menu_left_up_forward, 2, Forward);
        Set Global Variable(buy_menu_cam_pos, Vector(0, 900, 0));
    }
}

rule ("Team 1: Player Damage Automater (+-)") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Value In Array((Event Player).Damage_Dealt, True) != Value In Array((Event Player).Damage_Dealt, False);
    }
    actions {
        Set Player Variable At Index(Event Player, Damage_Dealt, True, Value In Array((Event Player).Damage_Dealt, False));
        Set Damage Dealt(Event Player, Value In Array((Event Player).Damage_Dealt, True));
    }
}

rule ("Team 1: Player HP Automater (+-)") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Value In Array((Event Player).health_percent, True) != Value In Array((Event Player).health_percent, False);
    }
    actions {
        Set Player Variable At Index(Event Player, health_percent, True, Value In Array((Event Player).health_percent, False));
        Set Max Health(Event Player, Value In Array((Event Player).health_percent, True));
    }
}

rule ("Team 1: Player Resistance Automater (+-)") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Value In Array((Event Player).Damage_Received, True) != Value In Array((Event Player).Damage_Received, False);
    }
    actions {
        Set Player Variable At Index(Event Player, Damage_Received, True, Value In Array((Event Player).Damage_Received, False));
        Set Damage Received(Event Player, Value In Array((Event Player).Damage_Received, True));
    }
}

rule ("Team 1: Player Move Speed Automater (+-)") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Value In Array((Event Player).Move_Speed, True) != Value In Array((Event Player).Move_Speed, False);
    }
    actions {
        Set Player Variable At Index(Event Player, Move_Speed, True, Value In Array((Event Player).Move_Speed, False));
        Set Move Speed(Event Player, Value In Array((Event Player).Move_Speed, True));
    }
}

rule ("Team 1: Player Healing Automater (+-)") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Value In Array((Event Player).healing_dealt_percent, True) != Value In Array((Event Player).healing_dealt_percent, False);
    }
    actions {
        Set Player Variable At Index(Event Player, healing_dealt_percent, True, Value In Array((Event Player).healing_dealt_percent, False));
        Set Healing Dealt(Event Player, Value In Array((Event Player).healing_dealt_percent, True));
    }
}

rule ("Team 1: Protect from One-shots if health is over 50%") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Normalized Health(Event Player) >= 0.5;
    }
    actions {
        Set Status(Event Player, Null, Unkillable, 9999);
        Wait Until(Compare(Normalized Health(Event Player), <, 0.5), 99999);
        Wait(0.4, Restart When True);
        Loop If Condition Is True;
        Clear Status(Event Player, Unkillable);
    }
}

rule ("Team 2 CG: Improve Air Movement near Jump Pad") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Global.is_map_cg == True;
        Or(Compare((Event Player).nav_idx, ==, 4), Compare((Event Player).nav_idx, ==, 45)) == True;
        (Event Player).is_alive == True;
        Is In Air(Event Player) == True;
        (Event Player).is_using_combat_pathfinding == 0;
        Horizontal Speed Of(Event Player) >= 5;
        Distance Between(Event Player, Vector(X Component Of((Event Player).nav_pos), Y Component Of(Position Of(Event Player)), Z Component Of((Event Player).nav_pos))) <= 0.5;
    }
    actions {
        Apply Impulse(Event Player, Multiply(-1, Direction From Angles(Horizontal Angle From Direction(Velocity Of(Event Player)), 0)), 0.001, To World, Cancel Contrary Motion XYZ);
        Wait(0.25, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Subroutine: Update Combatants") {
    event {
        Subroutine;
        update_combatants;
    }
    actions {
        Set Global Variable(combatants, Filtered Array(All Players(Team 1), (Current Array Element).is_combatant));
        Set Global Variable(combatants_count, Count Of(Global.combatants));
    }
}

rule ("Subroutine: Declare Victory") {
    event {
        Subroutine;
        declare_victory;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If(Global.is_victory_declared);
        Set Global Variable(is_victory_declared, True);
        Declare Team Victory(Team 1);
    }
}

rule ("Subroutine: Play Incoming Sound Twice") {
    event {
        Subroutine;
        play_incoming_sound_twice;
    }
    actions {
        Modify Team Score(Team 1, 1);
        Wait(0.6, Ignore Condition);
        Modify Team Score(Team 1, 1);
    }
}

rule ("Subroutine: Cancel player momentum") {
    event {
        Subroutine;
        Cancel_Momentum;
    }
    actions {
        Apply Impulse(Event Player, Multiply(-1, Direction From Angles(Horizontal Angle From Direction(Velocity Of(Event Player)), 0)), 0.001, To World, Cancel Contrary Motion XYZ);
    }
}

rule ("Global (First Wave): Create Mutator Start HUD, Scale Values, Set Level") {
    event {
        Ongoing - Global;
    }
    conditions {
        Global.wave_number == False;
        Is True For Any(Global.combatants, And(Is Button Held(Current Array Element, Button(Interact)), Compare(Distance Between(Current Array Element, Global.ability_shop_pos), >, 2))) == True;
    }
    actions {
        Destroy HUD Text(First Of(Global.game_or_mutator_start_huds));
        Destroy HUD Text(Value In Array(Global.game_or_mutator_start_huds, 1));
        Enable Built-In Game Mode Music;
        Set Global Variable(wave_number, 1);
        Set Ultimate Charge(Global.combatants, 0);
        Set Player Variable(All Players(Team 2), base_tier, 1);
        Set Global Variable(enable_normal_spawns, True);
        Modify Team Score(Team 1, 1);
        If(Compare(Global.gamemode, ==, 2));
            Set Global Variable(enable_objective_enemy_spawn, 2);
            Set Global Variable(iv_dom_objective_pos, Random Value In Array(Global.iv_dom_objective_all_pos_list));
            Set Global Variable(objective_progress, Array(0, 0));
        Else;
            Set Global Variable(enable_objective_enemy_spawn, True);
            Set Player Variable(Players In Slot(Global.gamemode, Team 2), base_tier, -1);
    }
}

rule ("Global (Next Wave): Revive Players, Scale Values, Set Level, Set Mutators") {
    event {
        Ongoing - Global;
    }
    conditions {
        Global.objective_phase_number == 3;
        Number Of Living Players(Team 2) == 0;
    }
    actions {
        If(And(Compare(Global.wave_number, >=, 15), Compare(Global.length, ==, 0)));
            Start Rule(declare_victory, Do Nothing);
        Else If(And(Compare(Global.wave_number, >=, 22), Compare(Global.length, ==, 1)));
            Start Rule(declare_victory, Do Nothing);
        End;
        Set Global Variable(objective_phase_number, False);
        Set Player Variable(Filtered Array(Global.combatants, And((Current Array Element).downed_start_t, Compare(Add((Current Array Element).downed_start_t, 0.1), <, Total Time Elapsed))), downed_start_t, False);
        Big Message(All Players(All Teams), Custom String("Wave cleared!"));
        Modify Global Variable(money_amount, Add, Add(If-Then-Else(Compare(Global.wave_number, >=, 2), 30, 45), Multiply(25, Global.wave_number)));
        Call Subroutine(set_random_perks);
        If(Or(And(Global.is_mutator_mode_enabled, Compare(Modulo(Global.wave_number, 2), ==, 1)), Global.is_apocalyptic));
            Skip If(Or(Global.is_hard_mode_enabled, Global.is_apocalyptic), 1);
            Modify Global Variable(mut_count, Add, 1);
            //lbl_0:
            Call Subroutine(mut_add_mutator);
            Skip If(Not(Or(Global.is_hard_mode_enabled, Global.is_apocalyptic)), 1);
            Modify Global Variable(mut_count, Add, 1);
            //lbl_1:
        End;
        Disable Built-In Game Mode Music;
        Set Match Time(20);
        Wait(0.5, Ignore Condition);
        Wait Until(Not(Match Time), 99999);
        Enable Built-In Game Mode Music;
        Modify Global Variable(wave_number, Add, 1);
        Set Global Variable(enable_normal_spawns, True);
        Modify Team Score(Team 1, 1);
        If(Compare(Global.gamemode, ==, 2));
            Set Global Variable(enable_objective_enemy_spawn, 2);
            Set Global Variable(hvt_dom_objective_killed_count, False);
            Set Global Variable(iv_dom_objective_pos, Random Value In Array(Remove From Array(Global.iv_dom_objective_all_pos_list, Global.iv_dom_objective_pos)));
            Set Global Variable(objective_progress, Array(0, 0));
        Else;
            Set Global Variable(enable_objective_enemy_spawn, True);
        End;
        If(Compare(Global.wave_number, ==, 2));
            Set Player Variable(Players In Slot(5, Team 2), base_tier, 2);
            Set Player Variable(Players In Slot(6, Team 2), base_tier, 2);
        Else If(Compare(Global.wave_number, ==, 3));
            Set Player Variable(Players In Slot(8, Team 2), base_tier, 2);
        Else If(Compare(Global.wave_number, ==, 4));
            Set Player Variable(Players In Slot(2, Team 2), base_tier, 3);
            Set Player Variable(Players In Slot(3, Team 2), base_tier, 3);
        Else If(Compare(Global.wave_number, ==, 5));
            Set Player Variable(Players In Slot(7, Team 2), base_tier, 2);
        Else If(Compare(Global.wave_number, ==, 8));
            Set Player Variable(Players In Slot(7, Team 2), base_tier, 3);
        Else If(Compare(Global.wave_number, ==, 9));
            Set Player Variable(Players In Slot(4, Team 2), base_tier, 3);
        End;
        Abort If(Not(Global.mut_expendable));
        Set Player Variable(Filtered Array(Players On Hero(Hero(Soldier: 76), Team 2), Compare((Current Array Element).base_tier, <=, 2)), is_expendable, True);
    }
}

rule ("Global: Enable normal Spawns") {
    event {
        Ongoing - Global;
    }
    conditions {
        Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)) == True;
        Global.enable_normal_spawns == False;
        Number Of Living Players(Team 2) < Number Of Players(Team 2);
    }
    actions {
        Set Global Variable(temp_1, Filtered Array(All Living Players(Team 2), Not((Current Array Element).is_living_boss)));
        Set Global Variable(temp_1, Add(Add(Multiply(2, Count Of(Filtered Array(Global.temp_1, Compare((Current Array Element).real_tier, <=, 2)))), Multiply(5, Count Of(Filtered Array(Global.temp_1, Compare((Current Array Element).real_tier, ==, 3))))), Multiply(10, Count Of(Filtered Array(Global.temp_1, Compare((Current Array Element).real_tier, ==, 4))))));
        If(Compare(Global.temp_1, <=, Max(5, Subtract(Subtract(Subtract(Total Time Elapsed, Global.last_spawn_phase_end_t), 25), Multiply(20, Divide(Count Of(Filtered Array(Global.combatants, (Current Array Element).downed_start_t)), Global.combatants_count))))));
            Wait(Subtract(If-Then-Else(Or(And(Compare(Global.gamemode, ==, 1), Compare(Global.objective_phase_number, ==, 1)), And(Compare(Global.gamemode, ==, 2), Is True For Any(All Living Players(Team 2), (Current Array Element).is_living_boss))), 11, 6), If-Then-Else(Global.mut_reinforcements, 3, 0)), Abort When False);
            Abort If Condition Is False;
            Set Global Variable(enable_normal_spawns, True);
            Modify Team Score(Team 1, 1);
        Else;
            Wait(1, Abort When False);
            Loop If Condition Is True;
    }
}

rule ("Global: Disable normal Spawns") {
    event {
        Ongoing - Global;
    }
    conditions {
        Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)) == True;
        Global.enable_normal_spawns == True;
        Number Of Living Players(Team 2) == Number Of Players(Team 2);
    }
    actions {
        Set Global Variable(enable_normal_spawns, False);
        Set Global Variable(last_spawn_phase_end_t, Total Time Elapsed);
    }
}

rule ("Global: Defeat") {
    event {
        Ongoing - Global;
    }
    conditions {
        Global.wave_number > 0;
        Is True For All(Global.combatants, (Current Array Element).downed_start_t) == True;
    }
    actions {
        Wait(2, Abort When False);
        Abort If(Global.is_victory_declared);
        Set Global Variable(is_victory_declared, True);
        Declare Team Victory(Team 2);
    }
}

rule ("Global: Anti-crash") {
    event {
        Ongoing - Global;
    }
    conditions {
        Number Of Players(Team 2) > 7;
        Server Load Average >= 255;
    }
    actions {
        Set Global Variable(is_load_limit_reached, True);
        If(And(Not(Global.is_waiting_to_remove_bot), Global.wave_number));
            Wait Until(Compare(Server Load Average, <, 255), 4);
            If(Compare(Server Load Average, >=, 255));
                Set Global Variable(is_waiting_to_remove_bot, True);
                Wait Until(Compare(Server Load Average, <, 255), 99999);
            End;
        Else;
            Wait Until(Compare(Server Load Average, <, 255), 99999);
        End;
        Set Global Variable(is_load_limit_reached, False);
    }
}

rule ("MUT Subroutine: Add Mutator") {
    event {
        Subroutine;
        mut_add_mutator;
    }
    actions {
        Set Global Variable(temp_2, Subtract(-50, Count Of(Global.mutators_list)));
        If(And(Compare(Modulo(Global.mut_count, 5), ==, 0), Compare(Global.wave_number, >, 0)));
            Big Message(All Players(All Teams), Custom String("Gamechanging Mutator added!"));
            Set Global Variable(is_gmut_enabled, True);
            Set Global Variable(temp_1, Random Value In Array(Global.gmut_list));
            Modify Global Variable(gmut_list, Remove From Array By Value, Global.temp_1);
            If(Compare(Global.temp_1, ==, 0));
                Set Global Variable(gmut_storm_raging, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Storm Raging: Some enemies are enraged, killing them spreads the rage"), Null, Right, Subtract(Global.temp_2, 0.5), Null, Color(Orange), Null, Visible To, Default Visibility);
                Start Damage Modification(Global.combatants, Filtered Array(All Players(Team 2), (Current Array Element).gmut_var), 140, Receivers and Damagers);
            Else If(Compare(Global.temp_1, ==, 1));
                Set Global Variable(gmut_sympathy_gains, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Sympathy Gains: Killing enemies heals other nearby enemies"), Null, Right, Subtract(Global.temp_2, 0.5), Null, Color(Orange), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 2));
                Set Global Variable(gmut_adaptive_shield, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Adaptive Shield: Enemies below 50% HP gain shields for every nearby player"), Null, Right, Subtract(Global.temp_2, 0.5), Null, Color(Orange), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 3));
                Set Global Variable(gmut_fortified, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Fortified: Enemies resist stuns, knockbacks, and gain extra armour"), Null, Right, Subtract(Global.temp_2, 0.5), Null, Color(Orange), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 4));
                Set Global Variable(gmut_salvation, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Salvation: Enemies heal themselves a small amount when they die"), Null, Right, Subtract(Global.temp_2, 0.5), Null, Color(Orange), Null, Visible To, Default Visibility);
            End;
        Else If(Count Of(Global.mutators_list));
            Big Message(All Players(All Teams), Custom String("New Mutator added!"));
            Set Global Variable(temp_1, Random Value In Array(Global.mutators_list));
            Modify Global Variable(mutators_list, Remove From Array By Value, Global.temp_1);
            If(Compare(Global.temp_1, ==, 0));
                Set Global Variable(mut_amped, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Stampede: Enemies move faster"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 1));
                Set Global Variable(mut_hardwired, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Hardwired: Mechanical enemies gain shields and resist fear & electrocution"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 2));
                Set Global Variable(mut_promotion, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Promotion: Higher tier heroes spawn more frequently"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 3));
                Set Global Variable(mut_advanced_medkit, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Advanced Medkit: Medics can revive tier 4 enemies and have less cooldown"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 4));
                Create HUD Text(All Players(All Teams), Null, Custom String("Berserk: Enemies below 50% health deal 25% more damage"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
                Start Damage Modification(Global.combatants, Filtered Array(All Players(Team 2), Compare(Normalized Health(Current Array Element), <=, 0.5)), 125, Receivers and Damagers);
            Else If(Compare(Global.temp_1, ==, 5));
                Create HUD Text(All Players(All Teams), Null, Custom String("Regeneration: Enemies slowly regenerate health"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
                Start Heal Over Time(All Players(Team 2), Null, 9999, 10);
            Else If(Compare(Global.temp_1, ==, 6));
                Set Global Variable(mut_yakuza, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Yakuza: Shinobis, Bowmasters, and Yokais gain more health and spawn as tier 3 enemies"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 7));
                Set Global Variable(mut_emp_rounds, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("EMP Rounds: Enemies deal double damage to barriers and objects"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
                Start Damage Modification(Global.combatants, All Players(Team 2), 50, Receivers and Damagers);
            Else If(Compare(Global.temp_1, ==, 8));
                Set Global Variable(mut_heartburn, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Heartburn: Healing in combat is reduced by 30%"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
                Start Healing Modification(Filtered Array(Global.combatants, Compare(Add((Current Array Element).last_damage_taken_t, Multiply(If-Then-Else((Current Array Element).perk_die_hard, 0.5, 1), If-Then-Else(Global.mut_deep_wounds, 5, 2.5))), >, Total Time Elapsed)), Global.combatants, 70, Receivers Healers and Healing Percent);
            Else If(Compare(Global.temp_1, ==, 9));
                Set Global Variable(mut_deep_wounds, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Deep Wounds: Health regeneration delay is doubled"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 10));
                Set Global Variable(mut_gear_upgrade, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Gear Upgrade: All Troopers are replaced with Heavy Troopers"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 11));
                Create HUD Text(All Players(All Teams), Null, Custom String("Last Men Standing: The final enemies take 25% less damage"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
                Start Damage Modification(All Players(Team 2), Global.combatants, If-Then-Else(Compare(Global.objective_phase_number, ==, 3), 75, 100), Receivers Damagers and Damage Percent);
            Else If(Compare(Global.temp_1, ==, 12));
                Set Global Variable(mut_reinforcements, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Reinforcements: Enemy spawn rate is increased"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 13));
                Set Global Variable(mut_mutation, Total Time Elapsed);
                Create HUD Text(All Players(All Teams), Null, Custom String("Mutation: Some enemies spawn with increased strength and size"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 14));
                Set Global Variable(mut_expendable, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Expendable: Dead Troopers are replaced almost instantly"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 15));
                Set Global Variable(mut_counterstrike, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Counterstrike: Enemies can retreat from ultimates and counter back with their own"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 16));
                Set Global Variable(mut_swan_song, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Swan Song: Boss enemies continue fighting for 5 seconds before going down"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 17));
                Set Global Variable(mut_bulletproof, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Bulletproof: Tier 2 enemies gain an additional layer of overhealth"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 18));
                Set Global Variable(mut_fully_loaded, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Lock N' Load: Enemies can use additional abilities and have a higher clip size"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            Else If(Compare(Global.temp_1, ==, 19));
                Set Global Variable(mut_low_blow, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Low Blow: Enemy knockback attacks double in damage and knockback"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
                Set Knockback Dealt(All Players(Team 2), 200);
            Else If(Compare(Global.temp_1, ==, 20));
                Set Global Variable(mut_artful_dodger, True);
                Create HUD Text(All Players(All Teams), Null, Custom String("Artful Dodger: Enemies can dodge attacks more often and easily"), Null, Right, Global.temp_2, Null, Color(Green), Null, Visible To, Default Visibility);
            End;
        End;
    }
}

rule ("Subroutine: Set Random Perks") {
    event {
        Subroutine;
        set_random_perks;
    }
    actions {
        If(Count Of(Global.current_perks_huds_list));
            Destroy In-World Text(First Of(Global.current_perks_huds_list));
            Destroy In-World Text(Value In Array(Global.current_perks_huds_list, 1));
        End;
        Set Global Variable(current_perks_huds_list, Empty Array);
        If(Compare(Modulo(Global.wave_number, 4), ==, 1));
            Set Global Variable(current_perks, Array Slice(Randomized Array(Remove From Array(Array(12, 13), Global.current_perks)), 0, 2));
            For Global Variable(temp_1, 0, 2, 1);
                Set Global Variable(temp_2, Subtract(Subtract(Global.buy_menu_base_pos, Multiply(If-Then-Else(Global.temp_1, 25, 2.5), Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(112.5, First Of(Global.buy_menu_left_up_forward))));
                If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 12));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Hero Talent 1\n      $1600"), Global.temp_2, 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).Talent1, Color(Gray), Color(Purple)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 13));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Hero Talent 2\n      $1600"), Global.temp_2, 2.5, Do Not Clip, Visible To String and Color, If-Then-Else((Local Player).Talent2, Color(Gray), Color(Purple)), Default Visibility);
                End;
                Modify Global Variable(current_perks_huds_list, Append To Array, Last Text ID);
            End;
        Else;
            Set Global Variable(current_perks, Array Slice(Randomized Array(Remove From Array(Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11), Global.current_perks)), 0, 2));
            For Global Variable(temp_1, 0, 2, 1);
                Set Global Variable(temp_2, Subtract(Subtract(Global.buy_menu_base_pos, Multiply(If-Then-Else(Global.temp_1, 25, 2.5), Value In Array(Global.buy_menu_left_up_forward, 1))), Multiply(112.5, First Of(Global.buy_menu_left_up_forward))));
                If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 0));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Mystery Swap\n     500$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_mystery_swap, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 1));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Bulletstorm\n   1000$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_bulletstorm, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 2));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Die Hard\n 700$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_die_hard, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 3));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("  Brass Knuckles\n     700$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_brass_knuckles, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 4));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Vampiric\n   1000$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_vampiric, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 5));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Crash N' Dash\n      700$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_crash_n_dash, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 6));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Golden Hour\n    1000$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_golden_hour, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 7));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Supercharge\n        700$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_super_charge, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 8));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Nemesis\n   800$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_nemesis, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 9));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Spec Ops\n 600$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_special_operator, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 10));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Sharpshooter\n   900$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_sharpshooter, Color(Gray), Color(Lime Green)), Default Visibility);
                Else If(Compare(Value In Array(Global.current_perks, Global.temp_1), ==, 11));
                    Create In-World Text(Filtered Array(Global.combatants, (Current Array Element).in_buy_menu_start_t), Custom String("Shockproof\n        700$"), Global.temp_2, 2.5, Do Not Clip, Visible To and Color, If-Then-Else((Local Player).perk_shockproof, Color(Gray), Color(Lime Green)), Default Visibility);
                End;
                Modify Global Variable(current_perks_huds_list, Append To Array, Last Text ID);
            End;
        End;
    }
}

rule ("Subroutine: Disable Player") {
    event {
        Subroutine;
        disable_player;
    }
    actions {
        Start Forcing Throttle(Event Player, False, 0.1, False, 0.1, False, 0.1);
        Set Primary Fire Enabled(Event Player, False);
        Set Secondary Fire Enabled(Event Player, False);
        Set Ability 1 Enabled(Event Player, False);
        Set Ability 2 Enabled(Event Player, False);
        Set Melee Enabled(Event Player, False);
        Set Jump Enabled(Event Player, False);
        Set Crouch Enabled(Event Player, False);
        Disallow Button(Event Player, Button(Ultimate));
    }
}

rule ("Subroutine: Enable Player") {
    event {
        Subroutine;
        enable_player;
    }
    actions {
        Stop Forcing Throttle(Event Player);
        Set Primary Fire Enabled(Event Player, True);
        Set Secondary Fire Enabled(Event Player, True);
        Set Ability 1 Enabled(Event Player, True);
        Set Ability 2 Enabled(Event Player, True);
        Set Melee Enabled(Event Player, True);
        Set Jump Enabled(Event Player, True);
        Set Crouch Enabled(Event Player, True);
        Allow Button(Event Player, Button(Ultimate));
    }
}

rule ("Subroutine: Open Buy Menu, Last Facing (3)") {
    event {
        Subroutine;
        open_buy_menu;
    }
    actions {
        Abort If(Or(Or(Or((Event Player).downed_start_t, Compare(Normalized Health(Event Player), <, 0.5)), Has Status(Event Player, Stunned)), Compare((Event Player).tased_end_t, >=, Total Time Elapsed)));
        Apply Impulse(Event Player, Multiply(-1, Direction From Angles(Horizontal Angle From Direction(Velocity Of(Event Player)), False)), 0.001, To World, Cancel Contrary Motion XYZ);
        Set Player Variable(Event Player, ab_var_3, Facing Direction Of(Event Player));
        Set Player Variable(Event Player, in_buy_menu_start_t, Total Time Elapsed);
        Disable Hero HUD(Event Player);
        Set Facing(Event Player, Forward, To World);
        Start Camera(Event Player, Global.buy_menu_cam_pos, Add(Global.buy_menu_cam_pos, Value In Array(Global.buy_menu_left_up_forward, 2)), 0);
        Call Subroutine(disable_player);
        Set Aim Speed(Event Player, 200);
    }
}

rule ("Subroutine: Leave Buy Menu") {
    event {
        Subroutine;
        leave_buy_menu;
    }
    actions {
        Set Player Variable(Event Player, in_buy_menu_start_t, False);
        Enable Hero HUD(Event Player);
        Set Facing(Event Player, (Event Player).ab_var_3, To World);
        If(Not((Event Player).downed_start_t));
            Stop Camera(Event Player);
            Call Subroutine(enable_player);
        End;
        Set Aim Speed(Event Player, 100);
    }
}

rule ("Team 1 Button: Interact, Open / Leave Buy Menu") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Is Button Held(Event Player, Button(Interact)) == True;
    }
    actions {
        If((Event Player).in_buy_menu_start_t);
            Call Subroutine(leave_buy_menu);
        Else If(Compare(Distance Between(Event Player, Global.ability_shop_pos), <=, 2));
            Call Subroutine(open_buy_menu);
        Else If(Or((Event Player).can_use_drop_in_buy_menu, Match Time));
            Wait(0.4, Abort When False);
            Call Subroutine(open_buy_menu);
        End;
        Wait(0.05, Ignore Condition);
    }
}

rule ("Team 1: Leave Buy Menu when downed, health low, stunned or tased") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).in_buy_menu_start_t == True;
        Or(Or(Or((Event Player).downed_start_t, Compare(Normalized Health(Event Player), <, 0.5)), Has Status(Event Player, Stunned)), Compare((Event Player).tased_end_t, >=, Total Time Elapsed)) == True;
    }
    actions {
        Call Subroutine(leave_buy_menu);
        Abort If(Compare(Normalized Health(Event Player), >, 0.4));
        Set Player Health(Event Player, Multiply(0.4, Max Health(Event Player)));
    }
}

rule ("Team 1: Toggle Show active Ability") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).in_buy_menu_start_t == True;
        Is Button Held(Event Player, Button(Melee)) == True;
    }
    actions {
        Abort If(Compare(Add((Event Player).in_buy_menu_start_t, 0.1), >=, Total Time Elapsed));
        Set Player Variable(Event Player, is_showing_active_abilities, Not((Event Player).is_showing_active_abilities));
    }
}

rule ("Subroutine: Check if enough money") {
    event {
        Subroutine;
        check_if_enough_money;
    }
    actions {
        If(Compare(Subtract(Multiply(Global.money_mult, Global.money_amount), (Event Player).money_spent_amount), >=, Global.temp_2));
            Modify Player Variable(Event Player, money_spent_amount, Add, Global.temp_2);
            Small Message(Event Player, Custom String("Ability unlocked"));
            Call Subroutine(play_purchase_confirmation_sound);
        Else;
            Set Global Variable(temp_2, False);
            Small Message(Event Player, Custom String("Not enough money"));
        End;
    }
}

rule ("Subroutine: Buy Active Ability") {
    event {
        Subroutine;
        buy_active_ability;
    }
    actions {
        If(Not((Event Player).active_ab_number));
            Set Global Variable(temp_2, 1200);
            Call Subroutine(check_if_enough_money);
            Abort If(Not(Global.temp_2));
        Else If(Compare(Global.temp_1, ==, (Event Player).active_ab_number));
            Abort;
        Else;
            Small Message(Event Player, Custom String("Swapped Active Ability"));
        End;
        Call Subroutine(remove_active_ability);
        Set Player Variable(Event Player, active_ab_number, Global.temp_1);
        If(Compare(Global.temp_1, ==, 1));
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Ana Nano Boosted Effect, Color(Team 1), Event Player, 1, Visible To);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
        Else If(Compare(Global.temp_1, ==, 2));
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Reaper Wraith Form Effect, Color(Team 1), Event Player, 1, Visible To);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
        Else If(Compare(Global.temp_1, ==, 4));
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Baptiste Immortality Field Protected Effect, Color(Team 1), Event Player, 1, Visible To);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
        Else If(Compare(Global.temp_1, ==, 5));
            Set Player Variable(Event Player, active_ab_var, Vector(0, -1000, 0));
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Cloud, Color(Sky Blue), Add((Event Player).active_ab_var, Vector(0, 2, 0)), 10, Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Cloud, Color(Sky Blue), Add((Event Player).active_ab_var, Vector(0, -2, 0)), 10, Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Ring, Color(Sky Blue), Add((Event Player).active_ab_var, Down), 10, Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
        Else If(Compare(Global.temp_1, ==, 6));
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Heal Target Active Effect, Color(Team 1), Event Player, 1, Visible To);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
        Else If(Compare(Global.temp_1, ==, 7));
            Set Player Variable(Event Player, active_ab_var, Vector(0, -1000, 0));
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Cloud, Color(Yellow), Add((Event Player).active_ab_var, Up), 8, Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
            Create Effect(If-Then-Else(Compare((Event Player).active_ab_cooldown, <, 0), All Players(All Teams), Empty Array), Cloud, Color(Yellow), Add((Event Player).active_ab_var, Down), 8, Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
        Else If(Compare(Global.temp_1, ==, 8));
            Set Player Variable(Event Player, active_ab_var, Empty Array);
            Create Beam Effect(If-Then-Else(Count Of((Event Player).active_ab_var), All Players(All Teams), Empty Array), Bad Beam, Event Player, First Of((Event Player).active_ab_var), Color(Purple), Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
            Create Beam Effect(If-Then-Else(Compare(Count Of((Event Player).active_ab_var), >, 1), All Players(All Teams), Empty Array), Bad Beam, First Of((Event Player).active_ab_var), Value In Array((Event Player).active_ab_var, 1), Color(Purple), Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
            Create Beam Effect(If-Then-Else(Compare(Count Of((Event Player).active_ab_var), >, 2), All Players(All Teams), Empty Array), Bad Beam, Value In Array((Event Player).active_ab_var, 1), Value In Array((Event Player).active_ab_var, 2), Color(Purple), Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
            Create Beam Effect(If-Then-Else(Compare(Count Of((Event Player).active_ab_var), >, 3), All Players(All Teams), Empty Array), Bad Beam, Value In Array((Event Player).active_ab_var, 2), Value In Array((Event Player).active_ab_var, 3), Color(Purple), Visible To Position and Radius);
            Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
        End;
        Call Subroutine(play_purchase_confirmation_sound);
    }
}

rule ("Subroutine: Remove Active Ability") {
    event {
        Subroutine;
        remove_active_ability;
    }
    actions {
        If(Compare((Event Player).active_ab_cooldown, <, 0));
            Set Player Variable(Event Player, active_ab_cooldown, -0.1);
        End;
        Destroy Effect((Event Player).active_ab_effect_list);
        Set Player Variable(Event Player, active_ab_effect_list, Empty Array);
        Set Player Variable(Event Player, active_ab_number, False);
    }
}

rule ("Subroutine: Update Ability String and Play Sound") {
    event {
        Subroutine;
        update_ab_string_and_play_sound;
    }
    actions {
        Set Player Variable(Event Player, ab_bought_abilities_string, String Slice(Custom String("{0}{1}{2}", Custom String("{0}{1}{2}", Custom String("{0}{1}{2}", Value In Array(Array(Custom String(""), Custom String("\nPriority A"), Custom String("\nPriority B"), Custom String("\nPriority C")), (Event Player).ab_priority), Value In Array(Array(Custom String(""), Custom String("\nHeadhunter I"), Custom String("\nHeadhunter II")), (Event Player).ab_headhunter), Value In Array(Array(Custom String(""), Custom String("\nAntigens I"), Custom String("\nAntigens II")), (Event Player).ab_antigens)), Custom String("{0}{1}{2}", Value In Array(Array(Custom String(""), Custom String("\nQuick Fix I"), Custom String("\nQuick Fix II")), (Event Player).ab_quick_fix), Value In Array(Array(Custom String(""), Custom String("\nCharged I"), Custom String("\nCharged II")), (Event Player).ab_charged), Value In Array(Array(Custom String(""), Custom String("\nHaste I"), Custom String("\nHaste II")), (Event Player).ab_haste)), Custom String("{0}{1}{2}", Value In Array(Array(Custom String(""), Custom String("\nHeavy Impact I"), Custom String("\nHeavy Impact II")), (Event Player).ab_heavy_impact), Value In Array(Array(Custom String(""), Custom String("\nSecond Wind I"), Custom String("\nSecond Wind II")), (Event Player).ab_second_wind), Value In Array(Array(Custom String(""), Custom String("\nTriage I"), Custom String("\nTriage II")), (Event Player).ab_triage))), Custom String("{0}{1}{2}", Custom String("{0}{1}{2}", Value In Array(Array(Custom String(""), Custom String("\nResilience I"), Custom String("\nResilience II")), (Event Player).ab_resilience), If-Then-Else((Event Player).perk_mystery_swap, Custom String("\nMystery Swap"), Custom String("")), If-Then-Else((Event Player).perk_bulletstorm, Custom String("\nBulletstorm"), Custom String(""))), Custom String("{0}{1}{2}", If-Then-Else((Event Player).perk_die_hard, Custom String("\nDie Hard"), Custom String("")), If-Then-Else((Event Player).perk_brass_knuckles, Custom String("\nBrass Knuckles"), Custom String("")), If-Then-Else((Event Player).perk_vampiric, Custom String("\nVampiric"), Custom String(""))), Custom String("{0}{1}{2}", If-Then-Else((Event Player).perk_crash_n_dash, Custom String("\nCrash N' Dash"), Custom String("")), If-Then-Else((Event Player).perk_golden_hour, Custom String("\nGolden Hour"), Custom String("")), If-Then-Else((Event Player).perk_super_charge, Custom String("\nSupercharge"), Custom String("")))), Custom String("{0}{1}{2}", Custom String("{0}{1}{2}", If-Then-Else((Event Player).perk_nemesis, Custom String("\nNemesis"), Custom String("")), If-Then-Else((Event Player).perk_special_operator, Custom String("\nSpec Ops"), Custom String("")), If-Then-Else((Event Player).perk_sharpshooter, Custom String("\nSharpshooter"), Custom String(""))), Custom String("{0}{1}{2}", If-Then-Else((Event Player).perk_shockproof, Custom String("\nShockproof"), Custom String("")), Custom String("{0}{1}{2}", If-Then-Else((Event Player).Talent1, Custom String("\n{0} {1}", Ability Icon String(Hero(Pharah), Button(Jump)), Value In Array((Event Player).talent_text, 1)), Custom String("")), If-Then-Else((Event Player).Talent2, Custom String("\n{0} {1}", Ability Icon String(Hero(Pharah), Button(Jump)), Value In Array((Event Player).talent_text, 3)), Custom String("")), If-Then-Else((Event Player).ab_health_bonus, Custom String("\n+{0}% Health", (Event Player).ab_health_bonus), Custom String(""))), If-Then-Else((Event Player).ab_damage_bonus, Custom String("\n+{0}% Damage", (Event Player).ab_damage_bonus), Custom String(""))), If-Then-Else((Event Player).ab_healing_bonus, Custom String("\n+{0}% Healing", (Event Player).ab_healing_bonus), Custom String("")))), 1, 511));
    }
}

rule ("Subroutine: Play Purchase Confirmation Sound") {
    event {
        Subroutine;
        play_purchase_confirmation_sound;
    }
    actions {
        Play Effect(Event Player, Buff Explosion Sound, Color(White), Global.buy_menu_cam_pos, 200);
    }
}

rule ("Team 1: Buy Ability") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).in_buy_menu_start_t == True;
        Is Button Held(Event Player, Button(Primary Fire)) == True;
    }
    actions {
        Abort If(Or(Or(Or(Compare(Add((Event Player).in_buy_menu_start_t, 0.1), >=, Total Time Elapsed), Compare(Absolute Value(Horizontal Facing Angle Of(Event Player)), >=, 135)), Compare(Absolute Value(Add(Vertical Facing Angle Of(Event Player), 11.25)), >=, 45)), Compare((Event Player).tased_end_t, >=, Total Time Elapsed)));
        "Grid coordinates of selected panel"
        Set Global Variable(temp_1, Array(Round To Integer(Divide(Add(Horizontal Facing Angle Of(Event Player), 135), 45), Down), Round To Integer(Divide(Add(Vertical Facing Angle Of(Event Player), 56.25), 22.5), Down)));
        If(Compare(Value In Array(Global.temp_1, 1), ==, 0));
            If(Compare(First Of(Global.temp_1), <=, 1));
                Call Subroutine(leave_buy_menu);
            Else If(Compare(First Of(Global.temp_1), <=, 3));
                Set Player Variable(Event Player, is_showing_active_abilities, Not((Event Player).is_showing_active_abilities));
            Else;
                If((Event Player).money_spent_amount);
                    Call Subroutine(remove_active_ability);
                    Set Player Variable(Event Player, money_spent_amount, False);
                    Set Player Variable(Event Player, ab_headhunter, False);
                    Set Player Variable(Event Player, ab_quick_fix, False);
                    Set Player Variable(Event Player, ab_charged, False);
                    Set Player Variable(Event Player, ab_heavy_impact, False);
                    Set Player Variable(Event Player, ab_second_wind, False);
                    Set Player Variable(Event Player, ab_triage, False);
                    If((Event Player).ab_resilience);
                        Set Player Variable(Event Player, ab_resilience, False);
                        Modify Player Variable(Event Player, Damage_Received, Add, 20);
                    End;
                    Set Knockback Dealt(Event Player, 100);
                    Set Knockback Received(Event Player, 100);
                    Set Player Variable(Event Player, ab_antigens, False);
                    Stop Healing Modification(Value In Array((Event Player).heal_mod, 1));
                    Stop Heal Over Time(Value In Array((Event Player).heal_mod, 2));
                    Stop Damage Modification(Value In Array((Event Player).damage_mod, 11));
                    Stop Damage Modification(Value In Array((Event Player).damage_mod, 12));
                    Set Player Variable(Event Player, ab_haste, False);
                    Set Player Variable(Event Player, ab_priority, False);
                    Modify Player Variable(Event Player, health_percent, Subtract, (Event Player).ab_health_bonus);
                    Set Player Variable(Event Player, ab_health_bonus, False);
                    Modify Player Variable(Event Player, Damage_Dealt, Subtract, (Event Player).ab_damage_bonus);
                    Set Player Variable(Event Player, ab_damage_bonus, False);
                    Modify Player Variable(Event Player, healing_dealt_percent, Subtract, (Event Player).ab_healing_bonus);
                    Set Player Variable(Event Player, ab_healing_bonus, False);
                    Set Player Variable(Event Player, perk_bulletstorm, False);
                    Set Player Variable(Event Player, perk_die_hard, False);
                    Set Player Variable(Event Player, perk_brass_knuckles, False);
                    Set Player Variable(Event Player, perk_vampiric, False);
                    Set Player Variable(Event Player, perk_crash_n_dash, False);
                    Set Player Variable(Event Player, perk_golden_hour, False);
                    Set Player Variable(Event Player, perk_super_charge, False);
                    If((Event Player).perk_nemesis);
                        Destroy Effect((Event Player).nemesis_beam_effect);
                        Set Player Variable(Event Player, perk_nemesis, False);
                    End;
                    If((Event Player).perk_special_operator);
                        Remove Health Pool From Player(Value In Array((Event Player).HP_Pool, 2));
                        Set Player Variable(Event Player, perk_special_operator, False);
                    End;
                    Set Player Variable(Event Player, perk_sharpshooter, False);
                    Stop Damage Modification(Value In Array((Event Player).damage_mod, 10));
                    Set Player Variable(Event Player, Talent1, False);
                    Set Player Variable(Event Player, Talent2, False);
                    If((Event Player).perk_mystery_swap);
                        Modify Player Variable(Event Player, health_percent, Subtract, 20);
                        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 20);
                        Modify Player Variable(Event Player, healing_dealt_percent, Subtract, 20);
                        Stop Forcing Player To Be Hero(Event Player);
                        Set Player Variable(Event Player, perk_mystery_swap, False);
                    End;
                    If((Event Player).perk_shockproof);
                        Enable Movement Collision With Players(Event Player);
                        Modify Player Variable(Event Player, Move_Speed, Subtract, 15);
                        Wait(0.016, Ignore Condition);
                        Set Player Variable(Event Player, perk_shockproof, False);
                    End;
                    Small Message(Event Player, Custom String("Money Refunded"));
                    Call Subroutine(update_ab_string_and_play_sound);
                    Abort;
                End;
            End;
        Else;
            If(Compare(First Of(Global.temp_1), ==, 0));
                If(Compare(Value In Array(Global.temp_1, 1), >=, 2));
                    Set Global Variable(temp_2, Value In Array(Global.current_perks, Compare(Value In Array(Global.temp_1, 1), >=, 3)));
                    If(Compare(Global.temp_2, ==, 0));
                        If(Not((Event Player).perk_mystery_swap));
                            Set Global Variable(temp_2, 500);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Modify Player Variable(Event Player, health_percent, Add, 20);
                                Modify Player Variable(Event Player, Damage_Dealt, Add, 20);
                                Modify Player Variable(Event Player, healing_dealt_percent, Add, 20);
                                Set Player Variable(Event Player, perk_mystery_swap, Add(Total Time Elapsed, 90));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 1));
                        If(Not((Event Player).perk_bulletstorm));
                            Set Global Variable(temp_2, 1000);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_bulletstorm, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 2));
                        If(Not((Event Player).perk_die_hard));
                            Set Global Variable(temp_2, 700);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_die_hard, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 3));
                        If(Not((Event Player).perk_brass_knuckles));
                            Set Global Variable(temp_2, 700);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_brass_knuckles, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 4));
                        If(Not((Event Player).perk_vampiric));
                            Set Global Variable(temp_2, 1000);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_vampiric, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 5));
                        If(Not((Event Player).perk_crash_n_dash));
                            Set Global Variable(temp_2, 700);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_crash_n_dash, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 6));
                        If(Not((Event Player).perk_golden_hour));
                            Set Global Variable(temp_2, 1000);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_golden_hour, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 7));
                        If(Not((Event Player).perk_super_charge));
                            Set Global Variable(temp_2, 700);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_super_charge, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 8));
                        If(Not((Event Player).perk_nemesis));
                            Set Global Variable(temp_2, 800);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_nemesis, True);
                                Create Beam Effect(If-Then-Else((Event Player).nemesis_killer, All Players(All Teams), Empty Array), Bad Beam, Position Of(Event Player), (Event Player).nemesis_killer, Color(Black), Visible To Position and Radius);
                                Set Player Variable(Event Player, nemesis_beam_effect, Last Created Entity);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 9));
                        If(Not((Event Player).perk_special_operator));
                            Set Global Variable(temp_2, 600);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Add Health Pool To Player(Event Player, Armor, 50, True, True);
                                Set Player Variable At Index(Event Player, HP_Pool, 2, Last Created Health Pool);
                                Set Player Variable(Event Player, perk_special_operator, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 10));
                        If(Not((Event Player).perk_sharpshooter));
                            Set Global Variable(temp_2, 900);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, perk_sharpshooter, True);
                                Start Damage Modification(Filtered Array(All Players(Team 2), Compare(Distance Between(Event Player, Current Array Element), >, 20)), Event Player, 150, Receivers Damagers and Damage Percent);
                                Set Player Variable At Index(Event Player, damage_mod, 10, Last Damage Modification ID);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 11));
                        If(Not((Event Player).perk_shockproof));
                            Set Global Variable(temp_2, 700);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Disable Movement Collision With Players(Event Player);
                                Modify Player Variable(Event Player, Move_Speed, Add, 15);
                                Set Player Variable(Event Player, perk_shockproof, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 12));
                        If(Not((Event Player).Talent1));
                            Set Global Variable(temp_2, 1600);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, Talent1, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Global.temp_2, ==, 13));
                        If(Not((Event Player).Talent2));
                            Set Global Variable(temp_2, 1600);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, Talent2, True);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    End;
                End;
            Else If(Compare(First Of(Global.temp_1), ==, 1));
                If((Event Player).is_showing_active_abilities);
                    If(Compare(Value In Array(Global.temp_1, 1), ==, 1));
                        Set Global Variable(temp_1, 4);
                        Call Subroutine(buy_active_ability);
                    Else If(Compare(Value In Array(Global.temp_1, 1), ==, 2));
                        Set Global Variable(temp_1, 8);
                        Call Subroutine(buy_active_ability);
                    End;
                Else;
                    Set Global Variable(temp_2, 500);
                    Call Subroutine(check_if_enough_money);
                    If(Global.temp_2);
                        If(Compare(Value In Array(Global.temp_1, 1), ==, 1));
                            Modify Player Variable(Event Player, ab_health_bonus, Add, 5);
                            Modify Player Variable(Event Player, health_percent, Add, 5);
                        Else If(Compare(Value In Array(Global.temp_1, 1), ==, 2));
                            Modify Player Variable(Event Player, ab_damage_bonus, Add, 5);
                            Modify Player Variable(Event Player, Damage_Dealt, Add, 5);
                            Set Damage Dealt(Event Player, (Event Player).Damage_Dealt);
                        Else;
                            Modify Player Variable(Event Player, ab_healing_bonus, Add, 5);
                            Modify Player Variable(Event Player, healing_dealt_percent, Add, 5);
                        End;
                        Call Subroutine(update_ab_string_and_play_sound);
                    End;
                End;
            Else If(Compare(First Of(Global.temp_1), ==, 2));
                If((Event Player).is_showing_active_abilities);
                    If(Compare(Value In Array(Global.temp_1, 1), ==, 1));
                        Set Global Variable(temp_1, 3);
                        Call Subroutine(buy_active_ability);
                    Else If(Compare(Value In Array(Global.temp_1, 1), ==, 2));
                        Set Global Variable(temp_1, 7);
                        Call Subroutine(buy_active_ability);
                    End;
                Else;
                    If(Compare(Value In Array(Global.temp_1, 1), ==, 1));
                        If(Compare((Event Player).ab_second_wind, <, 2));
                            Set Global Variable(temp_2, 1000);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, ab_second_wind, If-Then-Else((Event Player).ab_second_wind, 2, 1));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Value In Array(Global.temp_1, 1), ==, 2));
                        If(Compare((Event Player).ab_triage, <, 2));
                            Set Global Variable(temp_2, 700);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, ab_triage, If-Then-Else((Event Player).ab_triage, 2, 1));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else;
                        If(Compare((Event Player).ab_resilience, <, 2));
                            Set Global Variable(temp_2, 800);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, ab_resilience, If-Then-Else((Event Player).ab_resilience, 2, 1));
                                Modify Player Variable(Event Player, Damage_Received, Subtract, 20);
                                Set Knockback Dealt(Event Player, Add(100, Multiply(30, (Event Player).ab_resilience)));
                                Set Knockback Received(Event Player, Subtract(100, Multiply(30, (Event Player).ab_resilience)));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    End;
                End;
            Else If(Compare(First Of(Global.temp_1), ==, 3));
                If((Event Player).is_showing_active_abilities);
                    If(Compare(Value In Array(Global.temp_1, 1), ==, 1));
                        Set Global Variable(temp_1, 2);
                        Call Subroutine(buy_active_ability);
                    Else If(Compare(Value In Array(Global.temp_1, 1), ==, 2));
                        Set Global Variable(temp_1, 6);
                        Call Subroutine(buy_active_ability);
                    End;
                Else;
                    If(Compare(Value In Array(Global.temp_1, 1), ==, 1));
                        If(Compare((Event Player).ab_charged, <, 2));
                            Set Global Variable(temp_2, 700);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, ab_charged, If-Then-Else((Event Player).ab_charged, 2, 1));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Value In Array(Global.temp_1, 1), ==, 2));
                        If(Compare((Event Player).ab_haste, <, 2));
                            Set Global Variable(temp_2, 800);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, ab_haste, If-Then-Else((Event Player).ab_haste, 2, 1));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else;
                        If(Compare((Event Player).ab_heavy_impact, <, 2));
                            Set Global Variable(temp_2, 1000);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, ab_heavy_impact, If-Then-Else((Event Player).ab_heavy_impact, 2, 1));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    End;
                End;
            Else If(Compare(First Of(Global.temp_1), ==, 4));
                If((Event Player).is_showing_active_abilities);
                    If(Compare(Value In Array(Global.temp_1, 1), ==, 1));
                        Set Global Variable(temp_1, 1);
                        Call Subroutine(buy_active_ability);
                    Else If(Compare(Value In Array(Global.temp_1, 1), ==, 2));
                        Set Global Variable(temp_1, 5);
                        Call Subroutine(buy_active_ability);
                    End;
                Else;
                    If(Compare(Value In Array(Global.temp_1, 1), ==, 1));
                        If(Compare((Event Player).ab_headhunter, <, 2));
                            Set Global Variable(temp_2, 800);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, ab_headhunter, If-Then-Else((Event Player).ab_headhunter, 2, 1));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else If(Compare(Value In Array(Global.temp_1, 1), ==, 2));
                        If(Compare((Event Player).ab_antigens, <, 2));
                            Set Global Variable(temp_2, 600);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Stop Healing Modification(Value In Array((Event Player).heal_mod, 1));
                                Stop Heal Over Time(Value In Array((Event Player).heal_mod, 2));
                                Set Player Variable(Event Player, ab_antigens, If-Then-Else((Event Player).ab_antigens, 2, 1));
                                Start Healing Modification(Event Player, All Players(All Teams), Add(100, Multiply(20, (Event Player).ab_antigens)), Receivers Healers and Healing Percent);
                                Set Player Variable At Index(Event Player, heal_mod, 1, Last Healing Modification ID);
                                Start Heal Over Time(Event Player, Null, 9999, Multiply(Multiply(Max Health(Event Player), 0.01), (Event Player).ab_antigens));
                                Set Player Variable At Index(Event Player, heal_mod, 2, Last Heal Over Time ID);
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    Else;
                        If(Compare((Event Player).ab_quick_fix, <, 2));
                            Set Global Variable(temp_2, 700);
                            Call Subroutine(check_if_enough_money);
                            If(Global.temp_2);
                                Set Player Variable(Event Player, ab_quick_fix, If-Then-Else((Event Player).ab_quick_fix, 2, 1));
                                Call Subroutine(update_ab_string_and_play_sound);
                            End;
                        End;
                    End;
                End;
            Else;
                If(Not((Event Player).ab_priority));
                    Set Global Variable(temp_2, 1200);
                    Call Subroutine(check_if_enough_money);
                    If(Not(Global.temp_2));
                        Wait(0.1, Ignore Condition);
                        Abort;
                    End;
                Else If(Compare(Value In Array(Global.temp_1, 1), ==, (Event Player).ab_priority));
                    Wait(0.1, Ignore Condition);
                    Abort;
                Else;
                    Small Message(Event Player, Custom String("Swapped Priority"));
                End;
                Set Player Variable(Event Player, ab_priority, Value In Array(Global.temp_1, 1));
                Call Subroutine(update_ab_string_and_play_sound);
            End;
        End;
        Wait(0.1, Ignore Condition);
    }
}

rule ("All Teams: Player left Match, Scale Damage") {
    event {
        Player Left Match;
        All;
        All;
    }
    actions {
        Call Subroutine(update_combatants);
        Set Global Variable(temp_2, Multiply(Multiply(Multiply(If-Then-Else(Global.mut_emp_rounds, 2, 1), Add(20, Multiply(8.25, Add(Subtract(Global.wave_number, 1), Max(0, Subtract(Global.wave_number, 9)))))), Add(0.139, Multiply(0.2, Global.combatants_count))), Divide(9, Number Of Players(Team 2))));
        For Global Variable(temp_1, 0, Number Of Living Players(Team 2), 1);
            Set Damage Dealt(Value In Array(All Living Players(Team 2), Global.temp_1), Multiply((Value In Array(All Living Players(Team 2), Global.temp_1)).Damage_Dealt, Global.temp_2));
        End;
    }
}

rule ("Subroutine: Nearest Walkable Position Teleport") {
    event {
        Subroutine;
        nwp_teleport;
    }
    actions {
        If(Compare(Global.temp_1, ==, Empty Array));
            Teleport(Event Player, First Of(Sorted Array(Global.nodes, Distance Between(Event Player, Current Array Element))));
        Else;
            Teleport(Event Player, Global.temp_1);
        End;
    }
}

rule ("Team 1 (Spawn): Player Init, Create Effects, Set Is Combatant") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Has Spawned(Event Player) == True;
    }
    actions {
        "Fail-Safe if player somehow despawned (Like Echo duplicating D.Va)"
        Abort If((Event Player).is_combatant);
        Small Message(Event Player, Custom String("*******​ ​***********​ PvE: Talents​ | 3.4.6 ​***​ LemonAid"));
        "Triage: Players to Players Healing Increase"
        Start Healing Modification(Filtered Array(Global.combatants, Compare(Normalized Health(Current Array Element), <=, 0.5)), Event Player, Add(100, Multiply(25, (Event Player).ab_triage)), Receivers Healers and Healing Percent);
        Set Player Variable(Event Player, is_combatant, True);
        Set Player Variable(Event Player, spectated_player, Event Player);
        Set Player Variable(Event Player, ab_bought_abilities_string, Custom String(""));
        Set Player Variable(Event Player, health_percent, 100);
        Set Player Variable(Event Player, healing_dealt_percent, 100);
        Set Healing Received(Event Player, Add(85, Multiply(2.5, Global.upgrade_count)));
        Call Subroutine(update_combatants);
        Create Effect(If-Then-Else((Event Player).downed_start_t, All Players(All Teams), Empty Array), Ring, Color(Yellow), Event Player, 3, Visible To);
        Create Icon(If-Then-Else((Event Player).downed_start_t, Remove From Array(All Players(All Teams), Event Player), Empty Array), Event Player, Skull, Visible To, Color(Yellow), True);
        "Workaround: Normalized Health sometimes doesn't reevaluate, so force with TTE"
        Create HUD Text(All Players(Team 1), Custom String("{0}{1}", Hero Icon String(Hero Of(Event Player)), If-Then-Else(And((Event Player).downed_start_t, (Event Player).revive_timer), Value In Array(Global.progress_bar_strings, Round To Integer(Divide((Event Player).revive_timer, 10), Down)), Custom String(""))), Custom String("{0}{1}{2}", Event Player, If-Then-Else((Event Player).ab_priority, Value In Array(Array(Custom String(" (A)"), Custom String(" (B)"), Custom String(" (C)")), Subtract((Event Player).ab_priority, 1)), Custom String("")), If-Then-Else((Event Player).in_buy_menu_start_t, Custom String(" (In Shop)"), Custom String(""))), Custom String("{0}, {1}$", If-Then-Else((Event Player).downed_start_t, If-Then-Else((Event Player).revive_timer, Custom String("Being Revived"), Custom String("Downed")), If-Then-Else((Event Player).is_changing_heroes, Custom String("Changing Heroes"), Custom String("{0} HP", Round To Integer(Health(Event Player), Up)))), Round To Integer(Subtract(Multiply(Global.money_mult, Global.money_amount), (Event Player).money_spent_amount), Down)), Left, If-Then-Else(Compare(Local Player, ==, Event Player), -1, Slot Of(Event Player)), If-Then-Else((Event Player).downed_start_t, Color(Red), If-Then-Else(Or((Event Player).is_changing_heroes, Compare(Normalized Health(Event Player), >=, 0.5)), If-Then-Else(Compare(Local Player, ==, Event Player), Color(Green), Color(Sky Blue)), Color(Orange))), If-Then-Else((Event Player).downed_start_t, Color(Red), If-Then-Else(Or((Event Player).is_changing_heroes, Compare(Normalized Health(Event Player), >=, 0.5)), If-Then-Else(Compare(Local Player, ==, Event Player), Color(Green), Color(Sky Blue)), Color(Orange))), If-Then-Else((Event Player).downed_start_t, Color(Red), If-Then-Else(Or((Event Player).is_changing_heroes, Compare(Normalized Health(Event Player), >=, 0.5)), If-Then-Else(Compare(Local Player, ==, Event Player), Color(Green), Color(Sky Blue)), Color(Orange))), Visible To Sort Order String and Color, Default Visibility);
        "Stats"
        Set Player Variable(Event Player, Damage_Received, 100);
        Set Player Variable(Event Player, Damage_Dealt, 100);
        Set Player Variable(Event Player, Move_Speed, 100);
        "Ability lists"
        Create HUD Text(If-Then-Else((Event Player).is_combatant, Event Player, Empty Array), Null, ((Event Player).spectated_player).ab_bought_abilities_string, Null, Left, 10, Null, Color(Green), Null, Visible To and String, Default Visibility);
        Create HUD Text(If-Then-Else(((Event Player).spectated_player).Talent1, Event Player, Empty Array), Custom String(" "), Value In Array(((Event Player).spectated_player).talent_text, 2), Custom String("{0}\n━━━━", Value In Array(((Event Player).spectated_player).talent_text, 1)), Left, 11, Color(Blue), Color(White), Color(Sky Blue), Visible To and String, Default Visibility);
        Create HUD Text(If-Then-Else(((Event Player).spectated_player).Talent2, Event Player, Empty Array), Custom String(" "), Value In Array(((Event Player).spectated_player).talent_text, 4), Custom String("{0}\n━━━━", Value In Array(((Event Player).spectated_player).talent_text, 3)), Left, 12, Color(Blue), Color(White), Color(Sky Blue), Visible To and String, Default Visibility);
        Create HUD Text(If-Then-Else(((Event Player).spectated_player).active_ab_number, Event Player, Empty Array), Ability Icon String(Value In Array(Array(Hero(Ana), Hero(Sombra), Hero(Soldier: 76), Hero(Reaper), Hero(Cassidy), Hero(Baptiste), Hero(Sigma), Hero(Sombra)), Subtract(((Event Player).spectated_player).active_ab_number, 1)), Value In Array(Array(Button(Ultimate), Button(Ability 1), Button(Ability 1), Button(Ability 1), Button(Ability 2), Button(Ability 1), Button(Ultimate), Button(Secondary Fire)), Subtract(((Event Player).spectated_player).active_ab_number, 1))), Custom String("Hold or double tap {0}", Input Binding String(Button(Melee))), Custom String("{0}: {1}", Value In Array(Array(Custom String("Stim Infusion"), Custom String("Cloak"), Custom String("Feint"), Custom String("Frenzy"), Custom String("Smoke Bomb"), Custom String("Resurgence"), Custom String("Tear Gas"), Custom String("Chain Hack")), Subtract(((Event Player).spectated_player).active_ab_number, 1)), If-Then-Else(((Event Player).spectated_player).active_ab_cooldown, Round To Integer(Magnitude Of(((Event Player).spectated_player).active_ab_cooldown), Up), Custom String("Ready"))), Left, 13, If-Then-Else(Compare(((Event Player).spectated_player).active_ab_cooldown, <, 0), Color(Green), If-Then-Else(Or(Has Status((Event Player).spectated_player, Hacked), Has Status((Event Player).spectated_player, Stunned)), Color(Red), If-Then-Else(((Event Player).spectated_player).active_ab_cooldown, Color(Gray), Color(Green)))), Color(Orange), If-Then-Else(Compare(((Event Player).spectated_player).active_ab_cooldown, <, 0), Color(Green), If-Then-Else(Or(Has Status((Event Player).spectated_player, Hacked), Has Status((Event Player).spectated_player, Stunned)), Color(Red), If-Then-Else(((Event Player).spectated_player).active_ab_cooldown, Color(Gray), Color(Green)))), Visible To String and Color, Default Visibility);
        Create Effect(If-Then-Else(And((Event Player).Smoked_Screen, Not((Event Player).perk_special_operator)), Event Player, Empty Array), Sphere, Color(White), Event Player, 5, Visible To Position and Radius);
        Create Effect(If-Then-Else(Has Status(Event Player, Invincible), All Players(All Teams), Empty Array), Baptiste Immortality Field Protected Effect, Team 2, Event Player, 1, Visible To Position and Radius);
        If(Global.wave_number);
            Start Forcing Player Outlines(Filtered Array(All Players(Team 2), (Current Array Element).is_living_boss), Event Player, True, Color(Yellow), Always);
            Set Player Variable(Event Player, can_use_drop_in_buy_menu, True);
            Wait Until(Not(Not((Event Player).in_buy_menu_start_t)), 15);
            Set Player Variable(Event Player, can_use_drop_in_buy_menu, False);
            If((Event Player).in_buy_menu_start_t);
                Set Player Variable(Event Player, active_ab_is_cloaked, True);
                Set Status(Event Player, Null, Phased Out, 30);
                Wait Until(Not((Event Player).in_buy_menu_start_t), 30);
                Set Player Variable(Event Player, active_ab_is_cloaked, False);
                Clear Status(Event Player, Phased Out);
            End;
        Else;
            Teleport(Event Player, Global.player_spawn_pos);
            Wait(0.2, Ignore Condition);
            Set Facing(Event Player, Global.player_spawn_facing, To World);
    }
}

rule ("Team 1: Detect Input Device") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    actions {
        Wait Until(Compare(Magnitude Of(Throttle Of(Event Player)), >, 0), 99999);
        Set Global Variable(temp_1, Array(-1, False, 1));
        Set Player Variable(Event Player, is_controller_player, Not(And(Array Contains(Global.temp_1, X Component Of(Throttle Of(Event Player))), Array Contains(Global.temp_1, Z Component Of(Throttle Of(Event Player))))));
        Set Player Variable(Event Player, mercy_res_button, If-Then-Else((Event Player).is_controller_player, Button(Secondary Fire), Button(Ability 2)));
    }
}

rule ("Team 1: Add Health Pool") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).is_combatant == True;
        Global.upgrade_count > 0;
    }
    actions {
        Add Health Pool To Player(Event Player, Health, Multiply(Multiply((Event Player).health_percent, 0.25), Global.upgrade_count), True, True);
    }
}

rule ("Team 1 Button: Hold Reload, Change Hero, Set Last Position (1), Last Eye Position (2), Last Facing (3)") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Is Button Held(Event Player, Button(Reload)) == True;
    }
    actions {
        Wait(0.4, Abort When False);
        Abort If(Or(Or(Compare(Global.objective_phase_number, >, 0), (Event Player).downed_start_t), (Event Player).in_buy_menu_start_t));
        If((Event Player).perk_mystery_swap);
            Small Message(Event Player, Custom String("Mystery Swap prevents you from changing heroes"));
            Abort;
        End;
        Set Player Variable(Event Player, is_changing_heroes, True);
        Set Player Variable(Event Player, ab_var_1, Position Of(Event Player));
        Set Player Variable(Event Player, ab_var_2, Eye Position(Event Player));
        Set Player Variable(Event Player, ab_var_3, Facing Direction Of(Event Player));
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(Yellow), (Event Player).ab_var_1, 1);
        Start Camera(Event Player, Add(Ray Cast Hit Position((Event Player).ab_var_2, Subtract((Event Player).ab_var_2, Multiply(8.25, Direction From Angles(Horizontal Angle From Direction((Event Player).ab_var_3), 20))), Null, Null, False), Multiply(0.25, Direction From Angles(Horizontal Angle From Direction((Event Player).ab_var_3), 20))), (Event Player).ab_var_2, 0);
        Clear Status(Event Player, Unkillable);
        Kill(Event Player, Null);
        "Lower values might cause the player to fall through the map when respawning"
        Teleport(Event Player, Vector(0, -100, 0));
        Wait(0.1, Ignore Condition);
        Set Player Variable(Event Player, is_invisible, 2);
        Wait Until(Is Alive(Event Player), 99999);
        Stop Camera(Event Player);
        Teleport(Event Player, (Event Player).ab_var_1);
        Set Facing(Event Player, (Event Player).ab_var_3, To World);
        Set Player Variable(Event Player, is_changing_heroes, False);
        Set Player Variable(Event Player, is_invisible, False);
        Wait(0.5, Ignore Condition);
        Call Subroutine(update_ab_string_and_play_sound);
    }
}

rule ("Team 1: Took Damage, Set Last Damage Taken") {
    event {
        Player Took Damage;
        Team 1;
        All;
    }
    actions {
        Set Player Variable(Event Player, last_damage_taken_t, Total Time Elapsed);
    }
}

rule ("Team 1 (Death): Start Camera, Play Sounds, Set is Downed, Revive Timer, Knocked down, Phased out, Death Cam Target") {
    event {
        Player Died;
        Team 1;
        All;
    }
    conditions {
        (Event Player).is_changing_heroes == False;
    }
    actions {
        If(Not((Event Player).downed_start_t));
            Disable Messages(Event Player);
            Small Message(All Players(All Teams), Custom String("{0} was downed!", Event Player));
            Set Player Variable(Event Player, death_cam_target, Add(Eye Position(Event Player), Multiply(1000, Direction From Angles(Horizontal Facing Angle Of(Event Player), 0))));
            Start Camera(Event Player, Add(Ray Cast Hit Position(Eye Position((Event Player).spectated_player), Subtract(Eye Position((Event Player).spectated_player), If-Then-Else((Event Player).death_cam_target, Multiply(6.25, Direction Towards(Eye Position((Event Player).spectated_player), (Event Player).death_cam_target)), Multiply(8.25, Direction From Angles(Horizontal Facing Angle Of((Event Player).spectated_player), 20)))), Null, Null, False), Multiply(0.25, If-Then-Else((Event Player).death_cam_target, Direction Towards(Eye Position((Event Player).spectated_player), (Event Player).death_cam_target), Direction From Angles(Horizontal Facing Angle Of((Event Player).spectated_player), 20)))), Eye Position((Event Player).spectated_player), If-Then-Else((Event Player).death_cam_target, 10, 20));
            For Global Variable(temp_1, 0, Global.combatants_count, 1);
                Play Effect(Value In Array(Global.combatants, Global.temp_1), Ring Explosion Sound, Color(White), Value In Array(Global.combatants, Global.temp_1), 200);
                Play Effect(Value In Array(Global.combatants, Global.temp_1), Ring Explosion Sound, Color(White), Value In Array(Global.combatants, Global.temp_1), 200);
            End;
            Set Player Variable(Event Player, downed_start_t, Total Time Elapsed);
            Set Player Variable(Event Player, revive_timer, False);
            If(And(And(And(And((Event Player).perk_nemesis, (Attacker).is_alive), Compare(Team Of(Attacker), ==, Team 2)), Not((Attacker).iv_is_portal)), Compare(Slot Of(Attacker), !=, 1)));
                Set Player Variable(Event Player, nemesis_killer, Attacker);
            Else;
                Set Player Variable(Event Player, nemesis_killer, Null);
            End;
            Call Subroutine(disable_player);
        End;
        If(Event Was Environment);
            Set Global Variable(temp_1, Nearest Walkable Position(Event Player));
            Call Subroutine(nwp_teleport);
        End;
        Resurrect(Event Player);
        Clear Status(Event Player, Phased Out);
        Set Status(Event Player, Null, Invincible, 9999);
        "eventPlayer.setStatusEffect(null, Status.KNOCKED_DOWN, 9999)"
        Wait(0.05, Restart When True);
        Set Player Health(Event Player, 1);
        Set Status(Event Player, Null, Phased Out, 9999);
        If(Compare(Attacker, !=, Event Player));
            Set Player Variable(Event Player, death_cam_target, Attacker);
            Wait(5, Restart When True);
        End;
        Set Player Variable(Event Player, death_cam_target, Null);
    }
}

rule ("Team 1: Player downed fallback") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).downed_start_t == True;
        Has Status(Event Player, Stunned) == False;
    }
    actions {
        Wait(0.25, Abort When False);
        Abort If Condition Is False;
        Start Scaling Player(Event Player, 0.5, False);
        Call Subroutine(disable_player);
        While(And((Event Player).downed_start_t, Not(Has Status(Event Player, Hacked))));
            Clear Status(Event Player, Phased Out);
            Cancel Primary Action(Event Player);
            Set Status(Event Player, Null, Hacked, 9999);
            Wait(0.25, Ignore Condition);
        End;
        If((Event Player).downed_start_t);
            Set Status(Event Player, Null, Phased Out, 9999);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 1: Select Next Spectated Player") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).downed_start_t == True;
        Is Button Held(Event Player, Button(Jump)) == True;
    }
    actions {
        Abort If(Compare(Add((Event Player).downed_start_t, 0.5), >=, Total Time Elapsed));
        Set Player Variable(Event Player, death_cam_target, Null);
        If((Event Player).nemesis_killer);
            If(Compare((Event Player).spectated_player, ==, Event Player));
                Set Player Variable(Event Player, spectated_player, (Event Player).nemesis_killer);
            Else;
                Set Player Variable(Event Player, spectated_player, Event Player);
            End;
        Else;
            Set Player Variable(Event Player, spectated_player, Value In Array(Global.combatants, Modulo(Add(Index Of Array Value(Global.combatants, (Event Player).spectated_player), 1), Global.combatants_count)));
        End;
        Wait(0.25, Ignore Condition);
    }
}

rule ("Team 1: Spectated Player does not exist anymore") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Entity Exists((Event Player).spectated_player) == False;
    }
    actions {
        Set Player Variable(Event Player, spectated_player, Event Player);
    }
}

rule ("Team 1: Revive, Check Player in Radius, Unset Is Downed") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).downed_start_t == True;
        Add((Event Player).downed_start_t, 1) < Total Time Elapsed;
    }
    actions {
        Set Player Variable(Event Player, revivers, Filtered Array(Global.combatants, And(And(And(Not(Or((Current Array Element).downed_start_t, Modulo((Current Array Element).is_invisible, 3))), Compare(Distance Between(Event Player, Vector(X Component Of(Position Of(Current Array Element)), Y Component Of(Position Of(Event Player)), Z Component Of(Position Of(Current Array Element)))), <=, 3)), Compare(Absolute Value(Subtract(Y Component Of(Position Of(Event Player)), Y Component Of(Position Of(Current Array Element)))), <=, 3)), Or(And(Compare(Hero Of(Current Array Element), ==, Hero(Mei)), Is Using Ability 1(Current Array Element)), Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS)))));
        If(Count Of((Event Player).revivers));
            Set Player Variable(Event Player, is_revive_slow, Is True For All((Event Player).revivers, Or(Or((Current Array Element).active_ab_is_cloaked, Has Status(Current Array Element, Invincible)), Has Status(Current Array Element, Phased Out))));
            Modify Player Variable(Event Player, revive_timer, Add, Multiply(Multiply(If-Then-Else(Or(Global.is_hard_mode_enabled, Global.is_apocalyptic), 0.667, 1), If-Then-Else((Event Player).perk_golden_hour, 2, 1)), If-Then-Else((Event Player).is_revive_slow, 2.5, 5)));
            If(Compare((Event Player).revive_timer, >=, 100));
                Small Message(All Players(All Teams), Custom String("{0} has been revived!", Event Player));
                Set Player Variable(Event Player, downed_start_t, False);
            End;
        Else;
            Set Player Variable(Event Player, revive_timer, False);
        End;
        Wait(0.2, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 1: Teleport if Player died on Jumppad") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).downed_start_t == True;
        Add((Event Player).downed_start_t, 5) < Total Time Elapsed;
        (Event Player).is_flying == True;
    }
    actions {
        Set Global Variable(temp_1, Nearest Walkable Position(Add(Position Of(Event Player), Multiply(5, Direction From Angles(Random Integer(-179, 180), False)))));
        Call Subroutine(nwp_teleport);
    }
}

rule ("Team 1: Player gets up") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).downed_start_t == False;
    }
    actions {
        Abort If(Not((Event Player).is_combatant));
        Enable Messages(Event Player);
        Stop Camera(Event Player);
        Call Subroutine(enable_player);
        Play Effect(All Players(All Teams), Buff Impact Sound, Color(White), Event Player, 200);
        Set Player Health(Event Player, 100000);
        Set Player Variable(Event Player, spectated_player, Event Player);
        Set Player Variable(Event Player, revivers, Empty Array);
        Set Player Variable(Event Player, nemesis_killer, Null);
        Clear Status(Event Player, Hacked);
        Clear Status(Event Player, Invincible);
        Call Subroutine(enable_player);
        Stop Scaling Player(Event Player);
        Wait(2, Abort When False);
        Abort If Condition Is False;
        Clear Status(Event Player, Phased Out);
    }
}

rule ("Team 1: Heal after few sec") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Add((Event Player).last_damage_taken_t, Multiply(If-Then-Else((Event Player).perk_die_hard, 0.5, 1), If-Then-Else(Global.mut_deep_wounds, 5, 2.5))) < Total Time Elapsed;
        Normalized Health(Event Player) != 1;
        Health(Event Player) != False;
    }
    actions {
        Heal(Event Player, Null, Multiply(Max Health(Event Player), 0.333));
        Play Effect(Event Player, Buff Explosion Sound, Color(White), Event Player, 50);
        While(True);
            Wait(0.2, Abort When False);
            Abort If Condition Is False;
            Heal(Event Player, Null, 40);
        End;
    }
}

rule ("Team 1: Set / Unset Is Flying") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Is On Ground(Event Player) == False;
    }
    actions {
        Wait(1.5, Abort When False);
        Set Player Variable(Event Player, is_flying, True);
        Wait Until(Is On Ground(Event Player), 99999);
        Set Player Variable(Event Player, is_flying, False);
    }
}

rule ("Team 1: Calculate Eye Offset") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).is_combatant == True;
    }
    actions {
        If(And(Compare(Hero Of(Event Player), ==, Hero(Mei)), Is Using Ability 1(Event Player)));
            Set Player Variable(Event Player, eye_offset, Vector(0, 1.2, 0));
        Else If(Or(Or(Has Status(Event Player, Knocked Down), Has Status(Event Player, Asleep)), Is Communicating Any Emote(Event Player)));
            Set Player Variable(Event Player, eye_offset, Subtract(Add(Position Of(Event Player), Vector(0, 0.25, 0)), Eye Position(Event Player)));
        Else;
            Set Player Variable(Event Player, eye_offset, Global.aim_offset);
        End;
        If((Event Player).active_ab_is_smoked);
            Set Player Variable(Event Player, active_ab_is_smoked, False);
            Modify Player Variable(Event Player, eye_offset, Add, Multiply(Random Real(0.5, 2), Direction From Angles(Random Integer(-179, 180), Random Integer(0, 45))));
        End;
        Wait(1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 1 Button: Hold or double tap Melee, Use active Ability") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Is Button Held(Event Player, Button(Melee)) == True;
    }
    actions {
        Wait Until(Not(Is Button Held(Event Player, Button(Melee))), 0.4);
        If(Not(Is Button Held(Event Player, Button(Melee))));
            Wait Until(Is Button Held(Event Player, Button(Melee)), 0.3);
            Abort If(Not(Is Button Held(Event Player, Button(Melee))));
        End;
        Abort If(Or(Or(Or(Or(Or(Is Dead(Event Player), (Event Player).downed_start_t), Has Status(Event Player, Hacked)), Has Status(Event Player, Stunned)), Not((Event Player).active_ab_number)), (Event Player).in_buy_menu_start_t));
        Play Effect(Event Player, Debuff Impact Sound, Color(White), Event Player, 200);
        If(Compare((Event Player).active_ab_number, ==, 1));
            Set Player Variable(Event Player, last_damage_taken_t, False);
            Set Status(Event Player, Null, Invincible, 0.1);
            Modify Player Variable(Event Player, Damage_Dealt, Add, 100);
            Modify Player Variable(Event Player, healing_dealt_percent, Add, 100);
            Modify Player Variable(Event Player, Move_Speed, Add, 50);
            For Player Variable(Event Player, active_ab_cooldown, -6, 0, 1);
                Wait(1, Ignore Condition);
            End;
            Modify Player Variable(Event Player, Damage_Dealt, Subtract, 100);
            Modify Player Variable(Event Player, healing_dealt_percent, Subtract, 100);
            Modify Player Variable(Event Player, Move_Speed, Subtract, 50);
            Set Player Variable(Event Player, active_ab_cooldown, 30);
        Else If(Compare((Event Player).active_ab_number, ==, 2));
            Set Player Variable(Event Player, active_ab_is_cloaked, True);
            For Player Variable(Event Player, active_ab_cooldown, -8, 0, 1);
                Wait(1, Ignore Condition);
            End;
            Set Player Variable(Event Player, active_ab_is_cloaked, False);
            Damage(Players Within Radius(Eye Position(Event Player), 10, Team 2, Surfaces), Event Player, 99);
            Set Status(Players Within Radius(Eye Position(Event Player), 10, Team 2, Surfaces), Event Player, Frozen, 4);
            Play Effect(All Players(All Teams), Good Explosion, Color(Aqua), Eye Position(Event Player), 10);
            Play Effect(All Players(All Teams), Explosion Sound, Color(White), Event Player, 200);
            Set Player Variable(Event Player, active_ab_cooldown, 20);
        Else If(Compare((Event Player).active_ab_number, ==, 3));
            Set Player Variable(Event Player, active_ab_cooldown, -1);
            Set Global Variable(temp_1, Players Within Radius(Eye Position(Event Player), 6, Team 2, Surfaces));
            Damage(Global.temp_1, Event Player, 100);
            Apply Impulse(Event Player, If-Then-Else(Compare(Throttle Of(Event Player), !=, Vector(0, 0, 0)), Throttle Of(Event Player), Forward), 25, To Player, Cancel Contrary Motion);
            Play Effect(All Players(All Teams), Bad Explosion, Color(Black), Eye Position(Event Player), 6);
            Play Effect(All Players(All Teams), Explosion Sound, Color(White), Event Player, 200);
            Set Gravity(Event Player, 0);
            Set Status(Event Player, Null, Phased Out, 0.7);
            Wait(0.6, Ignore Condition);
            Set Gravity(Event Player, 100);
            Set Global Variable(temp_1, Players Within Radius(Eye Position(Event Player), 6, Team 2, Surfaces));
            Damage(Global.temp_1, Event Player, 100);
            Play Effect(All Players(All Teams), Bad Explosion, Color(Black), Eye Position(Event Player), 6);
            Play Effect(All Players(All Teams), Explosion Sound, Color(White), Event Player, 200);
            Set Player Variable(Event Player, active_ab_cooldown, 10);
            Wait(1, Ignore Condition);
        Else If(Compare((Event Player).active_ab_number, ==, 4));
            Set Player Variable(Event Player, active_ab_is_frenzied, True);
            Set Status(Event Player, Null, Invincible, 5);
            For Player Variable(Event Player, active_ab_cooldown, -5, 0, 1);
                Set Player Variable(Event Player, last_damage_taken_t, Total Time Elapsed);
                Wait(1, Ignore Condition);
            End;
            Set Player Variable(Event Player, active_ab_is_frenzied, False);
            Set Player Variable(Event Player, active_ab_cooldown, 30);
        Else If(Compare((Event Player).active_ab_number, ==, 5));
            Set Player Variable(Event Player, active_ab_var, Add(Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Vector(0, -2, 0)), Null, Null, False), Vector(0, 2, 0)));
            For Player Variable(Event Player, active_ab_cooldown, -10, 0, 0.5);
                Set Player Variable(Filtered Array(Global.combatants, And(Compare(Distance Between(Eye Position(Current Array Element), Vector(X Component Of((Event Player).active_ab_var), Y Component Of(Eye Position(Current Array Element)), Z Component Of((Event Player).active_ab_var))), <=, 10), Compare(Absolute Value(Subtract(Y Component Of(Eye Position(Current Array Element)), Y Component Of((Event Player).active_ab_var))), <=, 5))), active_ab_is_smoked, True);
                Wait(0.5, Ignore Condition);
            End;
            Set Player Variable(Event Player, active_ab_cooldown, 20);
        Else If(Compare((Event Player).active_ab_number, ==, 6));
            For Player Variable(Event Player, active_ab_cooldown, -5, 0, 0.25);
                If(Compare(Normalized Health(Event Player), !=, 1));
                    Heal(Event Player, Null, 75);
                End;
                If(Compare(Normalized Health(Event Player), ==, 1));
                    Heal(First Of(Sorted Array(Filtered Array(Players Within Radius(Event Player, 15, Team 1, Off), And(And((Current Array Element).is_combatant, Not((Current Array Element).downed_start_t)), Compare(Normalized Health(Current Array Element), !=, 1))), Normalized Health(Current Array Element))), Null, 75);
                End;
                Wait(0.25, Ignore Condition);
            End;
            Set Player Variable(Event Player, active_ab_cooldown, 25);
        Else If(Compare((Event Player).active_ab_number, ==, 7));
            Set Player Variable(Event Player, active_ab_var, Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Multiply(100, Facing Direction Of(Event Player))), All Players(Team 2), Null, True));
            Play Effect(All Players(All Teams), Good Explosion, Color(White), (Event Player).active_ab_var, 8);
            Play Effect(All Players(All Teams), Explosion Sound, Color(White), (Event Player).active_ab_var, 200);
            For Player Variable(Event Player, active_ab_cooldown, -6, 0, 1);
                Set Global Variable(temp_1, Filtered Array(All Living Players(Team 2), And(Not(Or(Has Status(Current Array Element, Phased Out), Has Status(Current Array Element, Stunned))), Compare(Distance Between((Event Player).active_ab_var, Eye Position(Current Array Element)), <=, 8))));
                Start Damage Over Time(Global.temp_1, Event Player, 2, 40);
                For Global Variable(temp_2, 0, Count Of(Global.temp_1), 1);
                    Set Player Variable(Value In Array(Global.temp_1, Global.temp_2), gmut_fortified_bypass_end_t, Max(Total Time Elapsed, (Value In Array(Global.temp_1, Global.temp_2)).gmut_fortified_bypass_end_t));
                    Set Status(Value In Array(Global.temp_1, Global.temp_2), Event Player, Stunned, If-Then-Else((Value In Array(Global.temp_1, Global.temp_2)).is_fortified, 0.5, 1));
                End;
                Wait(2, Ignore Condition);
            End;
            Set Player Variable(Event Player, active_ab_cooldown, 35);
        Else If(Compare((Event Player).active_ab_number, ==, 8));
            Set Global Variable(temp_1, Last Of(Sorted Array(Filtered Array(All Living Players(Team 2), And(And(Not(Or(Has Status(Current Array Element, Phased Out), (Current Array Element).iv_is_portal)), Is In View Angle(Event Player, Current Array Element, 45)), Is In Line of Sight(Eye Position(Event Player), Eye Position(Current Array Element), Barriers Do Not Block LOS))), Dot Product(Facing Direction Of(Event Player), Direction Towards(Eye Position(Event Player), Current Array Element)))));
            If(Global.temp_1);
                Set Status(Global.temp_1, Event Player, Hacked, 5);
                Modify Player Variable(Event Player, active_ab_var, Append To Array, Global.temp_1);
                For Global Variable(temp_2, 4, 1, -1);
                    Set Global Variable(temp_1, First Of(Sorted Array(Filtered Array(Remove From Array(All Living Players(Team 2), (Event Player).active_ab_var), And(Not(Or(Has Status(Current Array Element, Phased Out), (Current Array Element).iv_is_portal)), Is In Line of Sight(Global.temp_1, Current Array Element, Barriers Do Not Block LOS))), Distance Between(Global.temp_1, Current Array Element))));
                    If(Global.temp_1);
                        Set Status(Global.temp_1, Event Player, Hacked, Global.temp_2);
                        Modify Player Variable(Event Player, active_ab_var, Append To Array, Global.temp_1);
                    Else;
                        Break;
                    End;
                End;
                Damage((Event Player).active_ab_var, Event Player, 5);
                Set Player Variable(Event Player, active_ab_cooldown, -0.8);
                Wait(0.8, Ignore Condition);
                Set Player Variable(Event Player, active_ab_var, Empty Array);
                Set Player Variable(Event Player, active_ab_cooldown, 25);
            Else;
                Set Player Variable(Event Player, active_ab_cooldown, 1);
            End;
        End;
        For Player Variable(Event Player, active_ab_cooldown, (Event Player).active_ab_cooldown, 0, -1);
            Wait(1, Ignore Condition);
        End;
    }
}

rule ("Team 1 (Ability): Priority C") {
    event {
        Player Dealt Healing;
        Team 1;
        All;
    }
    actions {
        Abort If(Compare(Not((Event Player).ab_priority), ==, 3));
        Abort If(Compare(Healee, ==, Event Player));
        Abort If(Not(Event Healing));
        Set Player Health(Event Player, Add(Health(Event Player), Multiply(0.4, Event Healing)));
    }
}

rule ("Team 1 (Ability): Charged") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_charged == True;
        Ultimate Charge Percent(Event Player) < Multiply((Event Player).ab_charged, 15);
    }
    actions {
        Set Ultimate Charge(Event Player, Multiply((Event Player).ab_charged, 15));
        "Workaround: Sets Ultimate Charge to a higher value for duplicating Echo"
        If(Is Duplicating(Event Player));
            Wait(0.016, Ignore Condition);
            Set Ultimate Charge(Event Player, Multiply((Event Player).ab_charged, 15));
    }
}

rule ("Team 1 (Ability): Haste Primary Fire") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_haste == True;
        Ability Cooldown(Event Player, Button(Primary Fire)) > 0.1;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Primary Fire), Multiply(Subtract(1, Multiply(0.25, (Event Player).ab_haste)), Ability Cooldown(Event Player, Button(Primary Fire))));
    }
}

rule ("Team 1 (Ability): Haste Secondary Fire") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_haste == True;
        Ability Cooldown(Event Player, Button(Secondary Fire)) > 0.1;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Secondary Fire), Multiply(Subtract(1, Multiply(0.25, (Event Player).ab_haste)), Ability Cooldown(Event Player, Button(Secondary Fire))));
    }
}

rule ("Team 1 (Ability): Haste Ability 1") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_haste == True;
        Ability Cooldown(Event Player, Button(Ability 1)) > 0.1;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Ability 1), Multiply(Subtract(1, Multiply(0.25, (Event Player).ab_haste)), Ability Cooldown(Event Player, Button(Ability 1))));
    }
}

rule ("Team 1 (Ability): Haste Ability 2") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_haste == True;
        Ability Cooldown(Event Player, Button(Ability 2)) > 0.1;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Ability 2), Multiply(Subtract(1, Multiply(0.25, (Event Player).ab_haste)), Ability Cooldown(Event Player, Button(Ability 2))));
    }
}

rule ("Team 1 (Ability): Haste Jump") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_haste == True;
        Ability Cooldown(Event Player, Button(Jump)) > 0.1;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Jump), Multiply(Subtract(1, Multiply(0.25, (Event Player).ab_haste)), Ability Cooldown(Event Player, Button(Jump))));
    }
}

rule ("Team 1 (Ability): Haste Crouch") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_haste == True;
        Ability Cooldown(Event Player, Button(Crouch)) > 0.1;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Crouch), Multiply(Subtract(1, Multiply(0.25, (Event Player).ab_haste)), Ability Cooldown(Event Player, Button(Crouch))));
    }
}

rule ("Team 1 (Ability): Headhunter") {
    event {
        Player Dealt Damage;
        Team 1;
        All;
    }
    actions {
        Abort If(Not((Event Player).ab_headhunter));
        Abort If(Not(Event Was Critical Hit));
        Damage(Victim, Event Player, Multiply(Divide(Multiply((Event Player).ab_headhunter, 30), (Event Player).Damage_Dealt), Event Damage));
    }
}

rule ("Team 1 (Ability): Priority B") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_priority == 2;
        Add((Event Player).last_damage_taken_t, 3) < Total Time Elapsed;
    }
    actions {
        Modify Player Variable(Event Player, Damage_Dealt, Add, 20);
        Modify Player Variable(Event Player, Move_Speed, Add, 20);
        Wait Until(Or(Compare(Add((Event Player).last_damage_taken_t, 3), >=, Total Time Elapsed), Compare((Event Player).perk_mystery_swap, ==, Add(Total Time Elapsed, 90))), 99999);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 20);
        Modify Player Variable(Event Player, Move_Speed, Subtract, 20);
    }
}

rule ("Team 1 (Ability): Quick Fix") {
    event {
        Player Earned Elimination;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_quick_fix == True;
    }
    actions {
        Heal(Event Player, Null, Multiply((Event Player).ab_quick_fix, 50));
        If(Not((Event Player).current_quick_fix_speed_bonus));
            Set Player Variable(Event Player, current_quick_fix_speed_bonus, Multiply((Event Player).ab_quick_fix, 15));
            Modify Player Variable(Event Player, Move_Speed, Add, (Event Player).current_quick_fix_speed_bonus);
        End;
        Wait(5, Restart When True);
        Modify Player Variable(Event Player, Move_Speed, Subtract, (Event Player).current_quick_fix_speed_bonus);
        Set Player Variable(Event Player, current_quick_fix_speed_bonus, False);
    }
}

rule ("Team 1 (Ability): Second Wind") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).ab_second_wind == True;
        (Event Player).downed_start_t == True;
        Add((Event Player).downed_start_t, 0.9) < Total Time Elapsed;
    }
    actions {
        Small Message(All Players(All Teams), Custom String("{0} received a second wind!", Event Player));
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(Green), Event Player, 1);
        Set Status(Event Player, Null, Phased Out, 3.5);
        Set Player Variable(Event Player, downed_start_t, False);
        Wait(Subtract(120, Multiply(30, (Event Player).ab_second_wind)), Ignore Condition);
    }
}

rule ("Team 1 (Perk): Mystery Swap") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).perk_mystery_swap != False;
        (Event Player).perk_mystery_swap < Total Time Elapsed;
        (Event Player).downed_start_t == False;
    }
    actions {
        Wait(1, Abort When False);
        Abort If Condition Is False;
        If((Event Player).Talent1);
            Set Player Variable At Index(Event Player, Swapped_Talent_Array, 1, True);
            Set Player Variable(Event Player, Talent1, False);
        End;
        If((Event Player).Talent2);
            Set Player Variable At Index(Event Player, Swapped_Talent_Array, 2, True);
            Set Player Variable(Event Player, Talent2, False);
        End;
        Set Player Variable(Event Player, perk_mystery_swap, Add(Total Time Elapsed, 90));
        Wait(0.2, Ignore Condition);
        Start Forcing Player To Be Hero(Event Player, Random Value In Array(Remove From Array(All Heroes, Hero Of(Event Player))));
        Set Player Variable(Event Player, is_invisible, False);
        Set Player Variable(Event Player, last_damage_taken_t, 0);
        Wait(0.1, Ignore Condition);
        If(Value In Array((Event Player).Swapped_Talent_Array, 1));
            Set Player Variable At Index(Event Player, Swapped_Talent_Array, 1, False);
            Set Player Variable(Event Player, Talent1, True);
        End;
        If(Value In Array((Event Player).Swapped_Talent_Array, 2));
            Set Player Variable At Index(Event Player, Swapped_Talent_Array, 2, False);
            Set Player Variable(Event Player, Talent2, True);
        End;
        Set Ultimate Charge(Event Player, 100);
        Call Subroutine(update_ab_string_and_play_sound);
    }
}

rule ("Team 1 (Perk): Bulletstorm") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).perk_bulletstorm == True;
        Or(Compare(Ammo(Event Player, False), <, Max Ammo(Event Player, False)), Compare(Ammo(Event Player, 1), <, Max Ammo(Event Player, 1))) == True;
    }
    actions {
        Set Ammo(Event Player, False, 1000);
        Set Ammo(Event Player, 1, 1000);
    }
}

rule ("Team 1 (Perk): Nemesis") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        Is Dead((Event Player).nemesis_killer) == True;
    }
    actions {
        Wait(0.2, Abort When False);
        Abort If(Not((Event Player).downed_start_t));
        Small Message(All Players(All Teams), Custom String("{0}'s Nemesis was killed!", Event Player));
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(Green), Event Player, 1);
        Set Player Variable(Event Player, downed_start_t, False);
    }
}

rule ("Team 1 (Perk): Brass Knuckles") {
    event {
        Player Dealt Knockback;
        Team 1;
        All;
    }
    actions {
        Abort If(Not((Event Player).perk_brass_knuckles));
        Abort If(Compare(Event Ability, !=, Button(Melee)));
        Abort If((Victim).iv_is_portal);
        Abort If(Is Dead(Victim));
        Set Player Variable(Victim, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, 1.75), (Victim).gmut_fortified_bypass_end_t));
        Set Status(Victim, Event Player, Knocked Down, If-Then-Else((Victim).is_fortified, 1.75, 2.5));
        Abort If(Not(Has Status(Victim, Stunned)));
        Wait(0.25, Restart When True);
        Wait(15, Ignore Condition);
        Small Message(Event Player, Custom String("Brass Knuckles Ready"));
    }
}

rule ("Team 1 (Perk): Crash N' Dash") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).perk_crash_n_dash == True;
        Speed Of(Event Player) >= 8;
    }
    actions {
        Heal(Event Player, Null, 10);
        Wait(0.2, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 1 (Perk): Vampiric Heal") {
    event {
        Player Dealt Damage;
        Team 1;
        All;
    }
    actions {
        Abort If(Not((Event Player).perk_vampiric));
        Heal(Event Player, Null, Multiply(Event Damage, 0.3));
    }
}

rule ("Team 1 (Perk): Supercharge") {
    event {
        Player Dealt Healing;
        Team 1;
        All;
    }
    actions {
        Abort If(Not((Event Player).perk_super_charge));
        Abort If(Compare(Healee, ==, Event Player));
        Abort If(Not(Event Healing));
        Set Ultimate Charge(Healee, Add(Add(Ultimate Charge Percent(Healee), 1), Multiply(Event Healing, 0.03)));
        Wait(0.75, Ignore Condition);
    }
}

rule ("Team 2 (Mutator): Artful Dodger") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Global.mut_artful_dodger == True;
        (Event Player).can_dodge == False;
        Is Alive(Event Player) == True;
    }
    actions {
        Set Player Variable(Event Player, can_dodge, True);
    }
}

rule ("MUT Team 2 (Mutator): Swan Song") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Global.mut_swan_song == True;
        Is Alive(Event Player) == True;
        (Event Player).is_living_boss == True;
    }
    actions {
        Set Status(Event Player, Null, Unkillable, 9999);
        Wait Until(Compare(Health(Event Player), <=, 1), 99999);
        Create Effect(All Players(All Teams), Echo Cloning Effect, Color(Team 1), Event Player, 1, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(Violet), Event Player, 1);
        Set Status(Event Player, Null, Stunned, 1);
        Wait Until(Is Dead(Event Player), 5);
        Clear Status(Event Player, Unkillable);
        Kill(Event Player, Null);
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
    }
}

rule ("MUT Team 2: Counterstrike") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Global.mut_counterstrike == True;
        (Event Player).is_using_boss_aggression == False;
        Is Using Ultimate((Event Player).target) == True;
    }
    actions {
        Set Player Variable(Event Player, is_aggressive, Not((Event Player).is_aggressive));
        Wait(4, Ignore Condition);
        Loop If Condition Is True;
        Set Player Variable(Event Player, is_aggressive, True);
        If(And(Compare(Random Integer(1, 100), >, 75), Compare(Hero Of(Event Player), !=, Hero(Soldier: 76))));
            Wait(Random Real(3, 7), Ignore Condition);
            Set Ultimate Charge(Event Player, 100);
            Press Button(Event Player, Button(Ultimate));
            Wait(Random Real(1, 2), Ignore Condition);
            Press Button(Event Player, Button(Primary Fire));
        End;
        Loop If Condition Is True;
    }
}

rule ("MUT Team 2 (Mutator): Low B­low") {
    event {
        Player Dealt Knockback;
        Team 2;
        All;
    }
    actions {
        Abort If(Not(Global.mut_low_blow));
        Damage(Victim, Event Player, Multiply(0.5, Event Damage));
    }
}

rule ("MUT Team 2 (Mutator) Cassidy: Fully Loaded, Magnade") {
    event {
        Ongoing - Each Player;
        Team 2;
        Cassidy;
    }
    conditions {
        Or((Event Player).is_living_boss, Global.mut_fully_loaded) == True;
        Global.wave_number >= 4;
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 40));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 8));
        Press Button(Event Player, Button(Ability 2));
        Wait(10, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("MUT Team 2 Echo (Mutator): Fully Loaded, Focusing Beam") {
    event {
        Ongoing - Each Player;
        Team 2;
        Echo;
    }
    conditions {
        Global.mut_fully_loaded == True;
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Normalized Health((Event Player).target), >, 0.5));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 15));
        Press Button(Event Player, Button(Ability 2));
        Wait(10, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("MUT Team 2 (Mutator) Team 2 Ana: Fully Loaded, Sleep Dart") {
    event {
        Ongoing - Each Player;
        Team 2;
        Ana;
    }
    conditions {
        Global.mut_fully_loaded == True;
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 40));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 10));
        Press Button(Event Player, Button(Ability 1));
        Wait(13, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("MUT Team 2 Pharah (Mutator): Fully Loaded, Concussive Blast") {
    event {
        Ongoing - Each Player;
        Team 2;
        Pharah;
    }
    conditions {
        Global.mut_fully_loaded == True;
        (Event Player).is_target_in_los == True;
        Is Using Ability 1(Event Player) == False;
    }
    actions {
        Wait(1, Abort When False);
        Press Button(Event Player, Button(Ability 2));
    }
}

rule ("Team 1 Doomfist: Meteor Strike (Invisibility 2, not detectable)") {
    event {
        Ongoing - Each Player;
        Team 1;
        Doomfist;
    }
    conditions {
        Is Using Ultimate(Event Player) == True;
    }
    actions {
        Set Player Variable(Event Player, is_invisible, 2);
        Wait Until(Not(Is Using Ultimate(Event Player)), 99999);
        Set Player Variable(Event Player, is_invisible, False);
    }
}

rule ("Team 1 D.Va: Fill Ultimate Charge when downed") {
    event {
        Ongoing - Each Player;
        Team 1;
        D.Va;
    }
    conditions {
        (Event Player).downed_start_t == True;
        Ultimate Charge Percent(Event Player) != 100;
    }
    actions {
        Wait(0.05, Abort When False);
        Set Ultimate Charge(Event Player, 100);
    }
}

rule ("Team 1 Echo: Stealth (Invisibility 1, detectable)") {
    event {
        Ongoing - Each Player;
        Team 1;
        Echo;
    }
    conditions {
        Hero Being Duplicated(Event Player) == Hero(Sombra);
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Wait(0.8, Abort When False);
        Set Player Variable(Event Player, is_invisible, 1);
        Wait Until(Not(Is Using Ability 1(Event Player)), 99999);
        Set Player Variable(Event Player, is_invisible, False);
    }
}

rule ("Team 1 Echo: Remove Stealth when Duplicate ends") {
    event {
        Ongoing - Each Player;
        Team 1;
        Echo;
    }
    conditions {
        (Event Player).is_invisible == 1;
        Is Duplicating(Event Player) == False;
    }
    actions {
        Set Player Variable(Event Player, is_invisible, False);
    }
}

rule ("Team 1 Echo: Cancel Charge on Boss Enemies") {
    event {
        Player Dealt Knockback;
        Team 1;
        Echo;
    }
    actions {
        Abort If(Compare(Hero Being Duplicated(Event Player), !=, Hero(Reinhardt)));
        Abort If(Compare(Event Ability, !=, Null));
        Abort If(Not((Victim).is_living_boss));
        Damage(Victim, Event Player, 150);
        Cancel Primary Action(Event Player);
        Set Player Variable(Victim, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, 1.2), (Victim).gmut_fortified_bypass_end_t));
        Set Status(Victim, Event Player, Stunned, 1.2);
    }
}

rule ("Team 1 Echo: Cancel Chain Hook on Boss Enemies") {
    event {
        Player Dealt Damage;
        Team 1;
        Echo;
    }
    actions {
        Abort If(Compare(Hero Being Duplicated(Event Player), !=, Hero(Roadhog)));
        Abort If(Compare(Event Ability, !=, Button(Ability 1)));
        Abort If(Not((Victim).is_living_boss));
        Abort If(Not(Is Using Ability 1(Event Player)));
        Cancel Primary Action(Event Player);
        Wait(0.016, Ignore Condition);
        Set Player Variable(Victim, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, 1), (Victim).gmut_fortified_bypass_end_t));
        Set Status(Victim, Event Player, Stunned, 1);
    }
}

rule ("Team 1 Mercy: Revive Ability (Player)") {
    event {
        Ongoing - Each Player;
        Team 1;
        Mercy;
    }
    conditions {
        Is Button Held(Event Player, (Event Player).mercy_res_button) == True;
        Ability Cooldown(Event Player, Button(Ability 2)) == False;
        "Workaround: Check Cooldown for Controller Players"
        Ability Cooldown(Event Player, Button(Secondary Fire)) == False;
        (Event Player).downed_start_t == False;
        Has Status(Event Player, Hacked) == False;
        Has Status(Event Player, Stunned) == False;
    }
    actions {
        Set Player Variable(Event Player, ab_player, Last Of(Sorted Array(Filtered Array(Players Within Radius(Event Player, 10, Team 1, Off), And(And(And((Current Array Element).is_combatant, (Current Array Element).downed_start_t), Compare(Add((Current Array Element).downed_start_t, 0.1), <, Total Time Elapsed)), Is In View Angle(Event Player, Current Array Element, 45))), Dot Product(Facing Direction Of(Event Player), Direction Towards(Eye Position(Event Player), Current Array Element)))));
        If((Event Player).ab_player);
            Small Message(All Players(All Teams), Custom String("{0} has been resurrected by {1}!", (Event Player).ab_player, Event Player));
            Set Player Variable((Event Player).ab_player, downed_start_t, False);
            Play Effect(All Players(All Teams), Good Pickup Effect, Color(Sky Blue), (Event Player).ab_player, 1);
            Set Global Variable(temp_1, Multiply(If-Then-Else(Or(Global.is_hard_mode_enabled, Global.is_apocalyptic), 1.5, 1), Value In Array(Array(30, 33.333, 40), (Event Player).ab_haste)));
            Set Ability Cooldown(Event Player, Button(Ability 2), Global.temp_1);
            "Workaround: Set Cooldown for Controller Players"
            Set Ability Cooldown(Event Player, Button(Secondary Fire), Global.temp_1);
        End;
        Wait(0.05, Ignore Condition);
    }
}

rule ("IV Team 1 Moira: Biotic Grasp on Portal Simulation") {
    event {
        Ongoing - Each Player;
        Team 1;
        Moira;
    }
    conditions {
        Global.gamemode == False;
        Global.objective_phase_number == 1;
        Is Firing Secondary(Event Player) == True;
    }
    actions {
        If(And(Compare(Distance Between(Eye Position(Event Player), Add(Global.iv_dom_objective_pos, Vector(0, 1.11, 0))), <=, 20), Is In Line of Sight(Eye Position(Event Player), Add(Global.iv_dom_objective_pos, Vector(0, 1.11, 0)), Barriers Do Not Block LOS)));
            "If Facing ray intersects sphere"
            If(Compare(Distance Between(Add(Global.iv_dom_objective_pos, Vector(0, 1.11, 0)), Add(Eye Position(Event Player), Multiply(Max(0, Dot Product(Facing Direction Of(Event Player), Vector Towards(Eye Position(Event Player), Add(Global.iv_dom_objective_pos, Vector(0, 1.11, 0))))), Facing Direction Of(Event Player)))), <=, 0.85));
                Damage(Players In Slot(0, Team 2), Event Player, 9.6);
            End;
        End;
        Wait(0.192, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 1 Sombra: Stealth (Invisibility 1, detectable), end after 20 seconds") {
    event {
        Ongoing - Each Player;
        Team 1;
        Sombra;
    }
    conditions {
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Wait(0.8, Abort When False);
        Set Player Variable(Event Player, is_invisible, 1);
        For Player Variable(Event Player, sombra_stealth_timer, 100, 0, -0.48);
            Wait Until(Not(Is Using Ability 1(Event Player)), 0.096);
            If(Not(Is Using Ability 1(Event Player)));
                Break;
            End;
        End;
        If(Is Using Ability 1(Event Player));
            Press Button(Event Player, Button(Ability 1));
        End;
        Set Player Variable(Event Player, is_invisible, False);
    }
}

rule ("Team 1 Reinhardt: Cancel Charge on Boss Enemies") {
    event {
        Player Dealt Knockback;
        Team 1;
        Reinhardt;
    }
    actions {
        Abort If(Compare(Event Ability, !=, Null));
        Abort If(Not((Victim).is_living_boss));
        Damage(Victim, Event Player, 250);
        Cancel Primary Action(Event Player);
        Set Player Variable(Victim, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, 1.2), (Victim).gmut_fortified_bypass_end_t));
        Set Status(Victim, Event Player, Stunned, 1.2);
    }
}

rule ("Team 1 Roadhog: Cancel Chain Hook on Boss Enemies") {
    event {
        Player Dealt Damage;
        Team 1;
        Roadhog;
    }
    actions {
        Abort If(Compare(Event Ability, !=, Button(Ability 1)));
        Abort If(Not((Victim).is_living_boss));
        Abort If(Not(Is Using Ability 1(Event Player)));
        Cancel Primary Action(Event Player);
        Wait(0.016, Ignore Condition);
        Set Player Variable(Victim, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, 1), (Victim).gmut_fortified_bypass_end_t));
        Set Status(Victim, Event Player, Stunned, 1);
    }
}

rule ("Team 1 Tracer: Start Health Regeneration after Recall") {
    event {
        Ongoing - Each Player;
        Team 1;
        Tracer;
    }
    conditions {
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        Wait(0.85, Ignore Condition);
        Set Player Variable(Event Player, last_damage_taken_t, False);
    }
}

rule ("Team 1 Zenyatta: Harmony target is harder to hit") {
    event {
        Player Dealt Healing;
        Team 1;
        Zenyatta;
    }
    actions {
        Abort If(Compare(Event Ability, !=, Button(Ability 1)));
        Set Player Variable(Healee, active_ab_is_smoked, True);
        Wait(1, Ignore Condition);
    }
}

rule ("Subroutine: Spawn Reinforcements") {
    event {
        Subroutine;
        call_reinforcements;
    }
    actions {
        Modify Global Variable(special_spawns_count, Add, Add(Global.is_apocalyptic, If-Then-Else(Compare(Global.wave_number, >=, 5), 2, 1)));
    }
}

rule ("Subroutine: Teleport to free Spawn") {
    event {
        Subroutine;
        teleport_to_free_spawn;
    }
    actions {
        If(And(And(Compare(Global.gamemode, ==, 0), Or(Compare((Event Player).base_tier, ==, -1), Compare(Global.special_spawns_count, >, 0))), Not((Event Player).is_alive)));
            Set Player Variable(Event Player, is_nav_reachable_node, False);
            If(And(Compare((Event Player).base_tier, ==, -1), Compare(Global.objective_phase_number, ==, 0)));
                Teleport(Event Player, Vector(0, 100, 0));
            Else;
                Teleport(Event Player, Add(Global.iv_dom_objective_pos, Up));
            End;
        Else If(And(And(And(Compare(Global.gamemode, ==, 1), Compare(Global.hvt_call_reinforcements_end_t, >=, Total Time Elapsed)), Compare(Global.special_spawns_count, >, 0)), Not((Event Player).is_alive)));
            Set Player Variable(Event Player, is_nav_reachable_node, False);
            Teleport(Event Player, Players In Slot(1, Team 2));
        Else If(And(Compare(Global.gamemode, ==, 2), Compare(Global.objective_phase_number, ==, 0)));
            Set Player Variable(Event Player, nav_idx, Value In Array(Global.iv_dom_objective_pos, If-Then-Else(Compare(Slot Of(Event Player), ==, 2), 2, 3)));
            Set Player Variable(Event Player, dom_nav_guard_idx, (Event Player).nav_idx);
            Set Player Variable(Event Player, nav_pos, Value In Array(Global.nodes, (Event Player).nav_idx));
            Set Player Variable(Event Player, is_nav_reachable_node, True);
            Teleport(Event Player, Add((Event Player).nav_pos, Multiply(0.1, Direction From Angles(Horizontal Angle From Direction(Direction Towards(Value In Array(Global.iv_dom_objective_pos, If-Then-Else(Compare(Slot Of(Event Player), ==, 2), 0, 1)), (Event Player).nav_pos)), False))));
        Else;
            Set Global Variable(temp_2, Mapped Array(Global.spawn_pos_list, False));
            For Global Variable(temp_1, 0, Count Of(Global.spawn_pos_list), 1);
                If(Is True For Any(Global.combatants, Is In Line of Sight(Add(Value In Array(Global.spawn_pos_list, Global.temp_1), Up), Eye Position(Current Array Element), Barriers Do Not Block LOS)));
                    Set Global Variable At Index(temp_2, Global.temp_1, 2);
                Else If(Is True For Any(Global.combatants, Compare(Distance Between(Value In Array(Global.spawn_pos_list, Global.temp_1), Current Array Element), <=, 10)));
                    Set Global Variable At Index(temp_2, Global.temp_1, 1);
                End;
            End;
            Set Global Variable(temp_1, First Of(Sorted Array(Global.spawn_pos_list, Add(Value In Array(Global.temp_2, Current Array Index), Random Real(0, 0.5)))));
            Set Player Variable(Event Player, nav_idx, Value In Array(Global.spawn_nearest_node_idx_list, Index Of Array Value(Global.spawn_pos_list, Global.temp_1)));
            Set Player Variable(Event Player, nav_pos, Value In Array(Global.nodes, (Event Player).nav_idx));
            Set Player Variable(Event Player, is_nav_reachable_node, True);
            Teleport(Event Player, Global.temp_1);
        End;
    }
}

rule ("Subroutine: Find WP near Nav (find a walkable position near the Nav and check if it's reachable)") {
    event {
        Subroutine;
        find_wp_near_nav;
    }
    actions {
        Set Global Variable(temp_1, Nearest Walkable Position((Event Player).nav_pos));
        "If NWP is valid and not too far from the original destination"
        If(And(Compare(Global.temp_1, !=, Empty Array), Compare(Distance Between((Event Player).nav_pos, Global.temp_1), <, 3)));
            Set Player Variable(Event Player, nav_pos, Global.temp_1);
        Else;
            "If original destination is not walkable"
            If(Compare(Distance Between(Add((Event Player).nav_pos, Up), Ray Cast Hit Position(Add((Event Player).nav_pos, Up), Add((Event Player).nav_pos, Vector(0, -2, 0)), Null, Null, False)), >=, 3));
                "Ranged bots stand still"
                If(Or(Or(Global.is_load_limit_reached, (Event Player).is_ranged), Compare(Distance Between(Event Player, (Event Player).target), <, 2)));
                    Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
                    Abort;
                Else;
                    Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(Min(3.5, Subtract(Distance Between(Event Player, (Event Player).target), 2)), Direction Towards(Event Player, (Event Player).target))));
                    If(Is On Ground(Event Player));
                        "Check if destination is not walkable"
                        If(Compare(Distance Between(Add((Event Player).nav_pos, Up), Ray Cast Hit Position(Add((Event Player).nav_pos, Up), Add((Event Player).nav_pos, Vector(0, -2, 0)), Null, Null, False)), >=, 3));
                            Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
                            Modify Player Variable(Event Player, is_using_combat_pathfinding, Subtract, 1);
                            Abort;
                        End;
                    End;
                End;
            End;
        End;
        "Check if the destination is reachable"
        If(Is On Ground(Event Player));
            Set Global Variable(temp_1, Add(Add(Position Of(Event Player), Multiply(1.75, Direction Towards(Event Player, (Event Player).nav_pos))), Up));
            "If bot is near a ledge"
            If(Compare(Distance Between(Global.temp_1, Ray Cast Hit Position(Global.temp_1, Add(Global.temp_1, Vector(0, -3, 0)), Null, Null, False)), >=, 3));
                Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
                If(Not((Event Player).is_ranged));
                    Modify Player Variable(Event Player, is_using_combat_pathfinding, Subtract, 1);
                    Abort;
                End;
            End;
        End;
        Set Player Variable(Event Player, is_using_combat_pathfinding, 3);
    }
}

rule ("Subroutine: Check Drop (Avoid dropping too low)") {
    event {
        Subroutine;
        check_drop;
    }
    actions {
        If(Global.is_load_limit_reached);
            Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
            Abort;
        End;
        Set Global Variable(temp_1, Add(Add(Position Of(Event Player), Multiply(1.75, Direction Towards(Event Player, Vector(X Component Of((Event Player).nav_pos), Y Component Of(Position Of(Event Player)), Z Component Of((Event Player).nav_pos))))), Up));
        If(Compare(Distance Between(Global.temp_1, Ray Cast Hit Position(Global.temp_1, Add(Global.temp_1, Vector(0, -30, 0)), Null, Null, False)), >=, Add(Subtract(Y Component Of(Global.temp_1), Y Component Of(Position Of((Event Player).target))), 5)));
            Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
            Modify Player Variable(Event Player, is_using_combat_pathfinding, Subtract, 1);
            Abort;
        End;
        Set Global Variable(temp_1, Add(Add(Position Of(Event Player), Multiply(3.5, Direction Towards(Event Player, Vector(X Component Of((Event Player).nav_pos), Y Component Of(Position Of(Event Player)), Z Component Of((Event Player).nav_pos))))), Up));
        If(Compare(Distance Between(Global.temp_1, Ray Cast Hit Position(Global.temp_1, Add(Global.temp_1, Vector(0, -30, 0)), Null, Null, False)), >=, Add(Subtract(Y Component Of(Global.temp_1), Y Component Of(Position Of((Event Player).target))), 5)));
            Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
            Modify Player Variable(Event Player, is_using_combat_pathfinding, Subtract, 1);
            Abort;
        End;
        Set Player Variable(Event Player, is_using_combat_pathfinding, 3);
    }
}

rule ("Subroutine: Start Facing") {
    event {
        Subroutine;
        start_facing;
    }
    actions {
        If(Compare(Hero Of(Event Player), ==, Hero(Soldier: 76)));
            If(Compare((Event Player).real_tier, ==, 4));
                Start Facing(Event Player, Add(If-Then-Else(And((Event Player).is_target_in_los, Or(Not((Event Player).ab_var_1), (Event Player).is_using_combat_pathfinding)), Vector(False, False, False), Multiply(1.5, Direction Towards(Event Player, (Event Player).nav_pos))), If-Then-Else(((Event Player).target).is_combatant, Direction Towards(Eye Position(Event Player), Add(Eye Position((Event Player).target), ((Event Player).target).eye_offset)), Vector(False, False, False))), If-Then-Else(Has Status(Event Player, Stunned), 0, If-Then-Else((Event Player).ab_var_1, 1000, 300)), To World, Direction and Turn Rate);
            Else;
                Start Facing(Event Player, Add(If-Then-Else((Event Player).is_target_in_los, Vector(False, False, False), Multiply(1.5, Direction Towards(Event Player, (Event Player).nav_pos))), If-Then-Else(((Event Player).target).is_combatant, Direction Towards(Eye Position(Event Player), Add(Eye Position((Event Player).target), ((Event Player).target).eye_offset)), Vector(False, False, False))), If-Then-Else(Has Status(Event Player, Stunned), 0, If-Then-Else(Compare((Event Player).Slowed_until, >=, Total Time Elapsed), 50, 300)), To World, Direction and Turn Rate);
            End;
        Else;
            If(Or(Compare(Hero Of(Event Player), ==, Hero(Widowmaker)), Compare(Hero Of(Event Player), ==, Hero(Hanzo))));
                Start Facing(Event Player, If-Then-Else((Event Player).facing_override_direction, (Event Player).facing_override_direction, Add(If-Then-Else((Event Player).is_target_in_los, Vector(False, False, False), Multiply(1.5, Direction Towards(Event Player, (Event Player).nav_pos))), If-Then-Else(((Event Player).target).is_combatant, Direction Towards(Eye Position(Event Player), Add(Eye Position((Event Player).target), ((Event Player).target).eye_offset)), Vector(False, False, False)))), If-Then-Else(Has Status(Event Player, Stunned), 0, 300), To World, Direction and Turn Rate);
                Set Player Variable(Event Player, facing_override_direction, False);
            Else If(Not((Event Player).iv_is_portal));
                Start Facing(Event Player, Add(If-Then-Else((Event Player).is_target_in_los, Vector(False, False, False), Multiply(1.5, Direction Towards(Event Player, (Event Player).nav_pos))), If-Then-Else(((Event Player).target).is_combatant, Direction Towards(Eye Position(Event Player), Add(Eye Position((Event Player).target), ((Event Player).target).eye_offset)), Vector(False, False, False))), If-Then-Else(Has Status(Event Player, Stunned), 0, If-Then-Else(Compare((Event Player).Slowed_until, >=, Total Time Elapsed), 50, 300)), To World, Direction and Turn Rate);
            End;
        End;
    }
}

rule ("Subroutine: Find Chase Target") {
    event {
        Subroutine;
        find_chase_target;
    }
    actions {
        Abort If((Event Player).is_ignoring_other_targets);
        Set Player Variable(Event Player, target, First Of(Sorted Array(Filtered Array(Global.combatants, Not(Or(Or((Current Array Element).downed_start_t, (Current Array Element).active_ab_is_cloaked), And((Current Array Element).is_invisible, Compare(Distance Between(Event Player, Current Array Element), >, 2.4))))), Distance Between(Event Player, Current Array Element))));
    }
}

rule ("Subroutine: Update Target Nav") {
    event {
        Subroutine;
        update_target_nav;
    }
    actions {
        Set Player Variable((Event Player).target, last_nav_update_t, Total Time Elapsed);
        Set Global Variable(temp_1, Add(Eye Position((Event Player).target), ((Event Player).target).eye_offset));
        Set Player Variable((Event Player).target, best_nav_idx, Index Of Array Value(Global.nodes, First Of(Sorted Array(Filtered Array(Remove From Array(Global.nodes, Global.elevator_nodes), Is In Line of Sight(Add(Current Array Element, Vector(0, 1.5, 0)), Global.temp_1, Barriers Do Not Block LOS)), Add(Distance Between((Event Player).target, Current Array Element), Absolute Value(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Current Array Element))))))));
        If(Compare(((Event Player).target).best_nav_idx, ==, -1));
            Set Player Variable((Event Player).target, best_nav_idx, Index Of Array Value(Global.nodes, First Of(Sorted Array(Remove From Array(Global.nodes, Global.elevator_nodes), Distance Between((Event Player).target, Current Array Element)))));
        End;
    }
}

rule ("Team 2: Bot Init") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    actions {
        Set Respawn Max Time(Event Player, 9999);
        Set Player Variable(Event Player, ab_bought_abilities_string, Custom String(""));
        "Workaround: Create Boss Health Bars"
        If(Or(Compare(Slot Of(Event Player), ==, 0), And(Compare(Global.gamemode, ==, 2), Compare(Slot Of(Event Player), <=, 3))));
            Create Progress Bar In-World Text(If-Then-Else(And(Not((Event Player).iv_is_portal), (Event Player).is_living_boss), All Players(All Teams), Empty Array), Multiply(100, Normalized Health(Event Player)), Custom String(""), Event Player, 0.5, Clip Against Surfaces, Color(Red), Color(Blue), Visible To and Values, Default Visibility);
    }
}

rule ("Team 2 (Death): Field Resurrection") {
    event {
        Player Died;
        Team 2;
        All;
    }
    actions {
        Abort If(Not(Global.wave_number));
        Set Player Variable(Event Player, fear_end_t, False);
        Clear Status(Event Player, Hacked);
        If(And(Compare(Slot Of(Event Player), ==, 1), Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2))));
            If(Compare(Global.objective_phase_number, ==, 1));
                If(Global.hvt_dom_objective_killed_count);
                    Big Message(All Players(All Teams), Custom String("HVT subdued!"));
                Else;
                    Big Message(All Players(All Teams), Custom String("HVT subdued! Gained bonus health"));
                End;
                Modify Global Variable(hvt_dom_objective_killed_count, Add, 1);
                Set Global Variable(objective_phase_number, 2);
                Set Player Variable(Event Player, revive_timer, False);
                Set Player Variable(Event Player, downed_start_t, 2);
                Set Player Variable(Event Player, gmut_fortified_bypass_end_t, 100000);
            End;
            If(Event Was Environment);
                Set Global Variable(temp_1, Nearest Walkable Position(Event Player));
                Call Subroutine(nwp_teleport);
            End;
            Resurrect(Event Player);
            Clear Status(Event Player, Phased Out);
            Set Status(Event Player, Null, Invincible, 9999);
            Set Status(Event Player, Null, Knocked Down, 9999);
            Wait(0.05, Restart When True);
            Set Status(Event Player, Null, Phased Out, 9999);
            Abort;
        End;
        If(And(And(And(And(Not(Event Was Environment), Compare(Hero Of(Event Player), !=, Hero(Baptiste))), Not((Event Player).is_living_boss)), Not((Event Player).is_mutated)), Or(Global.mut_advanced_medkit, Compare((Event Player).real_tier, <, 4))));
            Set Global Variable(temp_1, Random Value In Array(Filtered Array(Players On Hero(Hero(Baptiste), Team 2), And(And(And(And(Is Alive(Current Array Element), Not(Or(Or(Has Status(Current Array Element, Hacked), Has Status(Current Array Element, Stunned)), Compare((Current Array Element).fear_end_t, >=, Total Time Elapsed)))), Compare(Add((Current Array Element).ab_var_2, If-Then-Else(Global.mut_advanced_medkit, 1, 3)), <, Total Time Elapsed)), Compare(Distance Between(Event Player, Current Array Element), <=, 10)), Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS)))));
            If(Global.temp_1);
                Communicate(Global.temp_1, You are Welcome);
                Set Player Variable(Global.temp_1, ab_var_2, Total Time Elapsed);
                Press Button(Global.temp_1, Button(Ability 1));
                Resurrect(Event Player);
                Play Effect(All Players(All Teams), Good Pickup Effect, Color(Green), Event Player, 1);
                If(Compare(Hero Of(Event Player), ==, Hero(Orisa)));
                    "Disable Fortify so that Orisa can be knocked down"
                    Set Ability Cooldown(Event Player, Button(Ability 1), 0.5);
                End;
                "Knocked Down Status is not applied when the bot is killed while stunned without a wait"
                Wait(0.016, Restart When True);
                Set Player Variable(Event Player, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, 1.75), (Event Player).gmut_fortified_bypass_end_t));
                Set Status(Event Player, Null, Knocked Down, 1.75);
                Abort;
            End;
        End;
        If(And(Global.gmut_storm_raging, (Event Player).gmut_var));
            Set Global Variable(temp_1, Array Slice(Sorted Array(Filtered Array(Players Within Radius(Eye Position(Event Player), 8, Team 2, Surfaces), And(And((Current Array Element).is_alive, Not((Current Array Element).gmut_var)), Not((Current Array Element).iv_is_portal))), Distance Between(Event Player, Current Array Element)), 0, 2));
            Set Player Variable(Global.temp_1, gmut_var, True);
            For Global Variable(temp_2, 0, Count Of(Global.temp_1), 1);
                Play Effect(All Players(All Teams), Good Pickup Effect, Color(Red), Value In Array(Global.temp_1, Global.temp_2), 1);
            End;
            Set Player Variable(Event Player, gmut_var, False);
        End;
        If(And(Compare(Global.gamemode, ==, 2), (Event Player).is_living_boss));
            Modify Global Variable(money_amount, Add, 40);
            If(Global.hvt_dom_objective_killed_count);
                Big Message(All Players(All Teams), Custom String("Killed both guards! Gained bonus health"));
                Set Global Variable(enable_normal_spawns, True);
                Call Subroutine(call_reinforcements);
                Start Rule(play_incoming_sound_twice, Do Nothing);
                Call Subroutine(upgrade_health_and_healing);
            Else;
                Big Message(All Players(All Teams), Custom String("Killed a guard!"));
            End;
            Modify Global Variable(hvt_dom_objective_killed_count, Add, 1);
        End;
        Stop Forcing Player Outlines(Event Player, All Players(All Teams));
        Stop Facing(Event Player);
        Stop Throttle In Direction(Event Player);
        Set Player Variable(Event Player, is_living_boss, False);
        Set Player Variable(Event Player, is_using_boss_aggression, False);
        Set Player Variable(Event Player, is_target_in_los, 0);
        Set Player Variable(Event Player, is_alive, False);
    }
}

rule ("Team 2 (Respawn): Reset Dummy, Change Hero") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_alive == False;
        If-Then-Else(Compare((Event Player).base_tier, ==, -1), Global.enable_objective_enemy_spawn, Or(Or(Compare(Global.special_spawns_count, >, 0), Global.enable_normal_spawns), (Event Player).is_expendable)) == True;
    }
    actions {
        If(Not(Or(Compare((Event Player).base_tier, ==, -1), And(And(Compare(Global.gamemode, ==, 2), Compare(Global.objective_phase_number, ==, 0)), Compare(Slot Of(Event Player), <=, 3)))));
            Wait(Add(0.5, Multiply(0.1, Max(0, Subtract(Slot Of(Event Player), 2)))), Abort When False);
        End;
        Stop All Damage Over Time(Event Player);
        Clear Status(Event Player, Burning);
        Clear Status(Event Player, Rooted);
        Abort If Condition Is False;
        If((Event Player).is_mutated);
            Stop Scaling Player(Event Player);
            Stop Modifying Hero Voice Lines(Event Player);
            Set Player Variable(Event Player, is_mutated, False);
            Set Global Variable(mut_mutation, Add(Total Time Elapsed, 30));
        End;
        If(And(Global.is_waiting_to_remove_bot, Compare(Slot Of(Event Player), >=, 9)));
            Set Global Variable(is_waiting_to_remove_bot, False);
            Destroy Dummy Bot(Team 2, Slot Of(Event Player));
            Abort;
        End;
        Destroy Effect((Event Player).active_ab_effect_list);
        Set Player Variable(Event Player, active_ab_effect_list, Empty Array);
        If((Event Player).is_hardwired);
            Remove Health Pool From Player(Value In Array((Event Player).HP_Pool, 4));
        End;
        If(Global.mut_bulletproof);
            Remove Health Pool From Player(Value In Array((Event Player).HP_Pool, 5));
        End;
        If(Global.mut_yakuza);
            Remove Health Pool From Player(Value In Array((Event Player).HP_Pool, 7));
        End;
        Call Subroutine(teleport_to_free_spawn);
        If(Compare(Hero Of(Event Player), ==, Hero(Soldier: 76)));
            "Select Soldier Variant"
            If(Compare(Global.special_spawns_count, >, 0));
                Modify Global Variable(special_spawns_count, Subtract, 1);
                If(Or(Compare(Global.tier_4_spawns_block_end_t, >=, Total Time Elapsed), Compare(Global.wave_number, <, 5)));
                    Set Player Variable(Event Player, real_tier, 3);
                Else;
                    Set Global Variable(tier_4_spawns_block_end_t, Add(Total Time Elapsed, 10));
                    Set Player Variable(Event Player, real_tier, 4);
                End;
            Else;
                Set Global Variable(temp_1, Add((Event Player).base_tier, And(Global.mut_promotion, Compare(Random Integer(1, 100), <=, 20))));
                If(Compare(Global.temp_1, ==, 1));
                    Set Player Variable(Event Player, real_tier, If-Then-Else(Global.mut_gear_upgrade, 2, 1));
                Else If(Compare(Global.temp_1, ==, 2));
                    Set Player Variable(Event Player, real_tier, 2);
                Else;
                    Set Player Variable(Event Player, real_tier, If-Then-Else(Or(Is True For Any(All Living Players(Team 2), And(Not((Current Array Element).is_living_boss), Compare((Current Array Element).real_tier, ==, 4))), Compare(Random Integer(1, 100), <=, 80)), 3, 4));
                End;
            End;
            Resurrect(Event Player);
            If(Compare((Event Player).real_tier, ==, 1));
                Start Forcing Dummy Bot Name(Event Player, Custom String("Trooper"));
                Set Player Variable(Event Player, combat_pathfinding_type, 0);
                Set Player Variable(Event Player, ab_var_3, True);
                Set Player Variable(Event Player, is_ranged, True);
                Set Player Variable(Event Player, can_dodge, False);
                Set Player Variable(Event Player, Damage_Dealt, 0.5);
                Set Player Variable(Event Player, health_percent, 0.333);
            Else If(Compare((Event Player).real_tier, ==, 2));
                Start Forcing Dummy Bot Name(Event Player, Custom String("Heavy Trooper"));
                Set Player Variable(Event Player, combat_pathfinding_type, 8);
                Set Player Variable(Event Player, ab_var_3, False);
                Set Player Variable(Event Player, is_ranged, False);
                Set Player Variable(Event Player, can_dodge, False);
                Set Player Variable(Event Player, Damage_Dealt, 0.45);
                Set Player Variable(Event Player, health_percent, 0.417);
            Else If(Compare((Event Player).real_tier, ==, 3));
                Start Forcing Dummy Bot Name(Event Player, Custom String("Grenadier"));
                Set Player Variable(Event Player, combat_pathfinding_type, 4);
                Set Player Variable(Event Player, ab_var_3, False);
                Set Player Variable(Event Player, is_ranged, True);
                Set Player Variable(Event Player, can_dodge, True);
                Set Player Variable(Event Player, Damage_Dealt, 0.55);
                Set Player Variable(Event Player, health_percent, 0.5);
            Else;
                Start Forcing Dummy Bot Name(Event Player, Custom String("Cloaker"));
                Create Effect(All Players(All Teams), Echo Cloning Effect, If-Then-Else(Or(Or(Compare(Evaluate Once(Add(Total Time Elapsed, 0.5)), >=, Total Time Elapsed), (Event Player).ab_var_1), (Event Player).ab_var_2), Color(Team 1), Color(Team 2)), Event Player, 1, Visible To and Color);
                Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
                Set Player Variable(Event Player, combat_pathfinding_type, 9);
                Set Player Variable(Event Player, ab_var_3, True);
                Set Player Variable(Event Player, is_ranged, False);
                Set Player Variable(Event Player, can_dodge, False);
                Set Player Variable(Event Player, Damage_Dealt, 1);
                Set Player Variable(Event Player, health_percent, 1.1);
                Set Player Variable(Event Player, real_tier, 4);
            End;
            If(Not(Global.mut_lock_n_load));
                Set Global Variable(temp_1, Value In Array(Array(30, 40, 1, 60), Subtract((Event Player).real_tier, 1)));
                Set Max Ammo(Event Player, False, Global.temp_1);
                Set Ammo(Event Player, False, Global.temp_1);
            End;
            Set Player Variable(Event Player, is_fortified, Global.gmut_fortified);
            Set Player Variable(Event Player, can_stagger, And(Not((Event Player).is_fortified), Compare((Event Player).real_tier, !=, 4)));
            Set Player Variable(Event Player, can_quick_melee, Compare((Event Player).real_tier, !=, 4));
        Else;
            "Select Hero"
            If(Compare((Event Player).base_tier, ==, -1));
                Set Player Variable(Event Player, is_living_boss, True);
                Set Global Variable(enable_objective_enemy_spawn, False);
                If(Compare(Global.gamemode, ==, 0));
                    If(Global.objective_phase_number);
                        Start Forcing Player To Be Hero(Event Player, Value In Array(Global.boss_list_1, Subtract(Global.wave_number, 1)));
                        Set Player Variable(Event Player, iv_is_portal, False);
                        Set Player Variable(Event Player, is_pathfinding_disabled, False);
                    Else;
                        Start Forcing Player To Be Hero(Event Player, Hero(Torbjörn));
                        Set Player Variable(Event Player, iv_is_portal, True);
                        Set Player Variable(Event Player, is_pathfinding_disabled, True);
                        Set Global Variable(objective_phase_number, 1);
                        Big Message(All Players(All Teams), Custom String("Portal Opened!"));
                    End;
                Else;
                    Start Forcing Player To Be Hero(Event Player, Value In Array(Global.boss_list_1, Subtract(Global.wave_number, 1)));
                    Set Global Variable(objective_phase_number, 1);
                    Set Global Variable(hvt_dom_objective_killed_count, False);
                    Set Player Variable(Event Player, is_using_boss_aggression, True);
                    Set Player Variable(Event Player, gmut_fortified_bypass_end_t, False);
                    Big Message(All Players(All Teams), Custom String("High Value Target located!"));
                End;
            Else If(And(Compare(Global.gamemode, ==, 2), Compare(Global.objective_phase_number, ==, 0)));
                Set Player Variable(Event Player, is_living_boss, True);
                Set Player Variable(Event Player, is_using_boss_aggression, True);
                Modify Global Variable(enable_objective_enemy_spawn, Subtract, 1);
                If(Compare(Slot Of(Event Player), ==, 2));
                    Start Forcing Player To Be Hero(Event Player, Value In Array(Global.boss_list_1, Subtract(Global.wave_number, 1)));
                Else;
                    Start Forcing Player To Be Hero(Event Player, Value In Array(Global.boss_list_2, Subtract(Global.wave_number, 1)));
                End;
                If(Compare(Global.enable_objective_enemy_spawn, <=, 0));
                    Set Global Variable(objective_phase_number, 1);
                    Big Message(All Players(All Teams), Custom String("Control Points located!"));
                End;
            Else If(Compare(Global.special_spawns_count, >, 0));
                Modify Global Variable(special_spawns_count, Subtract, 1);
                If(Or(Compare(Global.tier_4_spawns_block_end_t, >=, Total Time Elapsed), Compare(Global.wave_number, <, 5)));
                    Start Forcing Player To Be Hero(Event Player, First Of(Sorted Array(Filtered Array(Array(Hero(Roadhog), If-Then-Else(Global.mut_yakuza, Hero(Hanzo), False), If-Then-Else(Global.mut_yakuza, Hero(Genji), False), If-Then-Else(Global.mut_yakuza, Hero(Kiriko), False), If-Then-Else(Compare(Global.wave_number, >=, 2), Hero(Sigma), False), If-Then-Else(Compare(Global.wave_number, >=, 2), Hero(Orisa), False), If-Then-Else(Compare(Global.wave_number, >=, 3), Hero(D.Va), False), If-Then-Else(Compare(Global.wave_number, >=, 3), Hero(Tracer), False), If-Then-Else(Compare(Global.wave_number, >=, 4), Hero(Ana), False), If-Then-Else(Compare(Global.wave_number, >=, 4), Hero(Mei), False), If-Then-Else(Compare(Global.wave_number, >=, 6), Hero(Wrecking Ball), False)), Current Array Element), Add(Random Real(0, 0.5), Is Hero Being Played(Current Array Element, Team 2)))));
                Else;
                    Set Global Variable(tier_4_spawns_block_end_t, Add(Total Time Elapsed, 10));
                    Start Forcing Player To Be Hero(Event Player, First Of(Sorted Array(Filtered Array(Array(Hero(Hanzo), Hero(Genji), Hero(Kiriko), If-Then-Else(Compare(Global.wave_number, >=, 10), Hero(Reinhardt), False)), Current Array Element), Add(Random Real(0, 0.5), Number Of Heroes(Current Array Element, Team 2)))));
                End;
            Else;
                Set Global Variable(temp_1, Add((Event Player).base_tier, And(Global.mut_promotion, Compare(Random Integer(1, 100), <=, 20))));
                If(Compare(Global.temp_1, ==, 1));
                    Start Forcing Player To Be Hero(Event Player, First Of(Sorted Array(Filtered Array(Array(Hero(Cassidy), If-Then-Else(Compare(Global.wave_number, >=, 3), Hero(Brigitte), False)), Current Array Element), Add(Random Real(0, 0.5), Is Hero Being Played(Current Array Element, Team 2)))));
                Else If(Compare(Global.temp_1, ==, 2));
                    Start Forcing Player To Be Hero(Event Player, First Of(Sorted Array(Filtered Array(Array(Hero(Widowmaker), Hero(Baptiste), Hero(Zarya), Hero(Pharah), If-Then-Else(Compare(Global.wave_number, >=, 5), Hero(Echo), False), If-Then-Else(Compare(Global.wave_number, >=, 7), Hero(Sombra), False), If-Then-Else(Compare(Global.wave_number, >=, 11), Hero(Reaper), False), If-Then-Else(Compare(Global.wave_number, >=, 8), Hero(Lúcio), False)), Current Array Element), Add(Random Real(0, 0.5), Is Hero Being Played(Current Array Element, Team 2)))));
                Else;
                    Start Forcing Player To Be Hero(Event Player, First Of(Sorted Array(Filtered Array(Array(Hero(Roadhog), Hero(Wrecking Ball), Hero(Mei), If-Then-Else(Compare(Global.wave_number, >=, 6), Hero(Orisa), False), If-Then-Else(Compare(Global.wave_number, >=, 4), Hero(Sigma), False), If-Then-Else(Compare(Global.wave_number, >=, 8), Hero(Tracer), False), If-Then-Else(Compare(Global.wave_number, >=, 9), Hero(Ana), False), If-Then-Else(Compare(Global.wave_number, >=, 9), Hero(D.Va), False)), Current Array Element), Add(Random Real(0, 0.5), Is Hero Being Played(Current Array Element, Team 2)))));
                End;
            End;
            "Selected Hero is the same as current Hero"
            If(Is Dead(Event Player));
                Resurrect(Event Player);
                Set Ammo(Event Player, False, Max Ammo(Event Player, False));
                "D.Va is resurrected without mech, so remech"
                If(Compare(Hero Of(Event Player), ==, Hero(D.Va)));
                    Set Ultimate Charge(Event Player, 100);
                    Press Button(Event Player, Button(Ultimate));
                End;
            End;
            If(Or(Compare(Hero Of(Event Player), ==, Hero(Cassidy)), Compare(Hero Of(Event Player), ==, Hero(Baptiste))));
                Set Player Variable(Event Player, combat_pathfinding_type, 0);
                Set Player Variable(Event Player, is_ranged, True);
                Set Player Variable(Event Player, can_dodge, False);
            Else If(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Brigitte)), Compare(Hero Of(Event Player), ==, Hero(Reinhardt))), Compare(Hero Of(Event Player), ==, Hero(Wrecking Ball))));
                Set Player Variable(Event Player, combat_pathfinding_type, 1);
                Set Player Variable(Event Player, is_ranged, False);
                Set Player Variable(Event Player, can_dodge, False);
            Else If(Compare(Hero Of(Event Player), ==, Hero(Orisa)));
                Set Player Variable(Event Player, combat_pathfinding_type, 2);
                Set Player Variable(Event Player, is_ranged, True);
                Set Player Variable(Event Player, can_dodge, False);
            Else If(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Sombra)), Compare(Hero Of(Event Player), ==, Hero(D.Va))), Compare(Hero Of(Event Player), ==, Hero(Kiriko))));
                Set Player Variable(Event Player, combat_pathfinding_type, 3);
                Set Player Variable(Event Player, is_ranged, False);
                Set Player Variable(Event Player, can_dodge, False);
                If(Compare(Hero Of(Event Player), ==, Hero(Sombra)));
                    Create Beam Effect(If-Then-Else((Event Player).ab_player, All Players(All Teams), Empty Array), Bad Beam, Event Player, (Event Player).ab_player, Color(Red), Visible To Position and Radius);
                    Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
                End;
                If(Compare(Hero Of(Event Player), ==, Hero(Kiriko)));
                    Set Player Variable(Event Player, is_ranged, True);
                    Create Effect(If-Then-Else((Event Player).ab_var_1, All Players(All Teams), Empty Array), Sphere, Color(Turquoise), Event Player, (Event Player).ab_var_1, Visible To Position and Radius);
                    Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
                End;
            Else If(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Widowmaker)), Compare(Hero Of(Event Player), ==, Hero(Ana))), Compare(Hero Of(Event Player), ==, Hero(Pharah))));
                Set Player Variable(Event Player, combat_pathfinding_type, 4);
                Set Player Variable(Event Player, is_ranged, True);
                Set Player Variable(Event Player, can_dodge, True);
            Else If(Or(Or(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Roadhog)), Compare(Hero Of(Event Player), ==, Hero(Reaper))), Compare(Hero Of(Event Player), ==, Hero(Sigma))), Compare(Hero Of(Event Player), ==, Hero(Mei))), Compare(Hero Of(Event Player), ==, Hero(Zarya))));
                Set Player Variable(Event Player, combat_pathfinding_type, 5);
                Set Player Variable(Event Player, is_ranged, False);
                Set Player Variable(Event Player, can_dodge, True);
            Else If(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Tracer)), Compare(Hero Of(Event Player), ==, Hero(Genji))), Compare(Hero Of(Event Player), ==, Hero(Lúcio))));
                Set Player Variable(Event Player, combat_pathfinding_type, 6);
                Set Player Variable(Event Player, is_ranged, False);
                Set Player Variable(Event Player, can_dodge, False);
                If(Compare(Hero Of(Event Player), ==, Hero(Tracer)));
                    Set Player Variable(Event Player, recall_block_end_t, Add(Total Time Elapsed, 4));
                End;
            Else If(Or(Compare(Hero Of(Event Player), ==, Hero(Echo)), Compare(Hero Of(Event Player), ==, Hero(Hanzo))));
                Set Player Variable(Event Player, combat_pathfinding_type, 7);
                Set Player Variable(Event Player, is_ranged, True);
                Set Player Variable(Event Player, can_dodge, False);
            Else If((Event Player).iv_is_portal);
                Set Player Variable(Event Player, can_dodge, False);
            End;
            If(Or(Compare(Hero Of(Event Player), ==, Hero(Brigitte)), Compare(Hero Of(Event Player), ==, Hero(Cassidy))));
                Set Player Variable(Event Player, real_tier, 1);
            Else If(Or(Or(Or(Or(Or(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Echo)), Compare(Hero Of(Event Player), ==, Hero(Baptiste))), Compare(Hero Of(Event Player), ==, Hero(Reaper))), Compare(Hero Of(Event Player), ==, Hero(Sombra))), Compare(Hero Of(Event Player), ==, Hero(Widowmaker))), Compare(Hero Of(Event Player), ==, Hero(Pharah))), Compare(Hero Of(Event Player), ==, Hero(Lúcio))), Compare(Hero Of(Event Player), ==, Hero(Zarya))));
                Set Player Variable(Event Player, real_tier, 2);
                If(Compare(Global.mut_bulletproof, ==, True));
                    Add Health Pool To Player(Event Player, Health, Multiply(0.9, (Event Player).health_percent), False, False);
                    Set Player Variable At Index(Event Player, HP_Pool, 5, Last Created Health Pool);
                End;
            Else If(Or(Or(Or(Or(Or(Or(Or(Compare(Hero Of(Event Player), ==, Hero(D.Va)), Compare(Hero Of(Event Player), ==, Hero(Orisa))), Compare(Hero Of(Event Player), ==, Hero(Roadhog))), Compare(Hero Of(Event Player), ==, Hero(Ana))), Compare(Hero Of(Event Player), ==, Hero(Tracer))), Compare(Hero Of(Event Player), ==, Hero(Mei))), Compare(Hero Of(Event Player), ==, Hero(Wrecking Ball))), Compare(Hero Of(Event Player), ==, Hero(Sigma))));
                Set Player Variable(Event Player, real_tier, 3);
            Else;
                Set Player Variable(Event Player, real_tier, 4);
            End;
            Set Player Variable(Event Player, is_fortified, Or(Global.gmut_fortified, (Event Player).is_living_boss));
            Set Player Variable(Event Player, can_stagger, And(Not((Event Player).is_fortified), Or(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Cassidy)), Compare(Hero Of(Event Player), ==, Hero(Baptiste))), Compare(Hero Of(Event Player), ==, Hero(Pharah))), Compare(Hero Of(Event Player), ==, Hero(Widowmaker)))));
            Set Player Variable(Event Player, can_quick_melee, And(And(And(And(Compare(Hero Of(Event Player), !=, Hero(Brigitte)), Compare(Hero Of(Event Player), !=, Hero(Roadhog))), Compare(Hero Of(Event Player), !=, Hero(Wrecking Ball))), Compare(Hero Of(Event Player), !=, Hero(Reinhardt))), Not((Event Player).iv_is_portal)));
            If((Event Player).is_living_boss);
                Set Player Variable(Event Player, health_percent, Multiply(Multiply(If-Then-Else(Global.is_mutator_mode_enabled, 1.2, 1), If-Then-Else(Compare(Global.length, ==, 0), 1.25, 1.5)), Value In Array(Array(4, 2.25, 2.25, 1), Subtract((Event Player).real_tier, 1))));
                Set Player Variable(Event Player, Damage_Dealt, Multiply(Multiply(If-Then-Else(Global.is_mutator_mode_enabled, 1.2, 1), Add(If-Then-Else(Compare(Global.gamemode, ==, 0), 1.5, 1.3), Divide(Global.wave_number, 35))), Value In Array(Array(3.5, 2.25, 1.7, 1.05), Subtract((Event Player).real_tier, 1))));
            Else;
                If(And(And(And(Global.mut_mutation, Compare(Global.mut_mutation, <, Total Time Elapsed)), Compare(Random Integer(1, 100), <=, 15)), Compare((Event Player).real_tier, <, 4)));
                    Start Scaling Player(Event Player, 1.3, False);
                    Start Modifying Hero Voice Lines(Event Player, 0.5, False);
                    Set Global Variable(mut_mutation, 100000);
                    Set Player Variable(Event Player, is_mutated, True);
                    Set Player Variable(Event Player, health_percent, 2.5);
                    Set Player Variable(Event Player, Damage_Dealt, 1.3);
                    Create Effect(All Players(All Teams), Winston Primal Rage Effect, Color(Team 2), Event Player, 1, Visible To);
                    Modify Player Variable(Event Player, active_ab_effect_list, Append To Array, Last Created Entity);
                Else;
                    Set Player Variable(Event Player, health_percent, 1);
                    Set Player Variable(Event Player, Damage_Dealt, 1);
                End;
            End;
            If(Global.mut_hardwired);
                If(Or(Or(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Echo)), Compare(Hero Of(Event Player), ==, Hero(Orisa))), Compare(Hero Of(Event Player), ==, Hero(D.Va))), Compare(Hero Of(Event Player), ==, Hero(Genji))), Compare(Hero Of(Event Player), ==, Hero(Wrecking Ball))));
                    Set Player Variable(Event Player, is_hardwired, True);
                    If(Compare(Hero Of(Event Player), ==, Hero(D.Va)));
                        Add Health Pool To Player(Event Player, Shields, If-Then-Else(Is In Alternate Form(Event Player), 0, Multiply(0.75, (Event Player).health_percent)), True, True);
                    Else;
                        Add Health Pool To Player(Event Player, Shields, Multiply(0.75, (Event Player).health_percent), True, True);
                    End;
                    Set Player Variable At Index(Event Player, HP_Pool, 4, Last Created Health Pool);
                Else;
                    Set Player Variable(Event Player, is_hardwired, False);
                End;
            End;
            If(Global.mut_yakuza);
                If(Or(Or(Compare(Hero Of(Event Player), ==, Hero(Kiriko)), Compare(Hero Of(Event Player), ==, Hero(Hanzo))), Compare(Hero Of(Event Player), ==, Hero(Genji))));
                    Add Health Pool To Player(Event Player, Armor, Multiply(0.75, (Event Player).health_percent), True, True);
                    Set Player Variable At Index(Event Player, HP_Pool, 7, Last Created Health Pool);
                End;
            End;
            Stop Holding Button(Event Player, Button(Primary Fire));
            Stop Holding Button(Event Player, Button(Secondary Fire));
            Set Damage Received(Event Player, If-Then-Else((Event Player).is_living_boss, 50, 100));
            If(And(Compare(Hero Of(Event Player), ==, Hero(D.Va)), (Event Player).is_living_boss));
                Set Damage Received(Event Player, 100);
            End;
        End;
        Call Subroutine(start_facing);
        If(Compare(Slot Of(Event Player), ==, 1));
            Start Throttle In Direction(Event Player, Vector Towards(Event Player, (Event Player).nav_pos), Multiply(If-Then-Else(Compare((Event Player).Slowed_until, >=, Total Time Elapsed), 0.3, 1), If-Then-Else(Compare(Distance Between(Event Player, Vector(X Component Of((Event Player).nav_pos), Y Component Of(Position Of(Event Player)), Z Component Of((Event Player).nav_pos))), >=, 0.5), If-Then-Else((Event Player).is_aggressive, 1, 0.9), 0)), To World, Replace existing throttle, Direction and Magnitude);
        Else If(Not((Event Player).iv_is_portal));
            Start Throttle In Direction(Event Player, Vector Towards(Event Player, (Event Player).nav_pos), Multiply(If-Then-Else(Compare((Event Player).Slowed_until, >=, Total Time Elapsed), 0.3, 1), Compare(Distance Between(Event Player, Vector(X Component Of((Event Player).nav_pos), Y Component Of(Position Of(Event Player)), Z Component Of((Event Player).nav_pos))), >=, 0.5)), To World, Replace existing throttle, Direction and Magnitude);
        End;
        "health_percent value in percent, health does not scale during a bot's live"
        Modify Player Variable(Event Player, health_percent, Multiply, Multiply(Multiply(Multiply(Global.diff_health_mult, If-Then-Else(Global.is_mutator_mode_enabled, 1.1, 1)), Add(100, Multiply(5, Add(Subtract(Global.wave_number, 1), Max(0, Subtract(Global.wave_number, 9)))))), Add(0.111, Multiply(0.222, Global.combatants_count))));
        Set Max Health(Event Player, (Event Player).health_percent);
        "Damage_Dealt value as a factor, damage can scale during a bot's live"
        Modify Player Variable(Event Player, Damage_Dealt, Multiply, Global.diff_damage_mult);
        Set Damage Dealt(Event Player, Multiply(Multiply(Multiply(Multiply((Event Player).Damage_Dealt, If-Then-Else(Global.mut_emp_rounds, 2, 1)), Add(20, Multiply(9.25, Add(Subtract(Global.wave_number, 1), Max(0, Subtract(Global.wave_number, 9)))))), Add(0.111, Multiply(0.222, Global.combatants_count))), Divide(9, Number Of Players(Team 2))));
        Set Healing Received(Event Player, If-Then-Else((Event Player).iv_is_portal, 0, Multiply(Multiply(Multiply(Multiply(Global.diff_health_mult, If-Then-Else((Event Player).is_living_boss, 0.5, 1)), If-Then-Else(Global.is_mutator_mode_enabled, 1.1, 1)), Add(100, Multiply(4, Add(Subtract(Global.wave_number, 1), Max(0, Subtract(Global.wave_number, 9)))))), Add(0.111, Multiply(0.222, Global.combatants_count)))));
        Set Knockback Received(Event Player, If-Then-Else((Event Player).is_fortified, 60, 100));
        Set Status(Event Player, Null, Rooted, 1);
        If(Compare((Event Player).combat_pathfinding_type, ==, 9));
            Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 161, 140));
        Else;
            Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 115, 100));
        End;
        If(Global.mut_lock_n_load);
            Set Max Ammo(Event Player, False, 600);
            Set Ammo(Event Player, False, 600);
        End;
        Call Subroutine(find_chase_target);
        Set Player Variable(Event Player, ab_player, Null);
        Set Player Variable(Event Player, ab_var_1, False);
        Set Player Variable(Event Player, ab_var_2, False);
        Set Player Variable(Event Player, fear_end_t, If-Then-Else((Event Player).iv_is_portal, 100000, If-Then-Else(And(Compare(Global.gamemode, ==, 2), (Event Player).is_living_boss), Add(Total Time Elapsed, 3), 0)));
        Set Player Variable(Event Player, is_aggressive, Not((Event Player).is_using_boss_aggression));
        If(Global.gmut_storm_raging);
            Set Player Variable(Event Player, gmut_var, And(And(Not((Event Player).is_living_boss), Compare((Event Player).real_tier, <, 3)), Compare(Random Integer(1, 3), >, Count Of(Filtered Array(All Living Players(Team 2), (Current Array Element).gmut_var)))));
        Else If(Global.gmut_adaptive_shield);
            Set Player Variable(Event Player, gmut_var, False);
        End;
        If(Not((Event Player).iv_is_portal));
            Set Player Health(Event Player, 100000);
        End;
        Set Player Variable(Event Player, is_alive, True);
        Abort If(Not((Event Player).is_living_boss));
        Start Forcing Player Outlines(Event Player, All Players(All Teams), True, Color(Yellow), Always);
        Wait(0.5, Ignore Condition);
        If((Event Player).is_alive);
            "Workaround: Sometimes outlines don't appear when set too early"
            Start Forcing Player Outlines(Event Player, All Players(All Teams), True, Color(Yellow), Always);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2: Enable Combat Pathfinding") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Global.is_load_limit_reached == False;
        (Event Player).is_pathfinding_disabled == False;
        (Event Player).is_using_combat_pathfinding == 0;
        (Event Player).is_target_in_los >= 5;
        (Event Player).is_aggressive == True;
        Is On Ground(Event Player) == True;
        Or(Compare(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))), <=, 2), Compare(Subtract(Y Component Of(Value In Array(Global.nodes, ((Event Player).target).best_nav_idx)), Y Component Of(Position Of(Event Player))), <=, 1)) == True;
        Or((Event Player).is_ranged, Compare(Distance Between(Event Player, (Event Player).target), <=, Add(1, Distance Between((Event Player).target, Value In Array(Global.nodes, ((Event Player).target).best_nav_idx))))) == True;
    }
    actions {
        If(Compare(Add(((Event Player).target).last_nav_update_t, Multiply(Global.combatants_count, 0.4)), <, Total Time Elapsed));
            Call Subroutine(update_target_nav);
            Abort If Condition Is False;
        End;
        If(Is True For Any(Global.elevator_nodes, Compare(Distance Between(Event Player, Vector(X Component Of(Current Array Element), Y Component Of(Position Of(Event Player)), Z Component Of(Current Array Element))), <, 1.5)));
            Wait(1, Ignore Condition);
            Abort If Condition Is False;
        End;
        Set Player Variable(Event Player, is_using_combat_pathfinding, 3);
        Set Player Variable(Event Player, target_last_seen_pos, Position Of((Event Player).target));
        Set Player Variable(Event Player, is_nav_reachable_node, False);
        Wait(0.016, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2: Disable Combat Pathfinding") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_using_combat_pathfinding == True;
        And((Event Player).is_aggressive, (Event Player).is_target_in_los) == False;
    }
    actions {
        Set Player Variable(Event Player, is_using_combat_pathfinding, 0);
    }
}

rule ("Team 2: Set Nav (Not in Combat), Get Back to Node, Set Nav is Node") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_alive == True;
        (Event Player).is_using_combat_pathfinding == 0;
        (Event Player).is_nav_reachable_node == False;
    }
    actions {
        If(Not(Or(Global.is_load_limit_reached, (Event Player).is_pathfinding_disabled)));
            If(Compare((Event Player).combat_pathfinding_type, ==, 0));
                Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 115, 100));
            End;
            Set Player Variable(Event Player, nav_pos, First Of(Sorted Array(Filtered Array(Global.nodes, Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS)), Distance Between(Event Player, Current Array Element))));
            If(Compare((Event Player).nav_pos, ==, False));
                Set Player Variable(Event Player, nav_pos, First Of(Sorted Array(Global.nodes, Distance Between(Event Player, Current Array Element))));
            End;
            Set Player Variable(Event Player, nav_idx, Index Of Array Value(Global.nodes, (Event Player).nav_pos));
            Set Player Variable(Event Player, is_nav_reachable_node, True);
        End;
        Wait(0.5, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2: Set Nav (Not in Combat), Select Next Node, Set Last Time at Node") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_alive == True;
        (Event Player).is_using_combat_pathfinding == 0;
        (Event Player).is_nav_reachable_node == True;
        Distance Between(Event Player, (Event Player).nav_pos) <= 1;
    }
    actions {
        Set Player Variable(Event Player, last_time_at_node_t, Total Time Elapsed);
        If(Not(Or(Global.is_load_limit_reached, (Event Player).is_pathfinding_disabled)));
            If(And(And(Compare(Global.gamemode, ==, 2), (Event Player).is_living_boss), Not((Event Player).is_aggressive)));
                If(Compare((Event Player).nav_idx, ==, (Event Player).dom_nav_guard_idx));
                    Wait(0.5, Ignore Condition);
                    Loop If Condition Is True;
                Else;
                    Set Player Variable(Event Player, nav_idx, First Of(Sorted Array(Value In Array(Global.edges, (Event Player).nav_idx), Add(Random Real(0, 0.5), Index Of String Char(Global.char_string, Char In String(Value In Array(Global.distance_matrix, Round To Integer(Divide(Add(Multiply(Current Array Element, Global.nodes_count), (Event Player).dom_nav_guard_idx), 128), Down)), Modulo(Add(Multiply(Current Array Element, Global.nodes_count), (Event Player).dom_nav_guard_idx), 128)))))));
                    Set Player Variable(Event Player, nav_pos, Value In Array(Global.nodes, (Event Player).nav_idx));
                End;
            Else If(((Event Player).target).is_combatant);
                If(Compare(Add(((Event Player).target).last_nav_update_t, Multiply(Global.combatants_count, 0.4)), <, Total Time Elapsed));
                    Call Subroutine(update_target_nav);
                End;
                If(And(And(Compare((Event Player).nav_idx, ==, ((Event Player).target).best_nav_idx), (Event Player).is_aggressive), Compare((Event Player).fear_end_t, <, Total Time Elapsed)));
                    Set Player Variable(Event Player, is_target_in_los, 5);
                    Set Player Variable(Event Player, is_using_combat_pathfinding, 3);
                    Set Player Variable(Event Player, target_last_seen_pos, Position Of((Event Player).target));
                    Set Player Variable(Event Player, is_nav_reachable_node, False);
                Else;
                    Set Player Variable(Event Player, nav_idx, First Of(Sorted Array(Value In Array(Global.edges, (Event Player).nav_idx), Multiply(If-Then-Else(And((Event Player).is_aggressive, Compare((Event Player).fear_end_t, <, Total Time Elapsed)), 1, -1), Add(Random Real(0, 0.5), Index Of String Char(Global.char_string, Char In String(Value In Array(Global.distance_matrix, Round To Integer(Divide(Add(Multiply(Current Array Element, Global.nodes_count), ((Event Player).target).best_nav_idx), 128), Down)), Modulo(Add(Multiply(Current Array Element, Global.nodes_count), ((Event Player).target).best_nav_idx), 128))))))));
                    Set Player Variable(Event Player, nav_pos, Value In Array(Global.nodes, (Event Player).nav_idx));
                End;
            Else;
                Set Player Variable(Event Player, nav_idx, Random Value In Array(Value In Array(Global.edges, (Event Player).nav_idx)));
                Set Player Variable(Event Player, nav_pos, Value In Array(Global.nodes, (Event Player).nav_idx));
            End;
        End;
        Wait(0.5, Abort When False);
        Loop If Condition Is True;
    }
}

rule ("Team 2: Set Nav (in Combat)") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_using_combat_pathfinding == True;
    }
    actions {
        If(Not(Or(Or(Or(Global.is_load_limit_reached, (Event Player).is_pathfinding_disabled), Has Status(Event Player, Rooted)), Has Status(Event Player, Stunned))));
            If(Is In Line of Sight(Eye Position(Event Player), Add(Eye Position((Event Player).target), ((Event Player).target).eye_offset), Barriers Do Not Block LOS));
                Set Player Variable(Event Player, target_last_seen_pos, Position Of((Event Player).target));
                If((Event Player).is_flying);
                    Set Player Variable(Event Player, nav_pos, Ray Cast Hit Position(Eye Position((Event Player).target), Add(Eye Position((Event Player).target), Multiply(12, Direction From Angles(Add(Horizontal Facing Angle Of((Event Player).target), If-Then-Else(Random Integer(0, 1), -45, 45)), -60))), Null, Null, False));
                    Wait(0.5, Ignore Condition);
                Else If(And(((Event Player).target).is_flying, Compare((Event Player).combat_pathfinding_type, !=, 4)));
                    "Roam"
                    Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(3.5, Direction From Angles(Random Integer(-179, 180), 0))));
                    Call Subroutine(find_wp_near_nav);
                Else;
                    "Long Range, roam randomly, slow"
                    If(Compare((Event Player).combat_pathfinding_type, ==, 0));
                        If(Compare(Distance Between(Event Player, (Event Player).target), <=, If-Then-Else(Compare(Hero Of(Event Player), ==, Hero(Baptiste)), 20, 15)));
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(2.5, Direction From Angles(Random Integer(-179, 180), 0))));
                        Else;
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(2.5, Direction From Angles(Add(Horizontal Angle From Direction(Direction Towards(Event Player, (Event Player).target)), Random Value In Array(Array(-45, 0, 45))), 0))));
                        End;
                        Call Subroutine(find_wp_near_nav);
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 1));
                        If(Compare(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))), >, -2));
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(Min(3.5, Subtract(Distance Between(Event Player, (Event Player).target), 2)), Direction Towards(Event Player, (Event Player).target))));
                            Call Subroutine(find_wp_near_nav);
                        Else;
                            Set Player Variable(Event Player, nav_pos, Add(Position Of((Event Player).target), Multiply(2, Direction Towards((Event Player).target, Event Player))));
                            Call Subroutine(check_drop);
                        End;
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 2));
                        Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(Min(1.5, Subtract(Distance Between(Event Player, (Event Player).target), 2)), Direction Towards(Event Player, (Event Player).target))));
                        Call Subroutine(find_wp_near_nav);
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 3));
                        Set Player Variable(Event Player, nav_pos, Add(Position Of((Event Player).target), Multiply(5, Direction From Angles(Add(Horizontal Facing Angle Of((Event Player).target), Random Value In Array(Array(-45, 45))), 0))));
                        If(Compare(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))), >, -2));
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(Min(3.5, Distance Between(Event Player, (Event Player).nav_pos)), Direction Towards(Event Player, (Event Player).nav_pos))));
                            Call Subroutine(find_wp_near_nav);
                        Else;
                            Call Subroutine(check_drop);
                        End;
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 4));
                        If(Compare(Distance Between(Event Player, (Event Player).target), <=, 12));
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(3.5, Direction From Angles(Add(Horizontal Angle From Direction(Direction Towards((Event Player).target, Event Player)), If-Then-Else(And(Compare(Distance Between(Event Player, (Event Player).target), <=, 8), Compare((Event Player).real_speed, <=, 1)), Random Value In Array(Array(-135, 135)), 0)), 0))));
                            Call Subroutine(find_wp_near_nav);
                        Else;
                            Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
                        End;
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 5));
                        Set Player Variable(Event Player, nav_pos, Add(Position Of((Event Player).target), Multiply(3, Direction From Angles(Horizontal Facing Angle Of((Event Player).target), 0))));
                        If(Compare(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))), >, -2));
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(Min(3.5, Distance Between(Event Player, (Event Player).nav_pos)), Direction Towards(Event Player, (Event Player).nav_pos))));
                            Call Subroutine(find_wp_near_nav);
                        Else;
                            Call Subroutine(check_drop);
                        End;
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 6));
                        Set Player Variable(Event Player, nav_pos, Add(Position Of((Event Player).target), Multiply(1.5, Direction From Angles(Add(Horizontal Facing Angle Of((Event Player).target), If-Then-Else(Compare(Horizontal Angle Towards((Event Player).target, Event Player), >, 0), 90, -90)), 0))));
                        If(Compare(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))), >, -2));
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(Min(3.5, Distance Between(Event Player, (Event Player).nav_pos)), Direction Towards(Event Player, (Event Player).nav_pos))));
                            Call Subroutine(find_wp_near_nav);
                        Else;
                            Call Subroutine(check_drop);
                        End;
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 7));
                        If(Compare(Distance Between(Event Player, (Event Player).target), <=, 17));
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(3.5, Direction From Angles(Random Integer(-179, 180), 0))));
                        Else;
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(3.5, Direction From Angles(Add(Horizontal Angle From Direction(Direction Towards(Event Player, (Event Player).target)), Random Value In Array(Array(-45, 0, 45))), 0))));
                        End;
                        Call Subroutine(find_wp_near_nav);
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 8));
                        Set Global Variable(temp_1, Remove From Array(Filtered Array(Players Within Radius(Event Player, 3, Team 2, Off), (Current Array Element).is_alive), Event Player));
                        If(Count Of(Global.temp_1));
                            Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(3.5, Direction Towards(First Of(Sorted Array(Global.temp_1, Distance Between(Event Player, Current Array Element))), Event Player))));
                            Call Subroutine(find_wp_near_nav);
                        Else;
                            Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
                        End;
                    Else If(Compare((Event Player).combat_pathfinding_type, ==, 9));
                        If((Event Player).ab_var_1);
                            If(Compare(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))), >, -2));
                                Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(6, Direction Towards(Event Player, (Event Player).target))));
                                Call Subroutine(find_wp_near_nav);
                            Else;
                                Set Player Variable(Event Player, nav_pos, Position Of((Event Player).target));
                                Call Subroutine(check_drop);
                            End;
                        Else;
                            If((Event Player).ab_var_2);
                                Set Player Variable(Event Player, nav_pos, Add(Position Of((Event Player).target), Multiply(3, Direction From Angles(Horizontal Facing Angle Of((Event Player).target), 0))));
                            Else;
                                Set Player Variable(Event Player, nav_pos, Add(Position Of((Event Player).target), Multiply(5, Direction From Angles(Add(Horizontal Facing Angle Of((Event Player).target), Random Value In Array(Array(-45, 45))), 0))));
                            End;
                            If(Compare(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))), >, -2));
                                Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(Min(4, Distance Between(Event Player, (Event Player).nav_pos)), Direction Towards(Event Player, (Event Player).nav_pos))));
                                Call Subroutine(find_wp_near_nav);
                            Else;
                                Call Subroutine(check_drop);
                            End;
                        End;
                    End;
                End;
                If(Compare((Event Player).combat_pathfinding_type, ==, 0));
                    Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 75.5, 65));
                End;
            Else;
                If(Compare(Distance Between(Event Player, Vector(X Component Of((Event Player).target_last_seen_pos), Y Component Of(Position Of(Event Player)), Z Component Of((Event Player).target_last_seen_pos))), <, 0.5));
                    Set Player Variable(Event Player, target_last_seen_pos, Position Of((Event Player).target));
                End;
                If((Event Player).is_flying);
                    Set Player Variable(Event Player, nav_pos, (Event Player).target_last_seen_pos);
                Else;
                    Set Player Variable(Event Player, nav_pos, Add(Position Of(Event Player), Multiply(Min(3.5, Distance Between(Event Player, (Event Player).target_last_seen_pos)), Direction Towards(Event Player, (Event Player).target_last_seen_pos))));
                    Call Subroutine(find_wp_near_nav);
                End;
                If(Compare((Event Player).combat_pathfinding_type, ==, 0));
                    Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 115, 100));
                End;
            End;
        End;
        Wait(If-Then-Else(Global.is_load_limit_reached, 1, 0.5), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2: Find Target") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_alive == True;
    }
    actions {
        If(Not(Or(Or(Compare((Event Player).fear_end_t, >=, Total Time Elapsed), (Event Player).is_wraith), And(Compare(Hero Of(Event Player), ==, Hero(Sombra)), (Event Player).ab_player))));
            If((Event Player).is_ignoring_other_targets);
                Set Global Variable(temp_1, If-Then-Else(And(And(And(And(((Event Player).target).is_combatant, Not(((Event Player).target).downed_start_t)), Not(((Event Player).target).active_ab_is_cloaked)), Not(And(((Event Player).target).is_invisible, Compare(Distance Between(Event Player, (Event Player).target), >, 2.4)))), Is In Line of Sight(Eye Position(Event Player), Add(Eye Position((Event Player).target), ((Event Player).target).eye_offset), Barriers Do Not Block LOS)), (Event Player).target, Null));
            Else;
                Set Global Variable(temp_1, First Of(Sorted Array(Filtered Array(Global.combatants, And(Not(Or(Or((Current Array Element).downed_start_t, (Current Array Element).active_ab_is_cloaked), And((Current Array Element).is_invisible, Compare(Distance Between(Event Player, Current Array Element), >, 2.4)))), Is In Line of Sight(Eye Position(Event Player), Add(Eye Position(Current Array Element), (Current Array Element).eye_offset), Barriers Do Not Block LOS))), Add(Add(Add(Add(Multiply(Multiply(Value In Array(Array(1, 0.25, 2, 4), (Current Array Element).ab_priority), If-Then-Else(Compare(Current Array Element, ==, (Event Player).target), 0.25, 1)), Distance Between(Event Player, Current Array Element)), If-Then-Else(And(Not((Event Player).is_ranged), (Current Array Element).is_flying), 500, 0)), If-Then-Else(Has Status(Current Array Element, Asleep), 1000, 0)), If-Then-Else(Or(Has Status(Current Array Element, Invincible), Has Status(Current Array Element, Phased Out)), 2000, 0)), If-Then-Else((Current Array Element).active_ab_is_frenzied, -5000, 0)))));
            End;
            If(Global.temp_1);
                Set Player Variable(Event Player, is_target_in_los, 5);
                Set Player Variable(Event Player, target, Global.temp_1);
                Set Player Variable(Event Player, target_last_seen_pos, Position Of((Event Player).target));
            Else;
                If(Or(Or(Or(((Event Player).target).downed_start_t, Not(((Event Player).target).is_combatant)), ((Event Player).target).active_ab_is_cloaked), Not(And(((Event Player).target).is_invisible, Compare(Distance Between(Event Player, (Event Player).target), >, 2.4)))));
                    Call Subroutine(find_chase_target);
                    Set Player Variable(Event Player, is_target_in_los, 0);
                Else If((Event Player).is_target_in_los);
                    If(And(Not((Event Player).is_flying), Compare(Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))), >, 2)));
                        Set Player Variable(Event Player, is_using_combat_pathfinding, 0);
                    End;
                    Modify Player Variable(Event Player, is_target_in_los, Subtract, 1);
                End;
                If(And(Not((Event Player).is_target_in_los), Compare(Ammo(Event Player, 0), <, Multiply(0.5, Max Ammo(Event Player, 0)))));
                    Press Button(Event Player, Button(Reload));
                End;
            End;
        End;
        Wait(If-Then-Else(Global.is_load_limit_reached, 1, 0.5), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2: Calculate Real Speed") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_alive == True;
    }
    actions {
        If(Or(Global.is_load_limit_reached, (Event Player).is_pathfinding_disabled));
            "Larger than 1.5 to not trigger stuck rules"
            Set Player Variable(Event Player, real_speed, 1.6);
            Wait(0.5, Abort When False);
        Else;
            Set Player Variable(Event Player, real_speed_pos_1, Position Of(Event Player));
            If(Is Jumping(Event Player));
                Set Player Variable(Event Player, last_jump_t, Total Time Elapsed);
            End;
            If(Compare(Add((Event Player).last_jump_t, 0.15), >=, Total Time Elapsed));
                Set Player Variable(Event Player, real_speed, Divide(Distance Between(Vector(X Component Of((Event Player).real_speed_pos_1), Y Component Of((Event Player).real_speed_pos_2), Z Component Of((Event Player).real_speed_pos_1)), (Event Player).real_speed_pos_2), 0.112));
            Else;
                Set Player Variable(Event Player, real_speed, Divide(Distance Between((Event Player).real_speed_pos_1, (Event Player).real_speed_pos_2), 0.112));
            End;
            Wait(0.112, Abort When False);
            Set Player Variable(Event Player, real_speed_pos_2, Position Of(Event Player));
            If(Is Jumping(Event Player));
                Set Player Variable(Event Player, last_jump_t, Total Time Elapsed);
            End;
            If(Compare(Add((Event Player).last_jump_t, 0.15), >=, Total Time Elapsed));
                Set Player Variable(Event Player, real_speed, Divide(Distance Between(Vector(X Component Of((Event Player).real_speed_pos_1), Y Component Of((Event Player).real_speed_pos_2), Z Component Of((Event Player).real_speed_pos_1)), (Event Player).real_speed_pos_2), 0.112));
            Else;
                Set Player Variable(Event Player, real_speed, Divide(Distance Between((Event Player).real_speed_pos_1, (Event Player).real_speed_pos_2), 0.112));
            End;
            Wait(0.112, Abort When False);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2: Bot is stuck") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_alive == True;
        (Event Player).real_speed <= 1.5;
        (Event Player).is_flying == False;
        (Event Player).Slowed_until < Total Time Elapsed;
        Has Status(Event Player, Rooted) == False;
        Has Status(Event Player, Stunned) == False;
        Distance Between(Event Player, Vector(X Component Of((Event Player).nav_pos), Y Component Of(If-Then-Else((Event Player).is_using_combat_pathfinding, Position Of(Event Player), (Event Player).nav_pos)), Z Component Of((Event Player).nav_pos))) >= 0.5;
    }
    actions {
        Wait(0.5, Abort When False);
        Loop If(And(Compare(Hero Of(Event Player), ==, Hero(Reinhardt)), Is Using Ultimate(Event Player)));
        If(Is True For Any(Global.elevator_nodes, Compare(Distance Between(Event Player, Vector(X Component Of(Current Array Element), Y Component Of(Position Of(Event Player)), Z Component Of(Current Array Element))), <, 1.5)));
            Wait(1.5, Abort When False);
        End;
        Abort If Condition Is False;
        If((Event Player).is_using_combat_pathfinding);
            If(Compare(Absolute Value(Horizontal Angle From Direction(Throttle Of(Event Player))), <=, 45));
                Press Button(Event Player, Button(Jump));
            End;
        Else;
            Press Button(Event Player, Button(Jump));
            If(Not(Or((Event Player).is_target_in_los, Compare((Event Player).fear_end_t, >=, Total Time Elapsed))));
                Disable Movement Collision With Players(Event Player);
                Wait(0.5, Ignore Condition);
                Enable Movement Collision With Players(Event Player);
            End;
            Wait(0.5, Abort When False);
            Set Player Variable(Event Player, is_nav_reachable_node, False);
        End;
        Wait(0.5, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2: Teleport if Target not in LOS and hasn't reached Node for 8 seconds") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_alive == True;
        Has Status(Event Player, Rooted) == False;
        Has Status(Event Player, Stunned) == False;
        (Event Player).is_pathfinding_disabled == False;
        (Event Player).is_target_in_los == 0;
        (Event Player).fear_end_t < Total Time Elapsed;
        (Event Player).last_time_at_node_t < Total Time Elapsed;
    }
    actions {
        Wait(8, Abort When False);
        Loop If(Global.is_load_limit_reached);
        Call Subroutine(teleport_to_free_spawn);
    }
}

rule ("Team 2: Bot took damage, Dodge") {
    event {
        Player Took Damage;
        Team 2;
        All;
    }
    actions {
        Abort If(Global.is_load_limit_reached);
        Abort If((Event Player).is_pathfinding_disabled);
        Abort If(Not((Event Player).can_dodge));
        Abort If(Not((Event Player).is_using_combat_pathfinding));
        If(Not(Or(Or(Global.is_load_limit_reached, Has Status(Event Player, Rooted)), Has Status(Event Player, Stunned))));
            If(Compare((Event Player).combat_pathfinding_type, ==, 4));
                Set Player Variable(Event Player, nav_pos, If-Then-Else(Subtract(Position Of(Event Player), Global.mut_artful_dodger), 7, Multiply(3.5, Direction From Angles(Add(Horizontal Angle From Direction(Vector Towards(Event Player, (Event Player).target)), Random Integer(-90, 90)), False))));
            Else;
                Set Player Variable(Event Player, nav_pos, If-Then-Else(Add(Position Of(Event Player), Global.mut_artful_dodger), 7, Multiply(3.5, Direction From Angles(Add(Horizontal Angle From Direction(Vector Towards(Event Player, (Event Player).target)), Random Integer(-90, 90)), False))));
            End;
            Call Subroutine(find_wp_near_nav);
        End;
        Wait(If-Then-Else(Global.mut_artful_dodger, 0.6, 1.2), Ignore Condition);
    }
}

rule ("Team 2: Is Hacked, Tase Bot") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Has Status(Event Player, Hacked) == True;
    }
    actions {
        Abort If((Event Player).is_living_boss);
        Abort If((Event Player).is_hardwired);
        Set Player Variable(Event Player, soldier_espionage, True);
        Set Reload Enabled(Event Player, False);
        Set Status(Event Player, Null, Burning, 9999);
        Set Status(Event Player, Null, Rooted, 9999);
        Start Facing(Event Player, Direction From Angles(Add(Evaluate Once(Horizontal Facing Angle Of(Event Player)), Random Integer(-75, -15)), Add(Random Integer(35, 55), Max(-90, Multiply(Subtract(Evaluate Once(Total Time Elapsed), Total Time Elapsed), 18)))), If-Then-Else(Has Status(Event Player, Stunned), 0, If-Then-Else(Compare(Subtract(Evaluate Once(Total Time Elapsed), Total Time Elapsed), >, -0.2), 1000, 100)), To World, Direction and Turn Rate);
        Wait Until(Not(Has Status(Event Player, Hacked)), 3.5);
        Set Reload Enabled(Event Player, True);
        Clear Status(Event Player, Burning);
        Clear Status(Event Player, Rooted);
        Wait(0.1, Ignore Condition);
        Abort If(Not((Event Player).is_alive));
        Call Subroutine(start_facing);
    }
}

rule ("Team 2: Is Hacked, effect") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Has Status(Event Player, Hacked) == True;
    }
    actions {
        Set Player Variable(Event Player, soldier_espionage, True);
        Wait Until(Not(Has Status(Event Player, Hacked)), 99999);
        Wait(0.1, Ignore Condition);
        Set Player Variable(Event Player, soldier_espionage, False);
        Loop If Condition Is True;
    }
}

rule ("Team 2: Quick Melee") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).can_quick_melee == True;
        (Event Player).is_target_in_los == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Is Reloading(Event Player));
        Loop If(Has Status(Event Player, Hacked));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 3));
        Press Button(Event Player, Button(Melee));
        Wait(10, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2: Bot is feared") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).fear_end_t >= Total Time Elapsed;
    }
    actions {
        Set Player Variable(Event Player, is_target_in_los, 0);
        If((Event Player).is_living_boss);
            Start Forcing Player Outlines(Event Player, All Players(All Teams), True, Color(Violet), Always);
        Else;
            Start Forcing Player Outlines(Event Player, All Players(All Teams), True, Color(Violet), Default);
        End;
        Wait Until(Compare((Event Player).fear_end_t, <, Total Time Elapsed), 99999);
        If((Event Player).is_living_boss);
            Start Forcing Player Outlines(Event Player, All Players(All Teams), True, Color(Yellow), Always);
        Else;
            Stop Forcing Player Outlines(Event Player, All Players(All Teams));
    }
}

rule ("MUT Team 2 (Gamechanging Mutator): Gamechanging Mutator was enabled") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Global.is_gmut_enabled == True;
    }
    actions {
        Wait(0.5, Ignore Condition);
        If(Global.gmut_storm_raging);
            Create Effect(If-Then-Else((Event Player).gmut_var, All Players(All Teams), Empty Array), Ana Nano Boosted Effect, Color(Team 2), Event Player, 1, Visible To);
        End;
        If(Global.gmut_adaptive_shield);
            Create Effect(If-Then-Else(Compare((Event Player).gmut_var, ==, 1), All Players(All Teams), Empty Array), Wrecking Ball Adaptive Shield Target Effect, Color(Team 2), Event Player, 1, Visible To);
        End;
        If(Global.gmut_fortified);
            Add Health Pool To Player(Event Player, Armor, Multiply(0.4, (Event Player).health_percent), True, True);
        End;
        Set Global Variable(is_gmut_enabled, False);
    }
}

rule ("MUT Team 2 (Gamechanging Mutator): Adaptive Shield") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Global.gmut_adaptive_shield == True;
        Is Alive(Event Player) == True;
        (Event Player).gmut_var == False;
        Normalized Health(Event Player) <= 0.5;
    }
    actions {
        Abort If((Event Player).iv_is_portal);
        If(Compare(Slot Of(Event Player), ==, 1));
            "Set Player Health converts the shield into regular HP, so wait until after"
            Wait(0.016, Abort When False);
            Abort If Condition Is False;
        End;
        Set Global Variable(temp_1, Count Of(Filtered Array(Global.combatants, And(Compare(Distance Between(Event Player, Current Array Element), <=, 8), Is In Line of Sight(Event Player, Current Array Element, Enemy Barriers Block LOS)))));
        If(Global.temp_1);
            Play Effect(All Players(All Teams), Good Pickup Effect, Color(Blue), Event Player, 1);
            Add Health Pool To Player(Event Player, Shields, Multiply(Multiply(0.75, Divide(Global.temp_1, Global.combatants_count)), Max Health(Event Player)), False, False);
            Set Player Variable At Index(Event Player, HP_Pool, 3, Last Created Health Pool);
            Set Player Variable(Event Player, gmut_var, 1);
            Wait Until(Not(Health Of Type(Event Player, Shields)), 7);
            Remove Health Pool From Player(Value In Array((Event Player).HP_Pool, 3));
            Set Player Variable(Event Player, gmut_var, 2);
        Else;
            Set Player Variable(Event Player, gmut_var, 2);
    }
}

rule ("MUT Team 2 (Gamechanging Mutator): Sympathy Gains") {
    event {
        Player Died;
        Team 2;
        All;
    }
    conditions {
        Global.gmut_sympathy_gains == True;
        (Event Player).iv_is_portal == False;
    }
    actions {
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(Black), Event Player, 1);
        Wait(0.15, Abort When False);
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(White), Position Of(Event Player), 1);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Yellow), Position Of(Event Player), Add(Multiply((Event Player).real_tier, 8), 6));
        Heal(Players Within Radius(Event Player, Add(Multiply((Event Player).real_tier, 4), 3), Team 2, Off), Null, Min(Multiply(Max Health(Event Player), 0.3), 500));
    }
}

rule ("MUT Team 2 (Gamechanging Mutator): Fortified") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_fortified == True;
        Has Status(Event Player, Stunned) == True;
        (Event Player).gmut_fortified_bypass_end_t < Total Time Elapsed;
    }
    actions {
        If(Has Status(Event Player, Knocked Down));
            Clear Status(Event Player, Knocked Down);
            Wait(1, Ignore Condition);
        Else If(Has Status(Event Player, Asleep));
            Wait Until(Not(Has Status(Event Player, Asleep)), 3);
            If(Has Status(Event Player, Asleep));
                Clear Status(Event Player, Asleep);
                Wait(0.5, Ignore Condition);
            End;
        Else If(Has Status(Event Player, Frozen));
            Wait Until(Not(Has Status(Event Player, Frozen)), 1);
            Clear Status(Event Player, Frozen);
        Else;
            Wait Until(Not(Has Status(Event Player, Stunned)), 0.5);
            Clear Status(Event Player, Stunned);
        End;
        Wait(0.25, Abort When False);
        Loop If Condition Is True;
    }
}

rule ("MUT Team 2 (Gamechanging Mutator): Salvation") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Global.gmut_salvation == True;
        Is Alive(Event Player) == True;
        (Event Player).is_living_boss == False;
    }
    actions {
        Set Status(Event Player, Null, Unkillable, 9999);
        Wait Until(Compare(Health(Event Player), <=, 1), 99999);
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(Purple), Position Of(Event Player), 1);
        Set Status(Event Player, Null, Stunned, 1.333);
        Set Status(Event Player, Null, Invincible, 0.1);
        Heal(Event Player, Null, Multiply(Max Health(Event Player), 0.05));
        Clear Status(Event Player, Unkillable);
    }
}

rule ("Team 2 (Ability): Heavy Impact / Damage Stagger") {
    event {
        Player Took Damage;
        Team 2;
        All;
    }
    actions {
        Abort If(Not(Or((Event Player).can_stagger, (Attacker).ab_heavy_impact)));
        "the lower the minimum, the higher the chance"
        Abort If(Compare(Random Real(0.003, 0.75), >, Divide(Event Damage, Max Health(Event Player))));
        Set Player Variable(Event Player, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, Multiply(0.5, Max(0.8, (Attacker).ab_heavy_impact))), (Event Player).gmut_fortified_bypass_end_t));
        Set Status(Event Player, Attacker, Stunned, Multiply(If-Then-Else((Event Player).is_fortified, 0.5, 1), Max(0.8, (Attacker).ab_heavy_impact)));
        Wait(5.5, Ignore Condition);
    }
}

rule ("Team 2 Brigitte: Hold / Drop Shield if Target and Distance to Target >= 6m") {
    event {
        Ongoing - Each Player;
        Team 2;
        Brigitte;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        Distance Between(Event Player, (Event Player).target) >= 6;
    }
    actions {
        Start Holding Button(Event Player, Button(Secondary Fire));
        Wait Until(Not(And((Event Player).is_target_in_los, Compare(Distance Between(Event Player, (Event Player).target), >=, 6))), 99999);
        Stop Holding Button(Event Player, Button(Secondary Fire));
    }
}

rule ("Team 2 Brigitte: Start / Stop Attacking if Distance to Target < 6m") {
    event {
        Ongoing - Each Player;
        Team 2;
        Brigitte;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        Distance Between(Event Player, (Event Player).target) < 6;
    }
    actions {
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait Until(Not(And((Event Player).is_target_in_los, Compare(Distance Between(Event Player, (Event Player).target), <, 6))), 99999);
        Stop Holding Button(Event Player, Button(Primary Fire));
    }
}

rule ("Team 2 Brigitte: Increase / Normalize Move Speed while holding Shield") {
    event {
        Ongoing - Each Player;
        Team 2;
        Brigitte;
    }
    conditions {
        Is Firing Secondary(Event Player) == True;
    }
    actions {
        Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 164.286, 142.857));
        Wait Until(Not(Is Firing Secondary(Event Player)), 99999);
        Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 115, 100));
    }
}

rule ("Team 2 Brigitte: Whip Shot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Brigitte;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, If-Then-Else(((Event Player).target).is_flying, 100, 50)));
        Loop If(Or(Compare(Distance Between(Event Player, (Event Player).target), <=, 6), Compare(Distance Between(Event Player, (Event Player).target), >=, 20)));
        Press Button(Event Player, Button(Ability 1));
        Wait(3, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Zarya: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Zarya;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        If(Compare(Distance Between(Event Player, (Event Player).target), >, 10));
            Press Button(Event Player, Button(Secondary Fire));
            Wait(1.5, Ignore Condition);
        Else;
            Start Holding Button(Event Player, Button(Primary Fire));
            Wait(3, Ignore Condition);
            Stop Holding Button(Event Player, Button(Primary Fire));
            Press Button(Event Player, Button(Secondary Fire));
            Wait(0.5, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2 Zarya: Self Bubble") {
    event {
        Ongoing - Each Player;
        Team 2;
        Zarya;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(10, Ignore Condition);
        Press Button(Event Player, Button(Ability 1));
        Loop If Condition Is True;
    }
}

rule ("Team 2 Zarya: Team Bubble") {
    event {
        Ongoing - Each Player;
        Team 2;
        Zarya;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Ability Cooldown(Event Player, Button(Ability 2)) <= 0;
    }
    actions {
        Press Button(Event Player, Button(Ability 2));
        Wait(10, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Zarya: Grav") {
    event {
        Ongoing - Each Player;
        Team 2;
        Zarya;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        Is Using Ability 1(Event Player) == False;
        Or(Compare(Global.wave_number, >=, 12), (Event Player).is_living_boss) == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Set Projectile Speed(Event Player, 30);
        Set Projectile Gravity(Event Player, 60);
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(0.1, Ignore Condition);
        Set Projectile Speed(Event Player, 100);
        Set Projectile Gravity(Event Player, 100);
        Wait(Random Real(60, 80), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Lucio: Swap to heal and shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Lúcio;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        Press Button(Event Player, Button(Ability 1));
        If(Compare(Distance Between(Event Player, First Of(Sorted Array(Filtered Array(All Living Players(Team 1), Is In View Angle(Event Player, Current Array Element, 45)), Current Array Element))), <=, 4));
            Press Button(Event Player, Button(Secondary Fire));
            Wait(0.7, Ignore Condition);
        Else;
            Start Holding Button(Event Player, Button(Primary Fire));
            Wait(2, Ignore Condition);
        End;
        Press Button(Event Player, Button(Ability 2));
        Loop If Condition Is True;
        Press Button(Event Player, Button(Ability 1));
    }
}

rule ("Team 2 Lucio: Ultimate") {
    event {
        Ongoing - Each Player;
        Team 2;
        Lúcio;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Is Using Ability 1(Event Player) == False;
        Or(Compare(Global.wave_number, >=, 12), (Event Player).is_living_boss) == True;
    }
    actions {
        Abort If Condition Is False;
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(Random Real(40, 60), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Kiriko: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Kiriko;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Press Button(Event Player, Button(Secondary Fire));
        Wait(0.6, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Kiriko: Swift Step") {
    event {
        Ongoing - Each Player;
        Team 2;
        Kiriko;
    }
    conditions {
        And((Event Player).is_alive, Compare(Normalized Health(Event Player), <=, 0.5)) == (Event Player).is_aggressive;
    }
    actions {
        Set Player Variable(Event Player, is_aggressive, Not((Event Player).is_aggressive));
        Set Player Variable(Event Player, ab_var_1, 1);
        Chase Player Variable Over Time(Event Player, ab_var_1, 0, 3, Destination and Duration);
        Wait(3, Ignore Condition);
        Stop Chasing Player Variable(Event Player, ab_var_1);
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(Turquoise), Position Of(Event Player), 1);
        Play Effect(All Players(All Teams), Bad Pickup Effect, Color(White), Position Of(Event Player), 200);
        Wait(0.016, Ignore Condition);
        Skip If(Has Status(Event Player, Stunned), 1);
        Call Subroutine(teleport_to_free_spawn);
        //lbl_0:
        Set Player Variable(Event Player, is_aggressive, True);
        Wait Until((Event Player).is_target_in_los, 15);
        Wait(Random Integer(16, 22), Ignore Condition);
    }
}

rule ("Team 2 Kiriko: Jump") {
    event {
        Ongoing - Each Player;
        Team 2;
        Kiriko;
    }
    conditions {
        (Event Player).is_using_combat_pathfinding == True;
        ((Event Player).target).is_flying == False;
        Is On Ground(Event Player) == True;
    }
    actions {
        Start Holding Button(Event Player, Button(Jump));
        Wait(1, Ignore Condition);
        Stop Holding Button(Event Player, Button(Jump));
        Wait(Random Real(0.8, 1.2), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Kiriko: Suzu") {
    event {
        Ongoing - Each Player;
        Team 2;
        Kiriko;
    }
    conditions {
        Distance Between(Event Player, (Event Player).target) <= 40;
        (Event Player).is_target_in_los >= 3;
    }
    actions {
        Wait(Random Integer(7, 15), Ignore Condition);
        Press Button(Event Player, Button(Ability 2));
        Loop If Condition Is True;
    }
}

rule ("Team 2 Kiriko: Ult") {
    event {
        Ongoing - Each Player;
        Team 2;
        Kiriko;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        Distance Between(Event Player, (Event Player).target) <= 20;
        Or(Compare(Global.wave_number, >=, 6), (Event Player).is_living_boss) == True;
    }
    actions {
        Abort If Condition Is False;
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(Random Real(18, 30), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Wrecking Ball: Explode") {
    event {
        Ongoing - Each Player;
        Team 2;
        Wrecking Ball;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Distance Between(Event Player, (Event Player).target) <= 2.4;
    }
    actions {
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(White), Event Player, 1);
        Set Ultimate Charge(Event Player, 100);
        Wait(0.5, Ignore Condition);
        Start Damage Over Time(Event Player, Null, 9999, Multiply(Max Health(Event Player), 0.05));
        While(Is Alive(Event Player));
            Set Ultimate Charge(Event Player, 100);
            Wait(0.016, Ignore Condition);
            Press Button(Event Player, Button(Ultimate));
            Wait(0.25, Ignore Condition);
            Set Status(Event Player, Null, Stunned, 0.1);
            Wait(5, Ignore Condition);
        End;
        Kill(Event Player, Null);
    }
}

rule ("Team 2 Cassidy: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Cassidy;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Is Using Ultimate(Event Player) == False;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        If(Or(Global.mut_lock_n_load, Compare(Distance Between(Event Player, (Event Player).target), >, 5)));
            Start Holding Button(Event Player, Button(Primary Fire));
            Wait(0.6, Ignore Condition);
            Stop Holding Button(Event Player, Button(Primary Fire));
        Else;
            Press Button(Event Player, Button(Secondary Fire));
        End;
        Wait(Random Real(0.8, 1.2), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Cassidy: Combat Roll") {
    event {
        Player Took Damage;
        Team 2;
        Cassidy;
    }
    actions {
        Abort If(Global.is_load_limit_reached);
        Abort If(Not((Event Player).is_using_combat_pathfinding));
        Abort If(Compare(Random Integer(1, 100), >, 30));
        Set Global Variable(temp_1, Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Multiply(6, World Vector Of(If-Then-Else(Compare(Throttle Of(Event Player), ==, Vector(False, False, False)), Forward, Throttle Of(Event Player)), Event Player, Rotation))), Null, Null, False));
        If(Compare(Distance Between(Global.temp_1, Ray Cast Hit Position(Global.temp_1, Add(Global.temp_1, Vector(0, -5, 0)), Null, Null, False)), <, 5));
            Press Button(Event Player, Button(Ability 1));
            Wait(10, Ignore Condition);
        Else;
            Wait(2, Ignore Condition);
    }
}

rule ("Team 2 Soldier: Shoot, Is Charging (1), Protecting Charge Target (2), Has Used Ability (3)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Soldier: 76;
    }
    conditions {
        (Event Player).ab_var_1 == False;
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        If(Compare((Event Player).real_tier, ==, 3));
            Press Button(Event Player, Button(Secondary Fire));
            If(Global.mut_lock_n_load);
                Wait(0.5, Ignore Condition);
                Press Button(Event Player, Button(Secondary Fire));
                Wait(1, Ignore Condition);
            Else;
                If(Is Firing Secondary(Event Player));
                    Wait(0.5, Ignore Condition);
                    Press Button(Event Player, Button(Secondary Fire));
                    Set Ammo(Event Player, 0, False);
                Else;
                    Wait(0.5, Ignore Condition);
                    Press Button(Event Player, Button(Secondary Fire));
                    If(Is Firing Secondary(Event Player));
                        Set Ammo(Event Player, 0, False);
                    End;
                End;
                Wait(2, Ignore Condition);
            End;
        Else If(Compare((Event Player).real_tier, ==, 4));
            Start Holding Button(Event Player, Button(Primary Fire));
            Wait(1.6, Ignore Condition);
            Stop Holding Button(Event Player, Button(Primary Fire));
            If(Compare(Ammo(Event Player, False), <=, 4));
                Press Button(Event Player, Button(Reload));
            End;
            Wait(If-Then-Else((Event Player).ab_var_2, 0.2, Random Real(1.2, 1.6)), Ignore Condition);
        Else;
            Start Holding Button(Event Player, Button(Primary Fire));
            Wait(0.5, Ignore Condition);
            Stop Holding Button(Event Player, Button(Primary Fire));
            If(Compare(Ammo(Event Player, False), <=, 2));
                Press Button(Event Player, Button(Reload));
            End;
            Wait(If-Then-Else(Compare((Event Player).real_tier, ==, 1), Random Real(1.2, 1.8), Random Real(0.5, 0.9)), Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2 Soldier: Biotic Field (Heavy Trooper), Emit Smoke (Grenadier)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Soldier: 76;
    }
    conditions {
        (Event Player).ab_var_3 == False;
        Normalized Health(Event Player) <= 0.5;
    }
    actions {
        Set Player Variable(Event Player, ab_var_3, True);
        If(Compare((Event Player).real_tier, ==, 3));
            For Player Variable(Event Player, i, 5, 0, -1);
                Play Effect(All Players(All Teams), Good Explosion, Color(White), Event Player, 0.1);
                If(Is Dead(Event Player));
                    Set Player Variable(Event Player, i, 0);
                    Break;
                End;
                Wait(0.2, Ignore Condition);
            End;
            Set Player Variable(Players Within Radius(Eye Position(Event Player), 7, Team 1, Surfaces), Smoked_Screen, True);
            Play Effect(All Players(All Teams), Bad Explosion, Color(White), Event Player, 7);
            Play Effect(All Players(All Teams), Bad Explosion, Color(Gray), Event Player, 7);
            Play Effect(All Players(All Teams), Explosion Sound, Color(White), Event Player, 200);
        Else;
            Press Button(Event Player, Button(Ability 2));
    }
}

rule ("Team 1: Smoke Screen") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).Smoked_Screen == True;
        (Event Player).downed_start_t == False;
    }
    actions {
        Start Forcing Player Outlines(All Players(All Teams), Event Player, False, Color(White), Default);
        Wait Until(Is Dead(Event Player), 4);
        Stop Forcing Player Outlines(All Players(All Teams), Event Player);
        Set Player Variable(Event Player, Smoked_Screen, False);
        Start Forcing Player Outlines(Filtered Array(All Players(Team 2), (Current Array Element).is_living_boss), Event Player, True, Color(Yellow), Always);
    }
}

rule ("Team 2 Soldier (Cloaker): Tactical Visor") {
    event {
        Ongoing - Each Player;
        Team 2;
        Soldier: 76;
    }
    conditions {
        (Event Player).real_tier == 4;
        (Event Player).is_target_in_los >= 5;
        ((Event Player).target).is_flying == False;
        Distance Between(Event Player, (Event Player).target) <= 40;
    }
    actions {
        Wait(0.5, Ignore Condition);
        If(And(Compare(Count Of(Filtered Array(Global.combatants, (Current Array Element).downed_start_t)), <=, If-Then-Else(Compare(Global.combatants_count, >=, 4), 1, 0)), Compare(Random Integer(1, 100), >, 50)));
            Set Ultimate Charge(Event Player, 100);
            Press Button(Event Player, Button(Ultimate));
            If(Is Using Ultimate(Event Player));
                Disable Movement Collision With Players(Event Player);
                Set Global Variable(temp_1, If-Then-Else(Compare(Distance Between(Event Player, (Event Player).target), <=, 10), 2, 1.5));
                Set Status(Event Player, Null, Rooted, Global.temp_1);
                Set Player Variable(Event Player, is_ignoring_other_targets, True);
                Set Player Variable(Event Player, ab_var_1, 1);
                Wait Until(Or(Or(Or(Or(Or(Or(Or(((Event Player).target).downed_start_t, Not(((Event Player).target).is_combatant)), ((Event Player).target).active_ab_is_cloaked), Not(And(((Event Player).target).is_invisible, Compare(Distance Between(Event Player, (Event Player).target), >, 2.4)))), Not((Event Player).ab_var_1)), Not(Is Using Ultimate(Event Player))), Has Status(Event Player, Stunned)), Compare((Event Player).fear_end_t, >=, Total Time Elapsed)), Add(Global.temp_1, 0.05));
                Set Player Variable(Event Player, ab_var_1, 2);
                Wait Until(Or(Or(Or(Or(Or(Or(Or(((Event Player).target).downed_start_t, Not(((Event Player).target).is_combatant)), ((Event Player).target).active_ab_is_cloaked), Not(And(((Event Player).target).is_invisible, Compare(Distance Between(Event Player, (Event Player).target), >, 2.4)))), Not((Event Player).ab_var_1)), Not(Is Using Ultimate(Event Player))), Has Status(Event Player, Stunned)), Compare((Event Player).fear_end_t, >=, Total Time Elapsed)), 99999);
                Set Player Variable(Event Player, is_ignoring_other_targets, False);
                Set Player Variable(Event Player, ab_var_1, False);
                Enable Movement Collision With Players(Event Player);
                Wait Until(Not(Is Using Ultimate(Event Player)), 99999);
                Wait(12, Ignore Condition);
            End;
        Else;
            Wait(4, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2 Soldier (Cloaker): Stuck while charging") {
    event {
        Ongoing - Each Player;
        Team 2;
        Soldier: 76;
    }
    conditions {
        (Event Player).ab_var_1 == 2;
        Or(Compare((Event Player).real_speed, <=, 1.5), ((Event Player).target).is_flying) == True;
    }
    actions {
        Wait(2, Abort When False);
        Set Player Variable(Event Player, ab_var_1, False);
    }
}

rule ("Team 2 Soldier (Cloaker): Sprint") {
    event {
        Ongoing - Each Player;
        Team 2;
        Soldier: 76;
    }
    conditions {
        (Event Player).ab_var_1 == 2;
        Is Using Ability 1(Event Player) == False;
        Magnitude Of(Throttle Of(Event Player)) > 0;
        Absolute Value(Horizontal Angle From Direction(Throttle Of(Event Player))) <= 60;
    }
    actions {
        Press Button(Event Player, Button(Ability 1));
        Wait(0.5, Abort When False);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Soldier (Cloaker): Quick Melee") {
    event {
        Ongoing - Each Player;
        Team 2;
        Soldier: 76;
    }
    conditions {
        (Event Player).ab_var_1 == 2;
        Distance Between(Event Player, (Event Player).target) <= 3;
    }
    actions {
        Set Player Variable(Event Player, nav_pos, Add(Position Of((Event Player).target), Multiply(2.5, Direction Towards(Event Player, (Event Player).target))));
        Set Player Variable(Event Player, ab_var_1, False);
        Press Button(Event Player, Button(Melee));
    }
}

rule ("Team 2 Soldier (Cloaker): Quick Melee, apply Stun") {
    event {
        Player Dealt Knockback;
        Team 2;
        Soldier: 76;
    }
    actions {
        Abort If(Compare(Event Ability, !=, Button(Melee)));
        Abort If(Compare((Event Player).real_tier, !=, 4));
        Abort If(Compare((Event Player).target, !=, Victim));
        If(And((Victim).perk_brass_knuckles, Is Meleeing(Victim)));
            Wait(2, Ignore Condition);
        Else If(And(And(Compare(Hero Of(Victim), ==, Hero(Reinhardt)), Is Using Ability 1(Victim)), Compare(Absolute Value(Horizontal Angle Towards(Victim, Event Player)), <=, 60)));
            Set Player Variable(Event Player, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, 2), (Event Player).gmut_fortified_bypass_end_t));
            Set Status(Event Player, Victim, Knocked Down, 2);
            Set Status(Victim, Event Player, Knocked Down, 2);
            Wait(1, Ignore Condition);
        Else;
            Damage(Victim, Event Player, 150);
            "Stun Sound"
            Set Status(Victim, Event Player, Stunned, 3.5);
            Wait(0.05, Ignore Condition);
            Set Status(Victim, Event Player, Knocked Down, 3.5);
            Set Player Variable(Event Player, ab_var_2, True);
            Start Holding Button(Event Player, Button(Crouch));
            Wait(1, Ignore Condition);
            Wait Until(Not(And(And((Event Player).is_target_in_los, Compare((Event Player).target, ==, Victim)), Has Status(Victim, Knocked Down))), 2);
            Set Player Variable(Event Player, ab_var_2, False);
            Stop Holding Button(Event Player, Button(Crouch));
    }
}

rule ("Team 2 Baptiste: Shoot, Has Used Immortality Field (1), Revive last time used (2)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Baptiste;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        Press Button(Event Player, Button(Primary Fire));
        Wait(Random Real(0.7, 1.1), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Baptiste: Immortality Field") {
    event {
        Ongoing - Each Player;
        Team 2;
        Baptiste;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        (Event Player).ab_var_1 == False;
        Normalized Health(Event Player) <= 0.25;
        Or(Compare(Global.wave_number, >=, 10), (Event Player).is_living_boss) == True;
        Has Status(Event Player, Hacked) == False;
        Has Status(Event Player, Stunned) == False;
    }
    actions {
        Set Player Variable(Event Player, ab_var_1, True);
        Abort If(And(Not((Event Player).is_living_boss), Compare(Random Integer(1, 100), >, 40)));
        Press Button(Event Player, Button(Ability 2));
    }
}

rule ("Team 2 Echo: Shoot, Is Landing (1)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Echo;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait(1.1, Ignore Condition);
        Stop Holding Button(Event Player, Button(Primary Fire));
        Wait(Random Real(0.4, 0.6), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Echo: Sticky Bombs") {
    event {
        Ongoing - Each Player;
        Team 2;
        Echo;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 50));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 20));
        Press Button(Event Player, Button(Secondary Fire));
        Wait(6, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Echo: Flight") {
    event {
        Ongoing - Each Player;
        Team 2;
        Echo;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        (Event Player).is_aggressive == True;
        Distance Between(Event Player, (Event Player).target) <= 40;
    }
    actions {
        Set Player Variable(Event Player, is_using_combat_pathfinding, 3);
        Set Player Variable(Event Player, is_nav_reachable_node, False);
        Press Button(Event Player, Button(Jump));
        Press Button(Event Player, Button(Ability 1));
        If(Is Using Ability 1(Event Player));
            Set Player Variable(Event Player, is_flying, True);
            Wait Until(Not(Is Using Ability 1(Event Player)), 99999);
            If((Event Player).is_living_boss);
                "Without a wait the second flight is silent"
                Wait(0.016, Ignore Condition);
                Press Button(Event Player, Button(Jump));
                Press Button(Event Player, Button(Ability 1));
                Wait Until(Not(Is Using Ability 1(Event Player)), 99999);
            End;
            Set Player Variable(Event Player, nav_pos, First Of(Sorted Array(Filtered Array(Global.nodes, Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS)), Subtract(Multiply(2, Distance Between(Event Player, Current Array Element)), Vertical Angle Towards(Event Player, Current Array Element)))));
            If(Compare((Event Player).nav_pos, ==, False));
                Set Player Variable(Event Player, nav_pos, First Of(Sorted Array(Global.nodes, Distance Between(Event Player, Current Array Element))));
            End;
            Set Player Variable(Event Player, is_flying, False);
            Set Player Variable(Event Player, ab_var_1, True);
            Set Player Variable(Event Player, is_pathfinding_disabled, True);
            Wait Until(Or(Is On Ground(Event Player), Not((Event Player).is_alive)), 99999);
            Set Player Variable(Event Player, ab_var_1, False);
            Set Player Variable(Event Player, is_pathfinding_disabled, False);
            Wait(4, Ignore Condition);
        Else;
            Wait(2, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2 Echo: Ascend / Descend") {
    event {
        Ongoing - Each Player;
        Team 2;
        Echo;
    }
    conditions {
        (Event Player).is_flying == True;
        Absolute Value(Subtract(Y Component Of(Position Of(Event Player)), Y Component Of((Event Player).nav_pos))) >= 1;
    }
    actions {
        If(Compare(Y Component Of(Position Of(Event Player)), <, Y Component Of((Event Player).nav_pos)));
            Start Holding Button(Event Player, Button(Jump));
            Wait Until(Not(And((Event Player).is_flying, Compare(Subtract(Y Component Of((Event Player).nav_pos), Y Component Of(Position Of(Event Player))), >=, 1))), 99999);
            Stop Holding Button(Event Player, Button(Jump));
        Else;
            Start Holding Button(Event Player, Button(Crouch));
            Wait Until(Not(And((Event Player).is_flying, Compare(Subtract(Y Component Of(Position Of(Event Player)), Y Component Of((Event Player).nav_pos)), >=, 1))), 99999);
            Stop Holding Button(Event Player, Button(Crouch));
    }
}

rule ("Team 2 Echo: Glide") {
    event {
        Ongoing - Each Player;
        Team 2;
        Echo;
    }
    conditions {
        (Event Player).ab_var_1 == True;
    }
    actions {
        Wait(0.25, Abort When False);
        Start Holding Button(Event Player, Button(Jump));
        Wait Until(Not((Event Player).ab_var_1), 2.5);
        Stop Holding Button(Event Player, Button(Jump));
    }
}

rule ("Team 2 Mei: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Mei;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Is Using Ability 1(Event Player) == False;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        If(Compare(Distance Between(Event Player, (Event Player).target), >, 8));
            Press Button(Event Player, Button(Secondary Fire));
            Wait(1.5, Ignore Condition);
        Else;
            Start Holding Button(Event Player, Button(Primary Fire));
            Wait(2.468, Ignore Condition);
            Stop Holding Button(Event Player, Button(Primary Fire));
            Press Button(Event Player, Button(Secondary Fire));
            Wait(0.5, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2 Mei: Ice Block + Wall") {
    event {
        Ongoing - Each Player;
        Team 2;
        Mei;
    }
    conditions {
        Normalized Health(Event Player) <= 0.499;
        Is Using Ability 1(Event Player) == False;
    }
    actions {
        Press Button(Event Player, If-Then-Else(Compare(Random Integer(1, 4), <=, 3), Button(Ability 2), Button(Ability 1)));
        If(Is Using Ability 2(Event Player));
            Wait(0.05, Ignore Condition);
            Press Button(Event Player, Button(Primary Fire));
        End;
        Wait(0.5, Ignore Condition);
        If(Is Using Ability 1(Event Player));
            Heal(Event Player, Null, Multiply(Max Health(Event Player), 0.25));
        End;
        Wait(7, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Mei: Ult") {
    event {
        Ongoing - Each Player;
        Team 2;
        Mei;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        Distance Between(Event Player, (Event Player).target) <= 25;
        Is Using Ability 1(Event Player) == False;
        Or(Compare(Global.wave_number, >=, 12), (Event Player).is_living_boss) == True;
    }
    actions {
        Abort If Condition Is False;
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(Random Real(18, 40), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Sombra: Shoot, Tase Target (Player), Just used Translocater (1), Took Damage (2), Tase / EMP Start Health (3)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sombra;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        (Event Player).ab_player == Null;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait(0.7, Ignore Condition);
        Stop Holding Button(Event Player, Button(Primary Fire));
        If(Compare(Ammo(Event Player, False), <=, 7));
            Press Button(Event Player, Button(Reload));
        End;
        Wait(Random Real(0.8, 1.2), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Sombra: Translocator") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sombra;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        (Event Player).is_aggressive == True;
        ((Event Player).target).is_flying == False;
        Distance Between(Event Player, (Event Player).target) >= 7.5;
        Distance Between(Event Player, (Event Player).target) <= 25;
        Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))) >= 3;
        Is In View Angle(Event Player, (Event Player).target, 5) == True;
    }
    actions {
        If(Is Using Ability 2(Event Player));
            Press Button(Event Player, Button(Interact));
            Wait(0.05, Ignore Condition);
        End;
        Press Button(Event Player, Button(Ability 2));
        Wait(Add(0.2, Divide(Distance Between(Event Player, (Event Player).target), 25)), Ignore Condition);
        Abort If(Not(Is Using Ability 2(Event Player)));
        Press Button(Event Player, Button(Ability 2));
        Wait(0.1, Ignore Condition);
        Abort If(Not(Has Status(Event Player, Phased Out)));
        Set Player Variable(Event Player, ab_var_1, True);
        Set Player Variable(Event Player, is_nav_reachable_node, False);
        Wait(2, Ignore Condition);
        Set Player Variable(Event Player, ab_var_1, False);
        Wait(8, Ignore Condition);
    }
}

rule ("Team 2 Sombra: EMP") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sombra;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        Or(Compare(Global.wave_number, >=, 13), (Event Player).is_living_boss) == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, If-Then-Else((Event Player).ab_var_1, 60, 30)));
        Loop If(Or(Has Status(Event Player, Hacked), Has Status(Event Player, Stunned)));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 12));
        Loop If(Not(Is In Line of Sight(Eye Position(Event Player), Eye Position((Event Player).target), Barriers Do Not Block LOS)));
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(Purple), Event Player, 1);
        Wait(0.5, Ignore Condition);
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Set Player Variable(Event Player, ab_var_2, False);
        Set Player Variable(Event Player, ab_var_3, Health(Event Player));
        Wait Until(And(Compare(Ultimate Charge Percent(Event Player), !=, 100), Or((Event Player).ab_var_2, Compare(Health(Event Player), <, (Event Player).ab_var_3))), 0.3);
        If(And(Compare(Ultimate Charge Percent(Event Player), !=, 100), Or((Event Player).ab_var_2, Compare(Health(Event Player), <, (Event Player).ab_var_3))));
            Set Player Variable(Event Player, gmut_fortified_bypass_end_t, Max(Add(Total Time Elapsed, 0.5), (Event Player).gmut_fortified_bypass_end_t));
            Set Status(Event Player, Null, Stunned, 0.5);
            Wait(8, Ignore Condition);
        Else;
            Wait(14, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2 Sombra: Tase") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sombra;
    }
    conditions {
        (Event Player).is_target_in_los == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, If-Then-Else(((Event Player).target).is_flying, 80, 40)));
        Loop If(Or(Has Status(Event Player, Hacked), Has Status(Event Player, Stunned)));
        Loop If(Is Dead(Event Player));
        Loop If(Compare(((Event Player).target).tased_end_t, >=, Total Time Elapsed));
        Loop If(Or(Or(Has Status((Event Player).target, Invincible), Has Status((Event Player).target, Phased Out)), Is Using Ultimate((Event Player).target)));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 12));
        Loop If(Not(Is In Line of Sight(Eye Position(Event Player), Eye Position((Event Player).target), All Barriers Block LOS)));
        Set Player Variable(Event Player, ab_player, (Event Player).target);
        Set Player Variable(Event Player, ab_var_2, False);
        Set Player Variable(Event Player, ab_var_3, Health(Event Player));
        Set Player Variable((Event Player).ab_player, tased_end_t, Add(Total Time Elapsed, 6));
        Set Status(Event Player, Null, Rooted, 6);
        If(Not(((Event Player).ab_player).perk_shockproof));
            Small Message((Event Player).ab_player, Custom String("A Taser is stunning you! Shoot her to break free!"));
        End;
        Wait(10, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Sombra: Tase times out / Lost Health / Target is downed / Target left / Is CCd / Distance too High / LOS lost") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sombra;
    }
    conditions {
        (Event Player).ab_player != Null;
        Or(Or(Or(Or(Or(Or(Or(Or(Compare(((Event Player).ab_player).tased_end_t, <, Total Time Elapsed), (Event Player).ab_var_2), Compare(Health(Event Player), <, (Event Player).ab_var_3)), ((Event Player).ab_player).downed_start_t), Not(((Event Player).ab_player).is_combatant)), Has Status(Event Player, Hacked)), Has Status(Event Player, Stunned)), Compare(Distance Between(Event Player, (Event Player).ab_player), >=, 11)), Not(Is In Line of Sight(Eye Position(Event Player), Eye Position((Event Player).ab_player), All Barriers Block LOS))) == True;
    }
    actions {
        If(((Event Player).ab_player).perk_shockproof);
            Damage(Event Player, (Event Player).ab_player, 50);
            Set Status(Filtered Array(Players Within Radius(Eye Position(Event Player), 10, Team 2, Surfaces), Not(Has Status(Current Array Element, Phased Out))), Null, Hacked, 2);
            Play Effect(All Players(All Teams), Bad Explosion, Color(Purple), Event Player, 10);
            Play Effect(All Players(All Teams), Explosion Sound, Color(White), Event Player, 200);
        End;
        Set Player Variable((Event Player).ab_player, tased_end_t, False);
        Set Player Variable(Event Player, ab_player, Null);
        Abort If(Has Status(Event Player, Hacked));
        Clear Status(Event Player, Rooted);
    }
}

rule ("Team 2 Sombra: Took Damage") {
    event {
        Player Took Damage;
        Team 2;
        Sombra;
    }
    actions {
        Set Player Variable(Event Player, ab_var_2, True);
    }
}

rule ("Team 1: Is Tased, Disable Abilities, Movement, Shake Facing, Set Aimspeed, Shoot") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).tased_end_t >= Total Time Elapsed;
    }
    actions {
        Abort If((Event Player).perk_shockproof);
        Set Status(Event Player, Null, Burning, 10);
        Set Status(Event Player, Null, Hacked, 10);
        Set Status(Event Player, Null, Rooted, 10);
        Start Facing(Event Player, Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Random Integer(-100, 20)), Add(Vertical Facing Angle Of(Event Player), Random Integer(-100, 80))), 100, To World, Direction and Turn Rate);
        Press Button(Event Player, If-Then-Else(Compare(Hero Of(Event Player), ==, Hero(Moira)), Button(Secondary Fire), Button(Primary Fire)));
        Wait(0.3, Ignore Condition);
        Stop Facing(Event Player);
        While(Compare((Event Player).tased_end_t, >=, Total Time Elapsed));
            Set Aim Speed(Event Player, 50);
            Press Button(Event Player, If-Then-Else(Compare(Hero Of(Event Player), ==, Hero(Moira)), Button(Secondary Fire), Button(Primary Fire)));
            Wait Until(Compare((Event Player).tased_end_t, <, Total Time Elapsed), Random Real(0.1, 0.3));
            Set Aim Speed(Event Player, 200);
            Press Button(Event Player, If-Then-Else(Compare(Hero Of(Event Player), ==, Hero(Moira)), Button(Secondary Fire), Button(Primary Fire)));
            Wait Until(Compare((Event Player).tased_end_t, <, Total Time Elapsed), Random Real(0.1, 0.3));
        End;
        Set Aim Speed(Event Player, 100);
        Clear Status(Event Player, Burning);
        Clear Status(Event Player, Hacked);
        Clear Status(Event Player, Rooted);
    }
}

rule ("Team 2 Widowmaker: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Widowmaker;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        If(Or(Compare(Distance Between(Event Player, (Event Player).target), <, 8), And(Not((Event Player).is_living_boss), Has Status(Event Player, Hacked))));
            Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
            Abort If Condition Is False;
            Start Holding Button(Event Player, Button(Primary Fire));
            Wait(0.25, Ignore Condition);
            Stop Holding Button(Event Player, Button(Primary Fire));
            If(Compare(Ammo(Event Player, False), <=, 1));
                Press Button(Event Player, Button(Reload));
            End;
        Else;
            Start Holding Button(Event Player, Button(Secondary Fire));
            Set Player Variable(Event Player, is_ignoring_other_targets, True);
            Wait Until(Not(And(Is Firing Secondary(Event Player), (Event Player).is_target_in_los)), 1.3);
            Set Player Variable(Event Player, is_ignoring_other_targets, False);
            If(And(Is Firing Secondary(Event Player), Compare((Event Player).is_target_in_los, >=, 4)));
                Press Button(Event Player, Button(Primary Fire));
                Wait(0.016, Ignore Condition);
            End;
            Stop Holding Button(Event Player, Button(Secondary Fire));
        End;
        Wait(1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Widowmaker: Grappling Hook") {
    event {
        Ongoing - Each Player;
        Team 2;
        Widowmaker;
    }
    conditions {
        (Event Player).is_using_combat_pathfinding == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, If-Then-Else(Compare((Event Player).real_speed, <=, 1), 100, 25)));
        Loop If(Is Firing Secondary(Event Player));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 8));
        Press Button(Event Player, Button(Ability 1));
        If(Is Using Ability 1(Event Player));
            Set Player Variable(Event Player, facing_override_direction, Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), If-Then-Else(Random Integer(0, 1), -45, 45)), -5));
            Wait(0.16, Ignore Condition);
            Set Player Variable(Event Player, facing_override_direction, False);
            Wait Until(Not(Is Using Ability 1(Event Player)), 99999);
            Set Player Variable(Event Player, nav_pos, Position Of(Event Player));
            Wait(8, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

disabled rule ("Team 2 Widowmaker: Infra-Sight") {
    event {
        Ongoing - Each Player;
        Team 2;
        Widowmaker;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        Global.is_infrasight_on == False;
        Or(Compare(Global.wave_number, >=, 1), (Event Player).is_living_boss) == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 20));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(38, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Widowmaker: Infra-Sight if Sombra is stealthed") {
    event {
        Ongoing - Each Player;
        Team 2;
        Widowmaker;
    }
    conditions {
        (Event Player).target == 0;
        Global.is_infrasight_on == False;
        Is True For Any(Global.combatants, Compare((Current Array Element).is_invisible, ==, 1)) == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 40));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
    }
}

rule ("Global: Set / Unset Is Infrasight on (Bots)") {
    event {
        Ongoing - Global;
    }
    conditions {
        Global.is_infrasight_on != Is True For Any(Players On Hero(Hero(Widowmaker), Team 2), Is Using Ultimate(Current Array Element));
    }
    actions {
        Set Global Variable(is_infrasight_on, Not(Global.is_infrasight_on));
        Set Global Variable(aim_offset, Multiply(If-Then-Else(Global.is_infrasight_on, 0, 0.5), Down));
        Wait(0.016, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Pharah: Flight") {
    event {
        Ongoing - Each Player;
        Team 2;
        Pharah;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Press Button(Event Player, Button(Ability 1));
        Start Holding Button(Event Player, Button(Jump));
        Wait(Random Real(0.777, 1.111), Abort When False);
        Stop Holding Button(Event Player, Button(Jump));
        Wait(Random Real(0.222, 0.555), Abort When False);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Pharah: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Pharah;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        Press Button(Event Player, Button(Primary Fire));
        Wait(Random Real(0.6, 1.3), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Reaper: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reaper;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Is Using Ability 1(Event Player) == False;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        Press Button(Event Player, Button(Primary Fire));
        Wait(0.6, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Reaper: Wraith Form, Force Position") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reaper;
    }
    conditions {
        (Event Player).is_alive == True;
        (Event Player).is_aggressive == True;
        (Event Player).fear_end_t < Total Time Elapsed;
        Has Status(Event Player, Hacked) == False;
        Has Status(Event Player, Rooted) == False;
        Has Status(Event Player, Stunned) == False;
        Distance Between(Event Player, (Event Player).target) >= 10;
        Distance Between(Event Player, (Event Player).target) <= 40;
    }
    actions {
        Press Button(Event Player, Button(Ability 1));
        If(Is Using Ability 1(Event Player));
            Set Player Variable(Event Player, ab_wraith_pos, Position Of(Event Player));
            Chase Player Variable At Rate(Event Player, ab_wraith_pos, Add(Position Of((Event Player).target), Vector(0, 0.5, 0)), 15, Destination and Rate);
            Start Forcing Player Position(Event Player, (Event Player).ab_wraith_pos, True);
            Disable Movement Collision With Environment(Event Player, True);
            Set Player Variable(Event Player, is_wraith, True);
            Set Player Variable(Event Player, is_pathfinding_disabled, True);
            Set Player Variable(Event Player, is_target_in_los, 5);
            Wait(8, Ignore Condition);
        Else;
            Wait(1, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("Team 2 Reaper: Cancel Wraith Form, Stop Forcing Position") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reaper;
    }
    conditions {
        (Event Player).is_wraith == True;
        Is Using Ability 1(Event Player) == True;
        Distance Between(Event Player, (Event Player).target) <= 3;
        Is In Line of Sight((Event Player).target, Position Of(Event Player), Barriers Do Not Block LOS) == True;
    }
    actions {
        If(Compare(Distance Between(Event Player, Ray Cast Hit Position(Event Player, Add(Event Player, Vector(0, -5, 0)), Null, Null, False)), >=, 5));
            Wait(0.15, Ignore Condition);
            Abort If(Not((Event Player).is_wraith));
        End;
        Press Button(Event Player, Button(Ability 1));
        Stop Chasing Player Variable(Event Player, ab_wraith_pos);
        Stop Forcing Player Position(Event Player);
        Enable Movement Collision With Environment(Event Player);
        Set Player Variable(Event Player, is_wraith, False);
        Set Player Variable(Event Player, is_pathfinding_disabled, False);
        Set Player Variable(Event Player, nav_pos, Position Of((Event Player).target));
        Set Player Variable(Event Player, is_nav_reachable_node, False);
    }
}

rule ("Team 2 Reaper: Wraith Form Timed out / Target left / Target is invisible, Stop Forcing Position") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reaper;
    }
    conditions {
        (Event Player).is_wraith == True;
        Or(Not(And(Is Using Ability 1(Event Player), ((Event Player).target).is_combatant)), ((Event Player).target).active_ab_is_cloaked) == True;
    }
    actions {
        Stop Chasing Player Variable(Event Player, ab_wraith_pos);
        Stop Forcing Player Position(Event Player);
        Enable Movement Collision With Environment(Event Player);
        Set Player Variable(Event Player, is_wraith, False);
        Set Player Variable(Event Player, is_pathfinding_disabled, False);
        Set Player Variable(Event Player, is_nav_reachable_node, False);
    }
}

rule ("Team 2 Reaper: Death Blossom") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reaper;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        Is Using Ability 1(Event Player) == False;
        Or(Compare(Global.wave_number, >=, 12), (Event Player).is_living_boss) == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 20));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 7));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(28, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Ana: Shoot, Has Used Nano Boost (1)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Ana;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        If(Or(Compare(Distance Between(Event Player, (Event Player).target), <, 8), And(Not((Event Player).is_living_boss), Has Status(Event Player, Hacked))));
            Stop Holding Button(Event Player, Button(Secondary Fire));
            Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
            Abort If Condition Is False;
        Else;
            If(Not(Is Firing Secondary(Event Player)));
                Start Holding Button(Event Player, Button(Secondary Fire));
                Wait(0.5, Ignore Condition);
            End;
        End;
        Press Button(Event Player, Button(Primary Fire));
        Wait(1, Ignore Condition);
        Loop If Condition Is True;
        Stop Holding Button(Event Player, Button(Secondary Fire));
    }
}

rule ("Team 2 Ana: Biotic Grenade") {
    event {
        Ongoing - Each Player;
        Team 2;
        Ana;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(1.75, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 40));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 15));
        Press Button(Event Player, Button(Ability 2));
        Wait(9, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Ana: Nano Boost") {
    event {
        Ongoing - Each Player;
        Team 2;
        Ana;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        (Event Player).ab_var_1 == False;
        Normalized Health(Event Player) <= 0.75;
        Or(Compare(Global.wave_number, >=, 13), (Event Player).is_living_boss) == True;
        Has Status(Event Player, Hacked) == False;
        Has Status(Event Player, Stunned) == False;
    }
    actions {
        Set Player Variable(Event Player, ab_var_1, True);
        Abort If(And(Not((Event Player).is_living_boss), Compare(Random Integer(1, 100), >, 50)));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
    }
}

rule ("Team 2 D.Va: Start / Stop Shooting, Has Used Self-Destruct (1), Can remech (2)") {
    event {
        Ongoing - Each Player;
        Team 2;
        D.Va;
    }
    conditions {
        (Event Player).is_target_in_los >= 3;
        Or(Or(Or(Compare(Distance Between(Event Player, (Event Player).target), <=, 10), Is Using Ability 1(Event Player)), Is Standing(Event Player)), Is In Alternate Form(Event Player)) == True;
    }
    actions {
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait Until(Not(And(Compare((Event Player).is_target_in_los, >=, 3), Or(Or(Or(Compare(Distance Between(Event Player, (Event Player).target), <=, 15), Is Using Ability 1(Event Player)), Is Standing(Event Player)), Is In Alternate Form(Event Player)))), Random Integer(4, 8));
        Stop Holding Button(Event Player, Button(Primary Fire));
        Start Holding Button(Event Player, Button(Secondary Fire));
        Wait Until(Compare(Ability Resource(Event Player, Button(Secondary Fire)), <=, 30), 2);
        Stop Holding Button(Event Player, Button(Secondary Fire));
        Loop If Condition Is True;
    }
}

rule ("Team 2 D.Va: Boosters") {
    event {
        Ongoing - Each Player;
        Team 2;
        D.Va;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        (Event Player).is_aggressive == True;
        Is In Alternate Form(Event Player) == False;
        Distance Between(Event Player, (Event Player).target) >= 7.5;
        Distance Between(Event Player, (Event Player).target) <= 25;
        Is In View Angle(Event Player, (Event Player).target, 5) == True;
    }
    actions {
        Press Button(Event Player, Button(Ability 1));
        Set Player Variable(Event Player, is_pathfinding_disabled, True);
        Wait Until(Or(Not(Is Using Ability 1(Event Player)), Compare(Distance Between(Event Player, (Event Player).target), <, 1)), 3);
        Press Button(Event Player, Button(Ability 1));
        Set Player Variable(Event Player, is_pathfinding_disabled, False);
        Set Player Variable(Event Player, is_nav_reachable_node, False);
        Wait(5, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 D.Va: Self-Destruct") {
    event {
        Ongoing - Each Player;
        Team 2;
        D.Va;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        (Event Player).ab_var_1 == False;
        Global.wave_number >= 15;
        Is In Alternate Form(Event Player) == False;
        Normalized Health(Event Player) <= 0.8;
        Health(Event Player) > 1;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 30));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 15));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        If(Is Using Ultimate(Event Player));
            Set Player Variable(Event Player, ab_var_1, True);
            Wait(3.5, Ignore Condition);
            Set Player Variable(Event Player, ab_var_2, True);
        Else;
            Loop;
    }
}

rule ("Team 2 D.Va: Boss Self-Destruct") {
    event {
        Ongoing - Each Player;
        Team 2;
        D.Va;
    }
    conditions {
        (Event Player).is_living_boss == True;
        (Event Player).ab_var_1 == False;
        Is In Alternate Form(Event Player) == False;
        Health(Event Player) < 1;
    }
    actions {
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Abort If(Not(Is Using Ultimate(Event Player)));
        Set Player Variable(Event Player, ab_var_1, True);
        Wait(3.5, Ignore Condition);
        Set Player Variable(Event Player, ab_var_2, True);
    }
}

rule ("Team 2 D.Va: Allow Call Mech") {
    event {
        Ongoing - Each Player;
        Team 2;
        D.Va;
    }
    conditions {
        (Event Player).is_alive == True;
        Is In Alternate Form(Event Player) == True;
        (Event Player).ab_var_2 == False;
    }
    actions {
        Wait(If-Then-Else((Event Player).is_living_boss, 25, 10), Abort When False);
        Abort If Condition Is False;
        Set Player Variable(Event Player, ab_var_2, True);
    }
}

rule ("Team 2 D.Va: Call Mech") {
    event {
        Ongoing - Each Player;
        Team 2;
        D.Va;
    }
    conditions {
        (Event Player).is_alive == True;
        Is In Alternate Form(Event Player) == True;
        (Event Player).ab_var_2 == True;
        Has Status(Event Player, Hacked) == False;
        Has Status(Event Player, Stunned) == False;
        Is On Ground(Event Player) == True;
    }
    actions {
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Set Player Variable(Event Player, ab_var_2, False);
    }
}

rule ("Team 2 D.Va: Set / Unset Is aggressive") {
    event {
        Ongoing - Each Player;
        Team 2;
        D.Va;
    }
    conditions {
        (Event Player).is_using_boss_aggression == False;
        And((Event Player).is_alive, Is In Alternate Form(Event Player)) == (Event Player).is_aggressive;
    }
    actions {
        Set Player Variable(Event Player, is_aggressive, Not((Event Player).is_aggressive));
        Wait(0.016, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Orisa: Start / Stop Shooting") {
    event {
        Ongoing - Each Player;
        Team 2;
        Orisa;
    }
    conditions {
        (Event Player).is_target_in_los >= 3;
    }
    actions {
        If(Compare(Random Integer(1, 100), >, 60));
            Press Button(Event Player, Button(Secondary Fire));
            Wait(0.5, Ignore Condition);
        End;
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait Until(Compare((Event Player).is_target_in_los, <, 3), 99999);
        Stop Holding Button(Event Player, Button(Primary Fire));
    }
}

rule ("Team 2 Orisa: Decrease / Normalize Move Speed while shooting on ground") {
    event {
        Ongoing - Each Player;
        Team 2;
        Orisa;
    }
    conditions {
        Is Button Held(Event Player, Button(Primary Fire)) == True;
        Is On Ground(Event Player) == True;
    }
    actions {
        Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 57.5, 50));
        Wait Until(Not(And(Is Button Held(Event Player, Button(Primary Fire)), Is On Ground(Event Player))), 99999);
        Set Move Speed(Event Player, If-Then-Else(Global.mut_amped, 115, 100));
    }
}

rule ("Team 2 Orisa: Javelin") {
    event {
        Ongoing - Each Player;
        Team 2;
        Orisa;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        Distance Between(Event Player, (Event Player).target) <= 15;
        Is In View Angle(Event Player, (Event Player).target, 5) == True;
    }
    actions {
        Press Button(Event Player, Button(Secondary Fire));
        Wait(15, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Orisa: Fortify") {
    event {
        Ongoing - Each Player;
        Team 2;
        Orisa;
    }
    conditions {
        Or(Compare(Slot Of(Event Player), !=, 1), Compare(Global.objective_phase_number, ==, 1)) == True;
        Is Using Ability 1(Event Player) == False;
        Normalized Health(Event Player) <= If-Then-Else(Global.gmut_fortified, 0.6, 0.4);
    }
    actions {
        Press Button(Event Player, Button(Ability 1));
        Wait(15, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Orisa: Javelin Spin") {
    event {
        Ongoing - Each Player;
        Team 2;
        Orisa;
    }
    conditions {
        (Event Player).is_target_in_los == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 20));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >, 20));
        Press Button(Event Player, Button(Ability 2));
        Wait(12, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Orisa: Terra-Surge") {
    event {
        Ongoing - Each Player;
        Team 2;
        Orisa;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        Or(Compare(Global.wave_number, >=, 10), (Event Player).is_living_boss) == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 20));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >, 20));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(20, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Roadhog: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Roadhog;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Is Using Ability 1(Event Player) == False;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        If(Compare(Distance Between(Event Player, (Event Player).target), >, 9));
            Press Button(Event Player, Button(Secondary Fire));
        Else;
            Press Button(Event Player, Button(Primary Fire));
        End;
        Wait Until(Is Using Ability 1(Event Player), Random Real(2, 2.4));
        Loop If Condition Is True;
    }
}

rule ("Team 2 Roadhog: Chain Hook") {
    event {
        Ongoing - Each Player;
        Team 2;
        Roadhog;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, If-Then-Else(((Event Player).target).is_flying, 80, 40)));
        Loop If(Not(Ammo(Event Player, False)));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 20));
        Press Button(Event Player, Button(Ability 1));
        Wait(8, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Roadhog: Whole Hog") {
    event {
        Ongoing - Each Player;
        Team 2;
        Roadhog;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        Or(Compare(Global.wave_number, >=, 11), (Event Player).is_living_boss) == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 20));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 5));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(28, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Roadhog: Whole Hog Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Roadhog;
    }
    conditions {
        Is Using Ultimate(Event Player) == True;
    }
    actions {
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait(Random Real(0.7, 1.1), Ignore Condition);
        Stop Holding Button(Event Player, Button(Primary Fire));
        Loop If Condition Is True;
    }
}

rule ("Team 2 Tracer: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Tracer;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait(0.45, Ignore Condition);
        Stop Holding Button(Event Player, Button(Primary Fire));
        If(Compare(Ammo(Event Player, False), <=, 5));
            Press Button(Event Player, Button(Reload));
        End;
        Wait(Random Real(0.4, 0.6), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Tracer: Blink") {
    event {
        Ongoing - Each Player;
        Team 2;
        Tracer;
    }
    conditions {
        (Event Player).is_aggressive == True;
        (Event Player).is_target_in_los >= 4;
        Distance Between(Event Player, (Event Player).target) <= 5;
        Absolute Value(Horizontal Angle Towards((Event Player).target, Event Player)) <= 45;
    }
    actions {
        If(And(Not(Global.is_load_limit_reached), Ability Charge(Event Player, Button(Ability 1))));
            Set Global Variable(temp_1, Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Multiply(7.5, World Vector Of(If-Then-Else(Compare(Throttle Of(Event Player), ==, Vector(False, False, False)), Forward, Throttle Of(Event Player)), Event Player, Rotation))), Null, Null, False));
            If(Compare(Distance Between(Global.temp_1, Ray Cast Hit Position(Global.temp_1, Add(Global.temp_1, Vector(0, -5, 0)), Null, Null, False)), <, 5));
                Press Button(Event Player, Button(Ability 1));
            End;
        End;
        Wait(1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Tracer: Recall to enemy on high ground") {
    event {
        Ongoing - Each Player;
        Team 2;
        Tracer;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        (Event Player).is_aggressive == True;
        (Event Player).recall_block_end_t < Total Time Elapsed;
        ((Event Player).target).is_flying == False;
        Distance Between(Event Player, (Event Player).target) <= 20;
        Subtract(Y Component Of(Position Of((Event Player).target)), Y Component Of(Position Of(Event Player))) >= 3;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Ability 2), False);
        Press Button(Event Player, Button(Ability 2));
        Wait(0.8, Ignore Condition);
        If(And(Is Using Ability 2(Event Player), (Event Player).is_target_in_los));
            Teleport(Event Player, Add(Ray Cast Hit Position(Eye Position((Event Player).target), Subtract(Position Of((Event Player).target), Multiply(2.5, Direction From Angles(Horizontal Facing Angle Of((Event Player).target), False))), Null, Null, False), Multiply(0.5, Direction From Angles(Horizontal Facing Angle Of((Event Player).target), False))));
            Set Player Variable(Event Player, is_nav_reachable_node, False);
            Wait(15, Ignore Condition);
        End;
        Wait(5, Ignore Condition);
    }
}

rule ("Team 2 Tracer: Pulse Bomb, Has Used Pulse Bomb (1)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Tracer;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        (Event Player).is_aggressive == True;
        (Event Player).ab_var_1 == False;
        Normalized Health(Event Player) <= 0.4;
        Has Status(Event Player, Hacked) == False;
        Has Status(Event Player, Stunned) == False;
    }
    actions {
        Set Player Variable(Event Player, ab_var_1, True);
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(0.16, Ignore Condition);
        Cancel Primary Action(Event Player);
        If((Event Player).is_living_boss);
            Set Ability Charge(Event Player, Button(Ability 1), 3);
            Press Button(Event Player, Button(Ability 1));
            Set Ultimate Charge(Event Player, 100);
            Press Button(Event Player, Button(Ultimate));
            Wait(0.192, Ignore Condition);
            Cancel Primary Action(Event Player);
            Press Button(Event Player, Button(Ability 1));
            Set Ultimate Charge(Event Player, 100);
            Press Button(Event Player, Button(Ultimate));
            Wait(0.16, Ignore Condition);
            Cancel Primary Action(Event Player);
        End;
        Abort If(Compare((Event Player).recall_block_end_t, >=, Total Time Elapsed));
        Set Ability Cooldown(Event Player, Button(Ability 2), False);
        Press Button(Event Player, Button(Ability 2));
        Wait(0.8, Ignore Condition);
        Abort If(Not(And(Is Using Ability 2(Event Player), (Event Player).is_target_in_los)));
        Teleport(Event Player, Add(Ray Cast Hit Position(Eye Position((Event Player).target), Subtract(Position Of((Event Player).target), Multiply(2.5, Direction From Angles(Horizontal Facing Angle Of((Event Player).target), False))), Null, Null, False), Multiply(0.5, Direction From Angles(Horizontal Facing Angle Of((Event Player).target), False))));
        Set Player Variable(Event Player, is_nav_reachable_node, False);
        Wait(2.8, Ignore Condition);
    }
}

rule ("Team 2 Genji: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Genji;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        And(Is Using Ultimate(Event Player), Compare(Distance Between(Event Player, (Event Player).target), >, 5)) == False;
    }
    actions {
        If(Or(Compare(Distance Between(Event Player, (Event Player).target), >, 4), Is Using Ultimate(Event Player)));
            Press Button(Event Player, Button(Primary Fire));
        Else;
            Press Button(Event Player, Button(Secondary Fire));
        End;
        Wait(1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Genji: Jump") {
    event {
        Ongoing - Each Player;
        Team 2;
        Genji;
    }
    conditions {
        (Event Player).is_using_combat_pathfinding == True;
        ((Event Player).target).is_flying == False;
        Is On Ground(Event Player) == True;
    }
    actions {
        Press Button(Event Player, Button(Jump));
        Wait(0.5, Ignore Condition);
        Press Button(Event Player, Button(Jump));
        Wait(Random Real(0.8, 1.2), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Genji: Swift Strike") {
    event {
        Ongoing - Each Player;
        Team 2;
        Genji;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        (Event Player).is_aggressive == True;
        Distance Between(Event Player, (Event Player).target) <= 15;
        Absolute Value(Horizontal Angle Towards(Event Player, (Event Player).target)) <= 5;
        Is Using Ability 2(Event Player) == False;
    }
    actions {
        If(Not(Global.is_load_limit_reached));
            Set Global Variable(temp_1, Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Multiply(15, Facing Direction Of(Event Player))), Null, Null, False));
            If(Compare(Distance Between(Global.temp_1, Ray Cast Hit Position(Global.temp_1, Add(Global.temp_1, Vector(0, -20, 0)), Null, Null, False)), <, 20));
                Press Button(Event Player, Button(Ability 1));
                Wait(2, Ignore Condition);
            End;
        End;
        Wait(2, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Genji: Deflect") {
    event {
        Player Took Damage;
        Team 2;
        Genji;
    }
    actions {
        Abort If(Is Using Ultimate(Event Player));
        Abort If(Compare(Random Integer(1, 100), >, 30));
        Press Button(Event Player, Button(Ability 2));
        Wait(8, Ignore Condition);
    }
}

rule ("Team 2 Genji: Dragonblade") {
    event {
        Ongoing - Each Player;
        Team 2;
        Genji;
    }
    conditions {
        (Event Player).is_alive == True;
        Normalized Health(Event Player) <= 0.5;
        Is Using Ultimate(Event Player) == False;
    }
    actions {
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(0.5, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Hanzo: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Hanzo;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait(0.8, Ignore Condition);
        Stop Holding Button(Event Player, Button(Primary Fire));
        Wait(0.3, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Hanzo: Lunge") {
    event {
        Player Took Damage;
        Team 2;
        Hanzo;
    }
    actions {
        Abort If(Global.is_load_limit_reached);
        Abort If(Not((Event Player).is_using_combat_pathfinding));
        Abort If(Compare(Random Integer(1, 100), >, 50));
        Press Button(Event Player, Button(Jump));
        Wait(0.4, Ignore Condition);
        Set Global Variable(temp_1, Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Multiply(7.85, World Vector Of(If-Then-Else(Compare(Throttle Of(Event Player), ==, Vector(False, False, False)), Forward, Throttle Of(Event Player)), Event Player, Rotation))), Null, Null, False));
        If(Compare(Distance Between(Global.temp_1, Ray Cast Hit Position(Global.temp_1, Add(Global.temp_1, Vector(0, -5, 0)), Null, Null, False)), <, 5));
            Press Button(Event Player, Button(Jump));
            Wait(5.5, Ignore Condition);
        Else;
            Wait(2, Ignore Condition);
    }
}

rule ("Team 2 Hanzo: Storm Arrows") {
    event {
        Ongoing - Each Player;
        Team 2;
        Hanzo;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        Normalized Health(Event Player) <= 0.5;
        Is Using Ability 2(Event Player) == False;
    }
    actions {
        Press Button(Event Player, Button(Ability 2));
        Wait(0.5, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Hanzo: Dragonstrike") {
    event {
        Ongoing - Each Player;
        Team 2;
        Hanzo;
    }
    conditions {
        (Event Player).is_alive == True;
        (Event Player).is_target_in_los == 0;
        (Event Player).fear_end_t < Total Time Elapsed;
        Distance Between(Event Player, (Event Player).target) >= 15;
    }
    actions {
        Wait(1, Abort When False);
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Set Player Variable(Event Player, facing_override_direction, Vector Towards(Event Player, (Event Player).target));
        Wait(0.6, Ignore Condition);
        Set Player Variable(Event Player, facing_override_direction, Vector Towards(Event Player, (Event Player).target));
        Wait(0.4, Ignore Condition);
        Set Player Variable(Event Player, facing_override_direction, False);
        Wait(35, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Reinhardt: Disable Barrier Field after breaking") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reinhardt;
    }
    conditions {
        Ability Cooldown(Event Player, Button(Secondary Fire)) > 0;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Secondary Fire), 1000);
    }
}

rule ("Team 2 Reinhardt: Hold / Drop Shield if Target and Distance to Target >= 5m") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reinhardt;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        Distance Between(Event Player, (Event Player).target) >= 5;
        "Reinhardt won't automatically raise his shield again after charging or being hacked"
        Is Using Ability 1(Event Player) == False;
        Has Status(Event Player, Hacked) == False;
    }
    actions {
        Start Holding Button(Event Player, Button(Secondary Fire));
        Wait Until(Not(And(And(And((Event Player).is_target_in_los, Compare(Distance Between(Event Player, (Event Player).target), >=, 5)), Not(Is Using Ability 1(Event Player))), Not(Has Status(Event Player, Hacked)))), 99999);
        Stop Holding Button(Event Player, Button(Secondary Fire));
    }
}

rule ("Team 2 Reinhardt: Start / Stop Attacking if Distance to Target < 5m") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reinhardt;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        Distance Between(Event Player, (Event Player).target) < 5;
    }
    actions {
        Start Holding Button(Event Player, Button(Primary Fire));
        Wait Until(Not(And((Event Player).is_target_in_los, Compare(Distance Between(Event Player, (Event Player).target), <, 5))), 99999);
        Stop Holding Button(Event Player, Button(Primary Fire));
    }
}

rule ("Team 2 Reinhardt: Fire Strike") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reinhardt;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 75));
        Loop If(Or(Compare(Distance Between(Event Player, (Event Player).target), <=, 5), Compare(Distance Between(Event Player, (Event Player).target), >=, 25)));
        Press Button(Event Player, Button(Ability 2));
        Wait(5, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Reinhardt: Charge") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reinhardt;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        (Event Player).is_aggressive == True;
        Add(((Event Player).target).last_hit_by_shatter_t, 1) >= Total Time Elapsed;
        Add(((Event Player).target).last_hit_by_shatter_t, 0.4) < Total Time Elapsed;
        Absolute Value(Horizontal Angle Towards(Event Player, (Event Player).target)) <= 5;
    }
    actions {
        Press Button(Event Player, Button(Ability 1));
        Wait(6, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Reinhardt: Charge into battle (Mut: Lock 'n Load)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reinhardt;
    }
    conditions {
        Global.mut_lock_n_load == True;
        (Event Player).is_target_in_los >= 4;
        (Event Player).is_aggressive == True;
        Distance Between(Event Player, (Event Player).target) > 25;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Press Button(Event Player, Button(Ability 1));
    }
}

rule ("Team 2 Reinhardt: Earthshatter") {
    event {
        Ongoing - Each Player;
        Team 2;
        Reinhardt;
    }
    conditions {
        (Event Player).is_target_in_los >= 5;
        ((Event Player).target).is_flying == False;
        Is Firing Secondary(Event Player) == False;
    }
    actions {
        Wait(1, Abort When False);
        Loop If(Compare(Random Integer(1, 100), <=, Multiply(100, Normalized Health(Event Player))));
        Loop If(Or(Compare(Distance Between(Event Player, (Event Player).target), >=, 18), Compare(Absolute Value(Horizontal Angle Towards(Event Player, (Event Player).target)), >=, 30)));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(Random Integer(7, 20), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 1: Is Shattered, Start Accelerating") {
    event {
        Player Took Damage;
        Team 1;
        All;
    }
    actions {
        Abort If(Not(Has Status(Event Player, Stunned)));
        Abort If(Compare(Hero Of(Attacker), !=, Hero(Reinhardt)));
        Abort If(Compare(Event Ability, !=, Button(Ultimate)));
        Set Status(Event Player, Attacker, Stunned, 5);
        Set Player Variable(Event Player, last_hit_by_shatter_t, Total Time Elapsed);
        Apply Impulse(Event Player, Direction From Angles(Horizontal Angle From Direction(Event Direction), 30), 15, To World, Cancel Contrary Motion XYZ);
        Start Accelerating(Event Player, Direction From Angles(Horizontal Angle From Direction(Event Direction), 30), If-Then-Else(Is In Air(Event Player), 100, Multiply(Subtract(1, Subtract(Total Time Elapsed, (Event Player).last_hit_by_shatter_t)), 500)), 15, To World, Direction Rate and Max Speed);
        Wait(1, Ignore Condition);
        Clear Status(Event Player, Stunned);
        Stop Accelerating(Event Player);
    }
}

rule ("Team 2 Sigma: Flux") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sigma;
    }
    conditions {
        (Event Player).is_target_in_los == True;
        Or((Event Player).is_living_boss, Compare(Global.wave_number, >=, 10)) == True;
    }
    actions {
        Wait(2, Ignore Condition);
        Abort If Condition Is False;
        Loop If(Compare(Random Integer(1, 100), >, 30));
        Loop If(Compare(Distance Between(Event Player, (Event Player).target), >=, 25));
        Set Ultimate Charge(Event Player, 100);
        Press Button(Event Player, Button(Ultimate));
        Wait(1.75, Abort When False);
        While(Is Using Ultimate(Event Player));
            Wait(0.5, Abort When False);
            Press Button(Event Player, Button(Primary Fire));
        End;
        Wait(28, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Sigma: Shoot") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sigma;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Is Firing Secondary(Event Player) == False;
        Is Using Ultimate(Event Player) == False;
    }
    actions {
        Wait(Divide(Angle Between Vectors(Facing Direction Of(Event Player), Vector Towards(Event Player, (Event Player).target)), 300), Ignore Condition);
        Abort If Condition Is False;
        Press Button(Event Player, Button(Primary Fire));
        Wait(Random Real(0.9, 1.5), Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Sigma: Barrier") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sigma;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Is Using Ability 1(Event Player) == False;
        Is Using Ability 2(Event Player) == False;
        Is Using Ultimate(Event Player) == False;
    }
    actions {
        If(Compare(Distance Between((Event Player).target, Event Player), <=, 30));
            Start Holding Button(Event Player, Button(Secondary Fire));
            Wait(Random Real(0.2, 2), Ignore Condition);
            Stop Holding Button(Event Player, Button(Secondary Fire));
        End;
        Wait(4, Abort When False);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Sigma: Grasp") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sigma;
    }
    conditions {
        (Event Player).is_target_in_los >= 4;
        Is Firing Secondary(Event Player) == False;
        Is Using Ability 2(Event Player) == False;
    }
    actions {
        Wait(10, Ignore Condition);
        Press Button(Event Player, Button(Ability 1));
        Loop If Condition Is True;
    }
}

rule ("Team 2 Sigma: Rock") {
    event {
        Ongoing - Each Player;
        Team 2;
        Sigma;
    }
    conditions {
        Global.mut_lock_n_load == True;
        (Event Player).is_target_in_los >= 4;
        Is Firing Secondary(Event Player) == False;
        Is Using Ability 1(Event Player) == False;
    }
    actions {
        Press Button(Event Player, Button(Ability 2));
        Wait(10, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Subroutine: Upgrade Health and Healing") {
    event {
        Subroutine;
        upgrade_health_and_healing;
    }
    actions {
        Modify Global Variable(upgrade_count, Add, 1);
        Set Healing Received(All Players(Team 1), Add(85, Multiply(2.5, Global.upgrade_count)));
        Start Heal Over Time(All Players(Team 1), Null, 1, 100000);
    }
}

rule ("Subroutine: Start Kill remaining Phase") {
    event {
        Subroutine;
        start_kill_remaining_phase;
    }
    actions {
        Big Message(All Players(All Teams), Custom String("Kill the remaining enemies!"));
        Set Global Variable(enable_normal_spawns, False);
        Set Player Variable(All Players(Team 2), is_expendable, False);
        Set Global Variable(special_spawns_count, False);
        Set Global Variable(objective_phase_number, 3);
        Communicate(Random Value In Array(Global.combatants), Press the Attack);
    }
}

rule ("Team 2 Boss Aggro: Set / Unset Is aggressive") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_using_boss_aggression == True;
        (Event Player).is_aggressive != Compare((Event Player).is_target_in_los, ==, 5);
    }
    actions {
        Wait(3, Abort When False);
        Abort If Condition Is False;
        Set Player Variable(Event Player, is_aggressive, Not((Event Player).is_aggressive));
        Wait(0.016, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Team 2 Boss Aggro: Set Is aggressive after losing 20% health since Boss last time aggressive") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).is_using_boss_aggression == True;
        (Event Player).is_alive == True;
        (Event Player).is_aggressive == False;
    }
    actions {
        Set Player Variable(Event Player, aggression_health_threshold, Subtract(Normalized Health(Event Player), 0.2));
        Wait Until(Or(Or(Compare(Normalized Health(Event Player), <, (Event Player).aggression_health_threshold), (Event Player).is_aggressive), Not((Event Player).is_living_boss)), 99999);
        Abort If(Or((Event Player).is_aggressive, Not((Event Player).is_living_boss)));
        Set Player Variable(Event Player, is_using_boss_aggression, False);
        Set Player Variable(Event Player, is_aggressive, True);
        Wait Until(Or((Event Player).is_target_in_los, Not((Event Player).is_living_boss)), 99999);
        Abort If(Not((Event Player).is_living_boss));
        Set Player Variable(Event Player, is_using_boss_aggression, True);
    }
}

rule ("Team 2 Boss Aggro: Disengage after killing Player") {
    event {
        Player Earned Elimination;
        Team 2;
        All;
    }
    actions {
        Abort If(Not((Event Player).is_using_boss_aggression));
        Set Player Variable(Event Player, is_aggressive, False);
    }
}

rule ("IV Team 2 Slot 0: Create Portal Entities") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 0;
    }
    actions {
        Create Progress Bar HUD Text(If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), All Players(All Teams), Empty Array), If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Multiply(200, Normalized Health(Event Player)), Global.objective_progress), If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Custom String("Destroy the Portal"), Custom String("Portal closing")), Top, -97, If-Then-Else(Compare(Global.objective_phase_number, ==, 1), If-Then-Else(Compare(Global.special_spawns_count, >, 0), Color(Blue), Custom Color(Max(200, Subtract(255, Multiply(Subtract(Total Time Elapsed, (Event Player).ab_var_2), 165))), Max(0, Subtract(255, Multiply(Subtract(Total Time Elapsed, (Event Player).ab_var_2), 765))), Max(19, Subtract(255, Multiply(Subtract(Total Time Elapsed, (Event Player).ab_var_2), 708))), 255)), Color(Yellow)), Color(White), Visible To Values and Color, Default Visibility);
        Create Icon(If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), All Players(All Teams), Empty Array), Add(Global.iv_dom_objective_pos, Vector(0, 2, 0)), Exclamation Mark, Visible To and Position, Color(Yellow), True);
        Create In-World Text(If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), All Players(All Teams), Empty Array), If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Custom String("Destroy the Portal"), Custom String("Portal closing")), Add(Global.iv_dom_objective_pos, Vector(0, 1.7, 0)), 1.5, Do Not Clip, Visible To Position and String, Color(Yellow), Default Visibility);
        Create Effect(If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), All Players(All Teams), Empty Array), Sphere, If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Color(Red), Color(Yellow)), Add(Global.iv_dom_objective_pos, Vector(0, 1.11, 0)), Add(0.85, If-Then-Else(Compare(Global.objective_phase_number, ==, 1), 0, Multiply(0.3, Sine From Radians(Multiply(6, Total Time Elapsed))))), Visible To Position Radius and Color);
        Create Effect(If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), All Players(All Teams), Empty Array), Bad Aura, Color(Red), Add(Global.iv_dom_objective_pos, Vector(0, 1.11, 0)), 1, Visible To Position and Radius);
        Create Effect(If-Then-Else(And(Compare(Global.objective_phase_number, ==, 1), Or(Compare((Event Player).ab_var_2, >=, Total Time Elapsed), Compare(Global.special_spawns_count, >, 0))), All Players(All Teams), Empty Array), Light Shaft, Color(White), Subtract(Global.iv_dom_objective_pos, Vector(0, 2, 0)), 1, Visible To Position and Radius);
    }
}

rule ("IV Team 2 Torbjörn: Start Portal Mode, Open (Phase 1), Breakpoint End Time (2), Set Health to half to remove armour") {
    event {
        Ongoing - Each Player;
        Team 2;
        Torbjörn;
    }
    actions {
        Set Global Variable(iv_dom_objective_pos, Random Value In Array(Remove From Array(Global.iv_dom_objective_all_pos_list, Global.iv_dom_objective_pos)));
        Start Forcing Player Position(Event Player, Global.iv_dom_objective_pos, False);
        Disable Movement Collision With Environment(Event Player, True);
        Set Invisible(Event Player, All);
        Set Status(Event Player, Null, Unkillable, 9999);
        Set Player Health(Event Player, Multiply(0.5, Max Health(Event Player)));
    }
}

rule ("IV Team 2: Force portal to shoot lava") {
    event {
        Ongoing - Each Player;
        Team 2;
        Torbjörn;
    }
    conditions {
        Is Using Ultimate(Event Player) == True;
    }
    actions {
        Set Facing(Event Player, Direction Towards(Eye Position(Event Player), Vector(Random Integer(-500, 500), Random Integer(-500, 500), Random Integer(-500, 500))), To World);
        Press Button(Event Player, Button(Primary Fire));
        Wait(0.25, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("IV Subroutine: Defend Portal") {
    event {
        Subroutine;
        iv_defend_portal;
    }
    actions {
        Modify Global Variable(money_amount, Add, 95);
        If(Compare(Global.objective_phase_number, ==, 1));
            Set Global Variable(enable_normal_spawns, True);
            Call Subroutine(call_reinforcements);
            Start Rule(play_incoming_sound_twice, Do Nothing);
            Set Player Variable(Event Player, ab_var_2, Add(Total Time Elapsed, 10));
        End;
        Set Global Variable(temp_2, Filtered Array(Players Within Radius(Global.iv_dom_objective_pos, 15, Team 1, Surfaces), And(And((Current Array Element).is_combatant, Not(Has Status(Current Array Element, Phased Out))), Is In Line of Sight(Event Player, Current Array Element, Enemy Barriers Block LOS))));
        For Global Variable(temp_1, 0, Count Of(Global.temp_2), 1);
            Apply Impulse(Value In Array(Global.temp_2, Global.temp_1), Direction From Angles(Horizontal Angle From Direction(Vector Towards(Global.iv_dom_objective_pos, Value In Array(Global.temp_2, Global.temp_1))), -20), 25, To World, Cancel Contrary Motion XYZ);
        End;
        Set Global Variable(temp_1, Random Integer(0, 5));
        If(And(Compare(Global.temp_1, ==, 5), Compare(Global.wave_number, >=, 7)));
            Set Player Variable(Global.temp_2, tased_end_t, Add(Total Time Elapsed, 3));
        Else If(And(Compare(Global.temp_1, <=, 1), Compare(Global.wave_number, >=, 4)));
            Set Ultimate Charge(Event Player, 100);
            Press Button(Event Player, Button(Ultimate));
        Else If(And(Compare(Global.temp_1, ==, 3), Compare(Global.wave_number, >=, 4)));
            Press Button(Event Player, Button(Ability 1));
        End;
        Play Effect(All Players(All Teams), Explosion Sound, Color(White), Event Player, 200);
        Play Effect(All Players(All Teams), Bad Explosion, If-Then-Else(And(Compare(Global.temp_1, ==, 5), Compare(Global.wave_number, >=, 7)), Color(Purple), Color(Red)), Add(Global.iv_dom_objective_pos, Vector(0, 1.11, 0)), 10);
    }
}

rule ("IV Team 2 Torbjörn: Health reaches Breakpoint, Is Dead -> Portal Closing (Phase 2)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Torbjörn;
    }
    conditions {
        Normalized Health(Event Player) <= 0.333;
    }
    actions {
        Set Player Health(Event Player, Multiply(0.333, Max Health(Event Player)));
        Call Subroutine(iv_defend_portal);
        Wait Until(Compare(Normalized Health(Event Player), <=, 0.166), 99999);
        Set Player Health(Event Player, Multiply(0.166, Max Health(Event Player)));
        Call Subroutine(iv_defend_portal);
        Clear Status(Event Player, Unkillable);
        Wait Until(Is Dead(Event Player), 99999);
        Set Global Variable(objective_phase_number, 2);
        Call Subroutine(iv_defend_portal);
        Call Subroutine(upgrade_health_and_healing);
        Play Effect(All Players(All Teams), Bad Explosion, Color(Red), Add(Global.iv_dom_objective_pos, Vector(0, 1.11, 0)), 10);
        Play Effect(All Players(All Teams), Explosion Sound, Color(White), Event Player, 200);
        Big Message(All Players(All Teams), Custom String("Portal is closing! Gained bonus health"));
        Stop Forcing Player Position(Event Player);
        Enable Movement Collision With Environment(Event Player);
        Wait(0.25, Ignore Condition);
        Teleport(Event Player, Vector(0, -1000, 0));
        Set Invisible(Event Player, None);
    }
}

rule ("IV Team 2 Slot 0: Portal Closing (Phase 2) -> Kill remaining (Phase 3)") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 0;
    }
    conditions {
        Global.objective_phase_number == 2;
    }
    actions {
        For Global Variable(objective_progress, 100, 25, -1);
            Wait(0.096, Ignore Condition);
        End;
        Set Global Variable(enable_normal_spawns, True);
        Start Rule(play_incoming_sound_twice, Do Nothing);
        For Global Variable(objective_progress, 25, 10, -1);
            Wait(0.096, Ignore Condition);
        End;
        Set Global Variable(enable_objective_enemy_spawn, True);
        For Global Variable(objective_progress, 10, 0, -1);
            Wait(0.096, Ignore Condition);
        End;
        Call Subroutine(start_kill_remaining_phase);
    }
}

rule ("IV Team 2 Torbjörn: Set Breakpoint Damage Reduction") {
    event {
        Ongoing - Each Player;
        Team 2;
        Torbjörn;
    }
    conditions {
        Global.objective_phase_number == 1;
        Or(Compare((Event Player).ab_var_2, >=, Total Time Elapsed), Compare(Global.special_spawns_count, >, 0)) == True;
    }
    actions {
        Set Damage Received(Event Player, 5);
        Wait Until(Not(And(Compare(Global.objective_phase_number, ==, 1), Or(Compare((Event Player).ab_var_2, >=, Total Time Elapsed), Compare(Global.special_spawns_count, >, 0)))), 99999);
        Set Damage Received(Event Player, 50);
    }
}

rule ("HVT Team 2 Slot 1: Create HVT Entities") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 1;
    }
    actions {
        Create Progress Bar HUD Text(If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), All Players(All Teams), Empty Array), If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Multiply(100, Normalized Health(Event Player)), Divide(If-Then-Else((Event Player).downed_start_t, Global.objective_progress, (Event Player).revive_timer), 1.5)), If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Custom String("Subdue the High Value Target"), If-Then-Else((Event Player).downed_start_t, If-Then-Else(Array Contains((Event Player).revivers, Local Player), Custom String("Capturing..."), Custom String("Capture the High Value Target")), Custom String("High Value Target is being revived"))), Top, -97, If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Custom Color(Max(200, Subtract(255, Multiply(Subtract(Total Time Elapsed, Global.hvt_call_reinforcements_end_t), 165))), Max(0, Subtract(255, Multiply(Subtract(Total Time Elapsed, Global.hvt_call_reinforcements_end_t), 765))), Max(19, Subtract(255, Multiply(Subtract(Total Time Elapsed, Global.hvt_call_reinforcements_end_t), 708))), 255), If-Then-Else((Event Player).downed_start_t, If-Then-Else(Compare((Event Player).downed_start_t, ==, 2), Color(Green), Color(Blue)), Color(Red))), If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Color(Blue), If-Then-Else((Event Player).downed_start_t, Color(Blue), Color(Yellow))), Visible To Values and Color, Default Visibility);
        Create Icon(If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), All Players(All Teams), Empty Array), Event Player, Exclamation Mark, Visible To, Color(Yellow), True);
        Create In-World Text(If-Then-Else(Or(Compare(Global.objective_phase_number, ==, 1), Compare(Global.objective_phase_number, ==, 2)), All Players(All Teams), Empty Array), If-Then-Else(Compare(Global.hvt_call_reinforcements_end_t, >=, Total Time Elapsed), Custom String("Calling Reinforcements"), If-Then-Else(Compare(Global.objective_phase_number, ==, 1), Custom String("Subdue Target"), Custom String("Capture Target"))), Event Player, 1.5, Do Not Clip, Visible To and String, Color(Yellow), Default Visibility);
        Create Effect(If-Then-Else(Compare(Global.objective_phase_number, ==, 2), All Players(All Teams), Empty Array), Ring, If-Then-Else((Event Player).downed_start_t, If-Then-Else(Compare((Event Player).downed_start_t, ==, 2), Color(Green), Color(White)), Color(Red)), Add(Position Of(Event Player), Vector(0, 0.65, 0)), 10, Visible To Position Radius and Color);
        Create Effect(If-Then-Else(Compare(Global.objective_phase_number, ==, 2), All Players(All Teams), Empty Array), Ring, If-Then-Else((Event Player).downed_start_t, If-Then-Else(Compare((Event Player).downed_start_t, ==, 2), Color(Green), Color(White)), Color(Red)), Add(Position Of(Event Player), Vector(0, -0.65, 0)), 10, Visible To Position Radius and Color);
        Create Effect(If-Then-Else(Compare(Global.objective_phase_number, ==, 2), All Players(All Teams), Empty Array), Ring, If-Then-Else((Event Player).downed_start_t, If-Then-Else(Compare((Event Player).downed_start_t, ==, 2), Color(Green), Color(White)), Color(Red)), Position Of(Event Player), Multiply(Compare(Modulo(Total Time Elapsed, 1.333), <, 0.666), Modulo(Multiply(15, Total Time Elapsed), 10)), Visible To Position Radius and Color);
        Create Effect(If-Then-Else(Compare(Global.hvt_call_reinforcements_end_t, >=, Total Time Elapsed), All Players(All Teams), Empty Array), Light Shaft, Color(White), Update Every Frame(Position Of(Event Player)), 1, Visible To Position and Radius);
    }
}

rule ("HVT Team 2 Slot 1: HVT subdued fallback") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 1;
    }
    conditions {
        Global.objective_phase_number == 2;
        Has Status(Event Player, Stunned) == False;
    }
    actions {
        Wait(0.25, Abort When False);
        Abort If Condition Is False;
        While(And(Compare(Global.objective_phase_number, ==, 2), Not(Has Status(Event Player, Stunned))));
            Clear Status(Event Player, Phased Out);
            Cancel Primary Action(Event Player);
            Set Status(Event Player, Null, Knocked Down, 9999);
            Wait(0.25, Ignore Condition);
        End;
        If(Compare(Global.objective_phase_number, ==, 2));
            Set Status(Event Player, Null, Phased Out, 9999);
        End;
        Loop If Condition Is True;
    }
}

rule ("HVT Team 2 Slot 1: Subdued, check Player in Radius") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 1;
    }
    conditions {
        Global.objective_phase_number == 2;
    }
    actions {
        Set Player Variable(Event Player, revivers, Filtered Array(Global.combatants, And(And(And(Not(Or((Current Array Element).downed_start_t, Modulo((Current Array Element).is_invisible, 3))), Compare(Distance Between(Event Player, Vector(X Component Of(Position Of(Current Array Element)), Y Component Of(Position Of(Event Player)), Z Component Of(Position Of(Current Array Element)))), <=, 10)), Compare(Absolute Value(Subtract(Y Component Of(Position Of(Event Player)), Y Component Of(Position Of(Current Array Element)))), <=, 5)), Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS))));
        If(Count Of((Event Player).revivers));
            Set Player Variable(Event Player, downed_start_t, 2);
            Modify Global Variable(objective_progress, Add, 1.5);
        Else If(Compare(Global.hvt_dom_objective_killed_count, >=, 3));
            Set Player Variable(Event Player, downed_start_t, 1);
            Modify Global Variable(objective_progress, Add, 0.6);
        Else If(Compare((Event Player).downed_start_t, >, 0));
            Modify Player Variable(Event Player, downed_start_t, Subtract, 0.2);
        Else;
            Modify Player Variable(Event Player, revive_timer, Add, If-Then-Else(Compare(Global.hvt_dom_objective_killed_count, ==, 1), 3, 2));
        End;
        If(Compare(Global.objective_progress, >=, 150));
            Clear Status(Event Player, Knocked Down);
            Clear Status(Event Player, Phased Out);
            Clear Status(Event Player, Invincible);
            Play Effect(All Players(All Teams), Good Pickup Effect, Color(Yellow), Position Of(Event Player), 1);
            Play Effect(All Players(All Teams), Explosion Sound, Color(White), Position Of(Event Player), 200);
            Teleport(Event Player, Vector(0, -1000, 0));
            Call Subroutine(start_kill_remaining_phase);
            Set Global Variable(objective_progress, False);
        Else If(Compare((Event Player).revive_timer, >=, 150));
            Set Global Variable(objective_phase_number, 1);
            Set Global Variable(objective_progress, False);
            Set Player Variable(Event Player, gmut_fortified_bypass_end_t, False);
            Big Message(All Players(All Teams), Custom String("The HVT has been revived!"));
            Set Player Health(Event Player, Multiply(0.6, Max Health(Event Player)));
            Clear Status(Event Player, Knocked Down);
            Clear Status(Event Player, Phased Out);
            Clear Status(Event Player, Invincible);
        End;
        Wait(0.2, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("HVT Team 2 Slot 1: Call Reinforcements") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 1;
    }
    conditions {
        Global.objective_phase_number == 1;
        Normalized Health(Event Player) > 0.5;
    }
    actions {
        Wait Until(Or(Compare(Normalized Health(Event Player), <=, 0.5), Compare(Global.objective_phase_number, ==, 2)), 99999);
        If(Compare(Global.objective_phase_number, ==, 2));
            Set Global Variable(enable_normal_spawns, True);
            Call Subroutine(call_reinforcements);
            Start Rule(play_incoming_sound_twice, Do Nothing);
        Else;
            Play Effect(All Players(All Teams), Good Pickup Effect, Color(Red), Event Player, 1);
            Set Global Variable(hvt_call_reinforcements_end_t, Add(Total Time Elapsed, 10));
            Set Damage Received(Event Player, 5);
            Set Player Health(Event Player, Multiply(0.5, Max Health(Event Player)));
            Wait(1, Ignore Condition);
            Set Global Variable(enable_normal_spawns, True);
            Call Subroutine(call_reinforcements);
            Start Rule(play_incoming_sound_twice, Do Nothing);
            Wait(4, Ignore Condition);
            Set Damage Received(Event Player, 50);
        End;
        Wait Until(Compare(Global.objective_phase_number, ==, 3), 99999);
    }
}

rule ("HVT Team 2 Slot 1: Capture Breakpoints") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 1;
    }
    conditions {
        Global.objective_phase_number == 2;
    }
    actions {
        Call Subroutine(upgrade_health_and_healing);
        Modify Global Variable(money_amount, Add, 105);
        Wait Until(Compare(Global.objective_progress, >=, 140), 99999);
        Set Global Variable(enable_normal_spawns, True);
        Call Subroutine(call_reinforcements);
        Start Rule(play_incoming_sound_twice, Do Nothing);
        Wait Until(Compare(Global.objective_phase_number, ==, 3), 99999);
        Modify Global Variable(money_amount, Add, 105);
    }
}

rule ("DOM Team 2 Slot 2: Create Guard and Control Point Entities") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 2;
    }
    actions {
        Create Progress Bar HUD Text(If-Then-Else(Compare(Global.objective_phase_number, ==, 1), All Players(All Teams), Empty Array), If-Then-Else(Array Contains(Global.dom_point_A_contesters, Local Player), First Of(Global.objective_progress), If-Then-Else(Array Contains(Global.dom_point_B_contesters, Local Player), Value In Array(Global.objective_progress, 1), Multiply(0.25, Add(Add(Multiply(100, Add(If-Then-Else((Players In Slot(2, Color(Team 2))).is_living_boss, Subtract(1, Normalized Health(Players In Slot(2, Team 2))), 1), If-Then-Else((Players In Slot(3, Team 2)).is_living_boss, Subtract(1, Normalized Health(Players In Slot(3, Team 2))), 1))), First Of(Global.objective_progress)), Value In Array(Global.objective_progress, 1))))), If-Then-Else(Array Contains(Global.dom_point_A_contesters, Local Player), If-Then-Else((Players In Slot(2, Color(Team 2))).is_living_boss, Custom String("Kill the Guard to unlock this point"), Custom String("Capturing...")), If-Then-Else(Array Contains(Global.dom_point_B_contesters, Local Player), If-Then-Else((Players In Slot(3, Team 2)).is_living_boss, Custom String("Kill the Guard to unlock the point"), Custom String("Capturing...")), If-Then-Else(Is True For Any(All Players(Team 2), (Current Array Element).is_living_boss), Custom String("Kill the guards and capture the points"), Custom String("Capture the points")))), Top, -97, If-Then-Else(Or(Array Contains(Global.dom_point_A_contesters, Local Player), Array Contains(Global.dom_point_B_contesters, Local Player)), Color(Green), Color(Blue)), If-Then-Else(Or(And(Array Contains(Global.dom_point_A_contesters, Local Player), (Players In Slot(2, Team 2)).is_living_boss), And(Array Contains(Global.dom_point_B_contesters, Local Player), (Players In Slot(3, Team 2)).is_living_boss)), Color(Yellow), Color(Blue)), Visible To Values and Color, Default Visibility);
        Create Effect(If-Then-Else(And(Compare(Global.objective_phase_number, ==, 1), Compare(First Of(Global.objective_progress), <, 100)), All Players(All Teams), Empty Array), Ring, If-Then-Else((Players In Slot(2, Team 2)).is_living_boss, Color(Red), If-Then-Else(Count Of(Global.dom_point_A_contesters), Color(Green), Color(White))), First Of(Global.iv_dom_objective_pos), 3, Visible To Position Radius and Color);
        Create Effect(If-Then-Else(And(Compare(Global.objective_phase_number, ==, 1), Compare(Value In Array(Global.objective_progress, 1), <, 100)), All Players(All Teams), Empty Array), Ring, If-Then-Else((Players In Slot(3, Team 2)).is_living_boss, Color(Red), If-Then-Else(Count Of(Global.dom_point_B_contesters), Color(Green), Color(White))), Value In Array(Global.iv_dom_objective_pos, 1), 3, Visible To Position Radius and Color);
        Create Icon(If-Then-Else(And(Compare(Global.objective_phase_number, ==, 1), Compare(First Of(Global.objective_progress), <, 100)), All Players(All Teams), Empty Array), Add(First Of(Global.iv_dom_objective_pos), Vector(0, 2, 0)), Exclamation Mark, Visible To Position and Color, If-Then-Else((Players In Slot(2, Color(Team 2))).is_living_boss, Color(Orange), Color(Yellow)), True);
        Create Icon(If-Then-Else(And(Compare(Global.objective_phase_number, ==, 1), Compare(Value In Array(Global.objective_progress, 1), <, 100)), All Players(All Teams), Empty Array), Add(Value In Array(Global.iv_dom_objective_pos, 1), Vector(0, 2, 0)), Exclamation Mark, Visible To Position and Color, If-Then-Else((Players In Slot(3, Team 2)).is_living_boss, Color(Orange), Color(Yellow)), True);
        Create In-World Text(If-Then-Else(And(Compare(Global.objective_phase_number, ==, 1), Compare(First Of(Global.objective_progress), <, 100)), All Players(All Teams), Empty Array), If-Then-Else((Players In Slot(2, Team 2)).is_living_boss, Custom String("Kill Guard"), Custom String("Capture point")), If-Then-Else((Players In Slot(2, Team 2)).is_living_boss, Players In Slot(2, Team 2), Add(First Of(Global.iv_dom_objective_pos), Vector(0, 1.7, 0))), 1.5, Do Not Clip, Visible To Position and String, Color(Yellow), Default Visibility);
        Create In-World Text(If-Then-Else(And(Compare(Global.objective_phase_number, ==, 1), Compare(Value In Array(Global.objective_progress, 1), <, 100)), All Players(All Teams), Empty Array), If-Then-Else((Players In Slot(3, Team 2)).is_living_boss, Custom String("Kill Guard"), Custom String("Capture point")), If-Then-Else((Players In Slot(3, Team 2)).is_living_boss, Players In Slot(3, Team 2), Add(Value In Array(Global.iv_dom_objective_pos, 1), Vector(0, 1.7, 0))), 1.5, Do Not Clip, Visible To Position and String, Color(Yellow), Default Visibility);
    }
}

rule ("DOM Team 2 Slot 2: Contest Control Point A") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 2;
    }
    conditions {
        Global.objective_phase_number == 1;
        First Of(Global.objective_progress) < 100;
    }
    actions {
        Set Global Variable(dom_point_A_contesters, Filtered Array(Global.combatants, And(And(And(Not(Or((Current Array Element).downed_start_t, Modulo((Current Array Element).is_invisible, 3))), Compare(Distance Between(First Of(Global.iv_dom_objective_pos), Vector(X Component Of(Position Of(Current Array Element)), Y Component Of(First Of(Global.iv_dom_objective_pos)), Z Component Of(Position Of(Current Array Element)))), <=, 3)), Compare(Absolute Value(Subtract(Y Component Of(Position Of(First Of(Global.iv_dom_objective_pos))), Y Component Of(Position Of(Current Array Element)))), <=, 3)), Is In Line of Sight(Add(First Of(Global.iv_dom_objective_pos), Up), Current Array Element, Barriers Do Not Block LOS))));
        If(And(Not((Players In Slot(2, Team 2)).is_living_boss), Count Of(Global.dom_point_A_contesters)));
            Modify Global Variable At Index(objective_progress, 0, Add, 2);
            Wait(0.25, Ignore Condition);
            Modify Global Variable At Index(objective_progress, 0, Add, 2);
            If(Compare(First Of(Global.objective_progress), >=, 100));
                Play Effect(All Players(All Teams), Good Pickup Effect, Color(Yellow), First Of(Global.iv_dom_objective_pos), 3);
                Play Effect(All Players(All Teams), Explosion Sound, Color(White), First Of(Global.iv_dom_objective_pos), 200);
                Set Global Variable(dom_point_A_contesters, Empty Array);
                Modify Global Variable(money_amount, Add, 70);
                If(Compare(Value In Array(Global.objective_progress, 1), >=, 100));
                    Set Global Variable(objective_phase_number, 2);
                    Set Global Variable(enable_normal_spawns, True);
                    Call Subroutine(call_reinforcements);
                    Start Rule(play_incoming_sound_twice, Do Nothing);
                    Wait(2, Ignore Condition);
                    Call Subroutine(start_kill_remaining_phase);
                End;
            End;
            Wait(0.25, Ignore Condition);
        Else;
            Wait(0.5, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("DOM Team 2 Slot 2: Contest Control Point B") {
    event {
        Ongoing - Each Player;
        Team 2;
        Slot 2;
    }
    conditions {
        Global.objective_phase_number == 1;
        Value In Array(Global.objective_progress, 1) < 100;
    }
    actions {
        Set Global Variable(dom_point_B_contesters, Filtered Array(Global.combatants, And(And(And(Not(Or((Current Array Element).downed_start_t, Modulo((Current Array Element).is_invisible, 3))), Compare(Distance Between(Value In Array(Global.iv_dom_objective_pos, 1), Vector(X Component Of(Position Of(Current Array Element)), Y Component Of(Value In Array(Global.iv_dom_objective_pos, 1)), Z Component Of(Position Of(Current Array Element)))), <=, 3)), Compare(Absolute Value(Subtract(Y Component Of(Position Of(Value In Array(Global.iv_dom_objective_pos, 1))), Y Component Of(Position Of(Current Array Element)))), <=, 3)), Is In Line of Sight(Add(Value In Array(Global.iv_dom_objective_pos, 1), Up), Current Array Element, Barriers Do Not Block LOS))));
        If(And(Not((Players In Slot(3, Team 2)).is_living_boss), Count Of(Global.dom_point_B_contesters)));
            Modify Global Variable At Index(objective_progress, 1, Add, 2);
            Wait(0.25, Ignore Condition);
            Modify Global Variable At Index(objective_progress, 1, Add, 2);
            If(Compare(Value In Array(Global.objective_progress, 1), >=, 100));
                Play Effect(All Players(All Teams), Good Pickup Effect, Color(Yellow), Value In Array(Global.iv_dom_objective_pos, 1), 3);
                Play Effect(All Players(All Teams), Explosion Sound, Color(White), Value In Array(Global.iv_dom_objective_pos, 1), 200);
                Set Global Variable(dom_point_B_contesters, Empty Array);
                Modify Global Variable(money_amount, Add, 70);
                If(Compare(First Of(Global.objective_progress), >=, 100));
                    Set Global Variable(objective_phase_number, 2);
                    Set Global Variable(enable_normal_spawns, True);
                    Call Subroutine(call_reinforcements);
                    Start Rule(play_incoming_sound_twice, Do Nothing);
                    Wait(2, Ignore Condition);
                    Call Subroutine(start_kill_remaining_phase);
                End;
            End;
            Wait(0.25, Ignore Condition);
        Else;
            Wait(0.5, Ignore Condition);
        End;
        Loop If Condition Is True;
    }
}

rule ("[Info] Ana") {
    event {
        Ongoing - Each Player;
        All;
        Ana;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("multinade"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("throw 3 biotic grenades instead of 1"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("sleep paralysis"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("enemies slept by sleep dart receive large damage when they wake up"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Shrike"));
    }
}

rule ("[Info] Ashe") {
    event {
        Ongoing - Each Player;
        All;
        Ashe;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("black gunpowder"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("coach gun stuns and sets enemies on fire"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("dancing flames"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("eliminated enemies exlpode and burn others nearby"));
    }
}

rule ("[Info] Baptiste") {
    event {
        Ongoing - Each Player;
        All;
        Baptiste;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("corrode"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("regenerative burst inflicts poison damage to enemies"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("aerial ace"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("exo-boots allow for gliding and deal bonus damage while gliding"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Medic"));
    }
}

rule ("[Info] Bastion") {
    event {
        Ongoing - Each Player;
        All;
        Bastion;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("fusillade"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("start firing barrages of rockets when shooting in assault form"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("trickshot"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("landing tactical grenade on an enemy deals more damage and heals health"));
    }
}

rule ("[Info] Brigitte") {
    event {
        Ongoing - Each Player;
        All;
        Brigitte;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("endeavor"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("gain a boost in damage, armour and speed when your barrier breaks"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("whiplash"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("endpoint of whip shot generates a stunning shockwave"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Shield"));
    }
}

rule ("[Info] DVa") {
    event {
        Ongoing - Each Player;
        All;
        D.Va;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("voltage grid"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("defense matrix damages and roots enemies"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("shooting star"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("boosters set enemies on fire"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Aeronaut"));
        Wait(0.5, Ignore Condition);
        Set Player Health(Event Player, 100000);
    }
}

rule ("[Info] Doomfist") {
    event {
        Ongoing - Each Player;
        All;
        Doomfist;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("punch card"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("rocket punch deals triple damage at full charge"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("fire quake"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("seismic slam sends out two massive wave of flames"));
    }
}

rule ("[Info] Echo") {
    event {
        Ongoing - Each Player;
        All;
        Echo;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("bomblet jacket"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("send out mini-bombs to enemies while flight is active"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("focusing optics"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("focusing beam boost starts at 90% hp instead of 50%"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Hoverbird"));
    }
}

rule ("[Info] Genji") {
    event {
        Ongoing - Each Player;
        All;
        Genji;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("venomous strike"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("swift strike deals bleed damage; heal for bleed damage"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("sharpened storm"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("double the amount of shurikens fired"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Shinobi"));
    }
}

rule ("[Info] Hanzo") {
    event {
        Ongoing - Each Player;
        All;
        Hanzo;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("Arrow Rain"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("fire more arrows per shot during Storm Arrows"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("stormbreak"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("storm arrows have no cooldown for a short duration when earning a kill"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Bowmaster"));
    }
}

rule ("[Info] Junkrat") {
    event {
        Ongoing - Each Player;
        All;
        Junkrat;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("pyromania"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("All explosive attacks deal fire damage"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("trigger happy"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("Gain +1 Concussion Mine every 4s, up to 5 max"));
    }
}

rule ("[Info] Junker Queen") {
    event {
        Ongoing - Each Player;
        All;
        Junker Queen;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("Shout Louder"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("commanding shout wounds enemies in the area"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("Grace Period"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("gracie deals can pull multiple enemies back at once"));
    }
}

rule ("[Info] Lifeweaver") {
    event {
        Ongoing - Each Player;
        All;
        Lifeweaver;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("Autumn Blossoms"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("Deal more damage and eliminations cause enemies to drop heal orbs"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("Pressure Therapy"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("Deal 50% more damage to enemies you're above and behind"));
    }
}

rule ("[Info] Kiriko") {
    event {
        Ongoing - Each Player;
        All;
        Kiriko;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("Shinobi Tactics"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("healing health with abilities create energy explosions around the target"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("recession"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("protection suzu damages for 20% of health and freezes enemies"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Yokai"));
    }
}

rule ("[Info] Lucio") {
    event {
        Ongoing - Each Player;
        All;
        Lúcio;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("Chord Cadence"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("amp it up triggers twice and adds more shots to your attack"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("reverse amp"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("amp it up inflicts the opposite song effect to enemies"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Gunrunner"));
    }
}

rule ("[Info] Cassidy") {
    event {
        Ongoing - Each Player;
        All;
        Cassidy;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("standoff"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("enemies cannot move once their skull is locked during deadeye"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("flashpoint"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("magnetic grenade will heavily stun enemies if it sticks"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Gunslinger"));
    }
}

rule ("[Info] Mei") {
    event {
        Ongoing - Each Player;
        All;
        Mei;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("cold snap"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("instantly freeze nearby enemies once cryo-freeze breaks"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("fractical strike"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("shoot more icicles at once but at slightly less damage"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Subzero"));
    }
}

rule ("[Info] Mercy") {
    event {
        Ongoing - Each Player;
        All;
        Mercy;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("wings of grand"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("guardian angel damages and knocks enemies down in its path"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("holy light missiles"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("launch powerful light charges during valkyrie"));
    }
}

rule ("[Info] Moira") {
    event {
        Ongoing - Each Player;
        All;
        Moira;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("flourish"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("fading through allies heals and through enemies damages them"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("catalyst"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("holding primary during coalescence costs energy and speed, but boosts effectiveness"));
    }
}

rule ("[Info] Orisa") {
    event {
        Ongoing - Each Player;
        All;
        Orisa;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("spinning shreddies"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("javelin spin sends projectile shards that knock back enemies"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("metalhead"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("energy javelin also affects enemies around the stuck target and stuns longer"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Bulldozer"));
    }
}

rule ("[Info] Pharah") {
    event {
        Ongoing - Each Player;
        All;
        Pharah;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("head trauma"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("concussive blast deals damage and tazes enemies below half health"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("weaponized storm"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("every 6th rocket flies faster and detonates several clusters"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Skirmisher"));
    }
}

rule ("[Info] Ramattra") {
    event {
        Ongoing - Each Player;
        All;
        Ramattra;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("vile dominance"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("move faster and root enemies with every punch in nemesis form"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("nether sector"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("heal health and gain bonus ultimate charge for every grounded enemy with vortex"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("tyrant"));
    }
}

rule ("[Info] Reaper") {
    event {
        Ongoing - Each Player;
        All;
        Reaper;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("wrathful wraith"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("allow shooting during wraith form"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("paranoia"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("tase and damage enemies in sight during wraith form"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Spook"));
    }
}

rule ("[Info] Reinhardt") {
    event {
        Ongoing - Each Player;
        All;
        Reinhardt;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("fire blast"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("fire strike explodes as it deals damage, igniting enemies"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("epicenter"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("earthshatter travels in all directions"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Crusader"));
    }
}

rule ("[Info] Roadhog") {
    event {
        Ongoing - Each Player;
        All;
        Roadhog;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("stench"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("constantly inflict toxic damage to nearby enemeis"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("chainsnap"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("chain hook deals 4x more damage; resets upon eliminations"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Juggernaut"));
    }
}

rule ("[Info] Sigma") {
    event {
        Ongoing - Each Player;
        All;
        Sigma;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("accretion disk"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("accretion flies straight and has increased damage and stun"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("string theory"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("when kinetic grasp ends, fire a blast that scales based on the amount of damage collected"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Graviton"));
    }
}

rule ("[Info] Sojourn") {
    event {
        Ongoing - Each Player;
        All;
        Sojourn;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("Thunderous kicks"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("kickslide jump initiates a powerful energy blast"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("Matter Splatter"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("critical railgun hits are explosive"));
    }
}

rule ("[Info] Soldier: 76") {
    event {
        Ongoing - Each Player;
        All;
        Soldier: 76;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("triple threat"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("helix rockets fires two adjacent mini rockets"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("Espionage"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("allies in biotic field revive faster and become harder to hit"));
    }
}

rule ("[Info] Sombra") {
    event {
        Ongoing - Each Player;
        All;
        Sombra;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("stack overflow"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("cancelling stealth will temporarily boost damage and cause melees to stun"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("cyberattack"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("using translocator will damage and hack nearby enemies"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Taser"));
    }
}

rule ("[Info] Symmetra") {
    event {
        Ongoing - Each Player;
        All;
        Symmetra;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("sentry paragon"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("each sentry turret deals 50% more damage"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("shield generator"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("gain increased damage and speed, and grant all players shields with kills"));
    }
}

rule ("[Info] Torbjorn") {
    event {
        Ongoing - Each Player;
        All;
        Torbjörn;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("heatwaves"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("unleash waves of fire when overload or molten core is active"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("foundry"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("run 40% faster and deal 40% damage with forge hammer equipped"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Portal"));
    }
}

rule ("[Info] Tracer") {
    event {
        Ongoing - Each Player;
        All;
        Tracer;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("vortex"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("recall drags and roots nearby enemies to its activation point"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("chain reaction"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("pulse bomb explosions can chain onto other enemies"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Playmaker"));
    }
}

rule ("[Info] Widowmaker") {
    event {
        Ongoing - Each Player;
        All;
        Widowmaker;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("baiser de soie"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("scoped critical hits instantly kill enemies below 30% hp"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("parting gift"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("leave a line of grenades while using grappling hook"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Sniper"));
    }
}

rule ("[Info] Winston") {
    event {
        Ongoing - Each Player;
        All;
        Winston;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("next generation"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("primal rage damage is doubled and recharges 5% ult per hit"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("quake"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("jump pack landing force is much more powerful and stuns enemies"));
    }
}

rule ("[Info] Wrecking Ball") {
    event {
        Ongoing - Each Player;
        All;
        Wrecking Ball;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("orbital strike"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("piledriver deals more damage the higher you drop"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("distortion"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("adaptive shields triggers explosions and tazes nearby enemies"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Detonator"));
    }
}

rule ("[Info] Zarya") {
    event {
        Ongoing - Each Player;
        All;
        Zarya;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("combusta-bubble"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("barriers explode when they expire"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("power surge"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("personal barrier grants energy upon activation"));
        Start Forcing Dummy Bot Name(Event Player, Custom String("Amazon"));
    }
}

rule ("[Info] Zenyatta") {
    event {
        Ongoing - Each Player;
        All;
        Zenyatta;
    }
    actions {
        "T1"
        Set Player Variable At Index(Event Player, talent_text, 1, Custom String("stress relief"));
        Set Player Variable At Index(Event Player, talent_text, 2, Custom String("fully charged orb volleys deal 50% more damage"));
        "T2"
        Set Player Variable At Index(Event Player, talent_text, 3, Custom String("perfect balance"));
        Set Player Variable At Index(Event Player, talent_text, 4, Custom String("transcendence damages enemies in the area of effect"));
    }
}

rule ("Ana: Multinade") {
    event {
        Ongoing - Each Player;
        Team 1;
        Ana;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        For Player Variable(Event Player, i, 0, 4, 1);
            Wait(0.03, Ignore Condition);
            Set Ability Cooldown(Event Player, Button(Ability 2), False);
            Cancel Primary Action(Event Player);
            Wait(0.05, Ignore Condition);
            Press Button(Event Player, Button(Ability 2));
        End;
        Wait(2, Ignore Condition);
    }
}

rule ("Ana: Sleep Paralysis") {
    event {
        Player Dealt Damage;
        Team 1;
        Ana;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Ability 1)));
        Play Effect(All Players(All Teams), Good Explosion, Color(Black), Victim, 2);
        Wait(0.5, Ignore Condition);
        Wait Until(Not(Has Status(Victim, Asleep)), 5);
        Play Effect(All Players(All Teams), Explosion Sound, Color(Black), Eye Position(Victim), 150);
        Play Effect(All Players(All Teams), Good Explosion, Color(Black), Victim, 6);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Black), Victim, 12);
        Damage(Players Within Radius(Victim, 6, Team 2, Surfaces), Event Player, 150);
        Set Status(Players Within Radius(Eye Position(Victim), 6, Team 2, Surfaces), Null, Hacked, 1.5);
    }
}

rule ("Zenyatta: Stress Relief") {
    event {
        Ongoing - Each Player;
        Team 1;
        Zenyatta;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Firing Secondary(Event Player) == True;
    }
    actions {
        Wait(2, Abort When False);
        Play Effect(Event Player, Explosion Sound, Color(Black), Event Player, 150);
        Modify Player Variable(Event Player, Damage_Dealt, Add, 50);
        Wait(0.75, Ignore Condition);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 50);
    }
}

rule ("Zenyatta: Perfect Balance") {
    event {
        Ongoing - Each Player;
        Team 1;
        Zenyatta;
    }
    conditions {
        Is Using Ultimate(Event Player) == True;
        (Event Player).Talent2 == True;
    }
    actions {
        Start Damage Over Time(Players Within Radius(Event Player, 12, Team 2, Surfaces), Event Player, 1, 100);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Orange), Event Player, 24);
        Wait(1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Orisa- Spinning Shreddies") {
    event {
        Ongoing - Each Player;
        Team 1;
        Orisa;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        While(Is Using Ability 2(Event Player));
            Create Projectile(Orisa Fusion Driver, Event Player, Add(Eye Position(Event Player), World Vector Of(Vector(Random Real(-0.8, 0.8), Random Real(-0.8, -0.8), 0), Event Player, Rotation)), Null, To World, Damage, Team 2, 25, 2, 0, Good Explosion, Explosion Sound, 0, 60, 2, 10, 1, 0);
            Wait(0.02, Ignore Condition);
        End;
        Create Projectile(Orisa Fusion Driver, Event Player, Null, Null, To World, Damage, Team 2, 80, 2, 0, Good Explosion, Explosion Sound, 0.15, 60, 2, 20, 1, 0);
    }
}

rule ("Orisa: metalhead") {
    event {
        Player Dealt Knockback;
        Team 1;
        Orisa;
    }
    conditions {
        Event Ability == Button(Secondary Fire);
        (Event Player).Talent2 == True;
    }
    actions {
        Damage(Players Within Radius(Victim, 6, Team 2, Surfaces), Event Player, 50);
        Apply Impulse(Remove From Array(Players Within Radius(Victim, 6, Team 2, Surfaces), Victim), Direction Towards(Victim, Event Player), -15, To World, Cancel Contrary Motion);
        Apply Impulse(Remove From Array(Players Within Radius(Victim, 6, Team 2, Surfaces), Victim), Up, 2, To World, Cancel Contrary Motion);
        Set Status(Players Within Radius(Victim, 6, Team 2, Surfaces), Null, Stunned, 1.2);
    }
}

rule ("Sigma: Accretion Disk") {
    event {
        Ongoing - Each Player;
        Team 1;
        Sigma;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        Set Projectile Speed(Event Player, 150);
        Set Projectile Gravity(Event Player, 0);
        Wait Until(Not(And((Event Player).Talent1, Is Using Ability 2(Event Player))), 5);
        Set Projectile Speed(Event Player, 100);
        Set Projectile Gravity(Event Player, 100);
    }
}

rule ("Sigma: Accretion Disk") {
    event {
        Player Dealt Knockback;
        Team 1;
        Sigma;
    }
    actions {
        Abort If(Not((Event Player).Talent1));
        Abort If(Compare(Event Ability, !=, Button(Ability 2)));
        Abort If(Compare(Victim, ==, Event Player));
        Set Status(Victim, Event Player, Knocked Down, 1.5);
        Damage(Victim, Event Player, Multiply(Event Damage, 0.75));
    }
}

rule ("Sigma: String Theory") {
    event {
        Ongoing - Each Player;
        Team 1;
        Sigma;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Wait(1.8, Abort When False);
        Set Player Variable(Event Player, Ability_Projectile1, Eye Position(Event Player));
        Set Player Variable(Event Player, Ability_End, Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 50)), All Players(Team 2), Event Player, True));
        Chase Player Variable At Rate(Event Player, Ability_Projectile1, (Event Player).Ability_End, 40, Destination and Rate);
        Create Effect(All Players(All Teams), Sphere, Color(Violet), (Event Player).Ability_Projectile1, 0.6, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Create Effect(All Players(All Teams), Good Aura, Color(Violet), (Event Player).Ability_Projectile1, 0.6, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 2, Last Created Entity);
        Wait(0.25, Ignore Condition);
        Set Player Variable(Event Player, Ability_Countdown, Health Of Type(Event Player, Shields));
        Wait Until(Or(Not((Event Player).Talent2), Compare((Event Player).Ability_Projectile1, ==, (Event Player).Ability_End)), 5);
        Stop Chasing Player Variable(Event Player, Ability_Projectile1);
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
        Destroy Effect(Value In Array((Event Player).Effects__, 2));
        Damage(Players Within Radius((Event Player).Ability_Projectile1, Min(10, Add(1.5, Multiply((Event Player).Ability_Countdown, 0.017))), Team 2, Off), Event Player, Min(200, Add(100, Divide((Event Player).Ability_Countdown, 5))));
        Play Effect(All Players(All Teams), Debuff Impact Sound, Color(Violet), (Event Player).Ability_Projectile1, 150);
        Play Effect(All Players(All Teams), Bad Explosion, Color(Violet), (Event Player).Ability_Projectile1, Min(10, Add(1.5, Multiply((Event Player).Ability_Countdown, 0.017))));
        Play Effect(All Players(All Teams), Good Explosion, Color(Purple), (Event Player).Ability_Projectile1, Min(10, Add(1.5, Multiply((Event Player).Ability_Countdown, 0.017))));
        Play Effect(All Players(All Teams), Ring Explosion, Color(Violet), (Event Player).Ability_Projectile1, Min(20, Add(3, Multiply((Event Player).Ability_Countdown, 0.017))));
    }
}

rule ("Ashe: Black Gunpowder") {
    event {
        Player Dealt Knockback;
        Team 1;
        Ashe;
    }
    conditions {
        (Event Player).Talent1 == True;
        Event Ability == Button(Ability 1);
        Victim != Event Player;
    }
    actions {
        Start Damage Over Time(Victim, Event Player, 3, Multiply(Event Damage, 2.5));
        Set Status(Victim, Null, Burning, 3);
    }
}

rule ("Ashe: Dancing Flames") {
    event {
        Player Earned Elimination;
        Team 1;
        Ashe;
    }
    conditions {
        (Event Player).Talent2 == True;
    }
    actions {
        Play Effect(All Players(All Teams), Explosion Sound, Color(Orange), Eye Position(Victim), 120);
        Play Effect(All Players(All Teams), Good Explosion, Color(Orange), Victim, 5);
        Play Effect(All Players(All Teams), Bad Pickup Effect, Color(Yellow), Victim, 5);
        Start Damage Over Time(Players Within Radius(Victim, 5, Team 2, Surfaces), Event Player, 3, 15);
        Set Status(Players Within Radius(Victim, 5, Team 2, Surfaces), Event Player, Burning, 3);
        Damage(Players Within Radius(Victim, 5, Team 2, Surfaces), Event Player, 30);
    }
}

rule ("Widowmaker: Widowmaker Ult") {
    event {
        Ongoing - Each Player;
        Team 1;
        Widowmaker;
    }
    conditions {
        Is Using Ultimate(Event Player) == True;
    }
    actions {
        Set Player Variable(All Players(Team 2), Slowed_until, Add(9999, Total Time Elapsed));
        Wait Until(Not(Is Using Ultimate(Event Player)), 9999);
        Set Player Variable(All Players(Team 2), Slowed_until, Total Time Elapsed);
    }
}

rule ("Widowmaker: Baiser De Soie") {
    event {
        Player Dealt Damage;
        Team 1;
        Widowmaker;
    }
    actions {
        Abort If(Not((Event Player).Talent1));
        Abort If(Compare(Event Ability, !=, Button(Primary Fire)));
        Abort If(Not(Is Firing Secondary(Event Player)));
        Abort If(Not(Event Was Critical Hit));
        Abort If(Compare(Normalized Health(Victim), >, 0.3));
        Abort If((Victim).is_living_boss);
        Abort If((Victim).iv_is_portal);
        Play Effect(All Players(All Teams), Bad Pickup Effect, Color(Violet), Victim, 3);
        Damage(Victim, Event Player, 10000);
        Damage(Players Within Radius(Victim, 3, Team 2, Surfaces), Event Player, Event Damage);
    }
}

rule ("Widowmaker: Parting Gift") {
    event {
        Ongoing - Each Player;
        Team 1;
        Widowmaker;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 1(Event Player) == True;
        Speed Of(Event Player) >= 20;
    }
    actions {
        While(Is Using Ability 1(Event Player));
            Create Projectile(Ramattra Ravenous Vortex Sphere, Event Player, Null, Up, To World, Damage, Team 2, 50, 2, 4, Ring Explosion, Explosion Sound, 0.05, 15, 3, 8, 1, 100);
            Wait(0.15, Ignore Condition);
        End;
        For Player Variable(Event Player, i, 0, 4, 1);
            Wait(0.15, Ignore Condition);
            Create Projectile(Ramattra Ravenous Vortex Sphere, Event Player, Null, Up, To World, Damage, Team 2, 50, 2, 4, Ring Explosion, Explosion Sound, 0.05, 15, 3, 8, 1, 100);
        End;
    }
}

rule ("Torbjorn: Heatwave") {
    event {
        Ongoing - Each Player;
        Team 1;
        Torbjörn;
    }
    conditions {
        (Event Player).Talent1 == True;
        Or(Is Using Ability 2(Event Player), Is Using Ultimate(Event Player)) == True;
    }
    actions {
        Play Effect(All Players(All Teams), Ring Explosion, Color(Orange), Position Of(Event Player), 11);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Orange), Position Of(Event Player), 12);
        Start Damage Over Time(Remove From Array(Players Within Radius(Event Player, 6, Team 2, Surfaces), Event Player), Event Player, 3, 20);
        Set Status(Remove From Array(Players Within Radius(Event Player, 6, Team 2, Surfaces), Event Player), Event Player, Burning, 3);
        Damage(Players Within Radius(Event Player, 6, Team 2, Surfaces), Event Player, 15);
        Wait(0.75, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("[Torbjorn] Foundry") {
    event {
        Player Dealt Damage;
        Team 1;
        Torbjörn;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Primary Fire)));
        Abort If(Compare(Weapon(Event Player), !=, 2));
        Abort If(Compare(Distance Between(Event Player, Victim), >, 2.5));
        Damage(Victim, Event Player, Multiply(Event Damage, 0.4));
        Play Effect(All Players(All Teams), Bad Explosion, Color(Orange), Victim, 0.25);
    }
}

rule ("[Torbjorn] Foundry - Bonus Speed") {
    event {
        Ongoing - Each Player;
        Team 1;
        Torbjörn;
    }
    conditions {
        (Event Player).Talent2 == True;
        Weapon(Event Player) == 2;
    }
    actions {
        Modify Player Variable(Event Player, Move_Speed, Add, 40);
        Wait Until(Or(Or(Compare(Weapon(Event Player), !=, 2), Is Dead(Event Player)), Not((Event Player).Talent2)), 99999);
        Modify Player Variable(Event Player, Move_Speed, Subtract, 40);
    }
}

rule ("Reinhardt: Fire Blast") {
    event {
        Player Dealt Damage;
        Team 1;
        Reinhardt;
    }
    actions {
        Abort If(Not((Event Player).Talent1));
        Abort If(Compare(Event Ability, !=, Button(Ability 2)));
        Play Effect(All Players(All Teams), Good Explosion, Color(Orange), Victim, 5);
        Start Damage Over Time(Players Within Radius(Victim, 5, Team 2, Surfaces), Event Player, 5, 20);
        Set Status(Players Within Radius(Victim, 5, Team 2, Surfaces), Event Player, Burning, 5);
    }
}

rule ("Reinhardt: Epicenter") {
    event {
        Ongoing - Each Player;
        Team 1;
        Reinhardt;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ultimate(Event Player) == True;
        Is On Ground(Event Player) == True;
    }
    actions {
        Set Status(Players Within Radius(Event Player, 20, Team 2, Surfaces), Event Player, Knocked Down, 2.5);
        For Player Variable(Event Player, i, 0, 3, 1);
            Wait(0.032, Ignore Condition);
            Damage(Players Within Radius(Event Player, Multiply((Event Player).i, 10), Team 2, Surfaces), Event Player, 50);
            Play Effect(All Players(All Teams), Ring Explosion, Color(Orange), Position Of(Event Player), Multiply((Event Player).i, 20));
        End;
        Wait(5, Ignore Condition);
    }
}

rule ("Brigitte: Endeavor") {
    event {
        Ongoing - Each Player;
        Team 1;
        Brigitte;
    }
    conditions {
        (Event Player).Talent1 == True;
        (Event Player).Ability_Available == True;
    }
    actions {
        Create Effect(All Players(All Teams), Echo Cloning Effect, Team 1, Event Player, 0.4, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Orange), Eye Position(Event Player), 15);
        Heal(Players Within Radius(Event Player, 15, Team 1, Off), Event Player, 200);
        Modify Player Variable(Event Player, Damage_Dealt, Add, 150);
        Modify Player Variable(Event Player, Move_Speed, Add, 75);
        Add Health Pool To Player(Event Player, Armor, Divide(Max Health(Event Player), 3), False, True);
        Set Player Variable At Index(Event Player, HP_Pool, 1, Last Created Health Pool);
        Wait(1, Ignore Condition);
        Wait Until(Or(Or(Not((Event Player).Talent1), Is Dead(Event Player)), (Event Player).Ability_Available), 6);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 150);
        Modify Player Variable(Event Player, Move_Speed, Subtract, 75);
        Remove Health Pool From Player(Value In Array((Event Player).HP_Pool, 1));
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
        Wait(0.1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Brigitte: Endeavor") {
    event {
        Ongoing - Each Player;
        Team 1;
        Brigitte;
    }
    conditions {
        (Event Player).Talent1 == True;
        Ability Cooldown(Event Player, Button(Secondary Fire)) >= 0.1;
    }
    actions {
        Set Player Variable(Event Player, Ability_Available, True);
        Wait(0.25, Ignore Condition);
        Set Player Variable(Event Player, Ability_Available, False);
    }
}

rule ("Brigitte: Whiplash") {
    event {
        Player Dealt Knockback;
        Team 1;
        Brigitte;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Play Effect(All Players(All Teams), Ring Explosion Sound, Color(Green), Victim, 100);
        Play Effect(All Players(All Teams), Bad Explosion, Color(Orange), Victim, 2.5);
        Play Effect(All Players(All Teams), Bad Pickup Effect, Color(Orange), Victim, 2.5);
        Damage(Players Within Radius(Victim, 2.5, Team 2, Surfaces), Event Player, 100);
        Set Status(Players Within Radius(Victim, 2.5, Team 2, Surfaces), Event Player, Stunned, 1.5);
    }
}

rule ("Genji: Venomous Strike") {
    event {
        Player Dealt Damage;
        Team 1;
        Genji;
    }
    actions {
        Abort If(Not((Event Player).Talent1));
        Abort If(Compare(Event Ability, !=, Button(Ability 1)));
        Start Heal Over Time(Event Player, Event Player, 3, 15);
        Start Damage Over Time(Victim, Event Player, 3, 15);
        Heal(Event Player, Event Player, 5);
        Wait(0.25, Restart When True);
        Wait(2, Ignore Condition);
    }
}

rule ("Genji: Sharpened Storm - Primary") {
    event {
        Ongoing - Each Player;
        Team 1;
        Genji;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Firing Primary(Event Player) == True;
        Is Using Ultimate(Event Player) == False;
    }
    actions {
        Wait(0.25, Ignore Condition);
        Create Projectile(Genji Shuriken, Event Player, Null, Null, To World, Damage, Team 2, 27, 2, 0, Good Explosion, Explosion Sound, 0, 60, 4, 0, 0, 0);
        Wait(0.1, Ignore Condition);
        Create Projectile(Genji Shuriken, Event Player, Null, Null, To World, Damage, Team 2, 27, 2, 0, Good Explosion, Explosion Sound, 0, 60, 4, 0, 0, 0);
        Wait(0.1, Ignore Condition);
        Create Projectile(Genji Shuriken, Event Player, Null, Null, To World, Damage, Team 2, 27, 2, 0, Good Explosion, Explosion Sound, 0, 60, 4, 0, 0, 0);
    }
}

rule ("Genji: Sharpened Storm - Secondary") {
    event {
        Ongoing - Each Player;
        Team 1;
        Genji;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Firing Secondary(Event Player) == True;
    }
    actions {
        Wait(0.016, Ignore Condition);
        Create Projectile(Genji Shuriken, Event Player, Null, Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), 4.5), Vertical Facing Angle Of(Event Player)), To World, Damage, Team 2, 27, 2, 0, Good Explosion, Explosion Sound, 0, 60, 4, 0, 0, 0);
        Create Projectile(Genji Shuriken, Event Player, Null, Direction From Angles(Subtract(Horizontal Facing Angle Of(Event Player), 4.5), Vertical Facing Angle Of(Event Player)), To World, Damage, Team 2, 27, 2, 0, Good Explosion, Explosion Sound, 0, 60, 4, 0, 0, 0);
        Create Projectile(Genji Shuriken, Event Player, Null, Null, To World, Damage, Team 2, 27, 2, 0, Good Explosion, Explosion Sound, 0, 60, 4, 0, 0, 0);
    }
}

rule ("Mercy: Wings of Grand") {
    event {
        Ongoing - Each Player;
        Team 1;
        Mercy;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Alive(Event Player) == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        If(Compare(Speed Of(Event Player), >, 10));
            Damage(Filtered Array(Players Within Radius(Event Player, 4, Team 2, Surfaces), Not(Has Status(Current Array Element, Knocked Down))), Event Player, 35);
            Set Status(Players Within Radius(Event Player, 4, Team 2, Surfaces), Event Player, Knocked Down, 0.8);
            Apply Impulse(Players Within Radius(Event Player, 4, Team 2, Surfaces), Add(Add(Normalize(Velocity Of(Event Player)), Direction Towards(Event Player, Throttle Of(Event Player))), Vector(0, 1.1, 0)), 7.5, To World, Cancel Contrary Motion);
            Play Effect(All Players(All Teams), Bad Explosion, Color(Yellow), Position Of(Event Player), 0.15);
        End;
        Wait(0.25, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Mercy: Holy Light Missiles") {
    event {
        Ongoing - Each Player;
        Team 1;
        Mercy;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ultimate(Event Player) == True;
    }
    actions {
        Create Effect(All Players(All Teams), Orb, Color(Yellow), (Event Player).Ability_Projectile1, 1, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Set Player Variable(Event Player, Ability_Projectile1, Eye Position(Event Player));
        Chase Player Variable At Rate(Event Player, Ability_Projectile1, (Event Player).Ability_End, 100, Destination and Rate);
        Set Player Variable(Event Player, Ability_End, Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 60)), All Living Players(Team 2), All Players(Team 1), True));
        Wait Until(Or(Not((Event Player).Talent2), Compare((Event Player).Ability_End, ==, (Event Player).Ability_Projectile1)), 1);
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
        Stop Chasing Player Variable(Event Player, Ability_Countdown);
        Play Effect(All Players(All Teams), Ring Explosion Sound, Color(Green), (Event Player).Ability_Projectile1, 100);
        Play Effect(All Players(All Teams), Bad Explosion, Color(Yellow), (Event Player).Ability_Projectile1, 6);
        Play Effect(All Players(All Teams), Good Pickup Effect, Color(White), (Event Player).Ability_Projectile1, 6);
        Damage(Players Within Radius((Event Player).Ability_Projectile1, 6, Team 2, Surfaces), Event Player, 150);
        Heal(Players Within Radius((Event Player).Ability_Projectile1, 6, Team 1, Surfaces), Event Player, 150);
        Wait(1.5, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Tracer: Vortex") {
    event {
        Ongoing - Each Player;
        Team 1;
        Tracer;
    }
    conditions {
        Is Using Ability 2(Event Player) == True;
        (Event Player).Talent1 == True;
    }
    actions {
        Heal(Players Within Radius(Event Player, 10, Team 2, Surfaces), Event Player, 1);
        Damage(Players Within Radius(Event Player, 10, Team 2, Surfaces), Event Player, 25);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Red), Position Of(Event Player), 20);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Yellow), Position Of(Event Player), 18);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Green), Position Of(Event Player), 16);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Aqua), Position Of(Event Player), 14);
        Set Environment Credit Player(Players Within Radius(Event Player, 10, Team 2, Surfaces), Event Player);
    }
}

rule ("Tracer: Vortex 2") {
    event {
        Player Received Healing;
        Team 2;
        All;
    }
    actions {
        Abort If(Not((Healer).Talent1));
        Abort If((Event Player).is_living_boss);
        Abort If(Not(Is Using Ability 2(Healer)));
        Disable Movement Collision With Players(Event Player);
        Apply Impulse(Event Player, Up, 3, To World, Cancel Contrary Motion);
        Set Gravity(Event Player, False);
        Wait(0.05, Ignore Condition);
        Apply Impulse(Event Player, Direction Towards(Event Player, Healer), Multiply(Distance Between(Event Player, Healer), 3.4), To World, Cancel Contrary Motion);
        Set Status(Event Player, Null, Rooted, 1);
        Wait(0.23, Ignore Condition);
        Set Gravity(Event Player, 100);
        Enable Movement Collision With Players(Event Player);
        Call Subroutine(Cancel_Momentum);
    }
}

rule ("Tracer: Chain Reaction") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        Is True For Any(Filtered Array(All Living Players(Team 2), (Current Array Element).Chain_Reaction_On), Compare(Distance Between(Event Player, Current Array Element), <=, 7)) == True;
        (Event Player).Chain_Reaction_Immune == False;
        (Event Player).Chain_Reaction_On == False;
        Is Alive(Event Player) == True;
    }
    actions {
        Wait(0.25, Ignore Condition);
        Set Player Variable(Event Player, Chain_Reaction_On, True);
    }
}

rule ("Tracer: Chain Reaction 2") {
    event {
        Ongoing - Each Player;
        Team 2;
        All;
    }
    conditions {
        (Event Player).Chain_Reaction_On == True;
    }
    actions {
        Wait(0.1, Ignore Condition);
        Play Effect(All Players(All Teams), Good Explosion, Color(Aqua), Event Player, 3);
        Damage(Event Player, Players On Hero(Hero(Tracer), Team 1), 200);
        Wait(0.5, Ignore Condition);
        Set Player Variable(Event Player, Chain_Reaction_Immune, True);
        Set Player Variable(Event Player, Chain_Reaction_On, False);
        Wait(2, Ignore Condition);
        Set Player Variable(Event Player, Chain_Reaction_Immune, False);
    }
}

rule ("Tracer: Chain Reaction 3") {
    event {
        Player Dealt Damage;
        Team 1;
        Tracer;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Ultimate)));
        Abort If(Compare(Event Damage, <=, 20));
        Set Player Variable(Victim, Chain_Reaction_On, True);
    }
}

rule ("Symmetra: Sentry Paragon") {
    event {
        Ongoing - Each Player;
        Team 1;
        Symmetra;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Alive(Event Player) == True;
    }
    actions {
        Wait(0.5, Abort When False);
        Start Damage Modification(All Players(Team 2), Event Player, 66.667, Receivers Damagers and Damage Percent);
        Set Player Variable At Index(Event Player, damage_mod, 1, Last Damage Modification ID);
        Modify Player Variable(Event Player, Damage_Dealt, Add, 50);
        Wait Until(Or(Not((Event Player).Talent1), Is Dead(Event Player)), 99999);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 50);
        Stop Damage Modification(Value In Array((Event Player).damage_mod, 1));
        Wait(0.1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Symmetra: Shield Generator") {
    event {
        Player Dealt Final Blow;
        Team 1;
        Symmetra;
    }
    conditions {
        (Event Player).Talent2 == True;
    }
    actions {
        Modify Player Variable(Event Player, Damage_Dealt, Add, 30);
        Modify Player Variable(Event Player, Move_Speed, Add, 30);
        Add Health Pool To Player(All Players(Team 1), Shields, Min(200, Multiply(Max Health(Event Player), 0.25)), False, False);
        Set Player Variable At Index(Event Player, HP_Pool, 6, Last Created Health Pool);
        Create Effect(All Players(All Teams), Ana Nano Boosted Effect, Color(Team 1), Event Player, 1, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Wait Until(Or(Not((Event Player).Talent2), Is Dead(Event Player)), 10);
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
        Remove Health Pool From Player(Value In Array((Event Player).HP_Pool, 6));
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 30);
        Modify Player Variable(Event Player, Move_Speed, Subtract, 30);
    }
}

rule ("[Hanzo] Arrow Rain ") {
    event {
        Ongoing - Each Player;
        Team 1;
        Hanzo;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Firing Primary(Event Player) == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        For Player Variable(Event Player, i, 0, 2, 1);
            Create Projectile(Mei Icicle, Event Player, Add(Eye Position(Event Player), Vector(0, -0.5, 0)), Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Random Real(-2, 2)), Add(Vertical Facing Angle Of(Event Player), Random Real(-2, 2))), To World, Damage, Team 2, 70, 2, 0, Bad Explosion, Explosion Sound, 0, 110, 5, 0, 1, 5);
            Create Projectile(Mei Icicle, Event Player, Add(Eye Position(Event Player), Vector(0, -0.5, 0)), Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Random Real(-2, 2)), Add(Vertical Facing Angle Of(Event Player), Random Real(-2, 2))), To World, Damage, Team 2, 70, 2, 0, Bad Explosion, Explosion Sound, 0, 110, 5, 0, 1, 5);
        End;
    }
}

rule ("Hanzo: Stormbreak") {
    event {
        Player Dealt Final Blow;
        Team 1;
        Hanzo;
    }
    conditions {
        (Event Player).Talent2 == True;
    }
    actions {
        Set Player Variable(Event Player, Ability_Countdown, 4);
        Chase Player Variable At Rate(Event Player, Ability_Countdown, 0, 1, Destination and Rate);
    }
}

rule ("Hanzo: Stormbreak - Boost") {
    event {
        Ongoing - Each Player;
        Team 1;
        Hanzo;
    }
    conditions {
        (Event Player).Talent2 == True;
        (Event Player).Ability_Countdown > 0;
    }
    actions {
        Create Effect(All Players(All Teams), Winston Primal Rage Effect, Color(Team 1), Event Player, 1, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Wait Until(Or(Or(Is Dead(Event Player), Not((Event Player).Ability_Countdown)), Not((Event Player).Talent2)), 99999);
        Set Player Variable(Event Player, Ability_Countdown, False);
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
        Stop Chasing Player Variable(Event Player, Ability_Countdown);
    }
}

rule ("Hanzo: Stormbreak - Reset Cooldowns For Storm Arrows") {
    event {
        Ongoing - Each Player;
        Team 1;
        Hanzo;
    }
    conditions {
        (Event Player).Ability_Countdown > 0;
        Ability Cooldown(Event Player, Button(Ability 2)) > 0;
    }
    actions {
        Set Ability Cooldown(Event Player, Button(Ability 2), False);
    }
}

rule ("Echo: Bomber Jacket") {
    event {
        Ongoing - Each Player;
        Team 1;
        Echo;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Create Homing Projectile(Echo Sticky Bomb, Event Player, Add(Eye Position(Event Player), World Vector Of(Vector(-0.5, False, False), Event Player, Rotation)), Down, To World, Damage, Team 2, 30, 1, 1.5, Ring Explosion, Explosion Sound, 0, 20, 5, 0, First Of(Sorted Array(Filtered Array(All Players(Team 2), And(Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS), (Current Array Element).is_alive)), Distance Between(Event Player, Current Array Element))), 1);
        Create Homing Projectile(Echo Sticky Bomb, Event Player, Add(Eye Position(Event Player), World Vector Of(Vector(0.5, False, False), Event Player, Rotation)), Down, To World, Damage, Team 2, 30, 1, 1.5, Ring Explosion, Explosion Sound, 0, 20, 5, 0, First Of(Sorted Array(Filtered Array(All Players(Team 2), And(Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS), (Current Array Element).is_alive)), Distance Between(Event Player, Current Array Element))), 1);
        Wait(0.25, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Echo: Focusing Optics") {
    event {
        Player Dealt Damage;
        Team 1;
        Echo;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Ability 2)));
        Abort If(Is Duplicating(Event Player));
        Abort If(Compare(Normalized Health(Victim), <=, 0.5));
        Abort If(Compare(Normalized Health(Victim), >, 0.9));
        Damage(Victim, Event Player, Multiply(Event Damage, 3));
        Play Effect(All Players(All Teams), Bad Explosion, Color(Violet), Victim, 0.5);
    }
}

rule ("[Lucio] Chord Cadence") {
    event {
        Ongoing - Each Player;
        Team 1;
        Lúcio;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        Wait Until(Not(Is Using Ability 2(Event Player)), 4);
        Set Ability Cooldown(Event Player, Button(Ability 2), 0);
        Abort If(Is Dead(Event Player));
        Cancel Primary Action(Event Player);
        Press Button(Event Player, Button(Ability 2));
        Wait(4, Ignore Condition);
    }
}

rule ("[Lucio] Chord Cadence burstfire") {
    event {
        Ongoing - Each Player;
        Team 1;
        Lúcio;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Firing Primary(Event Player) == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        For Player Variable(Event Player, i, 0, 4, 1);
            Create Projectile(Lucio Sonic Amplifier, Event Player, Add(Eye Position(Event Player), Vector(0, -0.5, 0)), Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Random Real(-1, 1)), Add(Vertical Facing Angle Of(Event Player), Random Real(-1, 1))), To World, Damage, Opposite Team Of(Team Of(Event Player)), 20, 2, 0, Bad Explosion, Explosion Sound, 0, 50, 5, 0, 0, 0);
            Create Projectile(Lucio Sonic Amplifier, Event Player, Add(Eye Position(Event Player), Vector(0, -0.5, 0)), Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Random Real(-1, 1)), Add(Vertical Facing Angle Of(Event Player), Random Real(-1, 1))), To World, Damage, Opposite Team Of(Team Of(Event Player)), 20, 2, 0, Bad Explosion, Explosion Sound, 0, 50, 5, 0, 0, 0);
            If(Not(Is Firing Primary(Event Player)));
                Break;
            End;
            Wait(0.04, Ignore Condition);
        End;
        Wait(0.05, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Lucio: Reverse Amp") {
    event {
        Ongoing - Each Player;
        Team 1;
        Lúcio;
    }
    conditions {
        Is Using Ability 2(Event Player) == True;
        (Event Player).Talent2 == True;
    }
    actions {
        If(Is Using Ability 1(Event Player));
            Set Status(Players Within Radius(Event Player, 12, Team 2, Surfaces), Event Player, Rooted, 0.75);
        Else;
            Damage(Players Within Radius(Event Player, 12, Team 2, Surfaces), Event Player, 30);
            Wait(0.5, Ignore Condition);
            Loop If Condition Is True;
    }
}

rule ("D.Va: Voltage Grid") {
    event {
        Ongoing - Each Player;
        Team 1;
        D.Va;
    }
    conditions {
        Is Firing Secondary(Event Player) == True;
        (Event Player).Talent1 == True;
    }
    actions {
        Play Effect(All Players(All Teams), Bad Explosion, Color(Turquoise), Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 2)), 0.15);
        Play Effect(All Players(All Teams), Bad Explosion, Color(Turquoise), Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 5)), 0.15);
        Play Effect(All Players(All Teams), Bad Explosion, Color(Turquoise), Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 8)), 0.15);
        Wait(0.3, Ignore Condition);
        Damage(Players Within Radius(Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 2)), 2.5, Team 2, Off), Event Player, 20);
        Damage(Players Within Radius(Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 5)), 2.5, Team 2, Off), Event Player, 20);
        Damage(Players Within Radius(Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 8)), 2.5, Team 2, Off), Event Player, 20);
        Set Status(Players Within Radius(Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 2)), 2.5, Team 2, Off), Event Player, Rooted, 0.4);
        Set Status(Players Within Radius(Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 5)), 2.5, Team 2, Off), Event Player, Rooted, 0.4);
        Set Status(Players Within Radius(Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 8)), 2.5, Team 2, Off), Event Player, Rooted, 0.4);
        Loop If Condition Is True;
    }
}

rule ("D.Va: Shooting Star") {
    event {
        Player Dealt Knockback;
        Team 1;
        D.Va;
    }
    conditions {
        Event Ability == Button(Ability 1);
        (Event Player).Talent2 == True;
    }
    actions {
        Damage(Victim, Event Player, 30);
        Set Status(Victim, Null, Burning, 3);
        Start Damage Over Time(Victim, Event Player, 3, 35);
        Play Effect(All Players(All Teams), Bad Explosion, Color(Red), Victim, 1);
    }
}

rule ("Zarya- Combusta-bubble - Detect Barrier Target") {
    event {
        Ongoing - Each Player;
        Team 1;
        Zarya;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        Wait(0.025, Ignore Condition);
        Set Player Variable(Event Player, Ability_End, First Of(Filtered Array(Players Within Radius(Event Player, 30, Team 1, Surfaces), And(And(Has Status(Current Array Element, Invincible), Is Alive(Current Array Element)), Is In View Angle(Event Player, Current Array Element, 103)))));
        Wait Until(Not(Is Using Ability 2(Event Player)), 2);
        Play Effect(All Players(All Teams), Explosion Sound, Color(Orange), (Event Player).Ability_End, 120);
        Play Effect(All Players(All Teams), Good Explosion, Color(Orange), Eye Position((Event Player).Ability_End), 6);
        Play Effect(All Players(All Teams), Bad Pickup Effect, Color(Yellow), Eye Position((Event Player).Ability_End), 6);
        Damage(Players Within Radius(Eye Position((Event Player).Ability_End), 6, Team 2, Surfaces), (Event Player).Ability_End, 100);
    }
}

rule ("Zarya- Combusta-Bubble - Self bubble") {
    event {
        Ongoing - Each Player;
        Team 1;
        Zarya;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Wait(0.1, Abort When False);
        Wait Until(Not(Is Using Ability 1(Event Player)), 2);
        Play Effect(All Players(All Teams), Explosion Sound, Color(Orange), Event Player, 120);
        Play Effect(All Players(All Teams), Good Explosion, Color(Orange), Eye Position(Event Player), 6);
        Play Effect(All Players(All Teams), Bad Pickup Effect, Color(Yellow), Eye Position(Event Player), 6);
        Damage(Players Within Radius(Event Player, 6, Team 2, Surfaces), Event Player, 100);
    }
}

rule ("Zarya- Power Surge") {
    event {
        Ongoing - Each Player;
        Team 1;
        Zarya;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Abort If(Not(Has Status(Event Player, Invincible)));
        Damage(Event Player, Null, 10000);
        Wait(0.1, Ignore Condition);
        Set Ability Cooldown(Event Player, Button(Ability 1), False);
        Press Button(Event Player, Button(Ability 1));
        Wait(3, Ignore Condition);
    }
}

rule ("Pharah: Head Trauma") {
    event {
        Player Dealt Knockback;
        Team 1;
        Pharah;
    }
    conditions {
        (Event Player).Talent1 == True;
        Event Ability == Button(Ability 2);
        (Victim).iv_is_portal == False;
        Victim != Event Player;
    }
    actions {
        Damage(Victim, Event Player, 60);
        Play Effect(All Players(All Teams), Good Explosion, Color(Gray), Victim, 1);
        Abort If(Compare(Normalized Health(Victim), >, 0.5));
        Set Status(Victim, Null, Hacked, 1);
    }
}

rule ("[Pharah] Weaponized Storm") {
    event {
        Ongoing - Each Player;
        Team 1;
        Pharah;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Firing Primary(Event Player) == True;
        Modulo(Ammo(Event Player, False), 6) == False;
    }
    actions {
        Set Projectile Speed(Event Player, 125);
        Set Player Variable(Event Player, Ability_End, Ray Cast Hit Position(Eye Position(Event Player), Add(Eye Position(Event Player), Multiply(Facing Direction Of(Event Player), 100)), All Living Players(All Teams), Event Player, True));
        Set Player Variable(Event Player, Ability_Projectile1, Eye Position(Event Player));
        Create Effect(All Players(All Teams), Bad Aura, Color(Orange), (Event Player).Ability_Projectile1, 1, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 7, Last Created Entity);
        Chase Player Variable At Rate(Event Player, Ability_Projectile1, (Event Player).Ability_End, 35, Destination and Rate);
        Wait Until(Or(Not((Event Player).Talent2), Compare((Event Player).Ability_Projectile1, ==, (Event Player).Ability_End)), 99999);
        Destroy Effect(Value In Array((Event Player).Effects__, 7));
        For Player Variable(Event Player, i, 0, 6, 1);
            Play Effect(All Players(All Teams), Bad Pickup Effect, Color(Orange), Add((Event Player).Ability_Projectile1, Vector(Random Real(-1.5, 1.5), Random Real(-0.5, 0.5), Random Real(-1.5, 1.5))), 1);
            Play Effect(All Players(All Teams), Explosion Sound, Color(Team 1), (Event Player).Ability_Projectile1, 25);
            Damage(Players Within Radius((Event Player).Ability_Projectile1, 4, Team 2, Surfaces), Event Player, 20);
            Wait(0.1, Ignore Condition);
        End;
        Set Projectile Speed(Event Player, 100);
        Stop Chasing Player Variable(Event Player, Ability_Projectile1);
    }
}

rule ("Junkrat: Pyromania") {
    event {
        Player Dealt Knockback;
        Team 1;
        Junkrat;
    }
    actions {
        Abort If(Not((Event Player).Talent1));
        Abort If(Compare(Event Ability, ==, Button(Melee)));
        Abort If(Compare(Victim, ==, Event Player));
        Start Damage Over Time(Victim, Event Player, 2, 20);
        Set Status(Victim, Null, Burning, 2);
    }
}

rule ("Junkrat: Trigger Happy") {
    event {
        Ongoing - Each Player;
        Team 1;
        Junkrat;
    }
    conditions {
        (Event Player).Talent2 == True;
        Ability Charge(Event Player, Button(Ability 1)) < 5;
    }
    actions {
        Wait(4, Abort When False);
        Set Ability Charge(Event Player, Button(Ability 1), Add(Ability Charge(Event Player, Button(Ability 1)), 1));
        Loop If Condition Is True;
    }
}

rule ("Roadhog: Stench") {
    event {
        Ongoing - Each Player;
        Team 1;
        Roadhog;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Alive(Event Player) == True;
    }
    actions {
        Create Effect(All Players(All Teams), Ring, Color(Violet), Event Player, 8, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Wait Until(Or(Not((Event Player).Talent1), Is Dead(Event Player)), 99999);
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
        Wait(0.1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Roadhog: Stench effect") {
    event {
        Ongoing - Each Player;
        Team 1;
        Roadhog;
    }
    conditions {
        Distance Between(Event Player, Closest Player To(Event Player, Team 2)) <= 8;
        (Event Player).Talent1 == True;
    }
    actions {
        Damage(Players Within Radius(Event Player, 8, Team 2, Surfaces), Event Player, 9);
        Wait(0.4, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Roadhog: Chainsnap") {
    event {
        Ongoing - Each Player;
        Team 1;
        Roadhog;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Modify Player Variable(Event Player, Damage_Dealt, Add, 400);
        Wait Until(Not(And((Event Player).Talent2, Is Using Ability 1(Event Player))), 99999);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 400);
        Wait(0.1, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Roadhog: Chainsnap - Reset cooldown") {
    event {
        Player Earned Elimination;
        Team 1;
        Roadhog;
    }
    conditions {
        (Event Player).Talent2 == True;
    }
    actions {
        Wait Until(Not(Is Using Ability 1(Event Player)), 3);
        Set Ability Cooldown(Event Player, Button(Ability 1), False);
    }
}

rule ("Moira: Flourish") {
    event {
        Ongoing - Each Player;
        Team 1;
        Moira;
    }
    conditions {
        Is Using Ability 1(Event Player) == True;
        (Event Player).Talent1 == True;
    }
    actions {
        Start Damage Over Time(Players Within Radius(Event Player, 3, Team 2, Surfaces), Event Player, 2, 25);
        Start Heal Over Time(Players Within Radius(Event Player, 3, Team 1, Surfaces), Event Player, 2, 40);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Black), Position Of(Event Player), 6);
        Wait(0.2, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("[Moira] Catalyst - ") {
    event {
        Ongoing - Each Player;
        Team 1;
        Moira;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ultimate(Event Player) == True;
        Is Button Held(Event Player, Button(Primary Fire)) == True;
        Ability Resource(Event Player, Button(Primary Fire)) > 8;
    }
    actions {
        Modify Player Variable(Event Player, Damage_Dealt, Add, 300);
        Modify Player Variable(Event Player, healing_dealt_percent, Add, 300);
        Modify Player Variable(Event Player, Move_Speed, Subtract, 40);
        Wait Until(Not(And(And(Is Button Held(Event Player, Button(Primary Fire)), (Event Player).Talent2), Is Using Ultimate(Event Player))), 8);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 300);
        Modify Player Variable(Event Player, Move_Speed, Add, 40);
        Modify Player Variable(Event Player, healing_dealt_percent, Subtract, 300);
        Wait(0.25, Ignore Condition);
    }
}

rule ("[Moira] Catalyst - ") {
    event {
        Ongoing - Each Player;
        Team 1;
        Moira;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ultimate(Event Player) == True;
        Is Button Held(Event Player, Button(Primary Fire)) == True;
        Ability Resource(Event Player, Button(Primary Fire)) > 8;
    }
    actions {
        Set Ability Resource(Event Player, Button(Primary Fire), Subtract(Ability Resource(Event Player, Button(Primary Fire)), 15));
        Play Effect(All Players(All Teams), Ring Explosion, Color(Purple), Eye Position(Event Player), 10);
        Damage(Players Within Radius(Eye Position(Event Player), 5, Team 2, Surfaces), Event Player, 35);
        Wait(0.5, Ignore Condition);
        Loop If Condition Is True;
    }
}

rule ("Mei: Cold Snap") {
    event {
        Ongoing - Each Player;
        Team 1;
        Mei;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Wait(0.5, Abort When False);
        Wait Until(Not(Is Using Ability 1(Event Player)), 99999);
        Damage(Players Within Radius(Eye Position(Event Player), 10, Team 2, Surfaces), Event Player, 35);
        Set Status(Players Within Radius(Eye Position(Event Player), 10, Team 2, Surfaces), Event Player, Frozen, 2);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Sky Blue), Position Of(Event Player), 20);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Aqua), Add(Position Of(Event Player), Vector(0, 1, False)), 20);
    }
}

rule ("[Mei] Fractical Strike ") {
    event {
        Ongoing - Each Player;
        Team 1;
        Mei;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Firing Secondary(Event Player) == True;
    }
    actions {
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 60);
        Wait(0.3, Ignore Condition);
        Modify Player Variable(Event Player, Damage_Dealt, Add, 60);
        Abort If Condition Is False;
        For Player Variable(Event Player, i, 0, 5, 1);
            Create Projectile(Mei Icicle, Event Player, Add(Eye Position(Event Player), World Vector Of(Vector(False, -0.25, False), Event Player, Rotation)), Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Random Real(-8, 8)), Add(Vertical Facing Angle Of(Event Player), Random Real(-8, 8))), To World, Damage, Team 2, 75, 2, 0, Bad Explosion, Explosion Sound, 0, 115, 5, 0, 0, 5);
            Create Projectile(Mei Icicle, Event Player, Add(Eye Position(Event Player), World Vector Of(Vector(False, -0.25, False), Event Player, Rotation)), Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Random Real(-8, 8)), Add(Vertical Facing Angle Of(Event Player), Random Real(-8, 8))), To World, Damage, Team 2, 75, 2, 0, Bad Explosion, Explosion Sound, 0, 115, 5, 0, 0, 5);
        End;
    }
}

rule ("[Winston] Next Generation") {
    event {
        Player Dealt Knockback;
        Team 1;
        Winston;
    }
    conditions {
        (Event Player).Talent1 == True;
        Event Ability == Button(Ultimate);
    }
    actions {
        Set Ultimate Charge(Event Player, Add(Ultimate Charge Percent(Event Player), 5));
        Damage(Victim, Event Player, Event Damage);
    }
}

rule ("[Winston] Quake") {
    event {
        Ongoing - Each Player;
        Team 1;
        Winston;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Wait(0.25, Ignore Condition);
        Wait Until(Is On Ground(Event Player), 99999);
        Abort If(Is Dead(Event Player));
        Damage(Players Within Radius(Event Player, 7.5, Team 2, Surfaces And All Barriers), Event Player, 30);
        Play Effect(All Players(All Teams), Ring Explosion, Color(White), Position Of(Event Player), 15);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Gray), Position Of(Event Player), 14);
        Set Status(Players Within Radius(Event Player, 7.5, Team 2, Surfaces And All Barriers), Event Player, Stunned, 1);
    }
}

rule ("Reaper: Wraith Wrath") {
    event {
        Ongoing - Each Player;
        Team 1;
        Reaper;
    }
    conditions {
        Is Using Ability 1(Event Player) == True;
        (Event Player).Talent1 == True;
    }
    actions {
        Wait(0.1, Abort When False);
        Cancel Primary Action(Event Player);
        Create Effect(All Players(All Teams), Reaper Wraith Form Effect, Color(Team 1), Event Player, True, Visible To Position and Radius);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Modify Player Variable(Event Player, Damage_Dealt, Add, 30);
        Modify Player Variable(Event Player, Move_Speed, Add, 50);
        Disallow Button(Event Player, Button(Ability 1));
        Set Status(Event Player, Null, Phased Out, 3);
        Wait Until(Or(Is Dead(Event Player), Not((Event Player).Talent1)), 3);
        Allow Button(Event Player, Button(Ability 1));
        Set Ability Cooldown(Event Player, Button(Ability 1), 8);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 30);
        Modify Player Variable(Event Player, Move_Speed, Subtract, 50);
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
    }
}

rule ("Reaper: Loom") {
    event {
        Ongoing - Each Player;
        Team 1;
        Reaper;
    }
    conditions {
        Is Using Ability 1(Event Player) == True;
        (Event Player).Talent2 == True;
    }
    actions {
        Set Status(Filtered Array(Players in View Angle(Event Player, Team 2, 45), Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS)), Event Player, Hacked, 2);
        Damage(Filtered Array(Players in View Angle(Event Player, Team 2, 45), Is In Line of Sight(Current Array Element, Event Player, Barriers Do Not Block LOS)), Event Player, 35);
    }
}

rule ("[Sojourn] Thunderout Kicks") {
    event {
        Ongoing - Each Player;
        Team 1;
        Sojourn;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Set Player Variable(Event Player, Ability_Active, Add(1, Total Time Elapsed));
        Wait Until(Or(Compare(Ability Cooldown(Event Player, Button(Ability 1)), >, 1), Is Button Held(Event Player, Button(Jump))), 1);
        Abort If(Compare((Event Player).Ability_Active, <, Total Time Elapsed));
        Play Effect(All Players(All Teams), Ring Explosion, Color(Turquoise), Position Of(Event Player), 12);
        Damage(Players Within Radius(Event Player, 6, Team 2, Surfaces), Event Player, 75);
    }
}

rule ("Sojourn: Matter Splatter") {
    event {
        Player Dealt Damage;
        Team 1;
        Sojourn;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Secondary Fire)));
        Abort If(Not(Event Was Critical Hit));
        Play Effect(All Players(All Teams), Bad Explosion, Color(Turquoise), Eye Position(Victim), 4);
        Damage(Players Within Radius(Victim, 4, Team 2, Surfaces), Event Player, Event Damage);
    }
}

rule ("Soldier76: Triple Threat") {
    event {
        Ongoing - Each Player;
        Team 1;
        Soldier: 76;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Firing Secondary(Event Player) == True;
    }
    actions {
        Create Projectile(Pharah Rocket, Event Player, Null, Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), 4.5), Vertical Facing Angle Of(Event Player)), To World, Damage, Team 2, 60, 1, 2.5, Good Explosion, Ring Explosion Sound, 0, 60, 4, 0, 0, 0);
        Create Projectile(Pharah Rocket, Event Player, Null, Direction From Angles(Subtract(Horizontal Facing Angle Of(Event Player), 4.5), Vertical Facing Angle Of(Event Player)), To World, Damage, Team 2, 60, 1, 2.5, Good Explosion, Ring Explosion Sound, 0, 60, 4, 0, 0, 0);
    }
}

rule ("Soldier76: Triple Threat - Init rocket") {
    event {
        Ongoing - Each Player;
        Team 1;
        Soldier: 76;
    }
    conditions {
        (Event Player).Talent1 == True;
    }
    actions {
        Set Player Variable(Event Player, Ability_Projectile1, (Event Player).Ability_Available);
        Set Player Variable(Event Player, Ability_Countdown, (Event Player).Ability_End);
    }
}

rule ("Soldier76: Espionage") {
    event {
        Player Dealt Healing;
        Team 1;
        Soldier: 76;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Ability 2)));
        If(Not((Healee).soldier_espionage));
            Set Player Variable(Healee, soldier_espionage, True);
    }
}

rule ("Soldier76: Espionage - Allies effect") {
    event {
        Ongoing - Each Player;
        Team 1;
        All;
    }
    conditions {
        (Event Player).soldier_espionage == True;
    }
    actions {
        Set Player Variable(Event Player, soldier_espionage, False);
        If(And((Event Player).downed_start_t, Compare(Count Of((Event Player).revivers), >, 0)));
            Modify Player Variable(Event Player, revive_timer, Add, 20);
        End;
        Set Player Variable(Event Player, active_ab_is_smoked, True);
        Wait(0.4, Ignore Condition);
    }
}

rule ("Baptiste: Corrode") {
    event {
        Ongoing - Each Player;
        Team 1;
        Baptiste;
    }
    conditions {
        Is Using Ability 1(Event Player) == True;
        (Event Player).Talent1 == True;
    }
    actions {
        For Player Variable(Event Player, i, 0, 3, 1);
            Play Effect(All Players(All Teams), Ring Explosion, Color(Purple), Position Of(Event Player), 20);
            Damage(Players Within Radius(Event Player, 10, Team 2, Surfaces), Event Player, 25);
            Start Damage Over Time(Players Within Radius(Event Player, 10, Team 2, Surfaces), Event Player, 5, 30);
            Wait(0.2, Ignore Condition);
        End;
    }
}

rule ("[Baptiste] Aerial Ace - Jump") {
    event {
        Ongoing - Each Player;
        Team 1;
        Baptiste;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Crouching(Event Player) == True;
        Has Status(Event Player, Hacked) == False;
    }
    actions {
        Wait Until(Not(Is Crouching(Event Player)), 9999);
        Wait Until(Is Jumping(Event Player), 1);
        Set Player Variable(Event Player, Ability_Available, True);
        Wait(0.25, Ignore Condition);
        Modify Player Variable(Event Player, Damage_Dealt, Add, 50);
        Wait Until(Is On Ground(Event Player), 99999);
        Set Player Variable(Event Player, Ability_Available, False);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 50);
    }
}

rule ("[Baptiste] Aerial Ace - Slower fall") {
    event {
        Ongoing - Each Player;
        Team 1;
        Baptiste;
    }
    conditions {
        (Event Player).Talent2 == True;
        (Event Player).Ability_Available == True;
        Is Alive(Event Player) == True;
        Is Button Held(Event Player, Button(Jump)) == True;
        And(Has Status(Event Player, Stunned), Has Status(Event Player, Hacked)) == False;
        Altitude Of(Event Player) >= 1;
        Vertical Speed Of(Event Player) < 0;
    }
    actions {
        Set Gravity(Event Player, 7.5);
        Wait(0.333, Ignore Condition);
        Play Effect(All Players(Team Of(Event Player)), Ring Explosion, Color(Orange), Position Of(Event Player), 2);
        Loop If Condition Is True;
        Set Gravity(Event Player, 100);
    }
}

rule ("[Bastion]- Fusillade") {
    event {
        Ongoing - Each Player;
        Team 1;
        Bastion;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is In Alternate Form(Event Player) == True;
        Is Firing Primary(Event Player) == True;
    }
    actions {
        Wait(0.5, Abort When False);
        While(And(Is Firing Primary(Event Player), Is In Alternate Form(Event Player)));
            Create Projectile(Pharah Rocket, Event Player, Add(Eye Position(Event Player), World Vector Of(Vector(Random Real(-0.4, 0.4), Random Real(-0.4, -0.4), 0), Event Player, Rotation)), Null, To World, Damage, Team 2, 25, 1, 1.5, Good Explosion, Explosion Sound, 0, 35, 2, 0, 0, 0);
            Wait(0.25, Ignore Condition);
        End;
    }
}

rule ("[Bastion]: Trickshot") {
    event {
        Player Dealt Damage;
        Team 1;
        Bastion;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Secondary Fire)));
        Abort If(Compare(Event Damage, >, 30));
        Wait(0.5, Ignore Condition);
        Set Ability Cooldown(Event Player, Button(Secondary Fire), Subtract(Ability Cooldown(Event Player, Button(Secondary Fire)), 3));
        Damage(Players Within Radius(Victim, 5, Team 2, Surfaces), Event Player, 30);
        Heal(Event Player, Event Player, 50);
    }
}

rule ("[Sombra] Stack Overflow") {
    event {
        Ongoing - Each Player;
        Team 1;
        Sombra;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Wait(0.8, Abort When False);
        Wait Until(Or(Or(Or(Or(Is Button Held(Event Player, Button(Primary Fire)), Is Button Held(Event Player, Button(Ability 1))), Is Button Held(Event Player, Button(Ultimate))), Is Button Held(Event Player, Button(Melee))), Is Communicating Any Emote(Event Player)), 99999);
        Cancel Primary Action(Event Player);
        Create Effect(Event Player, Mercy Damage Boosted Effect, Color(Team 1), Event Player, 1, Visible To Position Radius and Color);
        Modify Player Variable(Event Player, Damage_Dealt, Add, 50);
        Set Player Variable At Index(Event Player, Effects__, 1, Last Created Entity);
        Set Player Variable(Event Player, Ability_Active, True);
        Wait Until(Or(Is Dead(Event Player), Not((Event Player).Talent1)), 3);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 50);
        Destroy Effect(Value In Array((Event Player).Effects__, 1));
        Set Player Variable(Event Player, Ability_Active, False);
    }
}

rule ("[Sombra] Stack Overflow - melee") {
    event {
        Player Dealt Knockback;
        Team 1;
        Sombra;
    }
    conditions {
        (Event Player).Talent1 == True;
        (Event Player).Ability_Active == True;
        Event Ability == Button(Melee);
    }
    actions {
        Set Status(Victim, Event Player, Stunned, 1);
        Damage(Victim, Event Player, 40);
        Play Effect(All Players(All Teams), Bad Explosion, Color(Purple), Victim, 0.25);
    }
}

rule ("[Sombra] Cyberattack") {
    event {
        Ongoing - Each Player;
        Team 1;
        Sombra;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        Wait Until(Not(Is Using Ability 2(Event Player)), 99999);
        Abort If(Is Button Held(Event Player, Button(Interact)));
        Abort If(Is Dead(Event Player));
        Wait(0.25, Ignore Condition);
        Damage(Players Within Radius(Event Player, 8, Team 2, Surfaces), Event Player, 50);
        Play Effect(All Players(All Teams), Ring Explosion Sound, Color(White), Eye Position(Event Player), 20000);
        Play Effect(All Players(All Teams), Good Explosion, Color(Purple), Eye Position(Event Player), 8);
        Play Effect(All Players(All Teams), Ring Explosion, Color(Violet), Eye Position(Event Player), 16);
        Set Status(Players Within Radius(Eye Position(Event Player), 8, Team 2, Surfaces), Event Player, Hacked, 2);
    }
}

rule ("Doomfist: Punch Card") {
    event {
        Ongoing - Each Player;
        Team 1;
        Doomfist;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Firing Secondary(Event Player) == True;
    }
    actions {
        Wait(1, Abort When False);
        Modify Player Variable(Event Player, Damage_Dealt, Add, 200);
        Wait Until(Compare(Ability Cooldown(Event Player, Button(Secondary Fire)), >, 0.1), 1);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 200);
    }
}

rule ("[Doomfist] Fire Quake - Use seismic slam") {
    event {
        Ongoing - Each Player;
        Team 1;
        Doomfist;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Wait(0.5, Ignore Condition);
        Wait Until(Or(Is On Ground(Event Player), Not(Is Using Ability 1(Event Player))), 1000);
        Abort If(Not(Is Using Ability 1(Event Player)));
        For Player Variable(Event Player, i, -5, 5, 1);
            Create Projectile(Reinhardt Fire Strike, Event Player, Null, Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Multiply((Event Player).i, 5)), Vertical Facing Angle Of(Event Player)), To World, Damage, Team 2, 50, 1, 0, Good Explosion, Explosion Sound, 0, 40, 4, 0, 0, 0);
            Wait(0.025, Ignore Condition);
        End;
        For Player Variable(Event Player, i, 5, -5, -1);
            Create Projectile(Reinhardt Fire Strike, Event Player, Null, Direction From Angles(Add(Horizontal Facing Angle Of(Event Player), Multiply((Event Player).i, 5)), Vertical Facing Angle Of(Event Player)), To World, Damage, Team 2, 50, 1, 0, Good Explosion, Explosion Sound, 0, 40, 4, 0, 0, 0);
            Wait(0.025, Ignore Condition);
        End;
    }
}

rule ("Cassidy: Standoff") {
    event {
        Ongoing - Each Player;
        Team 1;
        Cassidy;
    }
    conditions {
        Is Using Ultimate(Event Player) == True;
        (Event Player).Talent1 == True;
    }
    actions {
        Wait(0.2, Ignore Condition);
        Set Player Variable(Event Player, Ability_Countdown, False);
        Chase Player Variable At Rate(Event Player, Ability_Countdown, 9999, 100, Destination and Rate);
        Wait(0.5, Ignore Condition);
        Chase Player Variable At Rate(Event Player, Ability_Countdown, 9999, 275, Destination and Rate);
        Wait(0.5, Ignore Condition);
        Chase Player Variable At Rate(Event Player, Ability_Countdown, 9999, 550, Destination and Rate);
    }
}

rule ("Cassidy: Standoff - Set root") {
    event {
        Ongoing - Each Player;
        Team 1;
        Cassidy;
    }
    conditions {
        Is Using Ultimate(Event Player) == True;
        (Event Player).Talent1 == True;
    }
    actions {
        Wait(0.2, Ignore Condition);
        For Player Variable(Event Player, i, 0, 5, 1);
            Wait(1, Abort When False);
            Play Effect(Event Player, Explosion Sound, Color(White), Event Player, 15);
            Set Status(Filtered Array(Players in View Angle(Event Player, Team 2, 103), And(Compare(Health(Current Array Element), <=, (Event Player).Ability_Countdown), Is In Line of Sight(Event Player, Current Array Element, Barriers Do Not Block LOS))), Event Player, Rooted, 2);
        End;
        Stop Chasing Player Variable(Event Player, Ability_Countdown);
    }
}

rule ("Cassidy: Flashpoint") {
    event {
        Player Dealt Damage;
        Team 1;
        Cassidy;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Ability 2)));
        If(Compare(Event Damage, <=, 25));
            Wait(1.25, Ignore Condition);
            Damage(Players Within Radius(Victim, 8, Team 2, Surfaces), Event Player, 35);
            Set Status(Players Within Radius(Victim, 8, Team 2, Surfaces), Event Player, Stunned, 2);
    }
}

rule ("Wrecking Ball: Orbital Strike") {
    event {
        Ongoing - Each Player;
        Team 1;
        Wrecking Ball;
    }
    conditions {
        (Event Player).Talent1 == True;
        Ability Cooldown(Event Player, Button(Crouch)) >= 0.1;
    }
    actions {
        Set Player Variable(Event Player, Ability_Countdown, Multiply(Altitude Of(Event Player), 10));
        Modify Player Variable(Event Player, Damage_Dealt, Add, (Event Player).Ability_Countdown);
        Wait Until(Or(Is On Ground(Event Player), Is Dead(Event Player)), 9999);
        Wait(1, Ignore Condition);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, (Event Player).Ability_Countdown);
    }
}

rule ("[Wrecking Ball] Orbital Strike") {
    event {
        Player Dealt Knockback;
        Team 1;
        Wrecking Ball;
    }
    actions {
        Abort If(Not((Event Player).Talent1));
        Abort If(Compare(Event Ability, !=, Button(Crouch)));
        Set Status(Victim, Null, Stunned, 1.1);
    }
}

rule ("Wrecking Ball: Distort") {
    event {
        Ongoing - Each Player;
        Team 1;
        Wrecking Ball;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Using Ability 2(Event Player) == True;
    }
    actions {
        For Player Variable(Event Player, i, False, 4, 1);
            Play Effect(All Players(All Teams), Ring Explosion, Color(Purple), Position Of(Event Player), 20);
            Damage(Players Within Radius(Event Player, 10, Team 2, Surfaces), Event Player, 25);
            Set Status(Players Within Radius(Event Player, 10, Team 2, Surfaces), Event Player, Hacked, 2);
            Wait(0.1, Ignore Condition);
        End;
    }
}

rule ("[Queen] Shout Very Loudly") {
    event {
        Ongoing - Each Player;
        Team 1;
        Junker Queen;
    }
    conditions {
        (Event Player).Talent1 == True;
        Is Using Ability 1(Event Player) == True;
    }
    actions {
        Start Damage Over Time(Remove From Array(Players Within Radius(Event Player, 15, Team 2, Surfaces), Event Player), Event Player, 5, 8);
        Start Heal Over Time(Event Player, Event Player, 5, Multiply(8, Count Of(Players Within Radius(Event Player, 15, Team 2, Surfaces))));
    }
}

rule ("[Queen] Grace Period") {
    event {
        Player Dealt Knockback;
        Team 1;
        Junker Queen;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Compare(Event Ability, !=, Button(Secondary Fire)));
        Abort If(Is Meleeing(Event Player));
        Damage(Players Within Radius(Victim, 6, Team 2, Surfaces), Event Player, 50);
        Heal(Event Player, Event Player, 50);
        Start Damage Over Time(Players Within Radius(Victim, 6, Team 2, Surfaces), Event Player, 3, 25);
        Start Heal Over Time(Event Player, Event Player, 3, 25);
        Apply Impulse(Remove From Array(Players Within Radius(Victim, 6, Team 2, Surfaces), Victim), Direction Towards(Victim, Event Player), 20, To World, Cancel Contrary Motion);
        Apply Impulse(Remove From Array(Players Within Radius(Victim, 6, Team 2, Surfaces), Victim), Up, 6, To World, Cancel Contrary Motion);
        Set Status(Players Within Radius(Victim, 6, Team 2, Surfaces), Null, Rooted, 0.8);
    }
}

rule ("Kiriko: Shinobi Tactics") {
    event {
        Player Dealt Healing;
        Team 1;
        Kiriko;
    }
    actions {
        Abort If(Not((Event Player).Talent1));
        Damage(Players Within Radius(Healee, 6, Team 2, Surfaces), Event Player, Multiply(Event Healing, 2));
    }
}

rule ("Kiriko: Recession") {
    event {
        Player Dealt Knockback;
        Team 1;
        Kiriko;
    }
    conditions {
        (Event Player).Talent2 == True;
        Event Ability == Button(Ability 2);
    }
    actions {
        Damage(Victim, Event Player, 75);
        Set Status(Victim, Event Player, Frozen, 1.5);
        Play Effect(All Players(All Teams), Good Explosion, Color(Gray), Victim, 1);
    }
}

rule ("Ramattra: Vile Dominance") {
    event {
        Ongoing - Each Player;
        Team 1;
        Ramattra;
    }
    conditions {
        (Event Player).Talent1 == True;
        Or(Is Using Ability 1(Event Player), Is Using Ultimate(Event Player)) == True;
    }
    actions {
        Modify Player Variable(Event Player, Move_Speed, Add, 30);
        Set Player Variable(Event Player, Ability_Active, True);
        Wait Until(Not(And(Or(Is Using Ability 1(Event Player), Is Using Ultimate(Event Player)), (Event Player).Talent1)), 9999);
        Modify Player Variable(Event Player, Move_Speed, Subtract, 30);
        Set Player Variable(Event Player, Ability_Active, False);
    }
}

rule ("Ramattra: Vile Dominance") {
    event {
        Player Dealt Damage;
        Team 1;
        Ramattra;
    }
    actions {
        Abort If(Not((Event Player).Ability_Active));
        Abort If(Compare(Event Ability, ==, Null));
        Abort If(Compare(Event Ability, ==, Button(Ability 2)));
        Abort If(Compare(Event Ability, ==, Button(Ultimate)));
        Set Status(Victim, Event Player, Rooted, 0.75);
    }
}

rule ("Ramattra: Nether Sector") {
    event {
        Player Dealt Damage;
        Team 1;
        Ramattra;
    }
    actions {
        Abort If(Not((Event Player).Talent2));
        Abort If(Not(Is On Ground(Event Player)));
        Abort If(Compare(Event Ability, !=, Button(Ability 2)));
        Heal(Event Player, Event Player, 20);
        Set Ultimate Charge(Event Player, Add(Ultimate Charge Percent(Event Player), 1));
        Wait(0.1, Ignore Condition);
    }
}

rule ("Lifeweaver: Autumn Blossoms") {
    event {
        Player Earned Elimination;
        Team 1;
        Lifeweaver;
    }
    conditions {
        (Event Player).Talent1 == True;
    }
    actions {
        Create Projectile(Zarya Particle Cannon, Null, Add(Position Of(Victim), Vector(0, 0.5, 0)), Up, To World, Heal, Team 1, Max Health(Victim), 1, 0, Bad Explosion, Explosion Sound, 0.025, 0, 8, 0, 0, 0);
    }
}

rule ("Team 1 Lifeweaver: Increased damage") {
    event {
        Ongoing - Each Player;
        Team 1;
        Lifeweaver;
    }
    actions {
        Modify Player Variable(Event Player, Damage_Dealt, Add, 30);
        Wait Until(Or(Compare((Event Player).perk_mystery_swap, >=, Add(Total Time Elapsed, 90)), Not((Event Player).Talent1)), 99999);
        Modify Player Variable(Event Player, Damage_Dealt, Subtract, 30);
    }
}

rule ("Lifeweaver: Pressure Therapy") {
    event {
        Ongoing - Each Player;
        Team 1;
        Lifeweaver;
    }
    conditions {
        (Event Player).Talent2 == True;
        Is Alive(Event Player) == True;
    }
    actions {
        Wait(0.5, Abort When False);
        Start Damage Modification(Filtered Array(All Players(Team 2), Or(Compare(Subtract(Y Component Of(Position Of(Event Player)), Y Component Of(Position Of(Current Array Element))), >=, 3), Compare(Dot Product(Facing Direction Of(Current Array Element), Vector Towards(Current Array Element, Event Player)), <, 0))), Event Player, 150, Receivers Damagers and Damage Percent);
        Set Player Variable At Index(Event Player, damage_mod, 1, Last Damage Modification ID);
        Wait Until(Or(Not((Event Player).Talent2), Is Dead(Event Player)), 99999);
        Stop Damage Modification(Value In Array((Event Player).damage_mod, 1));
        Wait(0.1, Ignore Condition);
        Loop If Condition Is True;
    }
}

